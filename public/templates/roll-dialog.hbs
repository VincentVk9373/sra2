<div class="roll-dialog-content">
    <header class="roll-dialog-header">
        <div class="attacker-info">
            {{#if actor}}
            <img class="attacker-portrait" src="{{actor.img}}" alt="{{actor.name}}" title="{{actor.name}}" />
            <div class="attacker-name">{{actor.name}}</div>
            {{else}}
            <div class="attacker-portrait-placeholder">
                <i class="fas fa-user"></i>
            </div>
            <div class="attacker-name">{{rollData.actorName}}</div>
            {{/if}}
        </div>
        <!-- Additional Info -->
        {{#if rollData.itemName}}
        <section class="roll-section item-section">
            <h3 class="section-title">
                <i class="fas fa-sword"></i> Action
            </h3>
            <div class="item-display">
                <div class="item-name">{{rollData.itemName}}</div>
                {{#if rollData.damageValue}}
                <div class="item-damage">Dégâts: {{rollData.damageValue}}</div>
                {{/if}}
            </div>
        </section>
        {{/if}}
        <!-- Target Information -->
        <section class="roll-section target-section">
            <h3 class="section-title">
                <i class="fas fa-bullseye"></i> Cible
                {{#if distanceText}}
                <div class="target-distance"> | 
                    <i class="fas fa-ruler"></i>  {{distanceText}}
                </div>
                {{/if}}
            </h3>
            <div class="target-display">
                {{#if targetToken}}
                <div class="target-info">
                    <img class="target-portrait" src="{{targetToken.actor.img}}" alt="{{targetToken.actor.name}}"
                        title="{{targetToken.actor.name}}" />
                    <div class="target-name">{{targetToken.actor.name}}</div>
                </div>
                {{else}}
                <div class="target-info no-target">
                    <div class="target-placeholder">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="target-name">Aucune cible</div>
                </div>
                {{/if}}
            </div>
        </section>
        <!-- Roll Dice Button -->
        <div class="roll-dice-section">
            <button type="button" class="roll-dice-button">
                <i class="fas fa-dice"></i> Lancer les Dés
            </button>
        </div>

    </header>

    <div class="roll-dialog-body">
        <!-- Skill Selection -->
        <section class="roll-section skill-section">
            <h3 class="section-title">
                <i class="fas fa-book"></i> Compétence
            </h3>
            <div class="skill-display">
                {{#if dropdownOptions}}
                <select class="skill-dropdown" name="skill-select" {{#if hasThreshold}}disabled{{/if}}>
                    <option value="">-- Sélectionner --</option>
                    {{#each dropdownOptions}}
                    <option value="{{value}}" {{#if (eq value ../selectedValue)}}selected{{/if}}>{{label}}</option>
                    {{/each}}
                </select>
                {{else}}
                <div class="selected-skill">
                    <span class="skill-name">{{skillDisplayName}}</span>
                    {{#if rollData.specName}}
                    <span class="skill-type">(Spécialisation)</span>
                    {{else if rollData.skillName}}
                    <span class="skill-type">(Compétence)</span>
                    {{/if}}
                </div>
                {{/if}}
            </div>
        </section>

        <!-- Dice Pool or Threshold -->
        <section class="roll-section dice-section">
            <h3 class="section-title">
                {{#if hasThreshold}}
                <i class="fas fa-bullseye"></i> Seuil
                {{else}}
                <i class="fas fa-dice"></i> Pool de Dés | {{dicePool}} dés{{#if riskDiceCount}} <span class="risk-dice-count">| {{riskDiceCount}} dés de risque</span>{{/if}}
                {{/if}}
            </h3>
            <div class="dice-pool-display">
                {{#if hasThreshold}}
                <div class="threshold-count">
                    <span class="threshold-number">{{threshold}}</span>
                    <span class="threshold-label">seuil</span>
                </div>
                {{else}}
                <div class="dice-list-container">
                    <div class="dice-list">
                        {{#each diceList}}
                        <div class="dice-icon {{#if this.isRiskDice}}risk-dice{{/if}} dice-{{this.riskColor}}" data-dice-index="{{this.index}}" style="cursor: pointer;" title="{{#if this.isRiskDice}}Dé de risque{{else}}Dé normal{{/if}}" data-risk-color="{{this.riskColor}}">
                            <i class="fas fa-dice"></i>
                        </div>
                        {{/each}}
                    </div>
                </div>
                {{/if}}
            </div>
        </section>

        <!-- VD and RR Summary -->
        <section class="roll-section summary-section">
            <h3 class="section-title">
                <i class="fas fa-info-circle"></i> Réduction de risque | {{totalRR}} RR
            </h3>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">RR</div>
                    <div class="summary-value">{{totalRR}}</div>
                </div>
            {{#if rrSources.length}}
            <div class="rr-sources">
                <ul class="rr-sources-list">
                    {{#each rrSources}}
                    <li class="rr-source-item">
                        <label class="rr-checkbox-label">
                            <input type="checkbox" class="rr-checkbox" data-rr-id="{{this.id}}" {{#if this.enabled}}checked{{/if}} />
                            <span class="rr-source-name">{{this.featName}}</span>
                            <span class="rr-source-value">+{{this.rrValue}}</span>
                        </label>
                    </li>
                    {{/each}}
                </ul>
            </div>
            {{/if}}
            </div>
        </section>


    </div>
</div>