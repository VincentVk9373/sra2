<form class="{{cssClass}} sra2-item-sheet" autocomplete="off">
  <header class="sheet-header">
    <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}" />
    <div class="header-fields">
      <h1 class="item-name"><input name="name" type="text" value="{{item.name}}" placeholder="{{localize 'SRA2.FEATS.NAME'}}"/></h1>
    </div>
  </header>

  <section class="sheet-body">
    <!-- Recommended Level Display -->
    <div class="form-group recommended-level-display">
      <label>{{localize "SRA2.FEATS.RECOMMENDED_LEVEL"}}</label>
      <div class="recommended-level-value">{{#if (or system.recommendedLevel (eq system.recommendedLevel 0))}}{{system.recommendedLevel}}{{else}}0{{/if}}</div>
      <p class="notes">{{localize "SRA2.FEATS.RECOMMENDED_LEVEL_HINT"}}</p>
      
      {{#if system.recommendedLevelBreakdown}}
        {{#if (gt system.recommendedLevelBreakdown.length 0)}}
        <div class="recommended-level-breakdown">
          <h4>{{localize "SRA2.FEATS.BREAKDOWN_TITLE"}}</h4>
          <ul>
            {{#each system.recommendedLevelBreakdown}}
            <li>
              <span class="breakdown-label">{{localize this.labelKey}}{{#if this.labelParams}} {{this.labelParams}}{{/if}}</span>
              <span class="breakdown-value">{{#if (gte this.value 0)}}+{{/if}}{{this.value}}</span>
            </li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
      {{/if}}
    </div>

    <!-- Rating -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.RATING"}}</label>
      <input type="number" name="system.rating" value="{{system.rating}}" min="0" />
    </div>

    <!-- Feat Type -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.FEAT_TYPE.LABEL"}}</label>
      <select name="system.featType">
        <option value="trait" {{#if (eq system.featType "trait")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.TRAIT"}}</option>
        <option value="contact" {{#if (eq system.featType "contact")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.CONTACT"}}</option>
        <option value="awakened" {{#if (eq system.featType "awakened")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.AWAKENED"}}</option>
        <option value="adept-power" {{#if (eq system.featType "adept-power")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.ADEPT_POWER"}}</option>
        <option value="equipment" {{#if (eq system.featType "equipment")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.EQUIPMENT"}}</option>
        <option value="cyberware" {{#if (eq system.featType "cyberware")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.CYBERWARE"}}</option>
        <option value="cyberdeck" {{#if (eq system.featType "cyberdeck")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.CYBERDECK"}}</option>
        <option value="vehicle" {{#if (eq system.featType "vehicle")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.VEHICLE"}}</option>
        <option value="weapons-spells" {{#if (eq system.featType "weapons-spells")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.WEAPONS_SPELLS"}}</option>
        <option value="weapon" {{#if (eq system.featType "weapon")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.WEAPON"}}</option>
        <option value="spell" {{#if (eq system.featType "spell")}}selected{{/if}}>{{localize "SRA2.FEATS.FEAT_TYPE.SPELL"}}</option>
      </select>
    </div>

    <!-- Cost -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.COST.LABEL"}}</label>
      <select name="system.cost">
        <option value="free-equipment" {{#if (eq system.cost "free-equipment")}}selected{{/if}}>{{localize "SRA2.FEATS.COST.FREE_EQUIPMENT"}}</option>
        <option value="equipment" {{#if (eq system.cost "equipment")}}selected{{/if}}>{{localize "SRA2.FEATS.COST.EQUIPMENT"}}</option>
        <option value="specialized-equipment" {{#if (eq system.cost "specialized-equipment")}}selected{{/if}}>{{localize "SRA2.FEATS.COST.SPECIALIZED_EQUIPMENT"}}</option>
        <option value="feat" {{#if (eq system.cost "feat")}}selected{{/if}}>{{localize "SRA2.FEATS.COST.FEAT"}}</option>
      </select>
    </div>

    <!-- Active -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.ACTIVE"}}</label>
      <input type="checkbox" name="system.active" {{checked system.active}} />
    </div>

    <!-- Bonus Light Damage -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.BONUS_LIGHT_DAMAGE"}}</label>
      <input type="number" name="system.bonusLightDamage" value="{{system.bonusLightDamage}}" min="0" />
    </div>

    <!-- Bonus Severe Damage -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.BONUS_SEVERE_DAMAGE"}}</label>
      <input type="number" name="system.bonusSevereDamage" value="{{system.bonusSevereDamage}}" min="0" />
    </div>

    <!-- Bonus Physical Threshold -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.BONUS_PHYSICAL_THRESHOLD"}}</label>
      <input type="number" name="system.bonusPhysicalThreshold" value="{{system.bonusPhysicalThreshold}}" />
      <p class="notes">{{localize "SRA2.FEATS.BONUS_PHYSICAL_THRESHOLD_HINT"}}</p>
    </div>

    <!-- Bonus Mental Threshold -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.BONUS_MENTAL_THRESHOLD"}}</label>
      <input type="number" name="system.bonusMentalThreshold" value="{{system.bonusMentalThreshold}}" />
      <p class="notes">{{localize "SRA2.FEATS.BONUS_MENTAL_THRESHOLD_HINT"}}</p>
    </div>

    <!-- Bonus Anarchy -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.BONUS_ANARCHY"}}</label>
      <input type="number" name="system.bonusAnarchy" value="{{system.bonusAnarchy}}" min="0" />
      <p class="notes">{{localize "SRA2.FEATS.BONUS_ANARCHY_HINT"}}</p>
    </div>

    <!-- Additional Sustained Spells -->
    <div class="form-group sustained-spell-group">
      <label>{{localize "SRA2.FEATS.SUSTAINED_SPELLS"}}</label>
      <p class="notes">{{localize "SRA2.FEATS.SUSTAINED_SPELLS_HINT"}}</p>
      <!-- Hidden input to store the actual value -->
      <input type="hidden" name="system.sustainedSpellCount" value="{{system.sustainedSpellCount}}" data-dtype="Number" />
      <div class="bonus-checkboxes">
        <label class="bonus-checkbox-label">
          <input type="checkbox" class="sustained-spell-checkbox" data-spell-value="1" {{#if (gte system.sustainedSpellCount 1)}}checked{{/if}} />
          <span>{{localize "SRA2.FEATS.SUSTAINED_SPELL_1"}}</span>
        </label>
        <label class="bonus-checkbox-label">
          <input type="checkbox" class="sustained-spell-checkbox" data-spell-value="2" {{#if (eq system.sustainedSpellCount 2)}}checked{{/if}} />
          <span>{{localize "SRA2.FEATS.SUSTAINED_SPELL_2"}}</span>
        </label>
      </div>
    </div>

    <!-- Additional Summoned Spirit -->
    <div class="form-group summoned-spirit-group">
      <label>{{localize "SRA2.FEATS.SUMMONED_SPIRIT"}}</label>
      <p class="notes">{{localize "SRA2.FEATS.SUMMONED_SPIRIT_HINT"}}</p>
      <!-- Hidden input to store the actual value -->
      <input type="hidden" name="system.summonedSpiritCount" value="{{system.summonedSpiritCount}}" data-dtype="Number" />
      <div class="bonus-checkboxes">
        <label class="bonus-checkbox-label">
          <input type="checkbox" class="summoned-spirit-checkbox" {{#if (eq system.summonedSpiritCount 1)}}checked{{/if}} />
          <span>{{localize "SRA2.FEATS.SUMMONED_SPIRIT_1"}}</span>
        </label>
      </div>
    </div>

    <!-- Grants Narration -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.GRANTS_NARRATION"}}</label>
      <input type="checkbox" name="system.grantsNarration" {{checked system.grantsNarration}} />
      <p class="notes">{{localize "SRA2.FEATS.GRANTS_NARRATION_HINT"}}</p>
    </div>

    <!-- Narration Actions -->
    {{#if system.grantsNarration}}
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.NARRATION_ACTIONS"}}</label>
      <select name="system.narrationActions">
        <option value="1" {{#if (eq system.narrationActions 1)}}selected{{/if}}>1 {{localize "SRA2.FEATS.NARRATION_ACTION"}}</option>
        <option value="2" {{#if (eq system.narrationActions 2)}}selected{{/if}}>2 {{localize "SRA2.FEATS.NARRATION_ACTIONS_LABEL"}}</option>
      </select>
      <p class="notes">{{localize "SRA2.FEATS.NARRATION_ACTIONS_HINT"}}</p>
    </div>
    {{/if}}

    <!-- Rigger Console Count -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.RIGGER_CONSOLE_COUNT"}}</label>
      <input type="number" name="system.riggerConsoleCount" value="{{system.riggerConsoleCount}}" min="0" />
      <p class="notes">{{localize "SRA2.FEATS.RIGGER_CONSOLE_COUNT_HINT"}}</p>
    </div>

    <!-- Vehicle Control Wiring -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.HAS_VEHICLE_CONTROL_WIRING"}}</label>
      <input type="checkbox" name="system.hasVehicleControlWiring" {{checked system.hasVehicleControlWiring}} />
      <p class="notes">{{localize "SRA2.FEATS.HAS_VEHICLE_CONTROL_WIRING_HINT"}}</p>
    </div>

    <!-- Essence Cost (Cyberware/Bioware only) -->
    {{#if (eq system.featType "cyberware")}}
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.ESSENCE_COST"}}</label>
      <input type="number" name="system.essenceCost" value="{{system.essenceCost}}" min="0" />
    </div>
    {{/if}}

    <!-- Risk Reduction Entries -->
    <div class="rr-entries-section">
      <h3>{{localize "SRA2.FEATS.RR_ENTRIES"}}</h3>
      <button type="button" data-action="add-rr-entry" title="{{localize 'SRA2.FEATS.ADD_RR_ENTRY'}}" class="add-entry-button">
        <i class="fas fa-plus"></i> {{localize "SRA2.FEATS.ADD_RR_ENTRY"}}
      </button>
      
      <div class="rr-entries-container">
        {{#if rrEntries}}
          {{#each rrEntries}}
          <div class="rr-entry" data-rr-index="{{index}}">
            <div class="rr-entry-header">
              <span class="entry-number">{{localize "SRA2.FEATS.RR_ENTRY_NUMBER"}} {{add index 1}}</span>
              <button type="button" data-action="remove-rr-entry" data-index="{{index}}" title="{{localize 'SRA2.FEATS.REMOVE_RR_ENTRY'}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <!-- RR Type -->
            <div class="form-group">
              <label>{{localize "SRA2.FEATS.RR_TYPE.LABEL"}}</label>
              <select name="system.rrList.{{index}}.rrType">
                <option value="skill" {{#if (eq rrType "skill")}}selected{{/if}}>{{localize "SRA2.FEATS.RR_TYPE.SKILL"}}</option>
                <option value="attribute" {{#if (eq rrType "attribute")}}selected{{/if}}>{{localize "SRA2.FEATS.RR_TYPE.ATTRIBUTE"}}</option>
                <option value="specialization" {{#if (eq rrType "specialization")}}selected{{/if}}>{{localize "SRA2.FEATS.RR_TYPE.SPECIALIZATION"}}</option>
              </select>
            </div>

            <!-- RR Value -->
            <div class="form-group">
              <label>{{localize "SRA2.FEATS.RR_VALUE"}}</label>
              <input type="number" name="system.rrList.{{index}}.rrValue" value="{{rrValue}}" min="0" max="3" />
            </div>

            <!-- RR Target -->
            <div class="form-group">
              <label>{{localize "SRA2.FEATS.RR_TARGET"}}</label>
              {{#if (eq rrType "attribute")}}
                <select name="system.rrList.{{index}}.rrTarget">
                  <option value="">{{localize "SRA2.FEATS.RR_TARGET_SELECT"}}</option>
                  <option value="strength" {{#if (eq rrTarget "strength")}}selected{{/if}}>{{localize "SRA2.ATTRIBUTES.STRENGTH"}}</option>
                  <option value="agility" {{#if (eq rrTarget "agility")}}selected{{/if}}>{{localize "SRA2.ATTRIBUTES.AGILITY"}}</option>
                  <option value="willpower" {{#if (eq rrTarget "willpower")}}selected{{/if}}>{{localize "SRA2.ATTRIBUTES.WILLPOWER"}}</option>
                  <option value="logic" {{#if (eq rrTarget "logic")}}selected{{/if}}>{{localize "SRA2.ATTRIBUTES.LOGIC"}}</option>
                  <option value="charisma" {{#if (eq rrTarget "charisma")}}selected{{/if}}>{{localize "SRA2.ATTRIBUTES.CHARISMA"}}</option>
                </select>
              {{else}}
                <!-- Hidden input to preserve rrTarget value for non-attribute types -->
                <input type="hidden" name="system.rrList.{{index}}.rrTarget" value="{{rrTarget}}" />
                <!-- Drop Zone for Skills/Specializations -->
                <div class="rr-target-drop-zone" data-rr-index="{{index}}">
                  {{#if rrTargetName}}
                    <div class="rr-target-display {{#if rrTargetNotFound}}warning{{/if}}">
                      {{#if rrTargetNotFound}}
                        <i class="fas fa-exclamation-triangle"></i>
                      {{else}}
                        <i class="fas fa-link"></i>
                      {{/if}}
                      <span class="target-name">{{rrTargetName}}</span>
                      <span class="target-type">({{rrTargetType}})</span>
                      {{#if rrTargetNotFound}}
                        <span class="warning-badge" title="{{localize 'SRA2.FEATS.TARGET_NOT_FOUND_ON_ACTOR'}}">⚠️</span>
                      {{/if}}
                      <a class="clear-link" data-action="clear-rr-target" data-index="{{index}}" title="{{localize 'SRA2.FEATS.CLEAR_RR_TARGET'}}">
                        <i class="fas fa-times"></i>
                      </a>
                    </div>
                  {{else}}
                    <div class="drop-zone-hint">
                      <i class="fas fa-hand-pointer"></i>
                      <p>{{localize "SRA2.FEATS.DROP_TARGET_HERE"}}</p>
                    </div>
                  {{/if}}
                </div>
              {{/if}}
            </div>
          </div>
          {{/each}}
        {{else}}
          <p class="no-entries">{{localize "SRA2.FEATS.NO_RR_ENTRIES"}}</p>
        {{/if}}
      </div>
    </div>

    <!-- Weapon/Weapons-Spells Specific Fields -->
    {{#if (or (eq system.featType "weapon") (eq system.featType "weapons-spells"))}}
    <div class="weapon-fields-section">
      <h3>{{localize "SRA2.FEATS.WEAPON.SECTION_TITLE"}}</h3>
      
      <!-- Weapon Focus -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.IS_WEAPON_FOCUS"}}</label>
        <input type="checkbox" name="system.isWeaponFocus" {{checked system.isWeaponFocus}} />
        <p class="notes">{{localize "SRA2.FEATS.IS_WEAPON_FOCUS_HINT"}}</p>
      </div>

      <!-- Weapon Type Selection -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.WEAPON.WEAPON_TYPE"}}</label>
        <select name="system.weaponType" data-action="select-weapon-type">
          <option value="">{{localize "SRA2.FEATS.WEAPON.SELECT_WEAPON"}}</option>
          <option value="bare-hands" {{#if (eq system.weaponType "bare-hands")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.BARE_HANDS"}}</option>
          <option value="short-weapons" {{#if (eq system.weaponType "short-weapons")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.SHORT_WEAPONS"}}</option>
          <option value="long-weapons" {{#if (eq system.weaponType "long-weapons")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.LONG_WEAPONS"}}</option>
          <option value="advanced-melee" {{#if (eq system.weaponType "advanced-melee")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.ADVANCED_MELEE"}}</option>
          <option value="throwing" {{#if (eq system.weaponType "throwing")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.THROWING"}}</option>
          <option value="bows" {{#if (eq system.weaponType "bows")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.BOWS"}}</option>
          <option value="crossbows" {{#if (eq system.weaponType "crossbows")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.CROSSBOWS"}}</option>
          <option value="tasers" {{#if (eq system.weaponType "tasers")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.TASERS"}}</option>
          <option value="pocket-pistols" {{#if (eq system.weaponType "pocket-pistols")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.POCKET_PISTOLS"}}</option>
          <option value="light-pistols" {{#if (eq system.weaponType "light-pistols")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.LIGHT_PISTOLS"}}</option>
          <option value="automatic-pistols" {{#if (eq system.weaponType "automatic-pistols")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.AUTOMATIC_PISTOLS"}}</option>
          <option value="heavy-pistols" {{#if (eq system.weaponType "heavy-pistols")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.HEAVY_PISTOLS"}}</option>
          <option value="smgs" {{#if (eq system.weaponType "smgs")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.SMGS"}}</option>
          <option value="assault-rifles" {{#if (eq system.weaponType "assault-rifles")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.ASSAULT_RIFLES"}}</option>
          <option value="shotguns" {{#if (eq system.weaponType "shotguns")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.SHOTGUNS"}}</option>
          <option value="sniper-rifles" {{#if (eq system.weaponType "sniper-rifles")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.SNIPER_RIFLES"}}</option>
          <option value="machine-guns" {{#if (eq system.weaponType "machine-guns")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.MACHINE_GUNS"}}</option>
          <option value="grenades" {{#if (eq system.weaponType "grenades")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.GRENADES"}}</option>
          <option value="gas-grenades" {{#if (eq system.weaponType "gas-grenades")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.GAS_GRENADES"}}</option>
          <option value="grenade-launchers" {{#if (eq system.weaponType "grenade-launchers")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.GRENADE_LAUNCHERS"}}</option>
          <option value="rocket-launchers" {{#if (eq system.weaponType "rocket-launchers")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.TYPES.ROCKET_LAUNCHERS"}}</option>
        </select>
      </div>

      <!-- Weapon Info Display -->
      {{#if system.weaponType}}
      <div class="form-group weapon-info-display">
        <label>{{localize "SRA2.FEATS.WEAPON.INFO"}}</label>
        <div class="weapon-stats">
          <span class="stat-label">{{localize "SRA2.FEATS.WEAPON.DAMAGE_VALUE_SHORT"}}:</span>
          <span class="stat-value">{{finalDamageValue}}</span>
          <span class="stat-separator">/</span>
          <span class="stat-label">{{localize "SRA2.FEATS.WEAPON.MELEE_SHORT"}}:</span>
          <span class="stat-value">{{#if (eq system.meleeRange "ok")}}OK{{else}}{{#if (eq system.meleeRange "dice")}}Dés{{else}}-{{/if}}{{/if}}</span>
          <span class="stat-separator">/</span>
          <span class="stat-label">{{localize "SRA2.FEATS.WEAPON.SHORT_SHORT"}}:</span>
          <span class="stat-value">{{#if (eq system.shortRange "ok")}}OK{{else}}{{#if (eq system.shortRange "dice")}}Dés{{else}}-{{/if}}{{/if}}</span>
          <span class="stat-separator">/</span>
          <span class="stat-label">{{localize "SRA2.FEATS.WEAPON.MEDIUM_SHORT"}}:</span>
          <span class="stat-value">{{#if (eq system.mediumRange "ok")}}OK{{else}}{{#if (eq system.mediumRange "dice")}}Dés{{else}}-{{/if}}{{/if}}</span>
          <span class="stat-separator">/</span>
          <span class="stat-label">{{localize "SRA2.FEATS.WEAPON.LONG_SHORT"}}:</span>
          <span class="stat-value">{{#if (eq system.longRange "ok")}}OK{{else}}{{#if (eq system.longRange "dice")}}Dés{{else}}-{{/if}}{{/if}}</span>
        </div>
      </div>
      {{/if}}
      
      <!-- Damage Value (VD) -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.WEAPON.DAMAGE_VALUE"}}</label>
        <div class="damage-value-display">
          <input type="text" name="system.damageValue" value="{{system.damageValue}}" {{#if system.weaponType}}disabled{{/if}} />
          {{#if system.weaponType}}
            <div class="calculated-damage">
              <span class="label-small">{{localize "SRA2.FEATS.WEAPON.FINAL_VALUE"}}:</span>
              <span class="value-display">{{finalDamageValue}}</span>
            </div>
            {{#unless item.actor}}
              <p class="notes warning-note">
                <i class="fas fa-info-circle"></i>
                {{localize "SRA2.FEATS.WEAPON.NEEDS_ACTOR_FOR_CALCULATION"}}
              </p>
            {{/unless}}
          {{/if}}
        </div>
      </div>

      <!-- Damage Value Bonus -->
      <div class="form-group damage-value-bonus-group">
        <label>{{localize "SRA2.FEATS.WEAPON.DAMAGE_VALUE_BONUS"}}</label>
        <p class="notes">{{localize "SRA2.FEATS.WEAPON.DAMAGE_VALUE_BONUS_HINT"}}</p>
        <!-- Hidden input to store the actual value -->
        <input type="hidden" name="system.damageValueBonus" value="{{system.damageValueBonus}}" data-dtype="Number" />
        <div class="bonus-checkboxes">
          <label class="bonus-checkbox-label">
            <input type="checkbox" class="damage-bonus-checkbox" data-bonus-value="1" {{#if (gte system.damageValueBonus 1)}}checked{{/if}} />
            <span>{{localize "SRA2.FEATS.WEAPON.BONUS_1"}}</span>
          </label>
          <label class="bonus-checkbox-label">
            <input type="checkbox" class="damage-bonus-checkbox" data-bonus-value="2" {{#if (eq system.damageValueBonus 2)}}checked{{/if}} />
            <span>{{localize "SRA2.FEATS.WEAPON.BONUS_2"}}</span>
          </label>
        </div>
      </div>

      <!-- Ranges -->
      <div class="form-group ranges-group">
        <label>{{localize "SRA2.FEATS.WEAPON.RANGES"}}</label>
        
        <div class="range-row">
          <span class="range-label">{{localize "SRA2.FEATS.WEAPON.MELEE_RANGE"}}</span>
          <select name="system.meleeRange">
            <option value="none" {{#if (eq system.meleeRange "none")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_NONE"}}</option>
            <option value="ok" {{#if (eq system.meleeRange "ok")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_OK"}}</option>
            <option value="dice" {{#if (eq system.meleeRange "dice")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_DICE"}}</option>
          </select>
        </div>

        <div class="range-row">
          <span class="range-label">{{localize "SRA2.FEATS.WEAPON.SHORT_RANGE"}}</span>
          <select name="system.shortRange">
            <option value="none" {{#if (eq system.shortRange "none")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_NONE"}}</option>
            <option value="ok" {{#if (eq system.shortRange "ok")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_OK"}}</option>
            <option value="dice" {{#if (eq system.shortRange "dice")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_DICE"}}</option>
          </select>
        </div>

        <div class="range-row">
          <span class="range-label">{{localize "SRA2.FEATS.WEAPON.MEDIUM_RANGE"}}</span>
          <select name="system.mediumRange">
            <option value="none" {{#if (eq system.mediumRange "none")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_NONE"}}</option>
            <option value="ok" {{#if (eq system.mediumRange "ok")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_OK"}}</option>
            <option value="dice" {{#if (eq system.mediumRange "dice")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_DICE"}}</option>
          </select>
        </div>

        <div class="range-row">
          <span class="range-label">{{localize "SRA2.FEATS.WEAPON.LONG_RANGE"}}</span>
          <select name="system.longRange">
            <option value="none" {{#if (eq system.longRange "none")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_NONE"}}</option>
            <option value="ok" {{#if (eq system.longRange "ok")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_OK"}}</option>
            <option value="dice" {{#if (eq system.longRange "dice")}}selected{{/if}}>{{localize "SRA2.FEATS.WEAPON.RANGE_DICE"}}</option>
          </select>
        </div>
      </div>
    </div>
    {{/if}}

    <!-- Spell Specific Fields -->
    {{#if (eq system.featType "spell")}}
    <div class="spell-fields-section">
      <h3>{{localize "SRA2.FEATS.SPELL.SECTION_TITLE"}}</h3>
      <p class="notes">{{localize "SRA2.FEATS.SPELL.SECTION_HINT"}}</p>
    </div>
    {{/if}}

    <!-- Vehicle/Drone Specific Fields -->
    {{#if (eq system.featType "vehicle")}}
    <div class="vehicle-fields-section">
      <h3>{{localize "SRA2.FEATS.VEHICLE.SECTION_TITLE"}}</h3>
      
      <!-- Autopilot -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.VEHICLE.AUTOPILOT"}}</label>
        <input type="number" name="system.autopilot" value="{{system.autopilot}}" min="0" />
      </div>

      <!-- Structure -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.VEHICLE.STRUCTURE"}}</label>
        <input type="number" name="system.structure" value="{{system.structure}}" min="0" />
      </div>

      <!-- Handling -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.VEHICLE.HANDLING"}}</label>
        <input type="number" name="system.handling" value="{{system.handling}}" min="0" />
      </div>

      <!-- Speed -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.VEHICLE.SPEED"}}</label>
        <input type="number" name="system.speed" value="{{system.speed}}" min="0" />
      </div>

      <!-- Armor -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.VEHICLE.ARMOR"}}</label>
        <input type="number" name="system.armor" value="{{system.armor}}" min="0" />
      </div>

      <!-- Weapon Info -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.VEHICLE.WEAPON_INFO"}}</label>
        <input type="text" name="system.weaponInfo" value="{{system.weaponInfo}}" placeholder="{{localize 'SRA2.FEATS.VEHICLE.WEAPON_INFO_PLACEHOLDER'}}" />
      </div>
    </div>
    {{/if}}

    <!-- Cyberdeck Specific Fields -->
    {{#if (eq system.featType "cyberdeck")}}
    <div class="cyberdeck-fields-section">
      <h3>{{localize "SRA2.FEATS.CYBERDECK.SECTION_TITLE"}}</h3>
      
      <!-- Firewall -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.CYBERDECK.FIREWALL"}}</label>
        <input type="number" name="system.firewall" value="{{system.firewall}}" min="0" />
      </div>

      <!-- Attack -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.CYBERDECK.ATTACK"}}</label>
        <input type="number" name="system.attack" value="{{system.attack}}" min="0" />
      </div>
    </div>
    {{/if}}

    <!-- Contact Specific Fields -->
    {{#if (eq system.featType "contact")}}
    <div class="contact-fields-section">
      <h3>{{localize "SRA2.FEATS.CONTACT.SECTION_TITLE"}}</h3>
      
      <!-- Contact Name -->
      <div class="form-group">
        <label>{{localize "SRA2.FEATS.CONTACT.NAME"}}</label>
        <input type="text" name="system.contactName" value="{{system.contactName}}" placeholder="{{localize 'SRA2.FEATS.CONTACT.NAME_PLACEHOLDER'}}" />
      </div>
    </div>
    {{/if}}

    <!-- Awakened Specific Fields -->
    {{#if (eq system.featType "awakened")}}
    <div class="awakened-fields-section">
      <h3>{{localize "SRA2.FEATS.AWAKENED.SECTION_TITLE"}}</h3>
      
      <!-- Astral Perception -->
      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" name="system.astralPerception" {{checked system.astralPerception}} />
          {{localize "SRA2.FEATS.AWAKENED.ASTRAL_PERCEPTION"}}
        </label>
      </div>

      <!-- Astral Projection -->
      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" name="system.astralProjection" {{checked system.astralProjection}} />
          {{localize "SRA2.FEATS.AWAKENED.ASTRAL_PROJECTION"}}
        </label>
      </div>

      <!-- Sorcery -->
      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" name="system.sorcery" {{checked system.sorcery}} />
          {{localize "SRA2.FEATS.AWAKENED.SORCERY"}}
        </label>
      </div>

      <!-- Conjuration -->
      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" name="system.conjuration" {{checked system.conjuration}} />
          {{localize "SRA2.FEATS.AWAKENED.CONJURATION"}}
        </label>
      </div>

      <!-- Adept -->
      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" name="system.adept" {{checked system.adept}} />
          {{localize "SRA2.FEATS.AWAKENED.ADEPT"}}
        </label>
      </div>
    </div>
    {{/if}}

    <!-- Narrative Effects -->
    <div class="narrative-effects-section">
      <h3>{{localize "SRA2.FEATS.NARRATIVE_EFFECTS"}}</h3>
      <button type="button" data-action="add-narrative-effect" title="{{localize 'SRA2.FEATS.ADD_NARRATIVE_EFFECT'}}" class="add-entry-button">
        <i class="fas fa-plus"></i> {{localize "SRA2.FEATS.ADD_NARRATIVE_EFFECT"}}
      </button>
      
      <div class="narrative-effects-container">
        {{#if system.narrativeEffects}}
          {{#each system.narrativeEffects}}
          <div class="narrative-effect-entry">
            <div class="narrative-effect-header">
              <span class="entry-number">{{localize "SRA2.FEATS.EFFECT_NUMBER"}} {{add @index 1}}</span>
              <button type="button" data-action="remove-narrative-effect" data-index="{{@index}}" title="{{localize 'SRA2.FEATS.REMOVE_NARRATIVE_EFFECT'}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="form-group">
              <textarea name="system.narrativeEffects.{{@index}}.text" placeholder="{{localize 'SRA2.FEATS.NARRATIVE_EFFECT_PLACEHOLDER'}}">{{this.text}}</textarea>
            </div>
            
            <div class="form-group narrative-effect-negative">
              <label>
                <input type="checkbox" name="system.narrativeEffects.{{@index}}.isNegative" {{checked this.isNegative}} />
                {{localize "SRA2.FEATS.NARRATIVE_EFFECT_NEGATIVE"}}
              </label>
              <p class="notes">{{localize "SRA2.FEATS.NARRATIVE_EFFECT_NEGATIVE_HINT"}}</p>
            </div>
          </div>
          {{/each}}
        {{else}}
          <p class="no-entries">{{localize "SRA2.FEATS.NO_NARRATIVE_EFFECTS"}}</p>
        {{/if}}
      </div>
    </div>

    <!-- Description -->
    <div class="form-group">
      <label>{{localize "SRA2.FEATS.DESCRIPTION"}}</label>
      <div class="editor-content">{{editor system.description target="system.description" button=true engine="prosemirror" collaborate=false}}</div>
    </div>
  </section>
</form>

