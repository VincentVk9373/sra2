<form class="{{cssClass}} sra2-npc-sheet" autocomplete="off">
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
    <div class="header-fields">
      <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'SRA2.NPC.NAME'}}"/></h1>
    </div>
  </header>

  <div class="sheet-content">
    <!-- Armes et Sorts Section -->
    {{#if (or weapons spells)}}
    <section class="npc-section weapons-spells-section">
      <h2><i class="fas fa-crosshairs"></i> {{localize "SRA2.NPC.SECTION.WEAPONS_SPELLS"}}</h2>
      
      {{#if weapons}}
        <div class="weapons-list">
          <h3><i class="fas fa-sword"></i> {{localize "SRA2.FEATS.FEAT_TYPE.WEAPON"}}</h3>
          <div class="skills-header">
            <div class="skill-header-name">{{localize "SRA2.FEATS.NAME"}}</div>
            <div class="skill-header-vd">{{localize "SRA2.FEATS.WEAPON.DAMAGE_VALUE_SHORT"}}</div>
            <div class="skill-header-dice">{{localize "SRA2.NPC.DICE_POOL"}}</div>
            <div class="skill-header-rr">{{localize "SRA2.NPC.RR"}}</div>
            <div class="skill-header-threshold">{{localize "SRA2.NPC.THRESHOLD"}}</div>
            <div class="skill-header-actions"></div>
          </div>
          {{#each weapons}}
          <div class="weapon-item npc-skill-item" data-item-id="{{this._id}}">
            <div class="weapon-name">
              <img class="weapon-img" src="{{this.img}}" alt="{{this.name}}" />
              <span>{{this.name}}</span>
            </div>
            <div class="weapon-vd">
              <span class="vd-value">{{this.finalDamageValue}}</span>
            </div>
            <div class="skill-dice-pool clickable" data-action="roll-npc-weapon-dice" data-item-id="{{this._id}}" data-weapon-vd="{{this.system.damageValue}}" title="{{localize 'SRA2.NPC.ROLL_WITH_DICE'}}">
              <span class="dice-value">{{this.totalDicePool}}</span>
              <i class="fas fa-dice-d6"></i>
            </div>
            <div class="skill-rr">
              <span class="rr-value">{{this.totalRR}}</span>
            </div>
            <div class="skill-threshold clickable" data-action="attack-threshold-weapon" data-item-id="{{this._id}}" data-threshold="{{this.npcThreshold}}" data-item-name="{{this.name}}" data-weapon-vd="{{this.system.damageValue}}" title="{{localize 'SRA2.NPC.ATTACK_WITH_THRESHOLD'}}">
              <span class="threshold-value">{{this.npcThreshold}}</span>
            </div>
            <div class="skill-controls">
              <a class="weapon-edit" data-action="edit-feat" data-item-id="{{this._id}}" title="{{localize 'SRA2.FEATS.EDIT'}}">
                <i class="fas fa-edit"></i>
              </a>
              <a class="weapon-delete" data-action="delete-feat" data-item-id="{{this._id}}" title="{{localize 'SRA2.FEATS.DELETE'}}">
                <i class="fas fa-trash"></i>
              </a>
            </div>
          </div>
          {{/each}}
        </div>
      {{/if}}
      
      {{#if spells}}
        <div class="spells-list">
          <h3><i class="fas fa-magic"></i> {{localize "SRA2.FEATS.FEAT_TYPE.SPELL"}}</h3>
          <div class="skills-header">
            <div class="skill-header-name">{{localize "SRA2.FEATS.NAME"}}</div>
            <div class="skill-header-vd">{{localize "SRA2.FEATS.WEAPON.DAMAGE_VALUE_SHORT"}}</div>
            <div class="skill-header-dice">{{localize "SRA2.NPC.DICE_POOL"}}</div>
            <div class="skill-header-rr">{{localize "SRA2.NPC.RR"}}</div>
            <div class="skill-header-threshold">{{localize "SRA2.NPC.THRESHOLD"}}</div>
            <div class="skill-header-actions"></div>
          </div>
          {{#each spells}}
          <div class="spell-item npc-skill-item" data-item-id="{{this._id}}">
            <div class="spell-name">
              <img class="spell-img" src="{{this.img}}" alt="{{this.name}}" />
              <span>{{this.name}}</span>
            </div>
            <div class="spell-vd">
              <span class="vd-value">{{this.finalDamageValue}}</span>
            </div>
            <div class="skill-dice-pool clickable" data-action="roll-npc-spell-dice" data-item-id="{{this._id}}" data-spell-vd="{{this.system.damageValue}}" title="{{localize 'SRA2.NPC.ROLL_WITH_DICE'}}">
              <span class="dice-value">{{this.totalDicePool}}</span>
              <i class="fas fa-dice-d6"></i>
            </div>
            <div class="skill-rr">
              <span class="rr-value">{{this.totalRR}}</span>
            </div>
            <div class="skill-threshold clickable" data-action="attack-threshold-spell" data-item-id="{{this._id}}" data-threshold="{{this.npcThreshold}}" data-item-name="{{this.name}}" data-spell-vd="{{this.system.damageValue}}" title="{{localize 'SRA2.NPC.ATTACK_WITH_THRESHOLD'}}">
              <span class="threshold-value">{{this.npcThreshold}}</span>
            </div>
            <div class="skill-controls">
              <a class="spell-edit" data-action="edit-feat" data-item-id="{{this._id}}" title="{{localize 'SRA2.FEATS.EDIT'}}">
                <i class="fas fa-edit"></i>
              </a>
              <a class="spell-delete" data-action="delete-feat" data-item-id="{{this._id}}" title="{{localize 'SRA2.FEATS.DELETE'}}">
                <i class="fas fa-trash"></i>
              </a>
            </div>
          </div>
          {{/each}}
        </div>
      {{/if}}
    </section>
    {{/if}}

    <!-- Attributs Section -->
    <section class="npc-section attributes-section">
      <h2><i class="fas fa-chart-bar"></i> {{localize "SRA2.ATTRIBUTES.LABEL"}}</h2>
      
      <div class="attributes-grid">
        <div class="attribute-item">
          <label>{{localize "SRA2.ATTRIBUTES.STRENGTH"}}</label>
          <input type="number" name="system.attributes.strength" value="{{system.attributes.strength}}" min="0" />
        </div>
        <div class="attribute-item">
          <label>{{localize "SRA2.ATTRIBUTES.AGILITY"}}</label>
          <input type="number" name="system.attributes.agility" value="{{system.attributes.agility}}" min="0" />
        </div>
        <div class="attribute-item">
          <label>{{localize "SRA2.ATTRIBUTES.WILLPOWER"}}</label>
          <input type="number" name="system.attributes.willpower" value="{{system.attributes.willpower}}" min="0" />
        </div>
        <div class="attribute-item">
          <label>{{localize "SRA2.ATTRIBUTES.LOGIC"}}</label>
          <input type="number" name="system.attributes.logic" value="{{system.attributes.logic}}" min="0" />
        </div>
        <div class="attribute-item">
          <label>{{localize "SRA2.ATTRIBUTES.CHARISMA"}}</label>
          <input type="number" name="system.attributes.charisma" value="{{system.attributes.charisma}}" min="0" />
        </div>
      </div>
    </section>

    <!-- Combat Section -->
    <section class="npc-section combat-section">
      <h2><i class="fas fa-shield-alt"></i> {{localize "SRA2.NPC.SECTION.COMBAT"}}</h2>
      
      <div class="armor-level-field">
        <label>{{localize "SRA2.ARMOR_THRESHOLDS.ARMOR_LEVEL"}}</label>
        <input type="number" name="system.armorLevel" value="{{system.armorLevel}}" min="0" max="5" />
        <span class="armor-cost">{{system.armorCost}} <span class="yen-symbol">{{localize "SRA2.RESOURCES.YENS"}}</span></span>
      </div>

      <div class="damage-tracking">
        <label class="damage-label">{{localize "SRA2.DAMAGE.LABEL"}}</label>
        <div class="damage-checkboxes">
          <div class="damage-group light">
            <span class="damage-type-label">{{localize "SRA2.DAMAGE.LIGHT"}}</span>
            {{#each system.damage.light}}
              <input type="checkbox" name="system.damage.light.{{@index}}" {{#if this}}checked{{/if}} />
            {{/each}}
          </div>
          <div class="damage-group severe">
            <span class="damage-type-label">{{localize "SRA2.DAMAGE.SEVERE"}}</span>
            {{#each system.damage.severe}}
              <input type="checkbox" name="system.damage.severe.{{@index}}" {{#if this}}checked{{/if}} />
            {{/each}}
          </div>
          <div class="damage-group incapacitating">
            <span class="damage-type-label">{{localize "SRA2.DAMAGE.INCAPACITATING"}}</span>
            <input type="checkbox" name="system.damage.incapacitating" {{#if system.damage.incapacitating}}checked{{/if}} />
          </div>
        </div>
      </div>
      
      <div class="thresholds-table">
        <h3>{{localize "SRA2.ARMOR_THRESHOLDS.LABEL"}}</h3>
        <table>
          <thead>
            <tr>
              <th>{{localize "SRA2.ARMOR_THRESHOLDS.TYPE"}}</th>
              <th>{{localize "SRA2.ARMOR_THRESHOLDS.LIGHT"}}</th>
              <th>{{localize "SRA2.ARMOR_THRESHOLDS.MODERATE"}}</th>
              <th>{{localize "SRA2.ARMOR_THRESHOLDS.SEVERE"}}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{localize "SRA2.ARMOR_THRESHOLDS.WITHOUT_ARMOR"}}</td>
              <td>{{system.damageThresholds.withoutArmor.light}}</td>
              <td>{{system.damageThresholds.withoutArmor.moderate}}</td>
              <td>{{system.damageThresholds.withoutArmor.severe}}</td>
            </tr>
            <tr>
              <td>{{localize "SRA2.ARMOR_THRESHOLDS.WITH_ARMOR"}}</td>
              <td>{{system.damageThresholds.withArmor.light}}</td>
              <td>{{system.damageThresholds.withArmor.moderate}}</td>
              <td>{{system.damageThresholds.withArmor.severe}}</td>
            </tr>
            <tr>
              <td>{{localize "SRA2.ARMOR_THRESHOLDS.MENTAL"}}</td>
              <td>{{system.damageThresholds.mental.light}}</td>
              <td>{{system.damageThresholds.mental.moderate}}</td>
              <td>{{system.damageThresholds.mental.severe}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- CompÃ©tences Section -->
    <section class="npc-section skills-section">
      <h2><i class="fas fa-book"></i> {{localize "SRA2.NPC.SECTION.SKILLS"}}</h2>
      
      <div class="skills-list">
        <div class="skills-controls">
          <button type="button" class="add-world-skill-button" data-action="add-world-skill" title="{{localize 'SRA2.SKILLS.ADD_SKILL'}}">
            <i class="fas fa-search"></i> {{localize "SRA2.SKILLS.ADD_SKILL"}}
          </button>
        </div>

        {{#if skills}}
          <div class="skills-header">
            <div class="skill-header-name">{{localize "SRA2.SKILLS.NAME"}}</div>
            <div class="skill-header-dice">{{localize "SRA2.NPC.DICE_POOL"}}</div>
            <div class="skill-header-rr">{{localize "SRA2.NPC.RR"}}</div>
            <div class="skill-header-threshold">{{localize "SRA2.NPC.THRESHOLD"}}</div>
            <div class="skill-header-actions"></div>
          </div>

          {{#each skills}}
          <div class="skill-item npc-skill-item" data-item-id="{{this._id}}">
            <div class="skill-name">
              <img class="skill-img" src="{{this.img}}" alt="{{this.name}}" />
              <span>{{this.name}}</span>
              {{#if this.system.linkedAttribute}}
                <span class="skill-attribute">({{localize (concat "SRA2.ATTRIBUTES." (uppercase this.system.linkedAttribute))}})</span>
              {{/if}}
            </div>
            <div class="skill-dice-pool clickable" data-action="roll-skill" data-item-id="{{this._id}}" title="{{localize 'SRA2.SKILLS.ROLL'}}">
              <span class="dice-value">{{this.totalDicePool}}</span>
              <i class="fas fa-dice-d6"></i>
            </div>
            <div class="skill-rr">
              <span class="rr-value">{{this.totalRR}}</span>
            </div>
            <div class="skill-threshold clickable" data-action="attack-threshold" data-item-id="{{this._id}}" data-threshold="{{this.npcThreshold}}" data-item-name="{{this.name}}" data-is-specialization="false" title="{{localize 'SRA2.NPC.ATTACK_WITH_THRESHOLD'}}">
              <span class="threshold-value">{{this.npcThreshold}}</span>
            </div>
            <div class="skill-controls">
              <a class="skill-edit" data-action="edit-skill" data-item-id="{{this._id}}" title="{{localize 'SRA2.SKILLS.EDIT'}}">
                <i class="fas fa-edit"></i>
              </a>
              <a class="skill-delete" data-action="delete-skill" data-item-id="{{this._id}}" title="{{localize 'SRA2.SKILLS.DELETE'}}">
                <i class="fas fa-trash"></i>
              </a>
            </div>
          </div>

          {{#if this.specializations}}
            {{#each this.specializations}}
            <div class="specialization-item npc-specialization-item" data-item-id="{{this._id}}">
              <div class="specialization-name">
                <i class="fas fa-caret-right"></i>
                <span>{{this.name}}</span>
              </div>
              <div class="skill-dice-pool clickable" data-action="roll-specialization" data-item-id="{{this._id}}" title="{{localize 'SRA2.SPECIALIZATIONS.ROLL'}}">
                <span class="dice-value">{{this.totalDicePool}}</span>
                <i class="fas fa-dice-d6"></i>
              </div>
              <div class="skill-rr">
                <span class="rr-value">{{this.totalRR}}</span>
              </div>
              <div class="skill-threshold clickable" data-action="attack-threshold" data-item-id="{{this._id}}" data-threshold="{{this.npcThreshold}}" data-item-name="{{this.name}}" data-is-specialization="true" title="{{localize 'SRA2.NPC.ATTACK_WITH_THRESHOLD'}}">
                <span class="threshold-value">{{this.npcThreshold}}</span>
              </div>
              <div class="skill-controls">
                <a class="specialization-edit" data-action="edit-specialization" data-item-id="{{this._id}}" title="{{localize 'SRA2.SPECIALIZATIONS.EDIT'}}">
                  <i class="fas fa-edit"></i>
                </a>
                <a class="specialization-delete" data-action="delete-specialization" data-item-id="{{this._id}}" title="{{localize 'SRA2.SPECIALIZATIONS.DELETE'}}">
                  <i class="fas fa-trash"></i>
                </a>
              </div>
            </div>
            {{/each}}
          {{/if}}
          {{/each}}
        {{else}}
          <div class="empty-skills">
            <p>{{localize "SRA2.SKILLS.DRAG_DROP"}}</p>
          </div>
        {{/if}}
      </div>
    </section>

    <!-- Atouts Section -->
    <section class="npc-section feats-section">
      <h2><i class="fas fa-star"></i> {{localize "SRA2.NPC.SECTION.FEATS"}}</h2>
      
      <div class="feats-controls">
        <button type="button" class="add-world-feat-button" data-action="add-world-feat" title="{{localize 'SRA2.FEATS.ADD_FEAT'}}">
          <i class="fas fa-search"></i> {{localize "SRA2.FEATS.ADD_FEAT"}}
        </button>
      </div>

      {{#if feats}}
        <div class="feats-list">
          {{#each feats}}
          <div class="feat-item npc-feat-item {{#if system.active}}active{{/if}}" data-item-id="{{this._id}}">
            <div class="feat-header">
              <img class="feat-img" src="{{this.img}}" alt="{{this.name}}" />
              <div class="feat-info">
                <h4 class="feat-name">{{this.name}}</h4>
                <div class="feat-meta">
                  <span class="feat-type">
                    {{#if (eq system.featType "trait")}}{{localize "SRA2.FEATS.FEAT_TYPE.TRAIT"}}
                    {{else if (eq system.featType "contact")}}{{localize "SRA2.FEATS.FEAT_TYPE.CONTACT"}}
                    {{else if (eq system.featType "awakened")}}{{localize "SRA2.FEATS.FEAT_TYPE.AWAKENED"}}
                    {{else if (eq system.featType "equipment")}}{{localize "SRA2.FEATS.FEAT_TYPE.EQUIPMENT"}}
                    {{else if (eq system.featType "cyberware")}}{{localize "SRA2.FEATS.FEAT_TYPE.CYBERWARE"}}
                    {{else if (eq system.featType "weapon")}}{{localize "SRA2.FEATS.FEAT_TYPE.WEAPON"}}
                    {{else if (eq system.featType "spell")}}{{localize "SRA2.FEATS.FEAT_TYPE.SPELL"}}
                    {{/if}}
                  </span>
                  {{#if (eq system.featType "weapon")}}
                    {{#if this.system.weaponType}}
                    <span class="weapon-stats">
                      <span class="stat-label">{{localize "SRA2.FEATS.WEAPON.DAMAGE_VALUE_SHORT"}}:</span>
                      <span class="stat-value">{{this.finalDamageValue}}</span>
                    </span>
                    {{/if}}
                  {{/if}}
                </div>
              </div>
            </div>
            <div class="feat-controls">
              <a class="feat-edit" data-action="edit-feat" data-item-id="{{this._id}}" title="{{localize 'SRA2.FEATS.EDIT'}}">
                <i class="fas fa-edit"></i>
              </a>
              <a class="feat-delete" data-action="delete-feat" data-item-id="{{this._id}}" title="{{localize 'SRA2.FEATS.DELETE'}}">
                <i class="fas fa-trash"></i>
              </a>
            </div>
          </div>
          {{/each}}
        </div>
      {{else}}
        <div class="empty-feats">
          <p>{{localize "SRA2.FEATS.DRAG_DROP"}}</p>
        </div>
      {{/if}}
    </section>
  </div>
</form>
