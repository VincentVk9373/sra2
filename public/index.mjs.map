{"version":3,"file":"index.mjs","sources":["../src/module/config/system.ts","../src/module/models/actor-character.ts","../src/module/models/actor-npc.ts","../src/module/models/item-skill.ts","../src/module/models/item-feat.ts","../src/module/models/item-specialization.ts","../src/module/models/item-metatype.ts","../src/module/documents/actor.ts","../src/module/applications/character-sheet.ts","../src/module/applications/feat-sheet.ts","../src/module/applications/skill-sheet.ts","../src/module/applications/specialization-sheet.ts","../src/module/applications/metatype-sheet.ts","../src/module/sra2-system.ts","../src/start.ts"],"sourcesContent":["const SYSTEM_ID = 'sra2';\n\nexport interface SystemConfig {\n  id: string;\n  LOG: {\n    HEAD: string;\n  };\n  SOCKET: string;\n  PATH: {\n    ROOT: string;\n    STYLE: string;\n    TEMPLATES: string;\n    ASSETS: string;\n  };\n}\n\nexport const SYSTEM: SystemConfig = {\n  id: SYSTEM_ID,\n  LOG: {\n    HEAD: `${SYSTEM_ID} | `\n  },\n  SOCKET: `system.${SYSTEM_ID}`,\n  PATH: {\n    ROOT: `systems/${SYSTEM_ID}`,\n    STYLE: `systems/${SYSTEM_ID}/style`,\n    TEMPLATES: `systems/${SYSTEM_ID}/templates`,\n    ASSETS: `systems/${SYSTEM_ID}/assets`,\n  }\n};\n\n","/**\n * Data model for Character actors\n */\nexport class CharacterDataModel extends foundry.abstract.TypeDataModel<any, Actor> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      attributes: new fields.SchemaField({\n        strength: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        }),\n        agility: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        }),\n        willpower: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        }),\n        logic: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        }),\n        charisma: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        })\n      }),\n      resources: new fields.SchemaField({\n        yens: new fields.NumberField({\n          required: true,\n          initial: 0,\n          min: 0,\n          integer: true\n        }),\n        anarchy: new fields.NumberField({\n          required: true,\n          initial: 0,\n          min: 0,\n          integer: true\n        })\n      }),\n      maxEssence: new fields.NumberField({\n        required: true,\n        initial: 6,\n        min: 0,\n        integer: true\n      }),\n      armorLevel: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 5,\n        integer: true\n      }),\n      damage: new fields.SchemaField({\n        light: new fields.ArrayField(new fields.BooleanField({\n          required: true,\n          initial: false\n        }), {\n          required: true,\n          initial: [false, false]\n        }),\n        severe: new fields.ArrayField(new fields.BooleanField({\n          required: true,\n          initial: false\n        }), {\n          required: true,\n          initial: [false]\n        }),\n        incapacitating: new fields.BooleanField({\n          required: true,\n          initial: false\n        })\n      }),\n      anarchySpent: new fields.ArrayField(new fields.BooleanField({\n        required: true,\n        initial: false\n      }), {\n        required: true,\n        initial: [false, false, false]\n      }),\n      bio: new fields.SchemaField({\n        background: new fields.HTMLField({\n          required: true,\n          initial: \"\"\n        }),\n        notes: new fields.HTMLField({\n          required: true,\n          initial: \"\"\n        })\n      })\n    };\n  }\n\n  /**\n   * Calculate the cost of an attribute based on its level\n   * Each level costs 10000, except the last level (maximum) which costs 20000\n   */\n  private calculateAttributeCost(level: number, maxLevel: number): number {\n    let cost = 0;\n    for (let i = 1; i <= level; i++) {\n      if (i === maxLevel) {\n        cost += 20000;\n      } else {\n        cost += 10000;\n      }\n    }\n    return cost;\n  }\n\n  override prepareDerivedData(): void {\n    // Get metatype to determine attribute maximums and anarchy bonus\n    const parent = (this as any).parent;\n    let attributeMaxes = {\n      strength: 99,\n      agility: 99,\n      willpower: 99,\n      logic: 99,\n      charisma: 99\n    };\n    let anarchyBonus = 0;\n    \n    if (parent && parent.items) {\n      const metatype = parent.items.find((item: any) => item.type === 'metatype');\n      if (metatype && metatype.system) {\n        attributeMaxes = {\n          strength: metatype.system.maxStrength || 99,\n          agility: metatype.system.maxAgility || 99,\n          willpower: metatype.system.maxWillpower || 99,\n          logic: metatype.system.maxLogic || 99,\n          charisma: metatype.system.maxCharisma || 99\n        };\n        anarchyBonus = metatype.system.anarchyBonus || 0;\n      }\n    }\n    \n    (this as any).attributeMaxes = attributeMaxes;\n    \n    // Calculate damage boxes, thresholds bonuses, essence cost, and anarchy bonus from active feats\n    let bonusLightDamage = 0;\n    let bonusSevereDamage = 0;\n    let bonusPhysicalThreshold = 0;\n    let bonusMentalThreshold = 0;\n    let bonusAnarchy = 0;\n    let totalEssenceCost = 0;\n    \n    if (parent && parent.items) {\n      const activeFeats = parent.items.filter((item: any) => \n        item.type === 'feat' && item.system.active === true\n      );\n      \n      activeFeats.forEach((feat: any) => {\n        bonusLightDamage += feat.system.bonusLightDamage || 0;\n        bonusSevereDamage += feat.system.bonusSevereDamage || 0;\n        bonusPhysicalThreshold += feat.system.bonusPhysicalThreshold || 0;\n        bonusMentalThreshold += feat.system.bonusMentalThreshold || 0;\n        bonusAnarchy += feat.system.bonusAnarchy || 0;\n        totalEssenceCost += feat.system.essenceCost || 0;\n      });\n    }\n    \n    // Calculate total anarchy (base 3 + metatype bonus + feats bonus)\n    (this as any).totalAnarchy = 3 + anarchyBonus + bonusAnarchy;\n    (this as any).anarchyBonus = anarchyBonus;\n    (this as any).featsAnarchyBonus = bonusAnarchy;\n    \n    // Base: 2 light, 1 severe, 1 incapacitating\n    const totalLightBoxes = 2 + bonusLightDamage;\n    const totalSevereBoxes = 1 + bonusSevereDamage;\n    \n    // Ensure damage arrays match the required size\n    const damage = (this as any).damage || {};\n    \n    // Adjust light damage array\n    if (!Array.isArray(damage.light)) {\n      damage.light = [false, false];\n    }\n    while (damage.light.length < totalLightBoxes) {\n      damage.light.push(false);\n    }\n    while (damage.light.length > totalLightBoxes) {\n      damage.light.pop();\n    }\n    \n    // Adjust severe damage array\n    if (!Array.isArray(damage.severe)) {\n      damage.severe = [false];\n    }\n    while (damage.severe.length < totalSevereBoxes) {\n      damage.severe.push(false);\n    }\n    while (damage.severe.length > totalSevereBoxes) {\n      damage.severe.pop();\n    }\n    \n    (this as any).totalLightBoxes = totalLightBoxes;\n    (this as any).totalSevereBoxes = totalSevereBoxes;\n    \n    // Adjust anarchy spent array to match total anarchy\n    const totalAnarchy = 3 + anarchyBonus + bonusAnarchy;\n    const anarchySpent = (this as any).anarchySpent || [];\n    \n    if (!Array.isArray(anarchySpent)) {\n      (this as any).anarchySpent = [];\n    }\n    while ((this as any).anarchySpent.length < totalAnarchy) {\n      (this as any).anarchySpent.push(false);\n    }\n    while ((this as any).anarchySpent.length > totalAnarchy) {\n      (this as any).anarchySpent.pop();\n    }\n    \n    // Calculate armor cost (2500 per level)\n    const armorLevel = (this as any).armorLevel || 0;\n    (this as any).armorCost = armorLevel * 2500;\n    \n    // Calculate damage thresholds (with bonuses from feats)\n    const strength = (this as any).attributes?.strength || 1;\n    const willpower = (this as any).attributes?.willpower || 1;\n    \n    (this as any).damageThresholds = {\n      withoutArmor: {\n        light: strength + bonusPhysicalThreshold,\n        moderate: strength + bonusPhysicalThreshold + 3,\n        severe: strength + bonusPhysicalThreshold + 6\n      },\n      withArmor: {\n        light: strength + armorLevel + bonusPhysicalThreshold,\n        moderate: strength + armorLevel + bonusPhysicalThreshold + 3,\n        severe: strength + armorLevel + bonusPhysicalThreshold + 6\n      },\n      mental: {\n        light: willpower + bonusMentalThreshold,\n        moderate: willpower + bonusMentalThreshold + 3,\n        severe: willpower + bonusMentalThreshold + 6\n      }\n    };\n    \n    // Calculate current essence\n    const maxEssence = (this as any).maxEssence || 6;\n    (this as any).currentEssence = Math.max(0, maxEssence - totalEssenceCost);\n    \n    // Calculate costs for each attribute\n    const attributes = (this as any).attributes;\n    if (attributes) {\n      // Clamp attributes to their maximums\n      attributes.strength = Math.min(attributes.strength || 1, attributeMaxes.strength);\n      attributes.agility = Math.min(attributes.agility || 1, attributeMaxes.agility);\n      attributes.willpower = Math.min(attributes.willpower || 1, attributeMaxes.willpower);\n      attributes.logic = Math.min(attributes.logic || 1, attributeMaxes.logic);\n      attributes.charisma = Math.min(attributes.charisma || 1, attributeMaxes.charisma);\n      \n      (this as any).attributeCosts = {\n        strength: this.calculateAttributeCost(attributes.strength || 1, attributeMaxes.strength),\n        agility: this.calculateAttributeCost(attributes.agility || 1, attributeMaxes.agility),\n        willpower: this.calculateAttributeCost(attributes.willpower || 1, attributeMaxes.willpower),\n        logic: this.calculateAttributeCost(attributes.logic || 1, attributeMaxes.logic),\n        charisma: this.calculateAttributeCost(attributes.charisma || 1, attributeMaxes.charisma)\n      };\n      \n      // Calculate total cost of attributes\n      const attributeCosts = (this as any).attributeCosts;\n      let totalCost = Object.values(attributeCosts).reduce((sum: number, cost: any) => sum + cost, 0);\n      \n      // Add armor cost\n      totalCost += (this as any).armorCost || 0;\n      \n      // Add items cost (skills and feats)\n      if (parent && parent.items) {\n        parent.items.forEach((item: any) => {\n          if (item.system && item.system.calculatedCost !== undefined) {\n            totalCost += item.system.calculatedCost;\n          }\n        });\n      }\n      \n      (this as any).totalCost = totalCost;\n    }\n  }\n}\n\n","/**\n * Data model for NPC actors\n */\nexport class NpcDataModel extends foundry.abstract.TypeDataModel<any, Actor> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      state: new fields.SchemaField({\n        health: new fields.NumberField({\n          required: true,\n          initial: 10,\n          min: 0,\n          integer: true\n        }),\n        maxHealth: new fields.NumberField({\n          required: true,\n          initial: 10,\n          min: 1,\n          integer: true\n        }),\n        armor: new fields.NumberField({\n          required: true,\n          initial: 0,\n          min: 0,\n          integer: true\n        })\n      }),\n      difficulty: new fields.NumberField({\n        required: true,\n        initial: 1,\n        min: 1,\n        max: 6,\n        integer: true,\n        label: \"SRA2.NPC.DIFFICULTY\"\n      }),\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Add any derived data calculations here\n  }\n}\n\n","/**\n * Data model for Skill items\n */\nexport class SkillDataModel extends foundry.abstract.TypeDataModel<any, Item> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      rating: new fields.NumberField({\n        required: true,\n        initial: 1,\n        min: 0,\n        max: 8,\n        integer: true,\n        label: \"SRA2.SKILLS.RATING\"\n      }),\n      linkedAttribute: new fields.StringField({\n        required: true,\n        initial: \"strength\",\n        choices: {\n          strength: \"SRA2.ATTRIBUTES.STRENGTH\",\n          agility: \"SRA2.ATTRIBUTES.AGILITY\",\n          willpower: \"SRA2.ATTRIBUTES.WILLPOWER\",\n          logic: \"SRA2.ATTRIBUTES.LOGIC\",\n          charisma: \"SRA2.ATTRIBUTES.CHARISMA\"\n        },\n        label: \"SRA2.SKILLS.LINKED_ATTRIBUTE\"\n      }),\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Calculate cost based on rating\n    // 2500 per rating up to 5, then 5000 per rating above 5\n    const rating = (this as any).rating || 0;\n    \n    let calculatedCost = 0;\n    if (rating <= 5) {\n      calculatedCost = rating * 2500;\n    } else {\n      // First 5 levels at 2500 each, remaining levels at 5000 each\n      calculatedCost = 5 * 2500 + (rating - 5) * 5000;\n    }\n    \n    (this as any).calculatedCost = calculatedCost;\n  }\n}\n\n","/**\n * Data model for Feat items\n */\nexport class FeatDataModel extends foundry.abstract.TypeDataModel<any, Item> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      }),\n      rating: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.RATING\"\n      }),\n      cost: new fields.StringField({\n        required: true,\n        initial: \"free-equipment\",\n        choices: {\n          \"free-equipment\": \"SRA2.FEATS.COST.FREE_EQUIPMENT\",\n          \"equipment\": \"SRA2.FEATS.COST.EQUIPMENT\",\n          \"specialized-equipment\": \"SRA2.FEATS.COST.SPECIALIZED_EQUIPMENT\",\n          \"feat\": \"SRA2.FEATS.COST.FEAT\"\n        },\n        label: \"SRA2.FEATS.COST.LABEL\"\n      }),\n      active: new fields.BooleanField({\n        required: true,\n        initial: true,\n        label: \"SRA2.FEATS.ACTIVE\"\n      }),\n      rrType: new fields.ArrayField(new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.RR_TYPE.NONE\",\n          \"attribute\": \"SRA2.FEATS.RR_TYPE.ATTRIBUTE\",\n          \"skill\": \"SRA2.FEATS.RR_TYPE.SKILL\",\n          \"specialization\": \"SRA2.FEATS.RR_TYPE.SPECIALIZATION\"\n        }\n      }), {\n        initial: [],\n        label: \"SRA2.FEATS.RR_TYPE.LABEL\"\n      }),\n      rrValue: new fields.ArrayField(new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 3,\n        integer: true\n      }), {\n        initial: [],\n        label: \"SRA2.FEATS.RR_VALUE\"\n      }),\n      rrTarget: new fields.ArrayField(new fields.StringField({\n        required: false,\n        initial: \"\",\n        nullable: false\n      }), {\n        initial: [],\n        label: \"SRA2.FEATS.RR_TARGET\"\n      }),\n      bonusLightDamage: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_LIGHT_DAMAGE\"\n      }),\n      bonusSevereDamage: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_SEVERE_DAMAGE\"\n      }),\n      bonusPhysicalThreshold: new fields.NumberField({\n        required: true,\n        initial: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_PHYSICAL_THRESHOLD\"\n      }),\n      bonusMentalThreshold: new fields.NumberField({\n        required: true,\n        initial: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_MENTAL_THRESHOLD\"\n      }),\n      bonusAnarchy: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_ANARCHY\"\n      }),\n      essenceCost: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.ESSENCE_COST\"\n      }),\n      featType: new fields.StringField({\n        required: true,\n        initial: \"equipment\",\n        choices: {\n          \"trait\": \"SRA2.FEATS.FEAT_TYPE.TRAIT\",\n          \"contact\": \"SRA2.FEATS.FEAT_TYPE.CONTACT\",\n          \"awakened\": \"SRA2.FEATS.FEAT_TYPE.AWAKENED\",\n          \"adept-power\": \"SRA2.FEATS.FEAT_TYPE.ADEPT_POWER\",\n          \"equipment\": \"SRA2.FEATS.FEAT_TYPE.EQUIPMENT\",\n          \"cyberware\": \"SRA2.FEATS.FEAT_TYPE.CYBERWARE\",\n          \"cyberdeck\": \"SRA2.FEATS.FEAT_TYPE.CYBERDECK\",\n          \"vehicle\": \"SRA2.FEATS.FEAT_TYPE.VEHICLE\",\n          \"weapons-spells\": \"SRA2.FEATS.FEAT_TYPE.WEAPONS_SPELLS\"\n        },\n        label: \"SRA2.FEATS.FEAT_TYPE.LABEL\"\n      }),\n      // Weapon/Spell specific fields\n      damageValue: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.WEAPON.DAMAGE_VALUE\"\n      }),\n      meleeRange: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.WEAPON.RANGE_NONE\",\n          \"ok\": \"SRA2.FEATS.WEAPON.RANGE_OK\",\n          \"dice\": \"SRA2.FEATS.WEAPON.RANGE_DICE\"\n        },\n        label: \"SRA2.FEATS.WEAPON.MELEE_RANGE\"\n      }),\n      shortRange: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.WEAPON.RANGE_NONE\",\n          \"ok\": \"SRA2.FEATS.WEAPON.RANGE_OK\",\n          \"dice\": \"SRA2.FEATS.WEAPON.RANGE_DICE\"\n        },\n        label: \"SRA2.FEATS.WEAPON.SHORT_RANGE\"\n      }),\n      mediumRange: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.WEAPON.RANGE_NONE\",\n          \"ok\": \"SRA2.FEATS.WEAPON.RANGE_OK\",\n          \"dice\": \"SRA2.FEATS.WEAPON.RANGE_DICE\"\n        },\n        label: \"SRA2.FEATS.WEAPON.MEDIUM_RANGE\"\n      }),\n      longRange: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.WEAPON.RANGE_NONE\",\n          \"ok\": \"SRA2.FEATS.WEAPON.RANGE_OK\",\n          \"dice\": \"SRA2.FEATS.WEAPON.RANGE_DICE\"\n        },\n        label: \"SRA2.FEATS.WEAPON.LONG_RANGE\"\n      }),\n      // Vehicle/Drone specific fields\n      autopilot: new fields.NumberField({\n        required: true,\n        initial: 6,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.AUTOPILOT\"\n      }),\n      structure: new fields.NumberField({\n        required: true,\n        initial: 2,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.STRUCTURE\"\n      }),\n      handling: new fields.NumberField({\n        required: true,\n        initial: 5,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.HANDLING\"\n      }),\n      speed: new fields.NumberField({\n        required: true,\n        initial: 3,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.SPEED\"\n      }),\n      armor: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.ARMOR\"\n      }),\n      weaponInfo: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.VEHICLE.WEAPON_INFO\"\n      }),\n      // Cyberdeck specific fields\n      firewall: new fields.NumberField({\n        required: true,\n        initial: 1,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.CYBERDECK.FIREWALL\"\n      }),\n      attack: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.CYBERDECK.ATTACK\"\n      }),\n      // Contact specific fields\n      contactName: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.CONTACT.NAME\"\n      }),\n      // Awakened specific fields\n      astralPerception: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.ASTRAL_PERCEPTION\"\n      }),\n      astralProjection: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.ASTRAL_PROJECTION\"\n      }),\n      sorcery: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.SORCERY\"\n      }),\n      conjuration: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.CONJURATION\"\n      }),\n      adept: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.ADEPT\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Calculate cost based on cost type and rating\n    const rating = (this as any).rating || 0;\n    const costType = (this as any).cost || 'free-equipment';\n    \n    let calculatedCost = 0;\n    switch (costType) {\n      case 'free-equipment':\n        calculatedCost = 0 + rating * 5000;\n        break;\n      case 'equipment':\n        calculatedCost = 2500 + rating * 5000;\n        break;\n      case 'specialized-equipment':\n        calculatedCost = 5000 + rating * 5000;\n        break;\n      case 'feat':\n        calculatedCost = rating * 5000;\n        break;\n      default:\n        calculatedCost = 0;\n    }\n    \n    (this as any).calculatedCost = calculatedCost;\n  }\n}\n\n","/**\n * Data model for Specialization items\n * A specialization is linked to a skill and costs 2500 yens\n */\nexport class SpecializationDataModel extends foundry.abstract.TypeDataModel<any, Item> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      linkedSkill: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.SPECIALIZATIONS.LINKED_SKILL\"\n      }),\n      linkedAttribute: new fields.StringField({\n        required: true,\n        initial: \"strength\",\n        choices: {\n          strength: \"SRA2.ATTRIBUTES.STRENGTH\",\n          agility: \"SRA2.ATTRIBUTES.AGILITY\",\n          willpower: \"SRA2.ATTRIBUTES.WILLPOWER\",\n          logic: \"SRA2.ATTRIBUTES.LOGIC\",\n          charisma: \"SRA2.ATTRIBUTES.CHARISMA\"\n        },\n        label: \"SRA2.SPECIALIZATIONS.LINKED_ATTRIBUTE\"\n      }),\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Specializations have a fixed cost of 2500 yens\n    (this as any).calculatedCost = 2500;\n  }\n}\n\n","/**\n * Data model for Metatype items\n * Metatypes define maximum values for character attributes\n */\nexport class MetatypeDataModel extends foundry.abstract.TypeDataModel<any, Item> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      }),\n      maxStrength: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_STRENGTH\"\n      }),\n      maxAgility: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_AGILITY\"\n      }),\n      maxWillpower: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_WILLPOWER\"\n      }),\n      maxLogic: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_LOGIC\"\n      }),\n      maxCharisma: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_CHARISMA\"\n      }),\n      anarchyBonus: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.ANARCHY_BONUS\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Metatypes don't have a cost, they're character features\n    // No derived data needed for now\n  }\n}\n\n","/**\n * Custom Actor document for SRA2\n */\nexport class SRA2Actor<SubType extends Actor.SubType = Actor.SubType> extends Actor<SubType> {\n  get feats(): Item[] {\n    return this.items.filter((item: Item) => item.type === 'feat');\n  }\n}","/**\n * Character Sheet Application\n */\nexport class CharacterSheet extends ActorSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Actor> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'actor', 'character'],\n      template: 'systems/sra2/templates/actor-character-sheet.hbs',\n      width: 900,\n      height: 700,\n      tabs: [],\n      dragDrop: [\n        { dragSelector: '.metatype-item', dropSelector: '.metatype-drop-zone' },\n        { dragSelector: '.feat-item', dropSelector: '.feats-list' },\n        { dragSelector: '.skill-item', dropSelector: '.skills-list' },\n        { dragSelector: '.specialization-item', dropSelector: '.skills-list' }\n      ],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n\n    // Ensure system data is available\n    context.system = this.actor.system;\n\n    // Get metatype (there should be only one)\n    const metatypes = this.actor.items.filter((item: any) => item.type === 'metatype');\n    context.metatype = metatypes.length > 0 ? metatypes[0] : null;\n\n    // Get feats and enrich with RR target labels\n    const allFeats = this.actor.items.filter((item: any) => item.type === 'feat').map((feat: any) => {\n      // Add translated labels for attribute targets in RR entries\n      feat.rrEntries = [];\n      const rrTypes = feat.system.rrType || [];\n      const rrValues = feat.system.rrValue || [];\n      const rrTargets = feat.system.rrTarget || [];\n      \n      for (let i = 0; i < rrTypes.length; i++) {\n        const rrType = rrTypes[i];\n        const rrValue = rrValues[i] || 0;\n        const rrTarget = rrTargets[i] || '';\n        \n        if (rrType === 'none') continue;\n        \n        const entry: any = { rrType, rrValue, rrTarget };\n        \n        if (rrType === 'attribute' && rrTarget) {\n          entry.rrTargetLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${rrTarget.toUpperCase()}`);\n        }\n        \n        feat.rrEntries.push(entry);\n      }\n      \n      return feat;\n    });\n    \n    // Group feats by type\n    context.featsByType = {\n      trait: allFeats.filter((feat: any) => feat.system.featType === 'trait'),\n      contact: allFeats.filter((feat: any) => feat.system.featType === 'contact'),\n      awakened: allFeats.filter((feat: any) => feat.system.featType === 'awakened'),\n      adeptPower: allFeats.filter((feat: any) => feat.system.featType === 'adept-power'),\n      equipment: allFeats.filter((feat: any) => feat.system.featType === 'equipment'),\n      cyberware: allFeats.filter((feat: any) => feat.system.featType === 'cyberware'),\n      cyberdeck: allFeats.filter((feat: any) => feat.system.featType === 'cyberdeck'),\n      vehicle: allFeats.filter((feat: any) => feat.system.featType === 'vehicle'),\n      weaponsSpells: allFeats.filter((feat: any) => feat.system.featType === 'weapons-spells')\n    };\n    \n    // Keep the feats array for backwards compatibility\n    context.feats = allFeats;\n    \n    // Get skills\n    const skills = this.actor.items.filter((item: any) => item.type === 'skill');\n    \n    // Get all specializations\n    const allSpecializations = this.actor.items.filter((item: any) => item.type === 'specialization');\n    \n    // Organize specializations by linked skill\n    const specializationsBySkill = new Map<string, any[]>();\n    const unlinkedSpecializations: any[] = [];\n    \n    allSpecializations.forEach((spec: any) => {\n      const linkedSkillName = spec.system.linkedSkill;\n      if (linkedSkillName) {\n        // linkedSkill is stored as a name, find the skill by name\n        const linkedSkill = this.actor.items.find((i: any) => \n          i.type === 'skill' && i.name === linkedSkillName\n        );\n        \n        if (linkedSkill && linkedSkill.id) {\n          // Valid linked skill found\n          const skillId = linkedSkill.id;\n          if (!specializationsBySkill.has(skillId)) {\n            specializationsBySkill.set(skillId, []);\n          }\n          specializationsBySkill.get(skillId)!.push(spec);\n        } else {\n          // Linked skill doesn't exist (name doesn't match any skill), mark as unlinked\n          unlinkedSpecializations.push(spec);\n        }\n      } else {\n        // No linked skill specified\n        unlinkedSpecializations.push(spec);\n      }\n    });\n    \n    // Calculate RR for attributes first (needed for skills and specializations)\n    const attributesRR = {\n      strength: this.calculateRR('attribute', 'strength'),\n      agility: this.calculateRR('attribute', 'agility'),\n      willpower: this.calculateRR('attribute', 'willpower'),\n      logic: this.calculateRR('attribute', 'logic'),\n      charisma: this.calculateRR('attribute', 'charisma')\n    };\n    \n    // Add specializations to each skill and calculate RR\n    context.skills = skills.map((skill: any) => {\n      // Get linked attribute label for the skill\n      const linkedAttribute = skill.system?.linkedAttribute || 'strength';\n      skill.linkedAttributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${linkedAttribute.toUpperCase()}`);\n      \n      // Calculate RR for this skill (skill RR + attribute RR, max 3)\n      const skillRR = this.calculateRR('skill', skill.name);\n      const attributeRR = (attributesRR as any)[linkedAttribute] || 0;\n      skill.rr = Math.min(3, skillRR + attributeRR);\n      \n      // Calculate total dice pool (attribute + skill rating)\n      const attributeValue = (this.actor.system as any).attributes[linkedAttribute] || 0;\n      const skillRating = skill.system?.rating || 0;\n      skill.totalDicePool = attributeValue + skillRating;\n      \n      // Get specializations for this skill and add calculated ratings\n      const specs = specializationsBySkill.get(skill.id) || [];\n      skill.specializations = specs.map((spec: any) => {\n        const parentRating = skill.system?.rating || 0;\n        // Add properties directly to the spec object instead of creating a new one\n        spec.parentRating = parentRating;\n        spec.effectiveRating = parentRating + 2;  // Specialization adds +2 to skill rating\n        spec.parentSkillName = skill.name;\n        \n        // Get linked attribute label for the specialization\n        const specLinkedAttribute = spec.system?.linkedAttribute || 'strength';\n        spec.linkedAttributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${specLinkedAttribute.toUpperCase()}`);\n        \n        // Calculate RR for this specialization (attribute RR + skill RR + spec RR, max 3)\n        const specRR = this.calculateRR('specialization', spec.name);\n        const specAttributeRR = (attributesRR as any)[specLinkedAttribute] || 0;\n        const parentSkillRR = skillRR; // RR of the parent skill\n        spec.rr = Math.min(3, specAttributeRR + parentSkillRR + specRR);\n        \n        // Calculate total dice pool (attribute + effective rating)\n        const specAttributeValue = (this.actor.system as any).attributes[specLinkedAttribute] || 0;\n        spec.totalDicePool = specAttributeValue + spec.effectiveRating;\n        \n        return spec;\n      });\n      return skill;\n    });\n    \n    // Add unlinked specializations with attribute labels and RR\n    context.unlinkedSpecializations = unlinkedSpecializations.map((spec: any) => {\n      const linkedAttribute = spec.system?.linkedAttribute || 'strength';\n      spec.linkedAttributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${linkedAttribute.toUpperCase()}`);\n      \n      // Calculate RR for this specialization (spec RR + attribute RR, max 3)\n      // Note: unlinked specializations don't have a parent skill, so only attribute + spec RR\n      const specRR = this.calculateRR('specialization', spec.name);\n      const attributeRR = (attributesRR as any)[linkedAttribute] || 0;\n      spec.rr = Math.min(3, specRR + attributeRR);\n      \n      // Calculate total dice pool (attribute only, since no skill linked)\n      const attributeValue = (this.actor.system as any).attributes[linkedAttribute] || 0;\n      spec.totalDicePool = attributeValue;\n      \n      return spec;\n    });\n    \n    // Store attributesRR in context\n    context.attributesRR = attributesRR;\n\n    return context;\n  }\n\n  override async close(options?: Application.CloseOptions): Promise<void> {\n    // Clean up document-level event listeners\n    $(document).off('click.skill-search');\n    $(document).off('click.feat-search');\n    return super.close(options);\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n\n    // Edit metatype\n    html.find('[data-action=\"edit-metatype\"]').on('click', this._onEditMetatype.bind(this));\n    \n    // Delete metatype\n    html.find('[data-action=\"delete-metatype\"]').on('click', this._onDeleteMetatype.bind(this));\n\n    // Edit feat\n    html.find('[data-action=\"edit-feat\"]').on('click', this._onEditFeat.bind(this));\n\n    // Delete feat\n    html.find('[data-action=\"delete-feat\"]').on('click', this._onDeleteFeat.bind(this));\n\n    // Edit skill\n    html.find('[data-action=\"edit-skill\"]').on('click', this._onEditSkill.bind(this));\n\n    // Delete skill\n    html.find('[data-action=\"delete-skill\"]').on('click', this._onDeleteSkill.bind(this));\n\n    // Edit specialization\n    html.find('[data-action=\"edit-specialization\"]').on('click', this._onEditSpecialization.bind(this));\n\n    // Delete specialization\n    html.find('[data-action=\"delete-specialization\"]').on('click', this._onDeleteSpecialization.bind(this));\n\n    // Roll attribute\n    html.find('[data-action=\"roll-attribute\"]').on('click', this._onRollAttribute.bind(this));\n\n    // Roll skill\n    html.find('[data-action=\"roll-skill\"]').on('click', this._onRollSkill.bind(this));\n\n    // Quick roll skill (from dice badge)\n    html.find('[data-action=\"quick-roll-skill\"]').on('click', this._onQuickRollSkill.bind(this));\n\n    // Roll specialization\n    html.find('[data-action=\"roll-specialization\"]').on('click', this._onRollSpecialization.bind(this));\n\n    // Quick roll specialization (from dice badge)\n    html.find('[data-action=\"quick-roll-specialization\"]').on('click', this._onQuickRollSpecialization.bind(this));\n\n    // Handle rating changes\n    html.find('.rating-input').on('change', this._onRatingChange.bind(this));\n\n    // Skill search\n    html.find('.skill-search-input').on('input', this._onSkillSearch.bind(this));\n    html.find('.skill-search-input').on('focus', this._onSkillSearchFocus.bind(this));\n    html.find('.skill-search-input').on('blur', this._onSkillSearchBlur.bind(this));\n    \n    // Close skill search results when clicking outside\n    $(document).on('click.skill-search', (event) => {\n      const target = event.target as unknown as HTMLElement;\n      const skillSearchContainer = html.find('.skill-search-container')[0] as HTMLElement;\n      if (skillSearchContainer && !skillSearchContainer.contains(target)) {\n        html.find('.skill-search-results').hide();\n      }\n    });\n\n    // Feat search\n    html.find('.feat-search-input').on('input', this._onFeatSearch.bind(this));\n    html.find('.feat-search-input').on('focus', this._onFeatSearchFocus.bind(this));\n    html.find('.feat-search-input').on('blur', this._onFeatSearchBlur.bind(this));\n    \n    // Close feat search results when clicking outside\n    $(document).on('click.feat-search', (event) => {\n      const target = event.target as unknown as HTMLElement;\n      const featSearchContainer = html.find('.feat-search-container')[0] as HTMLElement;\n      if (featSearchContainer && !featSearchContainer.contains(target)) {\n        html.find('.feat-search-results').hide();\n      }\n    });\n\n    // Make feat items draggable\n    html.find('.feat-item').each((_index, item) => {\n      item.setAttribute('draggable', 'true');\n      item.addEventListener('dragstart', this._onDragStart.bind(this));\n    });\n\n    // Make skill items draggable\n    html.find('.skill-item').each((_index, item) => {\n      item.setAttribute('draggable', 'true');\n      item.addEventListener('dragstart', this._onDragStart.bind(this));\n    });\n\n    // Make specialization items draggable\n    html.find('.specialization-item').each((_index, item) => {\n      item.setAttribute('draggable', 'true');\n      item.addEventListener('dragstart', this._onDragStart.bind(this));\n    });\n  }\n\n  /**\n   * Handle form submission to update actor data\n   */\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    // Filter out item data (handled separately by _onRatingChange)\n    const actorData: any = {};\n    for (const [key, value] of Object.entries(formData)) {\n      if (!key.startsWith('items.')) {\n        actorData[key] = value;\n      }\n    }\n    \n    // Expand the form data to handle nested properties\n    const expandedData = foundry.utils.expandObject(actorData);\n    \n    // Update the actor with the form data\n    return this.actor.update(expandedData);\n  }\n\n  /**\n   * Handle editing a metatype\n   */\n  private async _onEditMetatype(event: Event): Promise<void> {\n    event.preventDefault();\n    const metatypeId = (event.currentTarget as HTMLElement).closest('.metatype-item')?.getAttribute('data-item-id');\n    if (metatypeId) {\n      const metatype = this.actor.items.get(metatypeId);\n      if (metatype) {\n        metatype.sheet?.render(true);\n      }\n    }\n  }\n\n  /**\n   * Handle deleting a metatype\n   */\n  private async _onDeleteMetatype(event: Event): Promise<void> {\n    event.preventDefault();\n    const metatypeId = (event.currentTarget as HTMLElement).closest('.metatype-item')?.getAttribute('data-item-id');\n    if (metatypeId) {\n      const metatype = this.actor.items.get(metatypeId);\n      if (metatype) {\n        await metatype.delete();\n        this.render(false);\n      }\n    }\n  }\n\n  /**\n   * Handle editing a feat\n   */\n  private async _onEditFeat(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) return;\n\n    const feat = this.actor.items.get(itemId);\n    if (feat) {\n      feat.sheet?.render(true);\n    }\n  }\n\n  /**\n   * Handle deleting a feat\n   */\n  private async _onDeleteFeat(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) return;\n\n    const item = this.actor.items.get(itemId);\n    if (item) {\n      await item.delete();\n    }\n  }\n\n  /**\n   * Handle editing a skill\n   */\n  private async _onEditSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) return;\n\n    const skill = this.actor.items.get(itemId);\n    if (skill) {\n      skill.sheet?.render(true);\n    }\n  }\n\n  /**\n   * Handle deleting a skill\n   */\n  private async _onDeleteSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) return;\n\n    const item = this.actor.items.get(itemId);\n    if (item) {\n      await item.delete();\n    }\n  }\n\n  /**\n   * Handle editing a specialization\n   */\n  private async _onEditSpecialization(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) return;\n\n    const specialization = this.actor.items.get(itemId);\n    if (specialization) {\n      specialization.sheet?.render(true);\n    }\n  }\n\n  /**\n   * Handle deleting a specialization\n   */\n  private async _onDeleteSpecialization(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) return;\n\n    const item = this.actor.items.get(itemId);\n    if (item) {\n      await item.delete();\n    }\n  }\n\n  /**\n   * Calculate Risk Reduction (RR) from active feats for a given skill, specialization, or attribute\n   */\n  private calculateRR(itemType: 'skill' | 'specialization' | 'attribute', itemName: string): number {\n    let totalRR = 0;\n    \n    // Get all active feats from the actor\n    const feats = this.actor.items.filter((item: any) => \n      item.type === 'feat' && \n      item.system.active === true\n    );\n    \n    // Calculate RR from feats that target this item\n    for (const feat of feats) {\n      const featSystem = feat.system as any;\n      const rrTypes = featSystem.rrType || [];\n      const rrValues = featSystem.rrValue || [];\n      const rrTargets = featSystem.rrTarget || [];\n      \n      // Loop through all RR entries in this feat\n      for (let i = 0; i < rrTypes.length; i++) {\n        const rrType = rrTypes[i];\n        const rrValue = rrValues[i] || 0;\n        const rrTarget = rrTargets[i] || '';\n        \n        // Check if this RR entry provides RR for the given item\n        if (rrType === itemType && rrTarget === itemName) {\n          totalRR += rrValue;\n        }\n      }\n    }\n    \n    // RR is capped at 3\n    return Math.min(3, totalRR);\n  }\n\n  /**\n   * Handle rating changes for items\n   */\n  private async _onRatingChange(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLInputElement;\n    const itemId = element.dataset.itemId;\n    const newRating = parseInt(element.value);\n    \n    if (!itemId || isNaN(newRating)) return;\n\n    const item = this.actor.items.get(itemId);\n    if (item) {\n      await item.update({ system: { rating: newRating } } as any);\n    }\n  }\n\n  /**\n   * Handle rolling a specialization\n   */\n  private async _onRollSpecialization(event: Event): Promise<void> {\n    event.preventDefault();\n    console.log(\"SRA2 | Roll specialization clicked!\");\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    const effectiveRating = parseInt(element.dataset.effectiveRating || '0');\n    \n    if (!itemId) {\n      console.error(\"SRA2 | No specialization ID found\");\n      return;\n    }\n\n    const specialization = this.actor.items.get(itemId);\n    if (!specialization || specialization.type !== 'specialization') return;\n\n    const specSystem = specialization.system as any;\n    const linkedAttribute = specSystem.linkedAttribute || 'strength';\n    \n    // Get the attribute value from the actor\n    const attributeValue = (this.actor.system as any).attributes?.[linkedAttribute] || 0;\n    const basePool = effectiveRating + attributeValue;\n\n    if (basePool <= 0) {\n      ui.notifications?.warn(game.i18n!.localize('SRA2.SPECIALIZATIONS.NO_DICE'));\n      return;\n    }\n\n    // Get localized attribute name\n    const attributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${linkedAttribute.toUpperCase()}`);\n    \n    // Calculate automatic RR from feats (specialization + attribute + parent skill)\n    const specializationRR = this.calculateRR('specialization', specialization.name);\n    const attributeRR = this.calculateRR('attribute', linkedAttribute);\n    \n    // Get RR from parent skill (if linked)\n    const linkedSkillName = specSystem.linkedSkill;\n    const skillRR = linkedSkillName ? this.calculateRR('skill', linkedSkillName) : 0;\n    \n    const autoRR = Math.min(3, specializationRR + attributeRR + skillRR);\n\n    // Create a dialog to optionally add modifiers and risk dice\n    new Dialog({\n      title: game.i18n!.format('SRA2.SPECIALIZATIONS.ROLL_TITLE', { name: specialization.name }),\n      content: `\n        <form class=\"sra2-roll-dialog\">\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.BASE_POOL')}: <strong>${basePool}</strong></label>\n            <p class=\"notes\">(${game.i18n!.localize('SRA2.SPECIALIZATIONS.BONUS')}: ${effectiveRating} + ${attributeLabel}: ${attributeValue})</p>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.MODIFIER')}:</label>\n            <input type=\"number\" name=\"modifier\" value=\"0\" min=\"-10\" max=\"10\" />\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE')}:</label>\n            <select name=\"rollMode\">\n              <option value=\"normal\" selected>${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_NORMAL')}</option>\n              <option value=\"advantage\">${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_ADVANTAGE')}</option>\n              <option value=\"disadvantage\">${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_DISADVANTAGE')}</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.RISK_DICE')} (max ${basePool}):</label>\n            <input type=\"number\" name=\"riskDice\" value=\"0\" min=\"0\" max=\"${basePool}\" />\n            <p class=\"notes\">${game.i18n!.localize('SRA2.SKILLS.RISK_DICE_HINT')}</p>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.RISK_REDUCTION')} </label>\n            <input type=\"number\" name=\"riskReduction\" value=\"${autoRR}\" min=\"0\" max=\"3\" />\n            <p class=\"notes\">${game.i18n!.localize('SRA2.SKILLS.RISK_REDUCTION_HINT')}${autoRR > 0 ? ' <strong>(Auto: ' + autoRR + ')</strong>' : ''}</p>\n          </div>\n        </form>\n      `,\n      buttons: {\n        roll: {\n          icon: '<i class=\"fas fa-dice-d6\"></i>',\n          label: game.i18n!.localize('SRA2.SKILLS.ROLL'),\n          callback: (html: any) => {\n            const modifier = parseInt(html.find('[name=\"modifier\"]').val()) || 0;\n            const totalPool = Math.max(1, basePool + modifier);\n            const riskDice = Math.min(totalPool, parseInt(html.find('[name=\"riskDice\"]').val()) || 0);\n            const normalDice = totalPool - riskDice;\n            const riskReduction = Math.max(0, Math.min(3, parseInt(html.find('[name=\"riskReduction\"]').val()) || 0));\n            const rollMode = html.find('[name=\"rollMode\"]').val() || 'normal';\n            this._rollSkillDice(specialization.name, normalDice, riskDice, riskReduction, rollMode);\n          }\n        },\n        cancel: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n!.localize('Cancel')\n        }\n      },\n      default: 'roll'\n    }).render(true);\n  }\n\n  /**\n   * Handle quick rolling a skill (from dice badge click) - opens dialog\n   */\n  private async _onQuickRollSkill(event: Event): Promise<void> {\n    // Simply call the regular roll skill function which opens the dialog\n    return this._onRollSkill(event);\n  }\n\n  /**\n   * Handle quick rolling a specialization (from dice badge click) - opens dialog\n   */\n  private async _onQuickRollSpecialization(event: Event): Promise<void> {\n    // Simply call the regular roll specialization function which opens the dialog\n    return this._onRollSpecialization(event);\n  }\n\n  /**\n   * Handle rolling an attribute\n   */\n  private async _onRollAttribute(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const attributeName = element.dataset.attribute;\n    \n    if (!attributeName) return;\n\n    const attributeValue = (this.actor.system as any).attributes?.[attributeName] || 0;\n    \n    if (attributeValue <= 0) {\n      ui.notifications?.warn(game.i18n!.localize('SRA2.ATTRIBUTES.NO_DICE'));\n      return;\n    }\n\n    // Calculate automatic RR from feats for this attribute\n    const autoRR = this.calculateRR('attribute', attributeName);\n\n    // Get localized attribute name\n    const attributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${attributeName.toUpperCase()}`);\n\n    // Create a dialog to optionally add modifiers and risk dice\n    new Dialog({\n      title: game.i18n!.format('SRA2.ATTRIBUTES.ROLL_TITLE', { name: attributeLabel }),\n      content: `\n        <form class=\"sra2-roll-dialog\">\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.ATTRIBUTES.BASE_POOL')}: <strong>${attributeValue}</strong></label>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.MODIFIER')}:</label>\n            <input type=\"number\" name=\"modifier\" value=\"0\" min=\"-10\" max=\"10\" />\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE')}:</label>\n            <select name=\"rollMode\">\n              <option value=\"normal\" selected>${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_NORMAL')}</option>\n              <option value=\"advantage\">${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_ADVANTAGE')}</option>\n              <option value=\"disadvantage\">${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_DISADVANTAGE')}</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.RISK_DICE')} (max ${attributeValue}):</label>\n            <input type=\"number\" name=\"riskDice\" value=\"0\" min=\"0\" max=\"${attributeValue}\" />\n            <p class=\"notes\">${game.i18n!.localize('SRA2.SKILLS.RISK_DICE_HINT')}</p>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.RISK_REDUCTION')} (max 3):</label>\n            <input type=\"number\" name=\"riskReduction\" value=\"${autoRR}\" min=\"0\" max=\"3\" />\n            <p class=\"notes\">${game.i18n!.localize('SRA2.SKILLS.RISK_REDUCTION_HINT')}${autoRR > 0 ? ' <strong>(Auto: ' + autoRR + ')</strong>' : ''}</p>\n          </div>\n        </form>\n      `,\n      buttons: {\n        roll: {\n          icon: '<i class=\"fas fa-dice-d6\"></i>',\n          label: game.i18n!.localize('SRA2.SKILLS.ROLL'),\n          callback: (html: any) => {\n            const modifier = parseInt(html.find('[name=\"modifier\"]').val()) || 0;\n            const totalPool = Math.max(1, attributeValue + modifier);\n            const riskDice = Math.min(totalPool, parseInt(html.find('[name=\"riskDice\"]').val()) || 0);\n            const normalDice = totalPool - riskDice;\n            const riskReduction = Math.max(0, Math.min(3, parseInt(html.find('[name=\"riskReduction\"]').val()) || 0));\n            const rollMode = html.find('[name=\"rollMode\"]').val() || 'normal';\n            this._rollSkillDice(attributeLabel, normalDice, riskDice, riskReduction, rollMode);\n          }\n        },\n        cancel: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n!.localize('Cancel')\n        }\n      },\n      default: 'roll'\n    }).render(true);\n  }\n\n  /**\n   * Handle rolling a skill\n   */\n  private async _onRollSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    console.log(\"SRA2 | Roll skill clicked!\");\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) {\n      console.error(\"SRA2 | No item ID found\");\n      return;\n    }\n\n    const skill = this.actor.items.get(itemId);\n    if (!skill || skill.type !== 'skill') return;\n\n    const skillSystem = skill.system as any;\n    const rating = skillSystem.rating || 0;\n    const linkedAttribute = skillSystem.linkedAttribute || 'strength';\n    \n    // Get the attribute value from the actor\n    const attributeValue = (this.actor.system as any).attributes?.[linkedAttribute] || 0;\n    const basePool = rating + attributeValue;\n    \n    if (basePool <= 0) {\n      ui.notifications?.warn(game.i18n!.localize('SRA2.SKILLS.NO_DICE'));\n      return;\n    }\n\n    // Get localized attribute name\n    const attributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${linkedAttribute.toUpperCase()}`);\n    \n    // Calculate automatic RR from feats (skill + attribute)\n    const skillRR = this.calculateRR('skill', skill.name);\n    const attributeRR = this.calculateRR('attribute', linkedAttribute);\n    const autoRR = Math.min(3, skillRR + attributeRR);\n\n    // Create a dialog to optionally add modifiers and risk dice\n    new Dialog({\n      title: game.i18n!.format('SRA2.SKILLS.ROLL_TITLE', { name: skill.name }),\n      content: `\n        <form class=\"sra2-roll-dialog\">\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.BASE_POOL')}: <strong>${basePool}</strong></label>\n            <p class=\"notes\">(${game.i18n!.localize('SRA2.SKILLS.RATING')}: ${rating} + ${attributeLabel}: ${attributeValue})</p>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.MODIFIER')}:</label>\n            <input type=\"number\" name=\"modifier\" value=\"0\" min=\"-10\" max=\"10\" />\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE')}:</label>\n            <select name=\"rollMode\">\n              <option value=\"normal\" selected>${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_NORMAL')}</option>\n              <option value=\"advantage\">${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_ADVANTAGE')}</option>\n              <option value=\"disadvantage\">${game.i18n!.localize('SRA2.SKILLS.ROLL_MODE_DISADVANTAGE')}</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.RISK_DICE')} (max ${basePool}):</label>\n            <input type=\"number\" name=\"riskDice\" value=\"0\" min=\"0\" max=\"${basePool}\" />\n            <p class=\"notes\">${game.i18n!.localize('SRA2.SKILLS.RISK_DICE_HINT')}</p>\n          </div>\n          <div class=\"form-group\">\n            <label>${game.i18n!.localize('SRA2.SKILLS.RISK_REDUCTION')}:</label>\n            <input type=\"number\" name=\"riskReduction\" value=\"${autoRR}\" min=\"0\" max=\"3\" />\n            <p class=\"notes\">${game.i18n!.localize('SRA2.SKILLS.RISK_REDUCTION_HINT')}${autoRR > 0 ? ' <strong>(Auto: ' + autoRR + ')</strong>' : ''}</p>\n          </div>\n        </form>\n      `,\n      buttons: {\n        roll: {\n          icon: '<i class=\"fas fa-dice-d6\"></i>',\n          label: game.i18n!.localize('SRA2.SKILLS.ROLL'),\n          callback: (html: any) => {\n            const modifier = parseInt(html.find('[name=\"modifier\"]').val()) || 0;\n            const totalPool = Math.max(1, basePool + modifier);\n            const riskDice = Math.min(totalPool, parseInt(html.find('[name=\"riskDice\"]').val()) || 0);\n            const normalDice = totalPool - riskDice;\n            const riskReduction = Math.max(0, Math.min(3, parseInt(html.find('[name=\"riskReduction\"]').val()) || 0));\n            const rollMode = html.find('[name=\"rollMode\"]').val() || 'normal';\n            this._rollSkillDice(skill.name, normalDice, riskDice, riskReduction, rollMode);\n          }\n        },\n        cancel: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n!.localize('Cancel')\n        }\n      },\n      default: 'roll'\n    }).render(true);\n  }\n\n\n  /**\n   * Roll skill dice and display results with Dice So Nice\n   */\n  private async _rollSkillDice(skillName: string, dicePool: number, riskDice: number = 0, riskReduction: number = 0, rollMode: string = 'normal'): Promise<void> {\n    let normalSuccesses = 0;\n    let riskSuccesses = 0;\n    let criticalFailures = 0;\n    let normalDiceResults = '';\n    let riskDiceResults = '';\n    \n    // Define success threshold based on roll mode\n    const getSuccessThreshold = (mode: string): number => {\n      switch (mode) {\n        case 'advantage': return 4;  // 4, 5, 6 = success\n        case 'disadvantage': return 6; // only 6 = success\n        default: return 5;  // 5, 6 = success\n      }\n    };\n    \n    const successThreshold = getSuccessThreshold(rollMode);\n    \n    // Roll normal dice\n    let normalRoll: Roll | null = null;\n    if (dicePool > 0) {\n      normalRoll = new Roll(`${dicePool}d6`);\n      await normalRoll.evaluate();\n      \n      const normalResults = normalRoll.dice[0]?.results || [];\n      normalSuccesses = normalResults.filter((r: any) => r.result >= successThreshold).length;\n      \n      normalDiceResults = normalResults.map((r: any) => {\n        const isSuccess = r.result >= successThreshold;\n        return `<span class=\"die normal ${isSuccess ? 'success' : 'failure'}\">${r.result}</span>`;\n      }).join(' ');\n    }\n    \n    // Roll risk dice\n    let riskRoll: Roll | null = null;\n    if (riskDice > 0) {\n      riskRoll = new Roll(`${riskDice}d6`);\n      await riskRoll.evaluate();\n      \n      const riskResults = riskRoll.dice[0]?.results || [];\n      \n      // Risk dice: success threshold gives 2 successes, 1 gives critical failure\n      riskResults.forEach((r: any) => {\n        if (r.result >= successThreshold) {\n          riskSuccesses += 2; // Double success on risk dice\n        } else if (r.result === 1) {\n          criticalFailures++;\n        }\n      });\n      \n      riskDiceResults = riskResults.map((r: any) => {\n        let cssClass = 'die risk ';\n        if (r.result >= successThreshold) {\n          cssClass += 'success';\n        } else if (r.result === 1) {\n          cssClass += 'critical';\n        } else {\n          cssClass += 'failure';\n        }\n        return `<span class=\"${cssClass}\">${r.result}</span>`;\n      }).join(' ');\n    }\n    \n    // Show Dice So Nice animations if available\n    if ((game as any).dice3d) {\n      const dice3d = (game as any).dice3d;\n      const promises: Promise<any>[] = [];\n      \n      // Show normal dice with gray color\n      if (normalRoll) {\n        promises.push(\n          dice3d.showForRoll(normalRoll, game.user, true, null, false, null, null, {\n            colorset: \"grey\"  // Grey color for normal dice\n          }).catch(() => {})\n        );\n      }\n      \n      // Show risk dice with purple color\n      if (riskRoll) {\n        // Wait a bit before showing risk dice so they appear after normal dice\n        await new Promise(resolve => setTimeout(resolve, 100));\n        promises.push(\n          dice3d.showForRoll(riskRoll, game.user, true, null, false, null, null, {\n            colorset: \"black\"  // Black color for risk dice\n          }).catch(() => {})\n        );\n      }\n      \n      // Wait for all dice animations to complete\n      await Promise.all(promises);\n    }\n    \n    // Apply risk reduction to critical failures\n    const rawCriticalFailures = criticalFailures;\n    criticalFailures = Math.max(0, criticalFailures - riskReduction);\n    \n    const totalSuccesses = normalSuccesses + riskSuccesses;\n    \n    // Build the results display\n    let resultsHtml = '<div class=\"sra2-skill-roll\">';\n    \n    // Dice pool info\n    const totalPool = dicePool + riskDice;\n    resultsHtml += '<div class=\"dice-pool\">';\n    resultsHtml += `<strong>${game.i18n!.localize('SRA2.SKILLS.DICE_POOL')}:</strong> `;\n    resultsHtml += `${totalPool}d6`;\n    if (riskDice > 0) {\n      resultsHtml += ` (${dicePool} ${game.i18n!.localize('SRA2.SKILLS.NORMAL')} + <span class=\"risk-label\">${riskDice} ${game.i18n!.localize('SRA2.SKILLS.RISK')}</span>`;\n      if (riskReduction > 0) {\n        resultsHtml += ` | <span class=\"rr-label\">RR ${riskReduction}</span>`;\n      }\n      resultsHtml += `)`;\n    } else if (riskReduction > 0) {\n      resultsHtml += ` | <span class=\"rr-label\">RR ${riskReduction}</span>`;\n    }\n    \n    // Display roll mode if not normal\n    if (rollMode !== 'normal') {\n      const modeKey = rollMode === 'advantage' ? 'ROLL_MODE_ADVANTAGE' : 'ROLL_MODE_DISADVANTAGE';\n      resultsHtml += ` | <span class=\"mode-label\">${game.i18n!.localize(`SRA2.SKILLS.${modeKey}`)}</span>`;\n    }\n    \n    resultsHtml += '</div>';\n    \n    // Normal dice results\n    if (normalDiceResults) {\n      resultsHtml += '<div class=\"dice-results\">';\n      resultsHtml += `<strong>${game.i18n!.localize('SRA2.SKILLS.NORMAL_DICE')}:</strong> ${normalDiceResults}`;\n      resultsHtml += `<span class=\"mini-success\"> (${normalSuccesses} ${game.i18n!.localize('SRA2.SKILLS.SUCCESSES_SHORT')})</span>`;\n      resultsHtml += '</div>';\n    }\n    \n    // Risk dice results\n    if (riskDiceResults) {\n      resultsHtml += '<div class=\"dice-results risk\">';\n      resultsHtml += `<strong>${game.i18n!.localize('SRA2.SKILLS.RISK_DICE')}:</strong> ${riskDiceResults}`;\n      resultsHtml += `<span class=\"mini-success\"> (${riskSuccesses} ${game.i18n!.localize('SRA2.SKILLS.SUCCESSES_SHORT')})</span>`;\n      resultsHtml += '</div>';\n    }\n    \n    // Total successes\n    resultsHtml += `<div class=\"successes ${totalSuccesses > 0 ? 'has-success' : 'no-success'}\">`;\n    resultsHtml += `<strong>${game.i18n!.localize('SRA2.SKILLS.TOTAL_SUCCESSES')}:</strong> ${totalSuccesses}`;\n    resultsHtml += '</div>';\n    \n    // Critical failures\n    if (rawCriticalFailures > 0 || riskReduction > 0) {\n      resultsHtml += `<div class=\"critical-failures ${criticalFailures === 0 ? 'reduced-to-zero' : ''}\">`;\n      resultsHtml += `<strong>${game.i18n!.localize('SRA2.SKILLS.CRITICAL_FAILURES')}:</strong> `;\n      \n      if (riskReduction > 0) {\n        resultsHtml += `<span class=\"calculation\">${rawCriticalFailures} - ${riskReduction} RR = </span>`;\n      }\n      \n      resultsHtml += `<span class=\"final-value\">${criticalFailures}</span>`;\n      resultsHtml += '</div>';\n    }\n    \n    resultsHtml += '</div>';\n    \n    // Create the chat message\n    const messageData = {\n      speaker: ChatMessage.getSpeaker({ actor: this.actor }),\n      flavor: game.i18n!.format('SRA2.SKILLS.ROLL_FLAVOR', { name: skillName }),\n      content: resultsHtml,\n      sound: CONFIG.sounds?.dice\n    };\n    \n    await ChatMessage.create(messageData);\n  }\n\n  /**\n   * Handle drag start for feat items\n   */\n  protected override _onDragStart(event: DragEvent): void {\n    const itemId = (event.currentTarget as HTMLElement).dataset.itemId;\n    if (!itemId) return;\n\n    const item = this.actor.items.get(itemId);\n    if (!item) return;\n\n    const dragData = {\n      type: 'Item',\n      uuid: item.uuid,\n    };\n\n    event.dataTransfer?.setData('text/plain', JSON.stringify(dragData));\n  }\n\n  /**\n   * Override to handle dropping feats and skills\n   */\n  protected override async _onDrop(event: DragEvent): Promise<any> {\n    const data = TextEditor.getDragEventData(event) as any;\n    const dropTarget = (event.target as HTMLElement).closest('[data-drop-zone]') as HTMLElement;\n    \n    // Handle Item drops\n    if (data && data.type === 'Item') {\n      const item = await Item.implementation.fromDropData(data) as any;\n      \n      if (!item) return super._onDrop(event);\n      \n      // Check if dropping in metatype section\n      if (dropTarget && dropTarget.dataset.dropZone === 'metatype') {\n        if (item.type === 'metatype') {\n          // Check if the item is from a compendium or another actor\n          if (!item.actor || item.actor.id !== this.actor.id) {\n            // Check if there's already a metatype\n            const existingMetatype = this.actor.items.find((i: any) => i.type === 'metatype');\n            \n            if (existingMetatype) {\n              const message = game.i18n!.localize('SRA2.METATYPES.ONLY_ONE_METATYPE');\n              ui.notifications?.warn(message);\n              return;\n            }\n            \n            await this.actor.createEmbeddedDocuments('Item', [item.toObject()]);\n            return;\n          }\n        } else {\n          ui.notifications?.warn(game.i18n!.localize('SRA2.METATYPES.ONLY_METATYPES'));\n          return;\n        }\n      }\n      \n      // Check if dropping in feats section\n      if (dropTarget && dropTarget.dataset.dropZone === 'feat') {\n        if (item.type === 'feat') {\n          // Check if the item is from a compendium or another actor\n          if (!item.actor || item.actor.id !== this.actor.id) {\n            // Check for duplicates by name\n            const existingFeat = this.actor.items.find((i: any) => \n              i.type === 'feat' && i.name === item.name\n            );\n            \n            if (existingFeat) {\n              const message = game.i18n!.format('SRA2.FEATS.ALREADY_EXISTS', { name: item.name });\n              ui.notifications?.warn(message);\n              return;\n            }\n            \n            await this.actor.createEmbeddedDocuments('Item', [item.toObject()]);\n            return;\n          }\n        } else {\n          ui.notifications?.warn(game.i18n!.localize('SRA2.FEATS.ONLY_FEATS'));\n          return;\n        }\n      }\n      \n      // Check if dropping in skills section\n      if (dropTarget && dropTarget.dataset.dropZone === 'skill') {\n        if (item.type === 'skill' || item.type === 'specialization') {\n          // Check if the item is from a compendium or another actor\n          if (!item.actor || item.actor.id !== this.actor.id) {\n            // Check for duplicates by name\n            const existingItem = this.actor.items.find((i: any) => \n              i.type === item.type && i.name === item.name\n            );\n            \n            if (existingItem) {\n              const messageKey = item.type === 'skill' ? 'SRA2.SKILLS.ALREADY_EXISTS' : 'SRA2.SPECIALIZATIONS.ALREADY_EXISTS';\n              const message = game.i18n!.format(messageKey, { name: item.name });\n              ui.notifications?.warn(message);\n              return;\n            }\n            \n            await this.actor.createEmbeddedDocuments('Item', [item.toObject()]);\n            return;\n          }\n        } else {\n          ui.notifications?.warn(game.i18n!.localize('SRA2.SKILLS.ONLY_SKILLS'));\n          return;\n        }\n      }\n    }\n\n    return super._onDrop(event);\n  }\n\n  /**\n   * Handle skill search input\n   */\n  private searchTimeout: any = null;\n  \n  private async _onSkillSearch(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const searchTerm = input.value.trim().toLowerCase();\n    const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n    \n    // Clear previous timeout\n    if (this.searchTimeout) {\n      clearTimeout(this.searchTimeout);\n    }\n    \n    // If search term is empty, hide results\n    if (searchTerm.length === 0) {\n      resultsDiv.style.display = 'none';\n      return;\n    }\n    \n    // Debounce search\n    this.searchTimeout = setTimeout(async () => {\n      await this._performSkillSearch(searchTerm, resultsDiv);\n    }, 300);\n  }\n\n  /**\n   * Perform the actual skill search in compendiums and world items\n   */\n  private async _performSkillSearch(searchTerm: string, resultsDiv: HTMLElement): Promise<void> {\n    const results: any[] = [];\n    \n    // Store search term for potential creation\n    this.lastSearchTerm = searchTerm;\n    \n    // Search in world items first\n    if (game.items) {\n      for (const item of game.items as any) {\n        if (item.type === 'skill' && item.name.toLowerCase().includes(searchTerm)) {\n          // Check if skill already exists on actor\n          const existingSkill = this.actor.items.find((i: any) => \n            i.type === 'skill' && i.name === item.name\n          );\n          \n          results.push({\n            name: item.name,\n            uuid: item.uuid,\n            pack: game.i18n!.localize('SRA2.SKILLS.WORLD_ITEMS'),\n            exists: !!existingSkill\n          });\n        }\n      }\n    }\n    \n    // Search in all compendiums\n    for (const pack of game.packs as any) {\n      // Only search in Item compendiums\n      if (pack.documentName !== 'Item') continue;\n      \n      // Get all documents from the pack\n      const documents = await pack.getDocuments();\n      \n      // Filter for skills that match the search term\n      for (const doc of documents) {\n        if (doc.type === 'skill' && doc.name.toLowerCase().includes(searchTerm)) {\n          // Check if skill already exists on actor\n          const existingSkill = this.actor.items.find((i: any) => \n            i.type === 'skill' && i.name === doc.name\n          );\n          \n          results.push({\n            name: doc.name,\n            uuid: doc.uuid,\n            pack: pack.title,\n            exists: !!existingSkill\n          });\n        }\n      }\n    }\n    \n    // Display results\n    this._displaySkillSearchResults(results, resultsDiv);\n  }\n\n  /**\n   * Display skill search results\n   */\n  private lastSearchTerm: string = '';\n  \n  private _displaySkillSearchResults(results: any[], resultsDiv: HTMLElement): void {\n    // Check if exact match exists on the actor\n    const formattedSearchTerm = this.lastSearchTerm\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    const exactMatchOnActor = this.actor.items.find((i: any) => \n      i.type === 'skill' && i.name.toLowerCase() === this.lastSearchTerm.toLowerCase()\n    );\n    \n    let html = '';\n    \n    // If no results at all, show only the create button with message\n    if (results.length === 0) {\n      html = `\n        <div class=\"search-result-item no-results-create\">\n          <div class=\"no-results-text\">\n            ${game.i18n!.localize('SRA2.SKILLS.SEARCH_NO_RESULTS')}\n          </div>\n          <button class=\"create-skill-btn\" data-skill-name=\"${this.lastSearchTerm}\">\n            <i class=\"fas fa-plus\"></i> ${game.i18n!.localize('SRA2.SKILLS.CREATE_SKILL')}\n          </button>\n        </div>\n      `;\n    } else {\n      // Display search results\n      for (const result of results) {\n        const disabledClass = result.exists ? 'disabled' : '';\n        const buttonText = result.exists ? '' : game.i18n!.localize('SRA2.SKILLS.ADD_SKILL');\n        \n        html += `\n          <div class=\"search-result-item ${disabledClass}\">\n            <div class=\"result-info\">\n              <span class=\"result-name\">${result.name}</span>\n              <span class=\"result-pack\">${result.pack}</span>\n            </div>\n            <button class=\"add-skill-btn\" data-uuid=\"${result.uuid}\" ${result.exists ? 'disabled' : ''}>\n              ${buttonText}\n            </button>\n          </div>\n        `;\n      }\n      \n      // Add create button if exact match doesn't exist on actor\n      if (!exactMatchOnActor) {\n        html += `\n          <div class=\"search-result-item create-new-item\">\n            <div class=\"result-info\">\n              <span class=\"result-name\"><i class=\"fas fa-plus-circle\"></i> ${formattedSearchTerm}</span>\n              <span class=\"result-pack\">${game.i18n!.localize('SRA2.SKILLS.CREATE_NEW')}</span>\n            </div>\n            <button class=\"create-skill-btn-inline\" data-skill-name=\"${this.lastSearchTerm}\">\n              ${game.i18n!.localize('SRA2.SKILLS.CREATE')}\n            </button>\n          </div>\n        `;\n      }\n    }\n    \n    resultsDiv.innerHTML = html;\n    resultsDiv.style.display = 'block';\n    \n    // Attach click handlers to buttons\n    $(resultsDiv).find('.add-skill-btn').on('click', this._onAddSkillFromSearch.bind(this));\n    $(resultsDiv).find('.create-skill-btn, .create-skill-btn-inline').on('click', this._onCreateNewSkill.bind(this));\n    \n    // Make entire result items clickable (except disabled ones and create button)\n    $(resultsDiv).find('.search-result-item:not(.disabled):not(.no-results-create):not(.create-new-item)').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.add-skill-btn').length > 0) return;\n      \n      // Find the button in this item and trigger its click\n      const button = $(event.currentTarget).find('.add-skill-btn')[0] as HTMLButtonElement;\n      if (button && !button.disabled) {\n        $(button).trigger('click');\n      }\n    });\n    \n    // Make create items clickable on the entire row\n    $(resultsDiv).find('.search-result-item.create-new-item').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.create-skill-btn-inline').length > 0) return;\n      \n      // Find the button and trigger its click\n      const button = $(event.currentTarget).find('.create-skill-btn-inline')[0];\n      if (button) {\n        $(button).trigger('click');\n      }\n    });\n  }\n\n  /**\n   * Handle adding a skill from search results\n   */\n  private async _onAddSkillFromSearch(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const uuid = button.dataset.uuid;\n    \n    if (!uuid) return;\n    \n    // Get the skill from the compendium\n    const skill = await fromUuid(uuid as any) as any;\n    \n    if (!skill) {\n      ui.notifications?.error('Skill not found');\n      return;\n    }\n    \n    // Check if skill already exists\n    const existingSkill = this.actor.items.find((i: any) => \n      i.type === 'skill' && i.name === skill.name\n    );\n    \n    if (existingSkill) {\n      ui.notifications?.warn(game.i18n!.format('SRA2.SKILLS.ALREADY_EXISTS', { name: skill.name }));\n      return;\n    }\n    \n    // Add the skill to the actor\n    await this.actor.createEmbeddedDocuments('Item', [skill.toObject()]);\n    \n    // Mark button as added\n    button.textContent = '';\n    button.disabled = true;\n    button.closest('.search-result-item')?.classList.add('disabled');\n    \n    ui.notifications?.info(`${skill.name} ${game.i18n!.localize('SRA2.SKILLS.ADD_SKILL')}`);\n  }\n\n  /**\n   * Handle skill search focus\n   */\n  private _onSkillSearchFocus(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    \n    // If there's already content and results, show them\n    if (input.value.trim().length > 0) {\n      const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv && resultsDiv.innerHTML.trim().length > 0) {\n        resultsDiv.style.display = 'block';\n      }\n    }\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle skill search blur\n   */\n  private _onSkillSearchBlur(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const blurEvent = event as FocusEvent;\n    \n    // Check if the new focus target is within the results div\n    setTimeout(() => {\n      const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        // Check if the related target (where focus is going) is inside the results div\n        const relatedTarget = blurEvent.relatedTarget as HTMLElement;\n        if (relatedTarget && resultsDiv.contains(relatedTarget)) {\n          // Don't hide if focus is moving to an element within the results\n          return;\n        }\n        \n        // Also check if any element in the results is focused\n        const activeElement = document.activeElement as HTMLElement;\n        if (activeElement && resultsDiv.contains(activeElement)) {\n          // Don't hide if an element in results is active\n          return;\n        }\n        \n        resultsDiv.style.display = 'none';\n      }\n    }, 200);\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle creating a new skill from search\n   */\n  private async _onCreateNewSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const skillName = button.dataset.skillName;\n    \n    if (!skillName) return;\n    \n    // Capitalize first letter of each word\n    const formattedName = skillName\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    // Create the new skill with default values\n    const skillData = {\n      name: formattedName,\n      type: 'skill',\n      system: {\n        rating: 1,\n        linkedAttribute: 'strength',\n        description: ''\n      }\n    } as any;\n    \n    // Add the skill to the actor\n    const createdItems = await this.actor.createEmbeddedDocuments('Item', [skillData]) as any;\n    \n    if (createdItems && createdItems.length > 0) {\n      const newSkill = createdItems[0] as any;\n      \n      // Clear the search input and hide results\n      const searchInput = this.element.find('.skill-search-input')[0] as HTMLInputElement;\n      if (searchInput) {\n        searchInput.value = '';\n      }\n      \n      const resultsDiv = this.element.find('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        resultsDiv.style.display = 'none';\n      }\n      \n      // Open the skill sheet for editing\n      if (newSkill && newSkill.sheet) {\n        setTimeout(() => {\n          newSkill.sheet.render(true);\n        }, 100);\n      }\n      \n      ui.notifications?.info(game.i18n!.format('SRA2.SKILLS.SKILL_CREATED', { name: formattedName }));\n    }\n  }\n\n  /**\n   * FEAT SEARCH FUNCTIONS\n   */\n  \n  private featSearchTimeout: any = null;\n  private lastFeatSearchTerm: string = '';\n  \n  /**\n   * Handle feat search input\n   */\n  private async _onFeatSearch(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const searchTerm = input.value.trim().toLowerCase();\n    const resultsDiv = $(input).siblings('.feat-search-results')[0] as HTMLElement;\n    \n    // Clear previous timeout\n    if (this.featSearchTimeout) {\n      clearTimeout(this.featSearchTimeout);\n    }\n    \n    // If search term is empty, hide results\n    if (searchTerm.length === 0) {\n      resultsDiv.style.display = 'none';\n      return;\n    }\n    \n    // Debounce search\n    this.featSearchTimeout = setTimeout(async () => {\n      await this._performFeatSearch(searchTerm, resultsDiv);\n    }, 300);\n  }\n\n  /**\n   * Perform the actual feat search in compendiums and world items\n   */\n  private async _performFeatSearch(searchTerm: string, resultsDiv: HTMLElement): Promise<void> {\n    const results: any[] = [];\n    \n    // Store search term for potential creation\n    this.lastFeatSearchTerm = searchTerm;\n    \n    // Search in world items first\n    if (game.items) {\n      for (const item of game.items as any) {\n        if (item.type === 'feat' && item.name.toLowerCase().includes(searchTerm)) {\n          // Check if feat already exists on actor\n          const existingFeat = this.actor.items.find((i: any) => \n            i.type === 'feat' && i.name === item.name\n          );\n          \n          results.push({\n            name: item.name,\n            uuid: item.uuid,\n            pack: game.i18n!.localize('SRA2.FEATS.WORLD_ITEMS'),\n            featType: item.system.featType,\n            exists: !!existingFeat\n          });\n        }\n      }\n    }\n    \n    // Search in all compendiums\n    for (const pack of game.packs as any) {\n      // Only search in Item compendiums\n      if (pack.documentName !== 'Item') continue;\n      \n      // Get all documents from the pack\n      const documents = await pack.getDocuments();\n      \n      // Filter for feats that match the search term\n      for (const doc of documents) {\n        if (doc.type === 'feat' && doc.name.toLowerCase().includes(searchTerm)) {\n          // Check if feat already exists on actor\n          const existingFeat = this.actor.items.find((i: any) => \n            i.type === 'feat' && i.name === doc.name\n          );\n          \n          results.push({\n            name: doc.name,\n            uuid: doc.uuid,\n            pack: pack.title,\n            featType: doc.system.featType,\n            exists: !!existingFeat\n          });\n        }\n      }\n    }\n    \n    // Display results\n    this._displayFeatSearchResults(results, resultsDiv);\n  }\n\n  /**\n   * Display feat search results\n   */\n  private _displayFeatSearchResults(results: any[], resultsDiv: HTMLElement): Promise<void> {\n    // Check if exact match exists on the actor\n    const formattedSearchTerm = this.lastFeatSearchTerm\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    const exactMatchOnActor = this.actor.items.find((i: any) => \n      i.type === 'feat' && i.name.toLowerCase() === this.lastFeatSearchTerm.toLowerCase()\n    );\n    \n    let html = '';\n    \n    // If no results at all, show only the create button with message and type selector\n    if (results.length === 0) {\n      html = `\n        <div class=\"search-result-item no-results-create\">\n          <div class=\"no-results-text\">\n            ${game.i18n!.localize('SRA2.FEATS.SEARCH_NO_RESULTS')}\n          </div>\n          <select class=\"feat-type-selector\">\n            <option value=\"equipment\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.EQUIPMENT')}</option>\n            <option value=\"trait\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.TRAIT')}</option>\n            <option value=\"contact\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CONTACT')}</option>\n            <option value=\"awakened\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.AWAKENED')}</option>\n            <option value=\"adept-power\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.ADEPT_POWER')}</option>\n            <option value=\"cyberware\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CYBERWARE')}</option>\n            <option value=\"cyberdeck\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CYBERDECK')}</option>\n            <option value=\"vehicle\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.VEHICLE')}</option>\n            <option value=\"weapons-spells\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.WEAPONS_SPELLS')}</option>\n          </select>\n          <button class=\"create-feat-btn\" data-feat-name=\"${this.lastFeatSearchTerm}\">\n            <i class=\"fas fa-plus\"></i> ${game.i18n!.localize('SRA2.FEATS.CREATE')}\n          </button>\n        </div>\n      `;\n    } else {\n      // Display search results\n      for (const result of results) {\n        const disabledClass = result.exists ? 'disabled' : '';\n        const buttonText = result.exists ? '' : game.i18n!.localize('SRA2.FEATS.ADD_FEAT');\n        const featTypeLabel = game.i18n!.localize(`SRA2.FEATS.FEAT_TYPE.${result.featType.toUpperCase().replace('-', '_')}`);\n        \n        html += `\n          <div class=\"search-result-item ${disabledClass}\">\n            <div class=\"result-info\">\n              <span class=\"result-name\">${result.name}</span>\n              <span class=\"result-pack\">${result.pack} - ${featTypeLabel}</span>\n            </div>\n            <button class=\"add-feat-btn\" data-uuid=\"${result.uuid}\" ${result.exists ? 'disabled' : ''}>\n              ${buttonText}\n            </button>\n          </div>\n        `;\n      }\n      \n      // Add create button if exact match doesn't exist on actor\n      if (!exactMatchOnActor) {\n        html += `\n          <div class=\"search-result-item create-new-item\">\n            <div class=\"result-info\">\n              <span class=\"result-name\"><i class=\"fas fa-plus-circle\"></i> ${formattedSearchTerm}</span>\n              <span class=\"result-pack\">${game.i18n!.localize('SRA2.FEATS.CREATE_NEW')}</span>\n            </div>\n            <select class=\"feat-type-selector-inline\">\n              <option value=\"equipment\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.EQUIPMENT')}</option>\n              <option value=\"trait\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.TRAIT')}</option>\n              <option value=\"contact\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CONTACT')}</option>\n              <option value=\"awakened\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.AWAKENED')}</option>\n              <option value=\"adept-power\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.ADEPT_POWER')}</option>\n              <option value=\"cyberware\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CYBERWARE')}</option>\n              <option value=\"cyberdeck\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CYBERDECK')}</option>\n              <option value=\"vehicle\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.VEHICLE')}</option>\n              <option value=\"weapons-spells\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.WEAPONS_SPELLS')}</option>\n            </select>\n            <button class=\"create-feat-btn-inline\" data-feat-name=\"${this.lastFeatSearchTerm}\">\n              ${game.i18n!.localize('SRA2.FEATS.CREATE')}\n            </button>\n          </div>\n        `;\n      }\n    }\n    \n    resultsDiv.innerHTML = html;\n    resultsDiv.style.display = 'block';\n    \n    // Attach click handlers\n    $(resultsDiv).find('.add-feat-btn').on('click', this._onAddFeatFromSearch.bind(this));\n    $(resultsDiv).find('.create-feat-btn, .create-feat-btn-inline').on('click', this._onCreateNewFeat.bind(this));\n    \n    // Make entire result items clickable (except disabled ones and create button)\n    $(resultsDiv).find('.search-result-item:not(.disabled):not(.no-results-create):not(.create-new-item)').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.add-feat-btn').length > 0) return;\n      \n      // Find the button in this item and trigger its click\n      const button = $(event.currentTarget).find('.add-feat-btn')[0] as HTMLButtonElement;\n      if (button && !button.disabled) {\n        $(button).trigger('click');\n      }\n    });\n    \n    // Make create items clickable on the entire row\n    $(resultsDiv).find('.search-result-item.create-new-item').on('click', (event) => {\n      // Don't trigger if clicking directly on the button or select\n      if ($(event.target).closest('.create-feat-btn-inline, .feat-type-selector-inline').length > 0) return;\n      \n      // Find the button and trigger its click\n      const button = $(event.currentTarget).find('.create-feat-btn-inline')[0];\n      if (button) {\n        $(button).trigger('click');\n      }\n    });\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle adding a feat from search results\n   */\n  private async _onAddFeatFromSearch(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const uuid = button.dataset.uuid;\n    \n    if (!uuid) return;\n    \n    // Get the feat from the compendium\n    const feat = await fromUuid(uuid as any) as any;\n    \n    if (!feat) {\n      ui.notifications?.error('Feat not found');\n      return;\n    }\n    \n    // Check if feat already exists\n    const existingFeat = this.actor.items.find((i: any) => \n      i.type === 'feat' && i.name === feat.name\n    );\n    \n    if (existingFeat) {\n      ui.notifications?.warn(game.i18n!.format('SRA2.FEATS.ALREADY_EXISTS', { name: feat.name }));\n      return;\n    }\n    \n    // Add the feat to the actor\n    await this.actor.createEmbeddedDocuments('Item', [feat.toObject()]);\n    \n    // Mark button as added\n    button.textContent = '';\n    button.disabled = true;\n    button.closest('.search-result-item')?.classList.add('disabled');\n    \n    ui.notifications?.info(`${feat.name} ${game.i18n!.localize('SRA2.FEATS.ADD_FEAT')}`);\n  }\n\n  /**\n   * Handle feat search focus\n   */\n  private _onFeatSearchFocus(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    \n    // If there's already content and results, show them\n    if (input.value.trim().length > 0) {\n      const resultsDiv = $(input).siblings('.feat-search-results')[0] as HTMLElement;\n      if (resultsDiv && resultsDiv.innerHTML.trim().length > 0) {\n        resultsDiv.style.display = 'block';\n      }\n    }\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle feat search blur\n   */\n  private _onFeatSearchBlur(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const blurEvent = event as FocusEvent;\n    \n    // Check if the new focus target is within the results div\n    setTimeout(() => {\n      const resultsDiv = $(input).siblings('.feat-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        // Check if the related target (where focus is going) is inside the results div\n        const relatedTarget = blurEvent.relatedTarget as HTMLElement;\n        if (relatedTarget && resultsDiv.contains(relatedTarget)) {\n          // Don't hide if focus is moving to an element within the results\n          return;\n        }\n        \n        // Also check if any select element in the results is focused\n        const activeElement = document.activeElement as HTMLElement;\n        if (activeElement && resultsDiv.contains(activeElement)) {\n          // Don't hide if a select or other element in results is active\n          return;\n        }\n        \n        resultsDiv.style.display = 'none';\n      }\n    }, 200);\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle creating a new feat from search\n   */\n  private async _onCreateNewFeat(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const featName = button.dataset.featName;\n    \n    if (!featName) return;\n    \n    // Get the feat type from the selector\n    const selector = $(button).siblings('.feat-type-selector, .feat-type-selector-inline')[0] as HTMLSelectElement;\n    const featType = selector ? selector.value : 'equipment';\n    \n    // Capitalize first letter of each word\n    const formattedName = featName\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    // Create the new feat with default values\n    const featData = {\n      name: formattedName,\n      type: 'feat',\n      system: {\n        description: '',\n        rating: 0,\n        cost: 'free-equipment',\n        active: true,\n        featType: featType,\n        rrType: [],\n        rrValue: [],\n        rrTarget: [],\n        bonusLightDamage: 0,\n        bonusSevereDamage: 0,\n        bonusPhysicalThreshold: 0,\n        bonusMentalThreshold: 0,\n        bonusAnarchy: 0,\n        essenceCost: 0\n      }\n    } as any;\n    \n    // Add the feat to the actor\n    const createdItems = await this.actor.createEmbeddedDocuments('Item', [featData]) as any;\n    \n    if (createdItems && createdItems.length > 0) {\n      const newFeat = createdItems[0] as any;\n      \n      // Clear the search input and hide results\n      const searchInput = this.element.find('.feat-search-input')[0] as HTMLInputElement;\n      if (searchInput) {\n        searchInput.value = '';\n      }\n      \n      const resultsDiv = this.element.find('.feat-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        resultsDiv.style.display = 'none';\n      }\n      \n      // Open the feat sheet for editing\n      if (newFeat && newFeat.sheet) {\n        setTimeout(() => {\n          newFeat.sheet.render(true);\n        }, 100);\n      }\n      \n      ui.notifications?.info(game.i18n!.format('SRA2.FEATS.FEAT_CREATED', { name: formattedName }));\n    }\n  }\n}\n\n","/**\n * Feat Sheet Application\n */\nexport class FeatSheet extends ItemSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Item> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'item', 'feat'],\n      template: 'systems/sra2/templates/item-feat-sheet.hbs',\n      width: 520,\n      height: 480,\n      tabs: [],\n      dragDrop: [\n        { dropSelector: '.rr-target-drop-zone' }\n      ],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n    context.system = this.item.system;\n    \n    // Build RR entries array from rrType, rrValue, and rrTarget arrays\n    context.rrEntries = [];\n    const rrTypes = context.system.rrType || [];\n    const rrValues = context.system.rrValue || [];\n    const rrTargets = context.system.rrTarget || [];\n    \n    for (let i = 0; i < rrTypes.length; i++) {\n      const rrType = rrTypes[i];\n      const rrValue = rrValues[i] || 0;\n      const rrTarget = rrTargets[i] || '';\n      \n      const entry: any = {\n        index: i,\n        rrType,\n        rrValue,\n        rrTarget,\n        rrTargetName: rrTarget\n      };\n      \n      if (rrType === 'skill' || rrType === 'specialization') {\n        entry.rrTargetType = rrType === 'skill' \n          ? game.i18n!.localize('SRA2.FEATS.RR_TYPE.SKILL')\n          : game.i18n!.localize('SRA2.FEATS.RR_TYPE.SPECIALIZATION');\n        \n        // If the feat is on an actor, check if the target exists\n        if (this.item.actor && rrTarget) {\n          const targetItem = this.item.actor.items.find((i: any) => \n            i.type === rrType && i.name === rrTarget\n          );\n          \n          if (!targetItem) {\n            entry.rrTargetNotFound = true;\n          }\n        }\n      }\n      \n      context.rrEntries.push(entry);\n    }\n    \n    return context;\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n    \n    // Add RR entry button\n    html.find('[data-action=\"add-rr-entry\"]').on('click', this._onAddRREntry.bind(this));\n    \n    // Remove RR entry button\n    html.find('[data-action=\"remove-rr-entry\"]').on('click', this._onRemoveRREntry.bind(this));\n    \n    // Clear RR target button\n    html.find('[data-action=\"clear-rr-target\"]').on('click', this._onClearRRTarget.bind(this));\n  }\n\n  /**\n   * Handle adding a new RR entry\n   */\n  private async _onAddRREntry(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const rrTypes = [...((this.item.system as any).rrType || [])];\n    const rrValues = [...((this.item.system as any).rrValue || [])];\n    const rrTargets = [...((this.item.system as any).rrTarget || [])];\n    \n    rrTypes.push('skill');\n    rrValues.push(0);\n    rrTargets.push('');\n    \n    await this.item.update({\n      'system.rrType': rrTypes,\n      'system.rrValue': rrValues,\n      'system.rrTarget': rrTargets\n    } as any);\n    \n    this.render(false);\n  }\n\n  /**\n   * Handle removing an RR entry\n   */\n  private async _onRemoveRREntry(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const index = parseInt((event.currentTarget as HTMLElement).dataset.index || '0');\n    \n    const rrTypes = [...((this.item.system as any).rrType || [])];\n    const rrValues = [...((this.item.system as any).rrValue || [])];\n    const rrTargets = [...((this.item.system as any).rrTarget || [])];\n    \n    rrTypes.splice(index, 1);\n    rrValues.splice(index, 1);\n    rrTargets.splice(index, 1);\n    \n    await this.item.update({\n      'system.rrType': rrTypes,\n      'system.rrValue': rrValues,\n      'system.rrTarget': rrTargets\n    } as any);\n    \n    this.render(false);\n  }\n\n  /**\n   * Handle clearing the RR target for a specific entry\n   */\n  private async _onClearRRTarget(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const index = parseInt((event.currentTarget as HTMLElement).dataset.index || '0');\n    const rrTargets = [...((this.item.system as any).rrTarget || [])];\n    \n    rrTargets[index] = '';\n    \n    await this.item.update({ 'system.rrTarget': rrTargets } as any);\n    this.render(false);\n  }\n\n  /**\n   * Handle dropping a skill or specialization onto the RR target field\n   */\n  protected override async _onDrop(event: DragEvent): Promise<any> {\n    const data = TextEditor.getDragEventData(event) as any;\n    \n    // Handle Item drops\n    if (data && data.type === 'Item') {\n      const item = await Item.implementation.fromDropData(data) as any;\n      \n      if (!item) return super._onDrop(event);\n      \n      // Find the drop zone and get the index\n      const dropZone = (event.target as HTMLElement).closest('[data-rr-index]');\n      if (!dropZone) return super._onDrop(event);\n      \n      const index = parseInt((dropZone as HTMLElement).dataset.rrIndex || '0');\n      const rrTypes = [...((this.item.system as any).rrType || [])];\n      const rrType = rrTypes[index];\n      \n      // Check if it's a skill or specialization matching the RR type\n      if (item.type === 'skill' && rrType === 'skill') {\n        // Store the skill name (not ID) so the feat can be prepared in advance\n        const rrTargets = [...((this.item.system as any).rrTarget || [])];\n        rrTargets[index] = item.name;\n        await this.item.update({ 'system.rrTarget': rrTargets } as any);\n        this.render(false);\n        ui.notifications?.info(game.i18n!.format('SRA2.FEATS.LINKED_TO_TARGET', { name: item.name }));\n        return;\n      } else if (item.type === 'specialization' && rrType === 'specialization') {\n        // Store the specialization name (not ID) so the feat can be prepared in advance\n        const rrTargets = [...((this.item.system as any).rrTarget || [])];\n        rrTargets[index] = item.name;\n        await this.item.update({ 'system.rrTarget': rrTargets } as any);\n        this.render(false);\n        ui.notifications?.info(game.i18n!.format('SRA2.FEATS.LINKED_TO_TARGET', { name: item.name }));\n        return;\n      } else if (rrType === 'skill' || rrType === 'specialization') {\n        // Wrong type of item\n        ui.notifications?.warn(game.i18n!.localize('SRA2.FEATS.WRONG_TARGET_TYPE'));\n        return;\n      }\n    }\n\n    return super._onDrop(event);\n  }\n\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = foundry.utils.expandObject(formData);\n    return this.item.update(expandedData);\n  }\n}\n\n","/**\n * Skill Sheet Application\n */\nexport class SkillSheet extends ItemSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Item> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'item', 'skill'],\n      template: 'systems/sra2/templates/item-skill-sheet.hbs',\n      width: 520,\n      height: 480,\n      tabs: [],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n    context.system = this.item.system;\n    return context;\n  }\n\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = foundry.utils.expandObject(formData);\n    return this.item.update(expandedData);\n  }\n}\n\n","/**\n * Specialization Sheet Application\n */\nexport class SpecializationSheet extends ItemSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Item> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'item', 'specialization'],\n      template: 'systems/sra2/templates/item-specialization-sheet.hbs',\n      width: 520,\n      height: 480,\n      tabs: [],\n      dragDrop: [\n        { dropSelector: '.linked-skill-drop-zone' }\n      ],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n    context.system = this.item.system;\n    \n    // Get linked skill info if exists\n    if (context.system.linkedSkill) {\n      // linkedSkill is stored as a name, so we display it directly\n      context.linkedSkillName = context.system.linkedSkill;\n      \n      // If the specialization is on an actor, check if the skill exists\n      if (this.item.actor) {\n        const linkedSkill = this.item.actor.items.find((i: any) => \n          i.type === 'skill' && i.name === context.system.linkedSkill\n        );\n        \n        if (!linkedSkill) {\n          // Mark as warning if skill doesn't exist on this actor\n          context.linkedSkillNotFound = true;\n        }\n      }\n    }\n    \n    // Get list of skills from the actor if this item is owned (for dropdown)\n    if (this.item.actor) {\n      const skills = this.item.actor.items.filter((i: any) => i.type === 'skill');\n      context.skills = skills.map((s: any) => ({\n        name: s.name\n      }));\n    } else {\n      context.skills = [];\n    }\n    \n    return context;\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n    \n    // Clear linked skill button\n    html.find('[data-action=\"clear-linked-skill\"]').on('click', this._onClearLinkedSkill.bind(this));\n  }\n\n  /**\n   * Handle clearing the linked skill\n   */\n  private async _onClearLinkedSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    await this.item.update({ 'system.linkedSkill': '' } as any);\n    this.render(false);\n  }\n\n  /**\n   * Handle dropping a skill onto the linked skill field\n   */\n  protected override async _onDrop(event: DragEvent): Promise<any> {\n    const data = TextEditor.getDragEventData(event) as any;\n    \n    // Handle Item drops\n    if (data && data.type === 'Item') {\n      const item = await Item.implementation.fromDropData(data) as any;\n      \n      if (!item) return super._onDrop(event);\n      \n      // Check if it's a skill\n      if (item.type === 'skill') {\n        // Store the skill name (not ID) so the specialization can be prepared in advance\n        await this.item.update({ 'system.linkedSkill': item.name } as any);\n        this.render(false);\n        ui.notifications?.info(game.i18n!.format('SRA2.SPECIALIZATIONS.LINKED_TO_SKILL', { name: item.name }));\n        return;\n      } else {\n        ui.notifications?.warn(game.i18n!.localize('SRA2.SPECIALIZATIONS.ONLY_SKILLS_CAN_BE_LINKED'));\n        return;\n      }\n    }\n\n    return super._onDrop(event);\n  }\n\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = foundry.utils.expandObject(formData);\n    return this.item.update(expandedData);\n  }\n}\n\n","/**\n * Metatype Sheet Application\n */\nexport class MetatypeSheet extends ItemSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Item> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'item', 'metatype'],\n      template: 'systems/sra2/templates/item-metatype-sheet.hbs',\n      width: 520,\n      height: 580,\n      tabs: [],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n    context.system = this.item.system;\n    return context;\n  }\n\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = foundry.utils.expandObject(formData);\n    return this.item.update(expandedData);\n  }\n}\n\n","import { SYSTEM } from \"./config/system.ts\";\n\n// Expose the SYSTEM object to the global scope\nglobalThis.SYSTEM = SYSTEM;\n\nimport * as models from \"./models/_module.ts\";\nimport * as documents from \"./documents/_module.ts\";\nimport * as applications from \"./applications/_module.ts\";\n\nexport class SRA2System {\n  static start(): void {\n    new SRA2System();\n  }\n\n  constructor() {\n    if (game.system) {\n      game.system.sra2 = this;\n    }\n    Hooks.once('init', () => this.onInit());\n  }\n  \n  onInit(): void {\n    console.log(SYSTEM.LOG.HEAD + 'SRA2System.onInit');\n    if (game.system) {\n      game.system.api = {\n        applications,\n        models,\n        documents,\n      };\n    }\n    \n    // Register custom Actor document class\n    CONFIG.Actor.documentClass = documents.SRA2Actor;\n    \n    // Register Actor data models\n    CONFIG.Actor.dataModels = {\n      character: models.CharacterDataModel,\n      npc: models.NpcDataModel,\n    };\n    \n    // Register Item data models\n    CONFIG.Item.dataModels = {\n      skill: models.SkillDataModel,\n      feat: models.FeatDataModel,\n      specialization: models.SpecializationDataModel,\n      metatype: models.MetatypeDataModel,\n    };\n    \n    // Register character sheet\n    DocumentSheetConfig.registerSheet(Actor, \"sra2\", applications.CharacterSheet, {\n      types: [\"character\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.CHARACTER\"\n    });\n    \n    // Register feat sheet\n    DocumentSheetConfig.registerSheet(Item, \"sra2\", applications.FeatSheet, {\n      types: [\"feat\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.FEAT\"\n    });\n    \n    // Register skill sheet\n    DocumentSheetConfig.registerSheet(Item, \"sra2\", applications.SkillSheet, {\n      types: [\"skill\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.SKILL\"\n    });\n    \n    // Register specialization sheet\n    DocumentSheetConfig.registerSheet(Item, \"sra2\", applications.SpecializationSheet, {\n      types: [\"specialization\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.SPECIALIZATION\"\n    });\n    \n    // Register metatype sheet\n    DocumentSheetConfig.registerSheet(Item, \"sra2\", applications.MetatypeSheet, {\n      types: [\"metatype\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.METATYPE\"\n    });\n    \n    // Register Handlebars helpers\n    Handlebars.registerHelper('add', function(a: number, b: number) {\n      return a + b;\n    });\n    \n    Handlebars.registerHelper('eq', function(a: any, b: any) {\n      return a === b;\n    });\n    \n    Hooks.once(\"ready\", () => this.onReady());\n  }\n\n  async onReady(): Promise<void> {\n    console.log(SYSTEM.LOG.HEAD + 'SRA2System.onReady');\n    \n    // Migrate old feat data to new array format\n    await this.migrateFeatsToArrayFormat();\n    \n    // Migrate anarchyNimbus to anarchySpent\n    await this.migrateAnarchyNimbusToSpent();\n  }\n  \n  /**\n   * Migrate old feat data (single rrType/rrValue/rrTarget) to new array format\n   */\n  async migrateFeatsToArrayFormat(): Promise<void> {\n    const featsToUpdate: any[] = [];\n    \n    // Check all feats in the world\n    for (const item of game.items! as any) {\n      if ((item as any).type === 'feat') {\n        const system = (item as any).system as any;\n        let needsUpdate = false;\n        const updates: any = { _id: (item as any).id };\n        \n        // Check if rrType is not an array (old format)\n        if (system.rrType !== undefined && !Array.isArray(system.rrType)) {\n          needsUpdate = true;\n          // Convert single value to array (only if not \"none\")\n          if (system.rrType !== 'none') {\n            updates['system.rrType'] = [system.rrType];\n            updates['system.rrValue'] = [system.rrValue || 0];\n            updates['system.rrTarget'] = [system.rrTarget || ''];\n          } else {\n            updates['system.rrType'] = [];\n            updates['system.rrValue'] = [];\n            updates['system.rrTarget'] = [];\n          }\n        }\n        \n        if (needsUpdate) {\n          featsToUpdate.push(updates);\n        }\n      }\n    }\n    \n    // Check all feats on actors\n    for (const actor of game.actors! as any) {\n      const actorUpdates: any[] = [];\n      \n      for (const item of (actor as any).items) {\n        if ((item as any).type === 'feat') {\n          const system = (item as any).system as any;\n          let needsUpdate = false;\n          const updates: any = { _id: (item as any).id };\n          \n          // Check if rrType is not an array (old format)\n          if (system.rrType !== undefined && !Array.isArray(system.rrType)) {\n            needsUpdate = true;\n            // Convert single value to array (only if not \"none\")\n            if (system.rrType !== 'none') {\n              updates['system.rrType'] = [system.rrType];\n              updates['system.rrValue'] = [system.rrValue || 0];\n              updates['system.rrTarget'] = [system.rrTarget || ''];\n            } else {\n              updates['system.rrType'] = [];\n              updates['system.rrValue'] = [];\n              updates['system.rrTarget'] = [];\n            }\n          }\n          \n          if (needsUpdate) {\n            actorUpdates.push(updates);\n          }\n        }\n      }\n      \n      if (actorUpdates.length > 0) {\n        console.log(`${SYSTEM.LOG.HEAD} Migrating ${actorUpdates.length} feats on actor ${(actor as any).name}`);\n        await (actor as any).updateEmbeddedDocuments('Item', actorUpdates);\n      }\n    }\n    \n    if (featsToUpdate.length > 0) {\n      console.log(`${SYSTEM.LOG.HEAD} Migrating ${featsToUpdate.length} world feats`);\n      await Item.updateDocuments(featsToUpdate);\n    }\n    \n    if (featsToUpdate.length > 0 || (game.actors! as any).some((a: any) => a.items.some((i: any) => i.type === 'feat'))) {\n      console.log(`${SYSTEM.LOG.HEAD} Feat migration to array format complete`);\n    }\n  }\n  \n  /**\n   * Migrate anarchyNimbus to anarchySpent\n   */\n  async migrateAnarchyNimbusToSpent(): Promise<void> {\n    const actorsToUpdate: any[] = [];\n    \n    // Check all character actors in the world\n    for (const actor of game.actors! as any) {\n      if ((actor as any).type === 'character') {\n        const system = (actor as any).system as any;\n        \n        // Check if the old anarchyNimbus field exists\n        if (system.anarchyNimbus !== undefined && system.anarchySpent === undefined) {\n          actorsToUpdate.push({\n            _id: (actor as any).id,\n            'system.anarchySpent': system.anarchyNimbus\n          });\n        }\n      }\n    }\n    \n    if (actorsToUpdate.length > 0) {\n      console.log(`${SYSTEM.LOG.HEAD} Migrating anarchyNimbus to anarchySpent for ${actorsToUpdate.length} actors`);\n      await Actor.updateDocuments(actorsToUpdate);\n      console.log(`${SYSTEM.LOG.HEAD} anarchyNimbus to anarchySpent migration complete`);\n    }\n  }\n}\n\n","import { SRA2System } from \"./module/sra2-system.ts\";\n\nSRA2System.start();\n\nimport \"./styles/global.scss\";\n\n"],"names":["documents","i","documents.SRA2Actor","models.CharacterDataModel","models.NpcDataModel","models.SkillDataModel","models.FeatDataModel","models.SpecializationDataModel","models.MetatypeDataModel","applications.CharacterSheet","applications.FeatSheet","applications.SkillSheet","applications.SpecializationSheet","applications.MetatypeSheet"],"mappings":"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"}