{"version":3,"file":"index.mjs","sources":["../src/module/config/system.ts","../src/module/models/actor-character.ts","../src/module/models/item-skill.ts","../src/module/models/item-feat.ts","../src/module/models/item-specialization.ts","../src/module/models/item-metatype.ts","../src/module/documents/actor.ts","../src/module/helpers/dice-roller.ts","../src/module/helpers/item-search.ts","../src/module/helpers/sheet-helpers.ts","../src/module/applications/character-sheet.ts","../src/module/applications/npc-sheet.ts","../src/module/applications/feat-sheet.ts","../src/module/applications/skill-sheet.ts","../src/module/applications/specialization-sheet.ts","../src/module/applications/metatype-sheet.ts","../src/module/applications/roll-dialog.ts","../src/module/hooks.mjs","../src/module/migration/migration.mjs","../src/module/migration/migration-13.0.3.mjs","../src/module/migration/migration-13.0.4.mjs","../src/module/migration/migration-13.0.5.mjs","../src/module/migration/migration-13.0.6.mjs","../src/module/migration/migration-13.0.7.mjs","../src/module/migration/migration-13.0.8.mjs","../src/module/migration/migration-13.0.9.mjs","../src/module/migration/migration-13.0.10.mjs","../src/module/migration/migration-13.0.11.mjs","../src/module/migration/migration-13.0.12.mjs","../src/module/sra2-system.ts","../src/start.ts"],"sourcesContent":["const SYSTEM_ID = 'sra2';\n\nexport interface SystemConfig {\n  id: string;\n  LOG: {\n    HEAD: string;\n  };\n  SOCKET: string;\n  PATH: {\n    ROOT: string;\n    STYLE: string;\n    TEMPLATES: string;\n    ASSETS: string;\n  };\n}\n\nexport const SYSTEM: SystemConfig = {\n  id: SYSTEM_ID,\n  LOG: {\n    HEAD: `${SYSTEM_ID} | `\n  },\n  SOCKET: `system.${SYSTEM_ID}`,\n  PATH: {\n    ROOT: `systems/${SYSTEM_ID}`,\n    STYLE: `systems/${SYSTEM_ID}/style`,\n    TEMPLATES: `systems/${SYSTEM_ID}/templates`,\n    ASSETS: `systems/${SYSTEM_ID}/assets`,\n  }\n};\n\n","/**\n * Data model for Character actors\n */\nexport class CharacterDataModel extends foundry.abstract.TypeDataModel<any, Actor> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      attributes: new fields.SchemaField({\n        strength: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        }),\n        agility: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        }),\n        willpower: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        }),\n        logic: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        }),\n        charisma: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 1,\n          integer: true\n        })\n      }),\n      resources: new fields.SchemaField({\n        yens: new fields.NumberField({\n          required: true,\n          initial: 0,\n          min: 0,\n          integer: true\n        }),\n        anarchy: new fields.NumberField({\n          required: true,\n          initial: 0,\n          min: 0,\n          integer: true\n        })\n      }),\n      maxEssence: new fields.NumberField({\n        required: true,\n        initial: 6,\n        min: 0,\n        integer: true\n      }),\n      armorLevel: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 5,\n        integer: true\n      }),\n      damage: new fields.SchemaField({\n        light: new fields.ArrayField(new fields.BooleanField({\n          required: true,\n          initial: false\n        }), {\n          required: true,\n          initial: [false, false]\n        }),\n        severe: new fields.ArrayField(new fields.BooleanField({\n          required: true,\n          initial: false\n        }), {\n          required: true,\n          initial: [false]\n        }),\n        incapacitating: new fields.BooleanField({\n          required: true,\n          initial: false\n        })\n      }),\n      anarchySpent: new fields.ArrayField(new fields.BooleanField({\n        required: true,\n        initial: false\n      }), {\n        required: true,\n        initial: [false, false, false]\n      }),\n      bio: new fields.SchemaField({\n        background: new fields.HTMLField({\n          required: true,\n          initial: \"\"\n        }),\n        notes: new fields.HTMLField({\n          required: true,\n          initial: \"\"\n        })\n      }),\n      keywords: new fields.SchemaField({\n        keyword1: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        keyword2: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        keyword3: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        keyword4: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        keyword5: new fields.StringField({\n          required: true,\n          initial: \"\"\n        })\n      }),\n      behaviors: new fields.SchemaField({\n        behavior1: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        behavior2: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        behavior3: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        behavior4: new fields.StringField({\n          required: true,\n          initial: \"\"\n        })\n      }),\n      catchphrases: new fields.SchemaField({\n        catchphrase1: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        catchphrase2: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        catchphrase3: new fields.StringField({\n          required: true,\n          initial: \"\"\n        }),\n        catchphrase4: new fields.StringField({\n          required: true,\n          initial: \"\"\n        })\n      })\n    };\n  }\n\n  /**\n   * Calculate the cost of an attribute based on its level\n   * Each level costs 10000, except the last level (maximum) which costs 20000\n   */\n  private calculateAttributeCost(level: number, maxLevel: number): number {\n    let cost = 0;\n    for (let i = 1; i <= level; i++) {\n      if (i === maxLevel) {\n        cost += 20000;\n      } else {\n        cost += 10000;\n      }\n    }\n    return cost;\n  }\n\n  override prepareDerivedData(): void {\n    // Get metatype to determine attribute maximums and anarchy bonus\n    const parent = (this as any).parent;\n    let attributeMaxes = {\n      strength: 99,\n      agility: 99,\n      willpower: 99,\n      logic: 99,\n      charisma: 99\n    };\n    let anarchyBonus = 0;\n    \n    if (parent && parent.items) {\n      const metatype = parent.items.find((item: any) => item.type === 'metatype');\n      if (metatype && metatype.system) {\n        attributeMaxes = {\n          strength: metatype.system.maxStrength || 99,\n          agility: metatype.system.maxAgility || 99,\n          willpower: metatype.system.maxWillpower || 99,\n          logic: metatype.system.maxLogic || 99,\n          charisma: metatype.system.maxCharisma || 99\n        };\n        anarchyBonus = metatype.system.anarchyBonus || 0;\n      }\n    }\n    \n    (this as any).attributeMaxes = attributeMaxes;\n    \n    // Calculate damage boxes, thresholds bonuses, essence cost, anarchy bonus, and narrations from active feats\n    let bonusLightDamage = 0;\n    let bonusSevereDamage = 0;\n    let bonusPhysicalThreshold = 0;\n    let bonusMentalThreshold = 0;\n    let bonusAnarchy = 0;\n    let totalEssenceCost = 0;\n    let totalNarrations = 0;\n    const narrationsDetails: Array<{ name: string; actions: number }> = [];\n    \n    if (parent && parent.items) {\n      const activeFeats = parent.items.filter((item: any) => \n        item.type === 'feat' && item.system.active === true\n      );\n      \n      activeFeats.forEach((feat: any) => {\n        bonusLightDamage += feat.system.bonusLightDamage || 0;\n        bonusSevereDamage += feat.system.bonusSevereDamage || 0;\n        bonusPhysicalThreshold += feat.system.bonusPhysicalThreshold || 0;\n        bonusMentalThreshold += feat.system.bonusMentalThreshold || 0;\n        bonusAnarchy += feat.system.bonusAnarchy || 0;\n        totalEssenceCost += feat.system.essenceCost || 0;\n        \n        // Count narrations\n        if (feat.system.grantsNarration) {\n          totalNarrations++;\n          narrationsDetails.push({\n            name: feat.name,\n            actions: feat.system.narrationActions || 1\n          });\n        }\n      });\n    }\n    \n    // Calculate total anarchy (base 3 + metatype bonus + feats bonus)\n    (this as any).totalAnarchy = 3 + anarchyBonus + bonusAnarchy;\n    (this as any).anarchyBonus = anarchyBonus;\n    (this as any).featsAnarchyBonus = bonusAnarchy;\n    \n    // Store narrations information (base 1 + feats bonus)\n    (this as any).totalNarrations = 1 + totalNarrations;\n    (this as any).bonusNarrations = totalNarrations;\n    (this as any).narrationsDetails = narrationsDetails;\n    \n    // Base: 2 light, 1 severe, 1 incapacitating\n    const totalLightBoxes = 2 + bonusLightDamage;\n    const totalSevereBoxes = 1 + bonusSevereDamage;\n    \n    // Ensure damage arrays match the required size\n    const damage = (this as any).damage || {};\n    \n    // Adjust light damage array\n    if (!Array.isArray(damage.light)) {\n      damage.light = [false, false];\n    }\n    while (damage.light.length < totalLightBoxes) {\n      damage.light.push(false);\n    }\n    while (damage.light.length > totalLightBoxes) {\n      damage.light.pop();\n    }\n    \n    // Adjust severe damage array\n    if (!Array.isArray(damage.severe)) {\n      damage.severe = [false];\n    }\n    while (damage.severe.length < totalSevereBoxes) {\n      damage.severe.push(false);\n    }\n    while (damage.severe.length > totalSevereBoxes) {\n      damage.severe.pop();\n    }\n    \n    (this as any).totalLightBoxes = totalLightBoxes;\n    (this as any).totalSevereBoxes = totalSevereBoxes;\n    \n    // Adjust anarchy spent array to match total anarchy\n    const totalAnarchy = 3 + anarchyBonus + bonusAnarchy;\n    const anarchySpent = (this as any).anarchySpent || [];\n    \n    if (!Array.isArray(anarchySpent)) {\n      (this as any).anarchySpent = [];\n    }\n    while ((this as any).anarchySpent.length < totalAnarchy) {\n      (this as any).anarchySpent.push(false);\n    }\n    while ((this as any).anarchySpent.length > totalAnarchy) {\n      (this as any).anarchySpent.pop();\n    }\n    \n    // Calculate armor cost (2500 per level)\n    const armorLevel = (this as any).armorLevel || 0;\n    (this as any).armorCost = armorLevel * 2500;\n    \n    // Calculate damage thresholds (with bonuses from feats)\n    const strength = (this as any).attributes?.strength || 1;\n    const willpower = (this as any).attributes?.willpower || 1;\n    \n    (this as any).damageThresholds = {\n      withoutArmor: {\n        light: strength + bonusPhysicalThreshold,\n        moderate: strength + bonusPhysicalThreshold + 3,\n        severe: strength + bonusPhysicalThreshold + 6\n      },\n      withArmor: {\n        light: strength + armorLevel + bonusPhysicalThreshold,\n        moderate: strength + armorLevel + bonusPhysicalThreshold + 3,\n        severe: strength + armorLevel + bonusPhysicalThreshold + 6\n      },\n      mental: {\n        light: willpower + bonusMentalThreshold,\n        moderate: willpower + bonusMentalThreshold + 3,\n        severe: willpower + bonusMentalThreshold + 6\n      }\n    };\n    \n    // Calculate current essence\n    const maxEssence = (this as any).maxEssence || 6;\n    (this as any).currentEssence = Math.max(0, maxEssence - totalEssenceCost);\n    \n    // Calculate costs for each attribute\n    const attributes = (this as any).attributes;\n    if (attributes) {\n      // Clamp attributes to their maximums\n      attributes.strength = Math.min(attributes.strength || 1, attributeMaxes.strength);\n      attributes.agility = Math.min(attributes.agility || 1, attributeMaxes.agility);\n      attributes.willpower = Math.min(attributes.willpower || 1, attributeMaxes.willpower);\n      attributes.logic = Math.min(attributes.logic || 1, attributeMaxes.logic);\n      attributes.charisma = Math.min(attributes.charisma || 1, attributeMaxes.charisma);\n      \n      (this as any).attributeCosts = {\n        strength: this.calculateAttributeCost(attributes.strength || 1, attributeMaxes.strength),\n        agility: this.calculateAttributeCost(attributes.agility || 1, attributeMaxes.agility),\n        willpower: this.calculateAttributeCost(attributes.willpower || 1, attributeMaxes.willpower),\n        logic: this.calculateAttributeCost(attributes.logic || 1, attributeMaxes.logic),\n        charisma: this.calculateAttributeCost(attributes.charisma || 1, attributeMaxes.charisma)\n      };\n      \n      // Calculate total cost of attributes\n      const attributeCosts = (this as any).attributeCosts;\n      let totalCost = Object.values(attributeCosts).reduce((sum: number, cost: any) => sum + cost, 0);\n      \n      // Add armor cost\n      totalCost += (this as any).armorCost || 0;\n      \n      // Add items cost (skills and feats)\n      if (parent && parent.items) {\n        parent.items.forEach((item: any) => {\n          if (item.system && item.system.calculatedCost !== undefined) {\n            totalCost += item.system.calculatedCost;\n          }\n        });\n      }\n      \n      (this as any).totalCost = totalCost;\n    }\n  }\n}\n\n","/**\n * Data model for Skill items\n */\nexport class SkillDataModel extends foundry.abstract.TypeDataModel<any, Item> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      rating: new fields.NumberField({\n        required: true,\n        initial: 1,\n        min: 0,\n        max: 8,\n        integer: true,\n        label: \"SRA2.SKILLS.RATING\"\n      }),\n      linkedAttribute: new fields.StringField({\n        required: true,\n        initial: \"strength\",\n        choices: {\n          strength: \"SRA2.ATTRIBUTES.STRENGTH\",\n          agility: \"SRA2.ATTRIBUTES.AGILITY\",\n          willpower: \"SRA2.ATTRIBUTES.WILLPOWER\",\n          logic: \"SRA2.ATTRIBUTES.LOGIC\",\n          charisma: \"SRA2.ATTRIBUTES.CHARISMA\"\n        },\n        label: \"SRA2.SKILLS.LINKED_ATTRIBUTE\"\n      }),\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      }),\n      bookmarked: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.SKILLS.BOOKMARKED\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Calculate cost based on rating\n    // 2500 per rating up to 5, then 5000 per rating above 5\n    const rating = (this as any).rating || 0;\n    \n    let calculatedCost = 0;\n    if (rating <= 5) {\n      calculatedCost = rating * 2500;\n    } else {\n      // First 5 levels at 2500 each, remaining levels at 5000 each\n      calculatedCost = 5 * 2500 + (rating - 5) * 5000;\n    }\n    \n    (this as any).calculatedCost = calculatedCost;\n  }\n}\n\n","/**\n * Weapon types configuration with their stats\n * Includes recommended skill and specialization for attack AND defense\n * Specializations are prefixed with \"Spé : \" to easily find them in game.items\n */\nexport const WEAPON_TYPES = {\n  \"custom-weapon\": { \n    vd: \"0\", melee: \"none\", short: \"none\", medium: \"none\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  // Combat rapproché - Mains nues\n  \"bare-hands\": { \n    vd: \"FOR\", melee: \"ok\", short: \"none\", medium: \"none\", long: \"none\",\n    linkedSkill: \"Combat rapproché\", linkedSpecialization: \"Spé : Mains nues\",\n    linkedDefenseSkill: \"Combat rapproché\", linkedDefenseSpecialization: \"Spé : Défense\"\n  },\n  // Combat rapproché - Lames\n  \"short-weapons\": { \n    vd: \"FOR+1\", melee: \"ok\", short: \"none\", medium: \"none\", long: \"none\",\n    linkedSkill: \"Combat rapproché\", linkedSpecialization: \"Spé : Lames\",\n    linkedDefenseSkill: \"Combat rapproché\", linkedDefenseSpecialization: \"Spé : Défense\"\n  },\n  \"long-weapons\": { \n    vd: \"FOR+2\", melee: \"ok\", short: \"none\", medium: \"none\", long: \"none\",\n    linkedSkill: \"Combat rapproché\", linkedSpecialization: \"Spé : Lames\",\n    linkedDefenseSkill: \"Combat rapproché\", linkedDefenseSpecialization: \"Spé : Défense\"\n  },\n  // Combat rapproché - Armes contondantes\n  \"advanced-melee\": { \n    vd: 5, melee: \"ok\", short: \"none\", medium: \"none\", long: \"none\",\n    linkedSkill: \"Combat rapproché\", linkedSpecialization: \"Spé : Armes contondantes\",\n    linkedDefenseSkill: \"Combat rapproché\", linkedDefenseSpecialization: \"Spé : Défense\"\n  },\n  \"tasers\": { \n    vd: 5, melee: \"ok\", short: \"ok\", medium: \"none\", long: \"none\",\n    linkedSkill: \"Combat rapproché\", linkedSpecialization: \"Spé : Armes contondantes\",\n    linkedDefenseSkill: \"Combat rapproché\", linkedDefenseSpecialization: \"Spé : Défense\"\n  },\n  // Armes à distance - Armes de jet\n  \"throwing\": { \n    vd: \"FOR+1\", melee: \"ok\", short: \"ok\", medium: \"disadvantage\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Armes de jet\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"grenades\": { \n    vd: 7, melee: \"ok\", short: \"ok\", medium: \"disadvantage\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Armes de jet\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"gas-grenades\": { \n    vd: \"toxin\", melee: \"ok\", short: \"ok\", medium: \"disadvantage\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Armes de jet\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  // Armes à distance - Armes de trait\n  \"bows\": { \n    vd: \"FOR+1\", melee: \"ok\", short: \"ok\", medium: \"ok\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Armes de trait\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"crossbows\": { \n    vd: 4, melee: \"ok\", short: \"ok\", medium: \"ok\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Armes de trait\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  // Armes à distance - Pistolets\n  \"pocket-pistols\": { \n    vd: 3, melee: \"ok\", short: \"ok\", medium: \"disadvantage\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Pistolets\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"light-pistols\": { \n    vd: 4, melee: \"ok\", short: \"ok\", medium: \"disadvantage\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Pistolets\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"automatic-pistols\": { \n    vd: 4, melee: \"ok\", short: \"ok\", medium: \"disadvantage\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Pistolets\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"heavy-pistols\": { \n    vd: 5, melee: \"ok\", short: \"ok\", medium: \"disadvantage\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Pistolets\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  // Armes à distance - Mitraillettes\n  \"smgs\": { \n    vd: 5, melee: \"disadvantage\", short: \"ok\", medium: \"ok\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Mitraillettes\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  // Armes à distance - Fusils\n  \"assault-rifles\": { \n    vd: 7, melee: \"disadvantage\", short: \"ok\", medium: \"ok\", long: \"disadvantage\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Fusils\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"shotguns\": { \n    vd: 8, melee: \"disadvantage\", short: \"ok\", medium: \"disadvantage\", long: \"none\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Fusils\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"sniper-rifles\": { \n    vd: 10, melee: \"none\", short: \"disadvantage\", medium: \"disadvantage\", long: \"ok\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Fusils\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  // Armes à distance - Lance-grenades\n  \"grenade-launchers\": { \n    vd: 7, melee: \"none\", short: \"disadvantage\", medium: \"ok\", long: \"disadvantage\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Lance-grenades\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  // Armes à distance - Armes lourdes\n  \"machine-guns\": { \n    vd: 9, melee: \"none\", short: \"ok\", medium: \"ok\", long: \"ok\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Armes lourdes\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  },\n  \"rocket-launchers\": { \n    vd: 12, melee: \"none\", short: \"none\", medium: \"disadvantage\", long: \"ok\",\n    linkedSkill: \"Armes à distance\", linkedSpecialization: \"Spé : Armes lourdes\",\n    linkedDefenseSkill: \"Athlétisme\", linkedDefenseSpecialization: \"Spé : Défense à distance\"\n  }\n} as const;\n\n/**\n * Vehicle/Drone types configuration with their stats\n */\nexport const VEHICLE_TYPES = {\n  \"microdrone\": { autopilot: 6, structure: 0, handling: 10, speed: 0, flyingSpeed: 1, armor: 0, weaponMount: \"none\" },\n  \"small-drone\": { autopilot: 6, structure: 1, handling: 9, speed: 2, flyingSpeed: 4, armor: 0, weaponMount: \"smg\" },\n  \"medium-drone\": { autopilot: 6, structure: 2, handling: 7, speed: 3, flyingSpeed: 6, armor: 0, weaponMount: \"rifle\" },\n  \"large-drone\": { autopilot: 6, structure: 4, handling: 4, speed: 4, flyingSpeed: 8, armor: 0, weaponMount: \"rifle\" },\n  \"racing-motorcycle\": { autopilot: 6, structure: 4, handling: 2, speed: 6, flyingSpeed: 0, armor: 0, weaponMount: \"rifle\" },\n  \"offroad-motorcycle\": { autopilot: 6, structure: 4, handling: 3, speed: 5, flyingSpeed: 0, armor: 0, weaponMount: \"rifle\" },\n  \"chopper\": { autopilot: 6, structure: 5, handling: 2, speed: 5, flyingSpeed: 0, armor: 0, weaponMount: \"rifle\" },\n  \"sports-car\": { autopilot: 6, structure: 5, handling: 2, speed: 5, flyingSpeed: 0, armor: 0, weaponMount: \"none\" },\n  \"sedan\": { autopilot: 6, structure: 6, handling: 2, speed: 4, flyingSpeed: 0, armor: 0, weaponMount: \"none\" },\n  \"suv-pickup\": { autopilot: 6, structure: 7, handling: 1, speed: 4, flyingSpeed: 0, armor: 0, weaponMount: \"none\" },\n  \"van\": { autopilot: 6, structure: 8, handling: 1, speed: 3, flyingSpeed: 0, armor: 0, weaponMount: \"none\" },\n  \"bus-truck\": { autopilot: 6, structure: 10, handling: 0, speed: 2, flyingSpeed: 0, armor: 0, weaponMount: \"none\" }\n} as const;\n\n/**\n * Data model for Feat items\n */\nexport class FeatDataModel extends foundry.abstract.TypeDataModel<any, Item> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      }),\n      rating: new fields.NumberField({\n        required: true,\n        initial: 0,\n        integer: true,\n        label: \"SRA2.FEATS.RATING\"\n      }),\n      cost: new fields.StringField({\n        required: true,\n        initial: \"free-equipment\",\n        choices: {\n          \"free-equipment\": \"SRA2.FEATS.COST.FREE_EQUIPMENT\",\n          \"equipment\": \"SRA2.FEATS.COST.EQUIPMENT\",\n          \"advanced-equipment\": \"SRA2.FEATS.COST.ADVANCED_EQUIPMENT\",\n          // Legacy values kept for migration compatibility (not shown in UI)\n          \"specialized-equipment\": \"SRA2.FEATS.COST.ADVANCED_EQUIPMENT\",\n          \"feat\": \"SRA2.FEATS.COST.FREE_EQUIPMENT\"\n        },\n        label: \"SRA2.FEATS.COST.LABEL\"\n      }),\n      active: new fields.BooleanField({\n        required: true,\n        initial: true,\n        label: \"SRA2.FEATS.ACTIVE\"\n      }),\n      bookmarked: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.BOOKMARKED\"\n      }),\n      rrList: new fields.ArrayField(new fields.SchemaField({\n        rrType: new fields.StringField({\n          required: true,\n          initial: \"skill\",\n          choices: {\n            \"attribute\": \"SRA2.FEATS.RR_TYPE.ATTRIBUTE\",\n            \"skill\": \"SRA2.FEATS.RR_TYPE.SKILL\",\n            \"specialization\": \"SRA2.FEATS.RR_TYPE.SPECIALIZATION\"\n          },\n          label: \"SRA2.FEATS.RR_TYPE.LABEL\"\n        }),\n        rrValue: new fields.NumberField({\n          required: true,\n          initial: 1,\n          min: 0,\n          max: 3,\n          integer: true,\n          label: \"SRA2.FEATS.RR_VALUE\"\n        }),\n        rrTarget: new fields.StringField({\n          required: false,\n          initial: \"\",\n          nullable: false,\n          label: \"SRA2.FEATS.RR_TARGET\"\n        })\n      }), {\n        initial: [],\n        label: \"SRA2.FEATS.RR_LIST\"\n      }),\n      bonusLightDamage: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_LIGHT_DAMAGE\"\n      }),\n      bonusSevereDamage: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_SEVERE_DAMAGE\"\n      }),\n      bonusPhysicalThreshold: new fields.NumberField({\n        required: true,\n        initial: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_PHYSICAL_THRESHOLD\"\n      }),\n      bonusMentalThreshold: new fields.NumberField({\n        required: true,\n        initial: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_MENTAL_THRESHOLD\"\n      }),\n      bonusAnarchy: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.BONUS_ANARCHY\"\n      }),\n      essenceCost: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.ESSENCE_COST\"\n      }),\n      featType: new fields.StringField({\n        required: true,\n        initial: \"equipment\",\n        choices: {\n          \"trait\": \"SRA2.FEATS.FEAT_TYPE.TRAIT\",\n          \"contact\": \"SRA2.FEATS.FEAT_TYPE.CONTACT\",\n          \"awakened\": \"SRA2.FEATS.FEAT_TYPE.AWAKENED\",\n          \"adept-power\": \"SRA2.FEATS.FEAT_TYPE.ADEPT_POWER\",\n          \"equipment\": \"SRA2.FEATS.FEAT_TYPE.EQUIPMENT\",\n          \"cyberware\": \"SRA2.FEATS.FEAT_TYPE.CYBERWARE\",\n          \"cyberdeck\": \"SRA2.FEATS.FEAT_TYPE.CYBERDECK\",\n          \"vehicle\": \"SRA2.FEATS.FEAT_TYPE.VEHICLE\",\n          \"weapons-spells\": \"SRA2.FEATS.FEAT_TYPE.WEAPONS_SPELLS\",\n          \"weapon\": \"SRA2.FEATS.FEAT_TYPE.WEAPON\",\n          \"spell\": \"SRA2.FEATS.FEAT_TYPE.SPELL\"\n        },\n        label: \"SRA2.FEATS.FEAT_TYPE.LABEL\"\n      }),\n      weaponType: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.WEAPON.WEAPON_TYPE\"\n      }),\n      vehicleType: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.VEHICLE.VEHICLE_TYPE\"\n      }),\n      // Weapon/Spell specific fields\n      damageValue: new fields.StringField({\n        required: true,\n        initial: \"0\",\n        label: \"SRA2.FEATS.WEAPON.DAMAGE_VALUE\"\n      }),\n      damageValueBonus: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 2,\n        integer: true,\n        label: \"SRA2.FEATS.WEAPON.DAMAGE_VALUE_BONUS\"\n      }),\n      meleeRange: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.WEAPON.RANGE_NONE\",\n          \"ok\": \"SRA2.FEATS.WEAPON.RANGE_OK\",\n          \"dice\": \"SRA2.FEATS.WEAPON.RANGE_DICE\",\n          \"disadvantage\": \"SRA2.FEATS.WEAPON.RANGE_DISADVANTAGE\"\n        },\n        label: \"SRA2.FEATS.WEAPON.MELEE_RANGE\"\n      }),\n      shortRange: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.WEAPON.RANGE_NONE\",\n          \"ok\": \"SRA2.FEATS.WEAPON.RANGE_OK\",\n          \"dice\": \"SRA2.FEATS.WEAPON.RANGE_DICE\",\n          \"disadvantage\": \"SRA2.FEATS.WEAPON.RANGE_DISADVANTAGE\"\n        },\n        label: \"SRA2.FEATS.WEAPON.SHORT_RANGE\"\n      }),\n      mediumRange: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.WEAPON.RANGE_NONE\",\n          \"ok\": \"SRA2.FEATS.WEAPON.RANGE_OK\",\n          \"dice\": \"SRA2.FEATS.WEAPON.RANGE_DICE\",\n          \"disadvantage\": \"SRA2.FEATS.WEAPON.RANGE_DISADVANTAGE\"\n        },\n        label: \"SRA2.FEATS.WEAPON.MEDIUM_RANGE\"\n      }),\n      longRange: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        choices: {\n          \"none\": \"SRA2.FEATS.WEAPON.RANGE_NONE\",\n          \"ok\": \"SRA2.FEATS.WEAPON.RANGE_OK\",\n          \"dice\": \"SRA2.FEATS.WEAPON.RANGE_DICE\",\n          \"disadvantage\": \"SRA2.FEATS.WEAPON.RANGE_DISADVANTAGE\"\n        },\n        label: \"SRA2.FEATS.WEAPON.LONG_RANGE\"\n      }),\n      rangeImprovements: new fields.SchemaField({\n        melee: new fields.BooleanField({\n          required: true,\n          initial: false\n        }),\n        short: new fields.BooleanField({\n          required: true,\n          initial: false\n        }),\n        medium: new fields.BooleanField({\n          required: true,\n          initial: false\n        }),\n        long: new fields.BooleanField({\n          required: true,\n          initial: false\n        })\n      }, {\n        required: true,\n        label: \"SRA2.FEATS.WEAPON.RANGE_IMPROVEMENTS\"\n      }),\n      // Vehicle/Drone specific fields\n      autopilot: new fields.NumberField({\n        required: true,\n        initial: 6,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.AUTOPILOT\"\n      }),\n      structure: new fields.NumberField({\n        required: true,\n        initial: 2,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.STRUCTURE\"\n      }),\n      handling: new fields.NumberField({\n        required: true,\n        initial: 5,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.HANDLING\"\n      }),\n      speed: new fields.NumberField({\n        required: true,\n        initial: 3,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.SPEED\"\n      }),\n      flyingSpeed: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.FLYING_SPEED\"\n      }),\n      armor: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.ARMOR\"\n      }),\n      weaponMount: new fields.StringField({\n        required: true,\n        initial: \"none\",\n        label: \"SRA2.FEATS.VEHICLE.WEAPON_MOUNT\"\n      }),\n      weaponInfo: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.VEHICLE.WEAPON_INFO\"\n      }),\n      // Vehicle bonuses\n      autopilotBonus: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 6,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.AUTOPILOT_BONUS\"\n      }),\n      speedBonus: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 3,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.SPEED_BONUS\"\n      }),\n      handlingBonus: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 3,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.HANDLING_BONUS\"\n      }),\n      armorBonus: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.ARMOR_BONUS\"\n      }),\n      isFixed: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.VEHICLE.IS_FIXED\"\n      }),\n      isFlying: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.VEHICLE.IS_FLYING\"\n      }),\n      weaponMountImprovement: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.VEHICLE.WEAPON_MOUNT_IMPROVEMENT\"\n      }),\n      autopilotUnlocked: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.VEHICLE.AUTOPILOT_UNLOCKED\"\n      }),\n      additionalDroneCount: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 3,\n        integer: true,\n        label: \"SRA2.FEATS.VEHICLE.ADDITIONAL_DRONE_COUNT\"\n      }),\n      // Cyberdeck specific fields\n      firewall: new fields.NumberField({\n        required: true,\n        initial: 1,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.CYBERDECK.FIREWALL\"\n      }),\n      attack: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.CYBERDECK.ATTACK\"\n      }),\n      // Contact specific fields\n      contactName: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.CONTACT.NAME\"\n      }),\n      // Awakened specific fields\n      astralPerception: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.ASTRAL_PERCEPTION\"\n      }),\n      astralProjection: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.ASTRAL_PROJECTION\"\n      }),\n      sorcery: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.SORCERY\"\n      }),\n      conjuration: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.CONJURATION\"\n      }),\n      adept: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.ADEPT\"\n      }),\n      // Additional fields for recommended level calculation\n      riggerConsoleCount: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        integer: true,\n        label: \"SRA2.FEATS.RIGGER_CONSOLE_COUNT\"\n      }),\n      hasVehicleControlWiring: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.HAS_VEHICLE_CONTROL_WIRING\"\n      }),\n      isWeaponFocus: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.IS_WEAPON_FOCUS\"\n      }),\n      // Narrative effects\n      narrativeEffects: new fields.ArrayField(new fields.SchemaField({\n        text: new fields.StringField({\n          required: false,\n          initial: \"\"\n        }),\n        isNegative: new fields.BooleanField({\n          required: true,\n          initial: false\n        }),\n        value: new fields.NumberField({\n          required: true,\n          initial: -1,\n          min: -5,\n          max: -1,\n          integer: true\n        })\n      }), {\n        initial: [],\n        label: \"SRA2.FEATS.NARRATIVE_EFFECTS\"\n      }),\n      // Grants narration\n      grantsNarration: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.GRANTS_NARRATION\"\n      }),\n      narrationActions: new fields.NumberField({\n        required: true,\n        initial: 1,\n        min: 1,\n        max: 2,\n        integer: true,\n        label: \"SRA2.FEATS.NARRATION_ACTIONS\"\n      }),\n      // Additional sustained spells and summoned spirits\n      sustainedSpellCount: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 2,\n        integer: true,\n        label: \"SRA2.FEATS.SUSTAINED_SPELL_COUNT\"\n      }),\n      summonedSpiritCount: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 1,\n        integer: true,\n        label: \"SRA2.FEATS.SUMMONED_SPIRIT_COUNT\"\n      }),\n      // First feat flag\n      isFirstFeat: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.IS_FIRST_FEAT\"\n      }),\n      // Shamanic mask (for awakened feats)\n      shamanicMask: new fields.BooleanField({\n        required: true,\n        initial: false,\n        label: \"SRA2.FEATS.AWAKENED.SHAMANIC_MASK\"\n      }),\n      // Spell type (direct or indirect)\n      spellType: new fields.StringField({\n        required: true,\n        initial: \"direct\",\n        choices: {\n          \"direct\": \"SRA2.FEATS.SPELL.TYPE_DIRECT\",\n          \"indirect\": \"SRA2.FEATS.SPELL.TYPE_INDIRECT\"\n        },\n        label: \"SRA2.FEATS.SPELL.TYPE\"\n      }),\n      // Linked skills and specializations for weapons (for custom weapons)\n      linkedAttackSkill: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.WEAPON.LINKED_ATTACK_SKILL\"\n      }),\n      linkedAttackSpecialization: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.WEAPON.LINKED_ATTACK_SPECIALIZATION\"\n      }),\n      linkedDefenseSkill: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.WEAPON.LINKED_DEFENSE_SKILL\"\n      }),\n      linkedDefenseSpecialization: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.FEATS.WEAPON.LINKED_DEFENSE_SPECIALIZATION\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Get common properties\n    const costType = (this as any).cost || 'free-equipment';\n    const featType = (this as any).featType || 'equipment';\n    const rating = (this as any).rating || 0;\n    \n    // Calculate cost based on cost type (for equipment and weapons)\n    let calculatedCost = 0;\n    \n    // Apply cost calculations for equipment, weapon, and weapons-spells types\n    if (featType === 'equipment' || featType === 'weapon' || featType === 'weapons-spells') {\n      switch (costType) {\n        case 'free-equipment':\n          calculatedCost = 0;\n          break;\n        case 'equipment':\n          calculatedCost = 2500;\n          break;\n        case 'advanced-equipment':\n          calculatedCost = 5000;\n          break;\n        // Legacy values (kept for migration compatibility)\n        case 'specialized-equipment':\n          calculatedCost = 5000;\n          break;\n        case 'feat':\n          calculatedCost = 0;\n          break;\n        default:\n          calculatedCost = 0;\n      }\n    }\n\n    calculatedCost += rating * 5000;\n    \n    (this as any).calculatedCost = calculatedCost;\n\n    // Calculate recommended attribute level\n    let recommendedLevel = 0;\n    const recommendedLevelBreakdown: Array<{ labelKey: string; labelParams?: string; value: number }> = [];\n    \n    const bonusLightDamage = (this as any).bonusLightDamage || 0;\n    const bonusSevereDamage = (this as any).bonusSevereDamage || 0;\n    const bonusPhysicalThreshold = (this as any).bonusPhysicalThreshold || 0;\n    const bonusMentalThreshold = (this as any).bonusMentalThreshold || 0;\n    const firewall = (this as any).firewall || 0;\n    const attack = (this as any).attack || 0;\n    const riggerConsoleCount = (this as any).riggerConsoleCount || 0;\n    const hasVehicleControlWiring = (this as any).hasVehicleControlWiring || false;\n    const isWeaponFocus = (this as any).isWeaponFocus || false;\n    const bonusAnarchy = (this as any).bonusAnarchy || 0;\n    const grantsNarration = (this as any).grantsNarration || false;\n    const narrativeEffects = (this as any).narrativeEffects || [];\n    const rrList = (this as any).rrList || [];\n    const isFirstFeat = (this as any).isFirstFeat || false;\n    \n    // Base cost for trait (not first feat): +3 levels\n    if (featType === 'trait' && !isFirstFeat) {\n      recommendedLevel += 3;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.BASE_FEAT_COST', value: 3 });\n    }\n    \n    // Cyberware/bioware: 1 level\n    if (featType === 'cyberware') {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.CYBERWARE', value: 1 });\n    }\n    \n    // Adept power: 1 level\n    if (featType === 'adept-power') {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.ADEPT_POWER', value: 1 });\n    }\n    \n    // Spell: 1 level\n    if (featType === 'spell') {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.SPELL', value: 1 });\n    }\n    \n    // Vehicle/Drone: 1 level\n    if (featType === 'vehicle') {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.VEHICLE', value: 1 });\n    }\n    \n    // Light wounds: +3 per wound\n    if (bonusLightDamage > 0) {\n      const value = bonusLightDamage * 3;\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.LIGHT_WOUNDS', labelParams: `(${bonusLightDamage})`, value });\n    }\n    \n    // Heavy wounds: +6 per wound\n    if (bonusSevereDamage > 0) {\n      const value = bonusSevereDamage * 6;\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.SEVERE_WOUNDS', labelParams: `(${bonusSevereDamage})`, value });\n    }\n    \n    // Physical threshold bonus: +1 per point (positive or negative)\n    if (bonusPhysicalThreshold !== 0) {\n      const value = Math.abs(bonusPhysicalThreshold);\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.PHYSICAL_THRESHOLD', labelParams: `(${bonusPhysicalThreshold > 0 ? '+' : ''}${bonusPhysicalThreshold})`, value });\n    }\n    \n    // Mental threshold bonus: +1 per point (positive or negative)\n    if (bonusMentalThreshold !== 0) {\n      const value = Math.abs(bonusMentalThreshold);\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.MENTAL_THRESHOLD', labelParams: `(${bonusMentalThreshold > 0 ? '+' : ''}${bonusMentalThreshold})`, value });\n    }\n    \n    // Cyberdeck firewall: starts at 1, each level is +1\n    if (featType === 'cyberdeck' && firewall > 0) {\n      recommendedLevel += firewall;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.FIREWALL', labelParams: `(${firewall})`, value: firewall });\n    }\n    \n    // Attack: starts at 0, each level is +1\n    if (attack > 0) {\n      recommendedLevel += attack;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.ATTACK', labelParams: `(${attack})`, value: attack });\n    }\n    \n    // Rigger console: +1 per drone controller\n    if (riggerConsoleCount > 0) {\n      recommendedLevel += riggerConsoleCount;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.RIGGER_CONSOLE', labelParams: `(${riggerConsoleCount})`, value: riggerConsoleCount });\n    }\n    \n    // Vehicle control wiring: +2\n    if (hasVehicleControlWiring) {\n      recommendedLevel += 2;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.VEHICLE_WIRING', value: 2 });\n    }\n    \n    // Weapon focus: +1\n    if (isWeaponFocus) {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.WEAPON_FOCUS', value: 1 });\n    }\n    \n    // Damage value bonus: +1 per bonus\n    const damageValueBonus = (this as any).damageValueBonus || 0;\n    if (damageValueBonus > 0) {\n      recommendedLevel += damageValueBonus;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.DAMAGE_VALUE_BONUS', labelParams: `(+${damageValueBonus})`, value: damageValueBonus });\n    }\n    \n    // Range improvements: +2 per improved range\n    const rangeImprovements = (this as any).rangeImprovements || {};\n    let rangeImprovementCount = 0;\n    if (rangeImprovements.melee) rangeImprovementCount++;\n    if (rangeImprovements.short) rangeImprovementCount++;\n    if (rangeImprovements.medium) rangeImprovementCount++;\n    if (rangeImprovements.long) rangeImprovementCount++;\n    if (rangeImprovementCount > 0) {\n      const value = rangeImprovementCount * 2;\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.RANGE_IMPROVEMENTS', labelParams: `(${rangeImprovementCount})`, value });\n    }\n    \n    // Resource Reduction (RR) entries\n    for (const rr of rrList) {\n      const rrType = rr.rrType;\n      const rrValue = rr.rrValue || 0;\n      \n      if (rrValue > 0) {\n        if (rrType === 'specialization') {\n          // RR specialization: +2 levels per value\n          const value = rrValue * 2;\n          recommendedLevel += value;\n          recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.RR_SPECIALIZATION', labelParams: `(${rrValue})`, value });\n        } else if (rrType === 'skill') {\n          // RR skill: +5 levels per value\n          const value = rrValue * 5;\n          recommendedLevel += value;\n          recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.RR_SKILL', labelParams: `(${rrValue})`, value });\n        } else if (rrType === 'attribute') {\n          // RR attribute: +10 levels per value\n          const value = rrValue * 10;\n          recommendedLevel += value;\n          recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.RR_ATTRIBUTE', labelParams: `(${rrValue})`, value });\n        }\n      }\n    }\n    \n    // Anarchy bonus: +2 per anarchy point\n    if (bonusAnarchy > 0) {\n      const value = bonusAnarchy * 2;\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.ANARCHY_BONUS', labelParams: `(${bonusAnarchy})`, value });\n    }\n    \n    // Grants narration: +3 levels\n    if (grantsNarration) {\n      recommendedLevel += 3;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.GRANTS_NARRATION', value: 3 });\n    }\n    \n    // Narrative effects: +1 level per positive effect, value per negative effect (count non-empty strings)\n    const positiveEffectsCount = narrativeEffects.filter((effect: any) => effect?.text && effect.text.trim() !== '' && !effect.isNegative).length;\n    const negativeEffects = narrativeEffects.filter((effect: any) => effect?.text && effect.text.trim() !== '' && effect.isNegative);\n    \n    if (positiveEffectsCount > 0) {\n      recommendedLevel += positiveEffectsCount;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.NARRATIVE_EFFECTS_POSITIVE', labelParams: `(${positiveEffectsCount})`, value: positiveEffectsCount });\n    }\n    \n    if (negativeEffects.length > 0) {\n      const negativeEffectValue = negativeEffects.reduce((sum: number, effect: any) => sum + (effect.value || -1), 0);\n      recommendedLevel += negativeEffectValue; // Adding because value is already negative\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.NARRATIVE_EFFECTS_NEGATIVE', labelParams: `(${negativeEffects.length})`, value: negativeEffectValue });\n    }\n    \n    // Additional sustained spells: +2 per spell (max 2)\n    const sustainedSpellCount = (this as any).sustainedSpellCount || 0;\n    if (sustainedSpellCount > 0) {\n      const value = sustainedSpellCount * 2;\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.SUSTAINED_SPELLS', labelParams: `(${sustainedSpellCount})`, value });\n    }\n    \n    // Additional summoned spirit: +3 (max 1)\n    const summonedSpiritCount = (this as any).summonedSpiritCount || 0;\n    if (summonedSpiritCount > 0) {\n      const value = summonedSpiritCount * 3;\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.SUMMONED_SPIRITS', labelParams: `(${summonedSpiritCount})`, value });\n    }\n    \n    // Awakened abilities\n    const astralPerception = (this as any).astralPerception || false;\n    const astralProjection = (this as any).astralProjection || false;\n    const sorcery = (this as any).sorcery || false;\n    const conjuration = (this as any).conjuration || false;\n    const adept = (this as any).adept || false;\n    \n    // Astral perception AND projection: +2\n    if (astralPerception && astralProjection) {\n      recommendedLevel += 2;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.ASTRAL_PERCEPTION_PROJECTION', value: 2 });\n    }\n    \n    // Sorcery: +1\n    if (sorcery) {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.SORCERY', value: 1 });\n    }\n    \n    // Conjuration: +2\n    if (conjuration) {\n      recommendedLevel += 2;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.CONJURATION', value: 2 });\n    }\n    \n    // Adept: +1\n    if (adept) {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.ADEPT', value: 1 });\n    }\n    \n    // Vehicle/Drone bonuses\n    const autopilotBonus = (this as any).autopilotBonus || 0;\n    const speedBonus = (this as any).speedBonus || 0;\n    const handlingBonus = (this as any).handlingBonus || 0;\n    const armorBonus = (this as any).armorBonus || 0;\n    const isFixed = (this as any).isFixed || false;\n    const isFlying = (this as any).isFlying || false;\n    const weaponMountImprovement = (this as any).weaponMountImprovement || false;\n    const autopilotUnlocked = (this as any).autopilotUnlocked || false;\n    const additionalDroneCount = (this as any).additionalDroneCount || 0;\n    \n    // Autopilot bonus: +1 per level\n    if (autopilotBonus > 0) {\n      recommendedLevel += autopilotBonus;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.AUTOPILOT_BONUS', labelParams: `(+${autopilotBonus})`, value: autopilotBonus });\n    }\n    \n    // Speed bonus: +1 per level\n    if (speedBonus > 0) {\n      recommendedLevel += speedBonus;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.SPEED_BONUS', labelParams: `(+${speedBonus})`, value: speedBonus });\n    }\n    \n    // Handling bonus: +1 per level\n    if (handlingBonus > 0) {\n      recommendedLevel += handlingBonus;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.HANDLING_BONUS', labelParams: `(+${handlingBonus})`, value: handlingBonus });\n    }\n    \n    // Armor bonus: +1 per level\n    if (armorBonus > 0) {\n      recommendedLevel += armorBonus;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.ARMOR_BONUS', labelParams: `(+${armorBonus})`, value: armorBonus });\n    }\n    \n    // Fixed (unable to move): -1\n    if (isFixed) {\n      recommendedLevel -= 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.IS_FIXED', value: -1 });\n    }\n    \n    // Flying: +1\n    if (isFlying) {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.IS_FLYING', value: 1 });\n    }\n    \n    // Weapon mount improvement: +1\n    if (weaponMountImprovement) {\n      recommendedLevel += 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.WEAPON_MOUNT_IMPROVEMENT', value: 1 });\n    }\n    \n    // Autopilot unlocked: +3\n    if (autopilotUnlocked) {\n      recommendedLevel += 3;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.AUTOPILOT_UNLOCKED', value: 3 });\n    }\n    \n    // Additional drones: +2 per drone\n    if (additionalDroneCount > 0) {\n      const value = additionalDroneCount * 2;\n      recommendedLevel += value;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.ADDITIONAL_DRONES', labelParams: `(${additionalDroneCount})`, value });\n    }\n    \n    // Shamanic mask: -1 level (for awakened feats only)\n    const shamanicMask = (this as any).shamanicMask || false;\n    if (shamanicMask && featType === 'awakened') {\n      recommendedLevel -= 1;\n      recommendedLevelBreakdown.push({ labelKey: 'SRA2.FEATS.BREAKDOWN.SHAMANIC_MASK', value: -1 });\n    }\n    \n    (this as any).recommendedLevel = recommendedLevel;\n    (this as any).recommendedLevelBreakdown = recommendedLevelBreakdown;\n  }\n}\n\n","/**\n * Data model for Specialization items\n * A specialization is linked to a skill and costs 2500 yens\n */\nexport class SpecializationDataModel extends foundry.abstract.TypeDataModel<any, Item> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      linkedSkill: new fields.StringField({\n        required: true,\n        initial: \"\",\n        label: \"SRA2.SPECIALIZATIONS.LINKED_SKILL\"\n      }),\n      linkedAttribute: new fields.StringField({\n        required: true,\n        initial: \"strength\",\n        choices: {\n          strength: \"SRA2.ATTRIBUTES.STRENGTH\",\n          agility: \"SRA2.ATTRIBUTES.AGILITY\",\n          willpower: \"SRA2.ATTRIBUTES.WILLPOWER\",\n          logic: \"SRA2.ATTRIBUTES.LOGIC\",\n          charisma: \"SRA2.ATTRIBUTES.CHARISMA\"\n        },\n        label: \"SRA2.SPECIALIZATIONS.LINKED_ATTRIBUTE\"\n      }),\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Specializations have a fixed cost of 2500 yens\n    (this as any).calculatedCost = 2500;\n  }\n}\n\n","/**\n * Data model for Metatype items\n * Metatypes define maximum values for character attributes\n */\nexport class MetatypeDataModel extends foundry.abstract.TypeDataModel<any, Item> {\n  static override defineSchema(): any {\n    const fields = foundry.data.fields;\n    \n    return {\n      description: new fields.HTMLField({\n        required: true,\n        initial: \"\"\n      }),\n      maxStrength: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_STRENGTH\"\n      }),\n      maxAgility: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_AGILITY\"\n      }),\n      maxWillpower: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_WILLPOWER\"\n      }),\n      maxLogic: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_LOGIC\"\n      }),\n      maxCharisma: new fields.NumberField({\n        required: true,\n        initial: 4,\n        min: 1,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.MAX_CHARISMA\"\n      }),\n      anarchyBonus: new fields.NumberField({\n        required: true,\n        initial: 0,\n        min: 0,\n        max: 10,\n        integer: true,\n        label: \"SRA2.METATYPES.ANARCHY_BONUS\"\n      })\n    };\n  }\n\n  override prepareDerivedData(): void {\n    // Metatypes don't have a cost, they're character features\n    // No derived data needed for now\n  }\n}\n\n","/**\n * Custom Actor document for SRA2\n */\nexport class SRA2Actor<SubType extends Actor.SubType = Actor.SubType> extends Actor<SubType> {\n  get feats(): Item[] {\n    return this.items.filter((item: Item) => item.type === 'feat');\n  }\n}","/**\n * Shared Dice Rolling Utilities for SRA2\n * This module contains common dice rolling functions used across character sheets, NPC sheets, and item sheets.\n */\n\n/**\n * RR source information\n */\nexport interface RRSource {\n  featName: string;\n  rrValue: number;\n}\n\n/**\n * Risk reduction constants\n */\nexport const RISK_DICE_BY_RR = [2, 5, 8, 12];\n\nexport const RISK_THRESHOLDS = {\n  0: { normal: 2, fort: 4, extreme: 6 },\n  1: { normal: 5, fort: 7, extreme: 9 },\n  2: { normal: 8, fort: 11, extreme: 13 },\n  3: { normal: 12, fort: 15, extreme: 999 }\n};\n\n/**\n * Get risk dice count based on RR level\n */\nexport function getRiskDiceByRR(rr: number): number {\n  return RISK_DICE_BY_RR[Math.min(3, Math.max(0, rr))] || 2;\n}\n\n/**\n * Get RR sources from an actor for a specific item type and name\n * This is the main function used by most sheets for their own actor\n */\nexport function getRRSources(\n  actor: any,\n  itemType: 'skill' | 'specialization' | 'attribute',\n  itemName: string\n): RRSource[] {\n  const sources: RRSource[] = [];\n  \n  // Get all active feats from the actor\n  const feats = actor.items.filter((item: any) => \n    item.type === 'feat' && \n    item.system.active === true\n  );\n  \n  // Calculate RR from feats that target this item\n  for (const feat of feats) {\n    const featSystem = feat.system as any;\n    const rrList = featSystem.rrList || [];\n    \n    // Loop through all RR entries in this feat\n    for (const rrEntry of rrList) {\n      const rrType = rrEntry.rrType;\n      const rrValue = rrEntry.rrValue || 0;\n      const rrTarget = rrEntry.rrTarget || '';\n      \n      // Check if this RR entry provides RR for the given item\n      if (rrType === itemType && rrTarget === itemName && rrValue > 0) {\n        sources.push({\n          featName: feat.name,\n          rrValue: rrValue\n        });\n      }\n    }\n  }\n  \n  return sources;\n}\n\n/**\n * Get RR sources from any actor for a specific item type and name\n * This is useful for defense rolls where we need to check another actor's RR\n * (identical to getRRSources but kept separate for clarity in combat scenarios)\n */\nexport function getRRSourcesForActor(\n  actor: any,\n  itemType: 'skill' | 'specialization' | 'attribute',\n  itemName: string\n): RRSource[] {\n  return getRRSources(actor, itemType, itemName);\n}\n\n/**\n * Get success threshold based on roll mode\n */\nexport function getSuccessThreshold(mode: string): number {\n  switch (mode) {\n    case 'advantage': return 4;  // 4, 5, 6 = success\n    case 'disadvantage': return 6; // only 6 = success\n    default: return 5;  // 5, 6 = success\n  }\n}\n\n/**\n * Build RR sources HTML for dialog\n */\nexport function buildRRSourcesHtml(rrSources: RRSource[]): string {\n  if (rrSources.length === 0) return '';\n  \n  let html = '<div class=\"rr-sources\"><strong>Sources RR:</strong>';\n  rrSources.forEach((source) => {\n    html += `\n      <label class=\"rr-source-item\">\n        <input type=\"checkbox\" class=\"rr-source-checkbox\" data-rr-value=\"${source.rrValue}\" checked />\n        <span>${source.featName} (+${source.rrValue})</span>\n      </label>`;\n  });\n  html += '</div>';\n  \n  return html;\n}\n\n/**\n * REMOVED: Roll dialog script generation\n */\n\n/**\n * REMOVED: Roll dialog content creation\n */\n\n/**\n * REMOVED: Dice rolling logic\n * All dice rolling and chat message functions have been removed.\n * Only UI triggers and threshold calculations remain.\n */\n\n/**\n * REMOVED: HTML building for dice results\n */\n\n/**\n * REMOVED: Chat message posting\n */\n\n/**\n * REMOVED: Dialog creation for rolls\n * Dialogs and callbacks have been removed as they trigger dice rolls.\n */\n\n/**\n * Roll Request Data Interface\n * Contains all information needed for a roll request\n */\nexport interface RollRequestData {\n  // Item information\n  itemType?: string;\n  weaponType?: string;\n  itemName?: string;\n  itemId?: string;\n  itemRating?: number;\n  itemActive?: boolean;\n  \n  // Linked skills (merged from weapon types and custom fields)\n  linkedAttackSkill?: string;\n  linkedAttackSpecialization?: string;\n  linkedDefenseSkill?: string;\n  linkedDefenseSpecialization?: string;\n  linkedAttribute?: string;\n  \n  // Weapon properties\n  isWeaponFocus?: boolean;\n  damageValue?: string;  // FINAL damage value (base + bonus)\n  damageValueBonus?: number;  // Bonus from feat\n  meleeRange?: string;  // \"none\" | \"ok\" | \"disadvantage\"\n  shortRange?: string;  // \"none\" | \"ok\" | \"disadvantage\"\n  mediumRange?: string; // \"none\" | \"ok\" | \"disadvantage\"\n  longRange?: string;   // \"none\" | \"ok\" | \"disadvantage\"\n  \n  // Skill/Spec information (undefined if not found)\n  skillName?: string;\n  specName?: string;\n  skillLevel?: number;\n  specLevel?: number;\n  \n  // NPC threshold (when not rolling dice)\n  threshold?: number;\n  \n  // Actor information\n  actorId?: string;\n  actorUuid?: string;\n  actorName?: string;\n  \n  // RR List\n  rrList?: any[];\n}\n\n/**\n * Handle roll request - central function for all roll clicks\n * Displays a roll dialog with roll information\n */\nexport function handleRollRequest(data: RollRequestData): void {\n  console.log('=== ROLL REQUEST ===', {\n    itemType: data.itemType,\n    weaponType: data.weaponType,\n    linkedAttackSkill: data.linkedAttackSkill,\n    linkedAttackSpecialization: data.linkedAttackSpecialization,\n    linkedDefenseSkill: data.linkedDefenseSkill,\n    linkedDefenseSpecialization: data.linkedDefenseSpecialization,\n    linkedAttribute: data.linkedAttribute,\n    isWeaponFocus: data.isWeaponFocus,\n    damageValue: data.damageValue,\n    damageValueBonus: data.damageValueBonus,\n    meleeRange: data.meleeRange,\n    shortRange: data.shortRange,\n    mediumRange: data.mediumRange,\n    longRange: data.longRange,\n    skillName: data.skillName,\n    specName: data.specName,\n    itemName: data.itemName,\n    itemId: data.itemId,\n    threshold: data.threshold,\n    actorId: data.actorId,\n    actorUuid: data.actorUuid,\n    actorName: data.actorName,\n    specLevel: data.specLevel,\n    skillLevel: data.skillLevel,\n    itemRating: data.itemRating,\n    itemActive: data.itemActive,\n    rrList: data.rrList\n  });\n\n  // Import RollDialog dynamically to avoid circular dependencies\n  import('../applications/roll-dialog.js').then((module) => {\n    const dialog = new module.RollDialog(data);\n    dialog.render(true);\n  });\n}\n\n","/**\n * Shared Item Search Utilities for SRA2\n * This module contains common item search functions used across character sheets, NPC sheets, and item sheets.\n */\n\n/**\n * Normalize text for search: lowercase and remove accents/special characters\n */\nexport function normalizeSearchText(text: string): string {\n  return text\n    .toLowerCase()\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, ''); // Remove diacritics\n}\n\n/**\n * Search result interface\n */\nexport interface SearchResult {\n  name: string;\n  uuid: string;\n  source: string;\n  type: string;\n  id?: string;\n  alreadyExists?: boolean;\n}\n\n/**\n * Search for items in world items\n */\nexport function searchItemsInWorld(\n  itemType: string,\n  searchTerm: string,\n  existingItemsCheck?: (itemName: string) => boolean\n): SearchResult[] {\n  const results: SearchResult[] = [];\n  \n  if (!game.items) return results;\n  \n  for (const item of game.items as any) {\n    if (item.type === itemType && normalizeSearchText(item.name).includes(searchTerm)) {\n      const alreadyExists = existingItemsCheck ? existingItemsCheck(item.name) : false;\n      \n      results.push({\n        name: item.name,\n        uuid: item.uuid,\n        id: item.id,\n        source: game.i18n!.localize('SRA2.SKILLS.WORLD_ITEMS'),\n        type: itemType,\n        alreadyExists\n      });\n    }\n  }\n  \n  return results;\n}\n\n/**\n * Search for items in actor's items\n */\nexport function searchItemsOnActor(\n  actor: any,\n  itemType: string,\n  searchTerm: string\n): SearchResult[] {\n  const results: SearchResult[] = [];\n  \n  if (!actor) return results;\n  \n  for (const item of actor.items as any) {\n    if (item.type === itemType && normalizeSearchText(item.name).includes(searchTerm)) {\n      results.push({\n        name: item.name,\n        uuid: item.uuid,\n        id: item.id,\n        source: game.i18n!.localize('SRA2.FEATS.FROM_ACTOR'),\n        type: itemType\n      });\n    }\n  }\n  \n  return results;\n}\n\n/**\n * Search for items in all compendiums\n */\nexport async function searchItemsInCompendiums(\n  itemType: string,\n  searchTerm: string,\n  existingItemsCheck?: (itemName: string) => boolean\n): Promise<SearchResult[]> {\n  const results: SearchResult[] = [];\n  const seenNames = new Set<string>();\n  \n  // Search in all compendiums\n  for (const pack of game.packs as any) {\n    // Only search in Item compendiums\n    if (pack.documentName !== 'Item') continue;\n    \n    // Get all documents from the pack\n    const documents = await pack.getDocuments();\n    \n    // Filter for items that match the search term and type\n    for (const doc of documents) {\n      if (doc.type === itemType && normalizeSearchText(doc.name).includes(searchTerm)) {\n        // Check if not already in results (by name)\n        if (seenNames.has(doc.name)) continue;\n        seenNames.add(doc.name);\n        \n        const alreadyExists = existingItemsCheck ? existingItemsCheck(doc.name) : false;\n        \n        results.push({\n          name: doc.name,\n          uuid: doc.uuid,\n          source: pack.title,\n          type: itemType,\n          alreadyExists\n        });\n      }\n    }\n  }\n  \n  return results;\n}\n\n/**\n * Perform a complete search across actor, world, and compendiums\n */\nexport async function searchItemsEverywhere(\n  itemType: string,\n  searchTerm: string,\n  actor?: any,\n  existingItemsCheck?: (itemName: string) => boolean\n): Promise<SearchResult[]> {\n  const results: SearchResult[] = [];\n  const seenNames = new Set<string>();\n  \n  // 1. Search in actor items if provided\n  if (actor) {\n    const actorResults = searchItemsOnActor(actor, itemType, searchTerm);\n    actorResults.forEach(result => {\n      results.push(result);\n      seenNames.add(result.name);\n    });\n  }\n  \n  // 2. Search in world items\n  const worldResults = searchItemsInWorld(itemType, searchTerm, existingItemsCheck);\n  worldResults.forEach(result => {\n    if (!seenNames.has(result.name)) {\n      results.push(result);\n      seenNames.add(result.name);\n    }\n  });\n  \n  // 3. Search in compendiums\n  const compendiumResults = await searchItemsInCompendiums(itemType, searchTerm, existingItemsCheck);\n  compendiumResults.forEach(result => {\n    if (!seenNames.has(result.name)) {\n      results.push(result);\n      seenNames.add(result.name);\n    }\n  });\n  \n  return results;\n}\n\n/**\n * Build HTML for search results display\n */\nexport interface DisplaySearchResultsOptions {\n  results: SearchResult[];\n  lastSearchTerm: string;\n  noResultsMessage: string;\n  typeLabel: string;\n  onAddCallback?: (result: SearchResult) => void;\n}\n\nexport function buildSearchResultsHtml(options: DisplaySearchResultsOptions): string {\n  const { results, lastSearchTerm, noResultsMessage, typeLabel } = options;\n  \n  // Check if there's a perfect match (case-insensitive and accent-insensitive)\n  const normalizedLastSearch = normalizeSearchText(lastSearchTerm);\n  const exactMatch = results.find(r => normalizeSearchText(r.name) === normalizedLastSearch);\n  \n  let html = '';\n  \n  if (results.length === 0) {\n    html = `\n      <div class=\"search-result-item no-results\">\n        <div class=\"no-results-text\">\n          ${noResultsMessage}\n        </div>\n      </div>\n    `;\n  } else {\n    // If we have an exact match, highlight it at the top\n    if (exactMatch) {\n      html += buildSingleResultHtml(exactMatch, typeLabel, true);\n    }\n    \n    // Display other search results\n    const otherResults = exactMatch \n      ? results.filter(r => r.name !== exactMatch.name)\n      : results;\n    \n    for (const result of otherResults) {\n      html += buildSingleResultHtml(result, typeLabel, false);\n    }\n  }\n  \n  return html;\n}\n\n/**\n * Build HTML for a single search result\n */\nfunction buildSingleResultHtml(result: SearchResult, typeLabel: string, isExactMatch: boolean): string {\n  const alreadyExistsClass = result.alreadyExists ? 'already-exists' : '';\n  const exactMatchClass = isExactMatch ? 'exact-match' : '';\n  \n  let html = `\n    <div class=\"search-result-item ${alreadyExistsClass} ${exactMatchClass}\" \n         data-result-name=\"${result.name}\" \n         data-result-uuid=\"${result.uuid}\">\n      <div class=\"result-info\">\n        <span class=\"result-name\">${result.name}</span>\n        <span class=\"result-pack\">${result.source} - ${typeLabel}</span>\n      </div>\n  `;\n  \n  if (result.alreadyExists) {\n    html += `\n      <span class=\"already-exists-label\">\n        ${game.i18n!.localize('SRA2.SKILLS.ALREADY_EXISTS')}\n      </span>\n    `;\n  } else {\n    html += `\n      <button class=\"add-item-btn\" \n              data-item-name=\"${result.name}\" \n              data-item-uuid=\"${result.uuid}\">\n        ${game.i18n!.localize('SRA2.SKILLS.ADD')}\n      </button>\n    `;\n  }\n  \n  html += `</div>`;\n  \n  return html;\n}\n\n/**\n * Create a debounced search function\n */\nexport function createDebouncedSearch(\n  searchFunction: (searchTerm: string) => Promise<void>,\n  delay: number = 300\n): (searchTerm: string) => void {\n  let timeoutId: any = null;\n  \n  return (searchTerm: string) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    \n    timeoutId = setTimeout(async () => {\n      await searchFunction(searchTerm);\n    }, delay);\n  };\n}\n\n/**\n * Show or hide search results container\n */\nexport function toggleSearchResults(resultsDiv: HTMLElement, show: boolean): void {\n  if (show) {\n    resultsDiv.style.display = 'block';\n  } else {\n    resultsDiv.style.display = 'none';\n  }\n}\n\n/**\n * Check if an item already exists on an actor\n */\nexport function itemExistsOnActor(actor: any, itemType: string, itemName: string): boolean {\n  if (!actor) return false;\n  \n  return actor.items.some((item: any) => \n    item.type === itemType && item.name === itemName\n  );\n}\n\n/**\n * Add an item to an actor from UUID\n */\nexport async function addItemToActorFromUuid(actor: any, itemUuid: string): Promise<boolean> {\n  try {\n    const item = await fromUuid(itemUuid as any);\n    if (!item) {\n      ui.notifications?.error(game.i18n!.localize('SRA2.SKILLS.ITEM_NOT_FOUND'));\n      return false;\n    }\n    \n    // Check if item already exists\n    if (itemExistsOnActor(actor, (item as any).type, (item as any).name)) {\n      ui.notifications?.warn(game.i18n!.format('SRA2.ALREADY_EXISTS', { name: (item as any).name }));\n      return false;\n    }\n    \n    // Add the item to the actor\n    await actor.createEmbeddedDocuments('Item', [(item as any).toObject()]);\n    ui.notifications?.info(game.i18n!.format('SRA2.SKILLS.ADDED', { name: (item as any).name }));\n    \n    return true;\n  } catch (error) {\n    console.error('SRA2 | Error adding item to actor:', error);\n    ui.notifications?.error(game.i18n!.localize('SRA2.SKILLS.ERROR_ADDING'));\n    return false;\n  }\n}\n\n","/**\n * Shared Sheet Helpers for SRA2\n * Common functions used by both CharacterSheet and NpcSheet\n */\n\nimport * as ItemSearch from './item-search.js';\n\n/**\n * Handle form submission with proper damage checkbox handling\n */\nexport function handleSheetUpdate(actor: any, formData: any): any {\n  // Expand the form data first to handle nested properties properly\n  const expandedData = foundry.utils.expandObject(formData) as any;\n  \n  // Ensure damage structure exists and handle unchecked checkboxes\n  if (expandedData.system) {\n    const currentDamage = (actor.system as any).damage || {};\n    \n    // Initialize damage object if not present\n    if (!expandedData.system.damage) {\n      expandedData.system.damage = {};\n    }\n    \n    // Handle light damage checkboxes - if array not in formData, it means all are unchecked\n    if (currentDamage.light && !expandedData.system.damage.light) {\n      expandedData.system.damage.light = currentDamage.light.map(() => false);\n    } else if (expandedData.system.damage.light && currentDamage.light) {\n      // Fill missing indices with false\n      for (let i = 0; i < currentDamage.light.length; i++) {\n        if (expandedData.system.damage.light[i] === undefined) {\n          expandedData.system.damage.light[i] = false;\n        }\n      }\n    }\n    \n    // Handle severe damage checkboxes\n    if (currentDamage.severe && !expandedData.system.damage.severe) {\n      expandedData.system.damage.severe = currentDamage.severe.map(() => false);\n    } else if (expandedData.system.damage.severe && currentDamage.severe) {\n      for (let i = 0; i < currentDamage.severe.length; i++) {\n        if (expandedData.system.damage.severe[i] === undefined) {\n          expandedData.system.damage.severe[i] = false;\n        }\n      }\n    }\n    \n    // Handle incapacitating - if not in formData, set to false\n    if (expandedData.system.damage.incapacitating === undefined) {\n      expandedData.system.damage.incapacitating = false;\n    }\n  }\n  \n  return expandedData;\n}\n\n/**\n * Calculate final damage value for weapon/spell display\n */\nexport function calculateFinalDamageValue(damageValue: string, damageValueBonus: number, strength: number): string {\n  if (damageValue === \"FOR\") {\n    const total = strength + damageValueBonus;\n    return damageValueBonus > 0 ? `${total} (FOR+${damageValueBonus})` : `${total} (FOR)`;\n  } else if (damageValue.startsWith(\"FOR+\")) {\n    const modifier = parseInt(damageValue.substring(4)) || 0;\n    const total = strength + modifier + damageValueBonus;\n    return damageValueBonus > 0 ? `${total} (FOR+${modifier}+${damageValueBonus})` : `${total} (FOR+${modifier})`;\n  } else if (damageValue === \"toxin\") {\n    return \"selon toxine\";\n  } else {\n    const base = parseInt(damageValue) || 0;\n    const total = base + damageValueBonus;\n    return damageValueBonus > 0 ? `${total} (${base}+${damageValueBonus})` : total.toString();\n  }\n}\n\n/**\n * Organize specializations by linked skill\n */\nexport function organizeSpecializationsBySkill(\n  allSpecializations: any[],\n  actorItems: any[]\n): { bySkill: Map<string, any[]>; unlinked: any[] } {\n  const specializationsBySkill = new Map<string, any[]>();\n  const unlinkedSpecializations: any[] = [];\n  \n  allSpecializations.forEach((spec: any) => {\n    const linkedSkillName = spec.system.linkedSkill;\n    if (linkedSkillName) {\n      // linkedSkill is stored as a name, find the skill by name\n      const linkedSkill = actorItems.find((i: any) => \n        i.type === 'skill' && i.name === linkedSkillName\n      );\n      \n      if (linkedSkill && linkedSkill.id) {\n        // Valid linked skill found\n        const skillId = linkedSkill.id;\n        if (!specializationsBySkill.has(skillId)) {\n          specializationsBySkill.set(skillId, []);\n        }\n        specializationsBySkill.get(skillId)!.push(spec);\n      } else {\n        // Linked skill doesn't exist, mark as unlinked\n        unlinkedSpecializations.push(spec);\n      }\n    } else {\n      // No linked skill specified\n      unlinkedSpecializations.push(spec);\n    }\n  });\n  \n  return { bySkill: specializationsBySkill, unlinked: unlinkedSpecializations };\n}\n\n/**\n * Handle item drop on actor sheet (feats, skills, specializations, metatypes)\n */\nexport async function handleItemDrop(\n  event: DragEvent,\n  actor: any,\n  allowedTypes: string[] = ['feat', 'skill', 'specialization', 'metatype']\n): Promise<boolean> {\n  const data = TextEditor.getDragEventData(event) as any;\n  \n  // Handle Item drops\n  if (data && data.type === 'Item') {\n    const item = await Item.implementation.fromDropData(data) as any;\n    \n    if (!item) return false;\n    \n    // Check if the item is from a compendium or another actor (not already on this actor)\n    if (item.actor && item.actor.id === actor.id) {\n      // Item already belongs to this actor, ignore\n      return false;\n    }\n    \n    // Check if type is allowed\n    if (!allowedTypes.includes(item.type)) {\n      return false;\n    }\n    \n    // Handle metatype\n    if (item.type === 'metatype') {\n      const existingMetatype = actor.items.find((i: any) => i.type === 'metatype');\n      if (existingMetatype) {\n        ui.notifications?.warn(game.i18n!.localize('SRA2.METATYPES.ONLY_ONE_METATYPE'));\n        return false;\n      }\n      await actor.createEmbeddedDocuments('Item', [item.toObject()]);\n      return true;\n    }\n    \n    // Handle feat\n    if (item.type === 'feat') {\n      const existingFeat = actor.items.find((i: any) => \n        i.type === 'feat' && i.name === item.name\n      );\n      if (existingFeat) {\n        ui.notifications?.warn(game.i18n!.format('SRA2.FEATS.ALREADY_EXISTS', { name: item.name }));\n        return false;\n      }\n      await actor.createEmbeddedDocuments('Item', [item.toObject()]);\n      return true;\n    }\n    \n    // Handle skill\n    if (item.type === 'skill') {\n      const existingSkill = actor.items.find((i: any) => \n        i.type === 'skill' && i.name === item.name\n      );\n      if (existingSkill) {\n        ui.notifications?.warn(game.i18n!.format('SRA2.SKILLS.ALREADY_EXISTS', { name: item.name }));\n        return false;\n      }\n      await actor.createEmbeddedDocuments('Item', [item.toObject()]);\n      return true;\n    }\n    \n    // Handle specialization\n    if (item.type === 'specialization') {\n      const existingSpec = actor.items.find((i: any) => \n        i.type === 'specialization' && i.name === item.name\n      );\n      if (existingSpec) {\n        ui.notifications?.warn(game.i18n!.format('SRA2.SPECIALIZATIONS.ALREADY_EXISTS', { name: item.name }));\n        return false;\n      }\n      await actor.createEmbeddedDocuments('Item', [item.toObject()]);\n      return true;\n    }\n  }\n  \n  return false;\n}\n\n/**\n * Get RR for a specific item type and name (wrapper for DiceRoller)\n */\nexport function getRRSources(actor: any, itemType: 'skill' | 'specialization' | 'attribute', itemName: string): Array<{featName: string, rrValue: number}> {\n  const sources: Array<{featName: string, rrValue: number}> = [];\n  \n  const feats = actor.items.filter((item: any) => \n    item.type === 'feat' && \n    item.system.active === true\n  );\n  \n  for (const feat of feats) {\n    const featSystem = feat.system as any;\n    const rrList = featSystem.rrList || [];\n    \n    for (const rrEntry of rrList) {\n      const rrType = rrEntry.rrType;\n      const rrValue = rrEntry.rrValue || 0;\n      const rrTarget = rrEntry.rrTarget || '';\n      \n      if (rrType === itemType && rrTarget === itemName && rrValue > 0) {\n        sources.push({\n          featName: feat.name,\n          rrValue: rrValue\n        });\n      }\n    }\n  }\n  \n  return sources;\n}\n\n/**\n * Calculate Risk Reduction for a given skill, specialization, or attribute\n */\nexport function calculateRR(actor: any, itemType: 'skill' | 'specialization' | 'attribute', itemName: string): number {\n  const sources = getRRSources(actor, itemType, itemName);\n  return sources.reduce((total, source) => total + source.rrValue, 0);\n}\n\n/**\n * Generic handler to edit an item from an actor\n */\nexport async function handleEditItem(event: Event, actor: any): Promise<void> {\n  event.preventDefault();\n  const element = event.currentTarget as HTMLElement;\n  const itemId = element.dataset.itemId || (element.closest('.metatype-item') as HTMLElement)?.getAttribute('data-item-id');\n  \n  if (!itemId) return;\n\n  const item = actor.items.get(itemId);\n  if (item) {\n    item.sheet?.render(true);\n  }\n}\n\n/**\n * Generic handler to delete an item from an actor\n */\nexport async function handleDeleteItem(event: Event, actor: any, sheetRender?: (refresh: boolean) => void): Promise<void> {\n  event.preventDefault();\n  const element = event.currentTarget as HTMLElement;\n  const itemId = element.dataset.itemId || (element.closest('.metatype-item') as HTMLElement)?.getAttribute('data-item-id');\n  \n  if (!itemId) return;\n\n  const item = actor.items.get(itemId);\n  if (item) {\n    await item.delete();\n    if (sheetRender) {\n      sheetRender(false);\n    }\n  }\n}\n\n/**\n * Enrich feats with RR entries and final damage values\n */\nexport function enrichFeats(feats: any[], actorStrength: number, calculateFinalDamageValueFn: (dv: string, bonus: number, str: number) => string): any[] {\n  return feats.map((feat: any) => {\n    // Add translated labels for attribute targets in RR entries\n    feat.rrEntries = [];\n    const rrList = feat.system.rrList || [];\n    \n    for (let i = 0; i < rrList.length; i++) {\n      const rrEntry = rrList[i];\n      const rrType = rrEntry.rrType;\n      const rrValue = rrEntry.rrValue || 0;\n      const rrTarget = rrEntry.rrTarget || '';\n      \n      const entry: any = { rrType, rrValue, rrTarget };\n      \n      if (rrType === 'attribute' && rrTarget) {\n        entry.rrTargetLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${rrTarget.toUpperCase()}`);\n      }\n      \n      feat.rrEntries.push(entry);\n    }\n    \n    // Calculate final damage value for weapons and spells\n    if (feat.system.featType === 'weapon' || feat.system.featType === 'spell' || feat.system.featType === 'weapons-spells') {\n      const damageValue = feat.system.damageValue || '0';\n      const damageValueBonus = feat.system.damageValueBonus || 0;\n      \n      feat.finalDamageValue = calculateFinalDamageValueFn(damageValue, damageValueBonus, actorStrength);\n    }\n    \n    return feat;\n  });\n}\n\n","import * as DiceRoller from '../helpers/dice-roller.js';\nimport * as ItemSearch from '../helpers/item-search.js';\nimport * as DefenseSelection from '../helpers/defense-selection.js';\nimport * as SheetHelpers from '../helpers/sheet-helpers.js';\nimport { WEAPON_TYPES } from '../models/item-feat.js';\n\n/**\n * Character Sheet Application\n */\nexport class CharacterSheet extends ActorSheet {\n  /** Active section for tabbed navigation */\n  private _activeSection: string = 'identity';\n\n  static override get defaultOptions(): DocumentSheet.Options<Actor> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'actor', 'character'],\n      template: 'systems/sra2/templates/actor-character-sheet.hbs',\n      width: 900,\n      height: 700,\n      tabs: [],\n      dragDrop: [\n        { dragSelector: '.metatype-item', dropSelector: null },\n        { dragSelector: '.feat-item', dropSelector: null },\n        { dragSelector: '.skill-item', dropSelector: null },\n        { dragSelector: '.specialization-item', dropSelector: null }\n      ],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n\n    // Ensure system data is available\n    context.system = this.actor.system;\n\n    // Get metatype (there should be only one)\n    const metatypes = this.actor.items.filter((item: any) => item.type === 'metatype');\n    context.metatype = metatypes.length > 0 ? metatypes[0] : null;\n\n    // Get actor's strength for damage value calculations\n    const actorStrength = (this.actor.system as any).attributes?.strength || 0;\n    \n    // Get feats and enrich with RR target labels and calculated damage values\n    const rawFeats = this.actor.items.filter((item: any) => item.type === 'feat');\n    const allFeats = SheetHelpers.enrichFeats(rawFeats, actorStrength, SheetHelpers.calculateFinalDamageValue);\n    \n    // Group feats by type\n    context.featsByType = {\n      trait: allFeats.filter((feat: any) => feat.system.featType === 'trait'),\n      contact: allFeats.filter((feat: any) => feat.system.featType === 'contact'),\n      awakened: allFeats.filter((feat: any) => feat.system.featType === 'awakened'),\n      adeptPower: allFeats.filter((feat: any) => feat.system.featType === 'adept-power'),\n      equipment: allFeats.filter((feat: any) => feat.system.featType === 'equipment'),\n      cyberware: allFeats.filter((feat: any) => feat.system.featType === 'cyberware'),\n      cyberdeck: allFeats.filter((feat: any) => feat.system.featType === 'cyberdeck'),\n      vehicle: allFeats.filter((feat: any) => feat.system.featType === 'vehicle'),\n      weaponsSpells: allFeats.filter((feat: any) => feat.system.featType === 'weapons-spells'),\n      weapon: allFeats.filter((feat: any) => feat.system.featType === 'weapon'),\n      spell: allFeats.filter((feat: any) => feat.system.featType === 'spell')\n    };\n    \n    // Keep the feats array for backwards compatibility\n    context.feats = allFeats;\n    \n    // Get skills (sorted alphabetically)\n    const skills = this.actor.items\n      .filter((item: any) => item.type === 'skill')\n      .sort((a: any, b: any) => a.name.localeCompare(b.name));\n    \n    // Get all specializations (sorted alphabetically)\n    const allSpecializations = this.actor.items\n      .filter((item: any) => item.type === 'specialization')\n      .sort((a: any, b: any) => a.name.localeCompare(b.name));\n    \n    // Organize specializations by linked skill using helper\n    const { bySkill: specializationsBySkill, unlinked: unlinkedSpecializations } = \n      SheetHelpers.organizeSpecializationsBySkill(allSpecializations, this.actor.items.contents);\n    \n    // Calculate RR for attributes first (needed for skills and specializations)\n    const attributesRR = {\n      strength: Math.min(3, this.calculateRR('attribute', 'strength')),\n      agility: Math.min(3, this.calculateRR('attribute', 'agility')),\n      willpower: Math.min(3, this.calculateRR('attribute', 'willpower')),\n      logic: Math.min(3, this.calculateRR('attribute', 'logic')),\n      charisma: Math.min(3, this.calculateRR('attribute', 'charisma'))\n    };\n    \n    // Add specializations to each skill and calculate RR\n    context.skills = skills.map((skill: any) => {\n      // Get linked attribute label for the skill\n      const linkedAttribute = skill.system?.linkedAttribute || 'strength';\n      skill.linkedAttributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${linkedAttribute.toUpperCase()}`);\n      \n      // Calculate RR for this skill (skill RR + attribute RR, max 3)\n      const skillRR = this.calculateRR('skill', skill.name);\n      const attributeRR = (attributesRR as any)[linkedAttribute] || 0;\n      skill.rr = Math.min(3, skillRR + attributeRR);\n      \n      // Calculate total dice pool (attribute + skill rating)\n      const attributeValue = (this.actor.system as any).attributes[linkedAttribute] || 0;\n      const skillRating = skill.system?.rating || 0;\n      skill.totalDicePool = attributeValue + skillRating;\n      \n      // Get specializations for this skill and add calculated ratings (sorted alphabetically)\n      const specs = (specializationsBySkill.get(skill.id) || []).sort((a: any, b: any) => a.name.localeCompare(b.name));\n      skill.specializations = specs.map((spec: any) => {\n        const parentRating = skill.system?.rating || 0;\n        // Add properties directly to the spec object instead of creating a new one\n        spec.parentRating = parentRating;\n        spec.effectiveRating = parentRating + 2;  // Specialization adds +2 to skill rating\n        spec.parentSkillName = skill.name;\n        \n        // Get linked attribute label for the specialization\n        const specLinkedAttribute = spec.system?.linkedAttribute || 'strength';\n        spec.linkedAttributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${specLinkedAttribute.toUpperCase()}`);\n        \n        // Calculate RR for this specialization (attribute RR + skill RR + spec RR, max 3)\n        const specRR = this.calculateRR('specialization', spec.name);\n        const specAttributeRR = (attributesRR as any)[specLinkedAttribute] || 0;\n        const parentSkillRR = skillRR; // RR of the parent skill\n        spec.rr = Math.min(3, specAttributeRR + parentSkillRR + specRR);\n        \n        // Calculate total dice pool (attribute + effective rating)\n        const specAttributeValue = (this.actor.system as any).attributes[specLinkedAttribute] || 0;\n        spec.totalDicePool = specAttributeValue + spec.effectiveRating;\n        \n        return spec;\n      });\n      return skill;\n    });\n    \n    // Add unlinked specializations with attribute labels and RR (sorted alphabetically)\n    context.unlinkedSpecializations = unlinkedSpecializations\n      .sort((a: any, b: any) => a.name.localeCompare(b.name))\n      .map((spec: any) => {\n      const linkedAttribute = spec.system?.linkedAttribute || 'strength';\n      spec.linkedAttributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${linkedAttribute.toUpperCase()}`);\n      \n      // Calculate RR for this specialization (spec RR + attribute RR, max 3)\n      // Note: unlinked specializations don't have a parent skill, so only attribute + spec RR\n      const specRR = this.calculateRR('specialization', spec.name);\n      const attributeRR = (attributesRR as any)[linkedAttribute] || 0;\n      spec.rr = Math.min(3, specRR + attributeRR);\n      \n      // Calculate total dice pool (attribute only, since no skill linked)\n      const attributeValue = (this.actor.system as any).attributes[linkedAttribute] || 0;\n      spec.totalDicePool = attributeValue;\n      \n      return spec;\n    });\n    \n    // Store attributesRR in context\n    context.attributesRR = attributesRR;\n\n    // Add active section for navigation\n    context.activeSection = this._activeSection;\n\n    return context;\n  }\n\n  override async close(options?: Application.CloseOptions): Promise<void> {\n    // Clean up document-level event listeners\n    $(document).off('click.skill-search');\n    $(document).off('click.feat-search');\n    return super.close(options);\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n\n    // Section navigation\n    html.find('.section-nav .nav-item').on('click', this._onSectionNavigation.bind(this));\n\n    // Edit metatype\n    html.find('[data-action=\"edit-metatype\"]').on('click', this._onEditMetatype.bind(this));\n    \n    // Delete metatype\n    html.find('[data-action=\"delete-metatype\"]').on('click', this._onDeleteMetatype.bind(this));\n\n    // Edit feat\n    html.find('[data-action=\"edit-feat\"]').on('click', this._onEditFeat.bind(this));\n\n    // Delete feat\n    html.find('[data-action=\"delete-feat\"]').on('click', this._onDeleteFeat.bind(this));\n\n    // Edit skill\n    html.find('[data-action=\"edit-skill\"]').on('click', this._onEditSkill.bind(this));\n\n    // Delete skill\n    html.find('[data-action=\"delete-skill\"]').on('click', this._onDeleteSkill.bind(this));\n\n    // Edit specialization\n    html.find('[data-action=\"edit-specialization\"]').on('click', this._onEditSpecialization.bind(this));\n\n    // Delete specialization\n    html.find('[data-action=\"delete-specialization\"]').on('click', this._onDeleteSpecialization.bind(this));\n\n    // Roll attribute\n    html.find('[data-action=\"roll-attribute\"]').on('click', this._onRollAttribute.bind(this));\n\n    // Roll skill\n    html.find('[data-action=\"roll-skill\"]').on('click', this._onRollSkill.bind(this));\n\n    // Quick roll skill (from dice badge)\n    html.find('[data-action=\"quick-roll-skill\"]').on('click', this._onQuickRollSkill.bind(this));\n\n    // Roll specialization\n    html.find('[data-action=\"roll-specialization\"]').on('click', this._onRollSpecialization.bind(this));\n\n    // Quick roll specialization (from dice badge)\n    html.find('[data-action=\"quick-roll-specialization\"]').on('click', this._onQuickRollSpecialization.bind(this));\n\n    // Send catchphrase to chat\n    html.find('[data-action=\"send-catchphrase\"]').on('click', this._onSendCatchphrase.bind(this));\n\n    // Roll weapon\n    html.find('[data-action=\"roll-weapon\"]').on('click', this._onRollWeapon.bind(this));\n\n    // Roll spell\n    html.find('[data-action=\"roll-spell\"]').on('click', this._onRollSpell.bind(this));\n\n    // Roll weapon/spell (old type)\n    html.find('[data-action=\"roll-weapon-spell\"]').on('click', this._onRollWeaponSpell.bind(this));\n\n    // Handle rating changes\n    html.find('.rating-input').on('change', this._onRatingChange.bind(this));\n\n    // Skill search\n    html.find('.skill-search-input').on('input', this._onSkillSearch.bind(this));\n    html.find('.skill-search-input').on('focus', this._onSkillSearchFocus.bind(this));\n    html.find('.skill-search-input').on('blur', this._onSkillSearchBlur.bind(this));\n    \n    // Close skill search results when clicking outside\n    $(document).on('click.skill-search', (event) => {\n      const target = event.target as unknown as HTMLElement;\n      const skillSearchContainer = html.find('.skill-search-container')[0] as HTMLElement;\n      if (skillSearchContainer && !skillSearchContainer.contains(target)) {\n        html.find('.skill-search-results').hide();\n      }\n    });\n\n    // Feat search\n    html.find('.feat-search-input').on('input', this._onFeatSearch.bind(this));\n    html.find('.feat-search-input').on('focus', this._onFeatSearchFocus.bind(this));\n    html.find('.feat-search-input').on('blur', this._onFeatSearchBlur.bind(this));\n    \n    // Close feat search results when clicking outside\n    $(document).on('click.feat-search', (event) => {\n      const target = event.target as unknown as HTMLElement;\n      const featSearchContainer = html.find('.feat-search-container')[0] as HTMLElement;\n      if (featSearchContainer && !featSearchContainer.contains(target)) {\n        html.find('.feat-search-results').hide();\n      }\n    });\n\n    // Make feat items draggable\n    html.find('.feat-item').each((_index, item) => {\n      item.setAttribute('draggable', 'true');\n      item.addEventListener('dragstart', this._onDragStart.bind(this));\n    });\n\n    // Make skill items draggable\n    html.find('.skill-item').each((_index, item) => {\n      item.setAttribute('draggable', 'true');\n      item.addEventListener('dragstart', this._onDragStart.bind(this));\n    });\n\n    // Make specialization items draggable\n    html.find('.specialization-item').each((_index, item) => {\n      item.setAttribute('draggable', 'true');\n      item.addEventListener('dragstart', this._onDragStart.bind(this));\n    });\n  }\n\n  /**\n   * Handle form submission to update actor data\n   */\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = SheetHelpers.handleSheetUpdate(this.actor, formData);\n    return this.actor.update(expandedData);\n  }\n\n  /**\n   * Handle section navigation\n   */\n  private _onSectionNavigation(event: Event): void {\n    event.preventDefault();\n    const button = event.currentTarget as HTMLElement;\n    const section = button.dataset.section;\n    \n    if (!section) return;\n    \n    // Update active section\n    this._activeSection = section;\n    \n    // Update UI\n    const form = $(this.form);\n    form.find('.section-nav .nav-item').removeClass('active');\n    button.classList.add('active');\n    \n    form.find('.content-section').removeClass('active');\n    form.find(`[data-section-content=\"${section}\"]`).addClass('active');\n  }\n\n  // Generic item handlers using SheetHelpers\n  private async _onEditMetatype(event: Event): Promise<void> { return SheetHelpers.handleEditItem(event, this.actor); }\n  private async _onDeleteMetatype(event: Event): Promise<void> { return SheetHelpers.handleDeleteItem(event, this.actor, this.render.bind(this)); }\n  private async _onEditFeat(event: Event): Promise<void> { return SheetHelpers.handleEditItem(event, this.actor); }\n  private async _onDeleteFeat(event: Event): Promise<void> { return SheetHelpers.handleDeleteItem(event, this.actor); }\n  private async _onEditSkill(event: Event): Promise<void> { return SheetHelpers.handleEditItem(event, this.actor); }\n  private async _onDeleteSkill(event: Event): Promise<void> { return SheetHelpers.handleDeleteItem(event, this.actor); }\n  private async _onEditSpecialization(event: Event): Promise<void> { return SheetHelpers.handleEditItem(event, this.actor); }\n  private async _onDeleteSpecialization(event: Event): Promise<void> { return SheetHelpers.handleDeleteItem(event, this.actor); }\n\n  /**\n   * Get detailed RR sources for a given skill, specialization, or attribute\n   */\n  private getRRSources(itemType: 'skill' | 'specialization' | 'attribute', itemName: string): Array<{featName: string, rrValue: number}> {\n    return SheetHelpers.getRRSources(this.actor, itemType, itemName);\n  }\n\n  /**\n   * Calculate Risk Reduction (RR) from active feats for a given skill, specialization, or attribute\n   */\n  private calculateRR(itemType: 'skill' | 'specialization' | 'attribute', itemName: string): number {\n    return SheetHelpers.calculateRR(this.actor, itemType, itemName);\n  }\n\n  /**\n   * Handle rating changes for items\n   */\n  private async _onRatingChange(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLInputElement;\n    const itemId = element.dataset.itemId;\n    const newRating = parseInt(element.value);\n    \n    if (!itemId || isNaN(newRating)) return;\n\n    const item = this.actor.items.get(itemId);\n    if (item) {\n      await item.update({ system: { rating: newRating } } as any);\n    }\n  }\n\n  /**\n   * Handle rolling a specialization\n   */\n  private async _onRollSpecialization(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    const effectiveRating = parseInt(element.dataset.effectiveRating || '0');\n    \n    if (!itemId) return;\n\n    const specialization = this.actor.items.get(itemId);\n    if (!specialization || specialization.type !== 'specialization') return;\n\n    const specSystem = specialization.system as any;\n    const linkedAttribute = specSystem.linkedAttribute || 'strength';\n    const linkedSkillName = specSystem.linkedSkill;\n    const attributeValue = (this.actor.system as any).attributes?.[linkedAttribute] || 0;\n    \n    // Get the linked skill to get its rating\n    const linkedSkill = linkedSkillName ? this.actor.items.find((i: any) => i.type === 'skill' && i.name === linkedSkillName) : null;\n    const skillRating = linkedSkill ? (linkedSkill.system as any).rating || 0 : 0;\n    \n    // Get RR sources\n    const specRRSources = this.getRRSources('specialization', specialization.name);\n    const attributeRRSources = this.getRRSources('attribute', linkedAttribute);\n    const skillRRSources = linkedSkillName ? this.getRRSources('skill', linkedSkillName) : [];\n    const allRRSources = [...specRRSources, ...skillRRSources, ...attributeRRSources];\n\n    DiceRoller.handleRollRequest({\n      itemType: 'specialization',\n      itemName: specialization.name,\n      itemId: specialization.id,\n      specName: specialization.name,\n      specLevel: attributeValue + effectiveRating,  // Total dice pool (attribute + effectiveRating)\n      skillName: linkedSkillName,\n      skillLevel: skillRating,  // Just the skill rating (without attribute)\n      linkedAttribute: linkedAttribute,\n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      rrList: allRRSources\n    });\n  }\n\n  /**\n   * Handle quick rolling a skill (from dice badge click) - opens dialog\n   */\n  private async _onQuickRollSkill(event: Event): Promise<void> {\n    // Simply call the regular roll skill function which opens the dialog\n    return this._onRollSkill(event);\n  }\n\n  /**\n   * Handle quick rolling a specialization (from dice badge click) - opens dialog\n   */\n  private async _onQuickRollSpecialization(event: Event): Promise<void> {\n    // Simply call the regular roll specialization function which opens the dialog\n    return this._onRollSpecialization(event);\n  }\n\n\n  /**\n   * Handle rolling an attribute\n   */\n  private async _onRollAttribute(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const attributeName = element.dataset.attribute;\n    \n    if (!attributeName) return;\n\n    const attributeValue = (this.actor.system as any).attributes?.[attributeName] || 0;\n    const attributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${attributeName.toUpperCase()}`);\n\n    // Get RR sources for this attribute\n    const rrSources = this.getRRSources('attribute', attributeName);\n\n    DiceRoller.handleRollRequest({\n      itemType: 'attribute',\n      itemName: attributeLabel,\n      skillName: attributeLabel,\n      skillLevel: attributeValue,\n      linkedAttribute: attributeName,\n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      rrList: rrSources\n    });\n  }\n\n  /**\n   * Handle rolling a skill\n   */\n  private async _onRollSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) return;\n\n    const skill = this.actor.items.get(itemId);\n    if (!skill || skill.type !== 'skill') return;\n\n    const skillSystem = skill.system as any;\n    const rating = skillSystem.rating || 0;\n    const linkedAttribute = skillSystem.linkedAttribute || 'strength';\n    const attributeValue = (this.actor.system as any).attributes?.[linkedAttribute] || 0;\n\n    // Get RR sources for skill and attribute\n    const skillRRSources = this.getRRSources('skill', skill.name);\n    const attributeRRSources = this.getRRSources('attribute', linkedAttribute);\n    const allRRSources = [...skillRRSources, ...attributeRRSources];\n\n    DiceRoller.handleRollRequest({\n      itemType: 'skill',\n      itemName: skill.name,\n      itemId: skill.id,\n      itemRating: rating,\n      skillName: skill.name,\n      skillLevel: attributeValue + rating,  // Total dice pool (attribute + rating)\n      linkedAttribute: linkedAttribute,\n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      rrList: allRRSources\n    });\n  }\n\n\n  /**\n   * REMOVED: Dice rolling logic\n   */\n  private async _rollSkillDice(skillName: string, dicePool: number, riskDice: number = 0, riskReduction: number = 0, rollMode: string = 'normal', weaponDamageValue?: string, damageValueBonus?: number): Promise<void> {\n    // All dice rolling and chat logic removed\n    console.log('Dice rolling disabled', { skillName, dicePool, riskDice, riskReduction, rollMode });\n  }\n\n  /**\n   * REMOVED: Attack with defense system logic\n   */\n  private async _rollAttackWithDefense(skillName: string, dicePool: number, riskDice: number = 0, riskReduction: number = 0, rollMode: string = 'normal', weaponDamageValue?: string, attackingWeapon?: any, damageValueBonus?: number): Promise<void> {\n    // All attack and defense rolling logic removed\n    console.log('Attack rolling disabled', { skillName, dicePool, riskDice, riskReduction, rollMode });\n  }\n\n  /**\n   * REMOVED: Defense roll prompt logic\n   */\n  private async _promptDefenseRoll(defenderActor: any, attackResult: any, attackName: string, weaponDamageValue: string, attackingWeapon?: any, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    // Defense dialog logic removed\n    console.log('Defense roll prompt disabled', { defenderActor: defenderActor.name, attackName });\n  }\n\n  /**\n   * REMOVED: Defense roll and damage calculation\n   */\n  private async _rollDefenseAndCalculateDamage(defenseItem: any, itemType: 'skill' | 'spec', attackName: string, attackResult: any, weaponDamageValue: string, defenderActor: any, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    // Defense rolling logic removed\n    console.log('Defense roll disabled', { defenseItem: defenseItem.name, itemType, attackName });\n  }\n\n\n  /**\n   * REMOVED: Threshold defense logic\n   */\n  private async _defendWithThreshold(defenseItem: any, _itemType: 'skill' | 'spec', threshold: number, attackName: string, attackResult: any, weaponDamageValue: string, defenderActor: any, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    // Threshold defense logic removed\n    console.log('Threshold defense disabled', { defenseItem: defenseItem.name, threshold, attackName });\n  }\n\n  /**\n   * REMOVED: Dice roll execution\n   */\n  private async _performDiceRoll(dicePool: number, riskDice: number, riskReduction: number, rollMode: string): Promise<any> {\n    // Dice roll execution removed\n    console.log('Dice roll disabled', { dicePool, riskDice, riskReduction, rollMode });\n    return {};\n  }\n\n  /**\n   * REMOVED: Attack result display\n   */\n  private async _displayAttackResult(attackName: string, attackResult: any, defenseResult: any | null, weaponDamageValue: string, defenderName?: string, defenderActor?: any, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    // Attack result display removed\n    console.log('Attack result display disabled', { attackName, defenderName });\n  }\n\n  /**\n   * Apply damage to a defender\n   */\n  static async applyDamage(defenderUuid: string, damageValue: number, defenderName: string): Promise<void> {\n    // Use fromUuid to get the token's actor if it's a token UUID, or the actor if it's an actor UUID\n    const defender = await fromUuid(defenderUuid) as any;\n    \n    if (!defender) {\n      ui.notifications?.error(`Cannot find defender: ${defenderName}`);\n      return;\n    }\n    \n    // If this is a token, get its actor\n    const defenderActor = defender.actor || defender;\n    \n    const defenderSystem = defenderActor.system as any;\n    const damageThresholds = defenderSystem.damageThresholds?.withArmor || {\n      light: 1,\n      moderate: 4,\n      severe: 7\n    };\n    \n    // Deep copy of damage object with arrays\n    let damage = {\n      light: [...(defenderSystem.damage?.light || [])],\n      severe: [...(defenderSystem.damage?.severe || [])],\n      incapacitating: defenderSystem.damage?.incapacitating || false\n    };\n    let damageType = '';\n    let overflow = false;\n    \n    // Determine damage type based on thresholds\n    if (damageValue >= damageThresholds.severe) {\n      // Incapacitating wound\n      damageType = game.i18n!.localize('SRA2.COMBAT.DAMAGE_INCAPACITATING');\n      damage.incapacitating = true;\n    } else if (damageValue >= damageThresholds.moderate) {\n      // Severe wound\n      damageType = game.i18n!.localize('SRA2.COMBAT.DAMAGE_SEVERE');\n      \n      // Find first empty severe box\n      let applied = false;\n      for (let i = 0; i < damage.severe.length; i++) {\n        if (!damage.severe[i]) {\n          damage.severe[i] = true;\n          applied = true;\n          break;\n        }\n      }\n      \n      // If no space in severe, overflow to incapacitating\n      if (!applied) {\n        ui.notifications?.info(game.i18n!.localize('SRA2.COMBAT.DAMAGE_OVERFLOW_SEVERE'));\n        damage.incapacitating = true;\n        overflow = true;\n      }\n    } else if (damageValue >= damageThresholds.light) {\n      // Light wound\n      damageType = game.i18n!.localize('SRA2.COMBAT.DAMAGE_LIGHT');\n      \n      // Find first empty light box\n      let applied = false;\n      for (let i = 0; i < damage.light.length; i++) {\n        if (!damage.light[i]) {\n          damage.light[i] = true;\n          applied = true;\n          break;\n        }\n      }\n      \n      // If no space in light, overflow to severe\n      if (!applied) {\n        ui.notifications?.info(game.i18n!.localize('SRA2.COMBAT.DAMAGE_OVERFLOW_LIGHT'));\n        \n        // Try to apply to severe\n        let severeApplied = false;\n        for (let i = 0; i < damage.severe.length; i++) {\n          if (!damage.severe[i]) {\n            damage.severe[i] = true;\n            severeApplied = true;\n            break;\n          }\n        }\n        \n        // If no space in severe either, overflow to incapacitating\n        if (!severeApplied) {\n          ui.notifications?.info(game.i18n!.localize('SRA2.COMBAT.DAMAGE_OVERFLOW_SEVERE'));\n          damage.incapacitating = true;\n        }\n        overflow = true;\n      }\n    } else {\n      // Damage below light threshold, no wound\n      ui.notifications?.info(game.i18n!.format('SRA2.COMBAT.DAMAGE_APPLIED', { \n        damage: `${damageValue} (en dessous du seuil)`,\n        target: defenderName \n      }));\n      return;\n    }\n    \n    // Update the actor's damage (use defenderActor to update the token's actor data)\n    await defenderActor.update({ 'system.damage': damage });\n    \n    // Check if now incapacitated\n    if (damage.incapacitating === true) {\n      ui.notifications?.error(game.i18n!.format('SRA2.COMBAT.NOW_INCAPACITATED', { target: defenderName }));\n    } else {\n      ui.notifications?.info(game.i18n!.format('SRA2.COMBAT.DAMAGE_APPLIED', { \n        damage: overflow ? `${damageType} (débordement)` : damageType,\n        target: defenderName \n      }));\n    }\n  }\n\n\n  /**\n   * REMOVED: Simple roll result display\n   */\n  private async _displayRollResult(skillName: string, rollResult: any, weaponDamageValue?: string, damageValueBonus?: number): Promise<void> {\n    // Roll result display removed\n    console.log('Roll result display disabled', { skillName });\n  }\n\n\n  /**\n   * Handle drag start for feat items\n   */\n  protected override _onDragStart(event: DragEvent): void {\n    const itemId = (event.currentTarget as HTMLElement).dataset.itemId;\n    if (!itemId) return;\n\n    const item = this.actor.items.get(itemId);\n    if (!item) return;\n\n    const dragData = {\n      type: 'Item',\n      uuid: item.uuid,\n    };\n\n    event.dataTransfer?.setData('text/plain', JSON.stringify(dragData));\n  }\n\n  /**\n   * Override to handle dropping feats and skills anywhere on the sheet\n   */\n  protected override async _onDrop(event: DragEvent): Promise<any> {\n    const handled = await SheetHelpers.handleItemDrop(event, this.actor);\n    return handled ? undefined : super._onDrop(event);\n  }\n\n  /**\n   * Handle skill search input\n   */\n  private searchTimeout: any = null;\n  \n  private async _onSkillSearch(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const searchTerm = ItemSearch.normalizeSearchText(input.value.trim());\n    const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n    \n    // Clear previous timeout\n    if (this.searchTimeout) {\n      clearTimeout(this.searchTimeout);\n    }\n    \n    // If search term is empty, hide results\n    if (searchTerm.length === 0) {\n      resultsDiv.style.display = 'none';\n      return;\n    }\n    \n    // Debounce search\n    this.searchTimeout = setTimeout(async () => {\n      await this._performSkillSearch(searchTerm, resultsDiv);\n    }, 300);\n  }\n\n  /**\n   * Perform the actual skill search in compendiums and world items\n   */\n  private async _performSkillSearch(searchTerm: string, resultsDiv: HTMLElement): Promise<void> {\n    // Store search term for potential creation\n    this.lastSearchTerm = searchTerm;\n    \n    // Use the helper function to search everywhere\n    const existingItemsCheck = (itemName: string) => \n      ItemSearch.itemExistsOnActor(this.actor, 'skill', itemName);\n    \n    const results = await ItemSearch.searchItemsEverywhere(\n      'skill',\n      searchTerm,\n      undefined,\n      existingItemsCheck\n    );\n    \n    // Display results\n    this._displaySkillSearchResults(results, resultsDiv);\n  }\n\n  /**\n   * Display skill search results\n   */\n  private lastSearchTerm: string = '';\n  \n  private _displaySkillSearchResults(results: any[], resultsDiv: HTMLElement): void {\n    // Check if exact match exists on the actor\n    const formattedSearchTerm = this.lastSearchTerm\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    const exactMatchOnActor = this.actor.items.find((i: any) => \n      i.type === 'skill' && ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(this.lastSearchTerm)\n    );\n    \n    let html = '';\n    \n    // If no results at all, show only the create button with message\n    if (results.length === 0) {\n      html = `\n        <div class=\"search-result-item no-results-create\">\n          <div class=\"no-results-text\">\n            ${game.i18n!.localize('SRA2.SKILLS.SEARCH_NO_RESULTS')}\n          </div>\n          <button class=\"create-skill-btn\" data-skill-name=\"${this.lastSearchTerm}\">\n            <i class=\"fas fa-plus\"></i> ${game.i18n!.localize('SRA2.SKILLS.CREATE_SKILL')}\n          </button>\n        </div>\n      `;\n    } else {\n      // Display search results\n      for (const result of results) {\n        const disabledClass = result.alreadyExists ? 'disabled' : '';\n        const buttonText = result.alreadyExists ? '✓' : game.i18n!.localize('SRA2.SKILLS.ADD_SKILL');\n        \n        html += `\n          <div class=\"search-result-item ${disabledClass}\">\n            <div class=\"result-info\">\n              <span class=\"result-name\">${result.name}</span>\n              <span class=\"result-pack\">${result.source}</span>\n            </div>\n            <button class=\"add-skill-btn\" data-uuid=\"${result.uuid}\" ${result.alreadyExists ? 'disabled' : ''}>\n              ${buttonText}\n            </button>\n          </div>\n        `;\n      }\n      \n      // Add create button if exact match doesn't exist on actor\n      if (!exactMatchOnActor) {\n        html += `\n          <div class=\"search-result-item create-new-item\">\n            <div class=\"result-info\">\n              <span class=\"result-name\"><i class=\"fas fa-plus-circle\"></i> ${formattedSearchTerm}</span>\n              <span class=\"result-pack\">${game.i18n!.localize('SRA2.SKILLS.CREATE_NEW')}</span>\n            </div>\n            <button class=\"create-skill-btn-inline\" data-skill-name=\"${this.lastSearchTerm}\">\n              ${game.i18n!.localize('SRA2.SKILLS.CREATE')}\n            </button>\n          </div>\n        `;\n      }\n    }\n    \n    resultsDiv.innerHTML = html;\n    resultsDiv.style.display = 'block';\n    \n    // Attach click handlers to buttons\n    $(resultsDiv).find('.add-skill-btn').on('click', this._onAddSkillFromSearch.bind(this));\n    $(resultsDiv).find('.create-skill-btn, .create-skill-btn-inline').on('click', this._onCreateNewSkill.bind(this));\n    \n    // Make entire result items clickable (except disabled ones and create button)\n    $(resultsDiv).find('.search-result-item:not(.disabled):not(.no-results-create):not(.create-new-item)').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.add-skill-btn').length > 0) return;\n      \n      // Find the button in this item and trigger its click\n      const button = $(event.currentTarget).find('.add-skill-btn')[0] as HTMLButtonElement;\n      if (button && !button.disabled) {\n        $(button).trigger('click');\n      }\n    });\n    \n    // Make create items clickable on the entire row\n    $(resultsDiv).find('.search-result-item.create-new-item').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.create-skill-btn-inline').length > 0) return;\n      \n      // Find the button and trigger its click\n      const button = $(event.currentTarget).find('.create-skill-btn-inline')[0];\n      if (button) {\n        $(button).trigger('click');\n      }\n    });\n  }\n\n  /**\n   * Handle adding a skill from search results\n   */\n  private async _onAddSkillFromSearch(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const uuid = button.dataset.uuid;\n    \n    if (!uuid) return;\n    \n    // Get the skill from the compendium\n    const skill = await fromUuid(uuid as any) as any;\n    \n    if (!skill) {\n      ui.notifications?.error('Skill not found');\n      return;\n    }\n    \n    // Check if skill already exists\n    const existingSkill = this.actor.items.find((i: any) => \n      i.type === 'skill' && i.name === skill.name\n    );\n    \n    if (existingSkill) {\n      ui.notifications?.warn(game.i18n!.format('SRA2.SKILLS.ALREADY_EXISTS', { name: skill.name }));\n      return;\n    }\n    \n    // Add the skill to the actor\n    await this.actor.createEmbeddedDocuments('Item', [skill.toObject()]);\n    \n    // Mark button as added\n    button.textContent = '✓';\n    button.disabled = true;\n    button.closest('.search-result-item')?.classList.add('disabled');\n    \n    ui.notifications?.info(`${skill.name} ${game.i18n!.localize('SRA2.SKILLS.ADD_SKILL')}`);\n  }\n\n  /**\n   * Handle skill search focus\n   */\n  private _onSkillSearchFocus(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    \n    // If there's already content and results, show them\n    if (input.value.trim().length > 0) {\n      const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv && resultsDiv.innerHTML.trim().length > 0) {\n        resultsDiv.style.display = 'block';\n      }\n    }\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle skill search blur\n   */\n  private _onSkillSearchBlur(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const blurEvent = event as FocusEvent;\n    \n    // Check if the new focus target is within the results div\n    setTimeout(() => {\n      const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        // Check if the related target (where focus is going) is inside the results div\n        const relatedTarget = blurEvent.relatedTarget as HTMLElement;\n        if (relatedTarget && resultsDiv.contains(relatedTarget)) {\n          // Don't hide if focus is moving to an element within the results\n          return;\n        }\n        \n        // Also check if any element in the results is focused\n        const activeElement = document.activeElement as HTMLElement;\n        if (activeElement && resultsDiv.contains(activeElement)) {\n          // Don't hide if an element in results is active\n          return;\n        }\n        \n        resultsDiv.style.display = 'none';\n      }\n    }, 200);\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle creating a new skill from search\n   */\n  private async _onCreateNewSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const skillName = button.dataset.skillName;\n    \n    if (!skillName) return;\n    \n    // Capitalize first letter of each word\n    const formattedName = skillName\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    // Create the new skill with default values\n    const skillData = {\n      name: formattedName,\n      type: 'skill',\n      system: {\n        rating: 1,\n        linkedAttribute: 'strength',\n        description: ''\n      }\n    } as any;\n    \n    // Add the skill to the actor\n    const createdItems = await this.actor.createEmbeddedDocuments('Item', [skillData]) as any;\n    \n    if (createdItems && createdItems.length > 0) {\n      const newSkill = createdItems[0] as any;\n      \n      // Clear the search input and hide results\n      const searchInput = this.element.find('.skill-search-input')[0] as HTMLInputElement;\n      if (searchInput) {\n        searchInput.value = '';\n      }\n      \n      const resultsDiv = this.element.find('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        resultsDiv.style.display = 'none';\n      }\n      \n      // Open the skill sheet for editing\n      if (newSkill && newSkill.sheet) {\n        setTimeout(() => {\n          newSkill.sheet.render(true);\n        }, 100);\n      }\n      \n      ui.notifications?.info(game.i18n!.format('SRA2.SKILLS.SKILL_CREATED', { name: formattedName }));\n    }\n  }\n\n  /**\n   * FEAT SEARCH FUNCTIONS\n   */\n  \n  private featSearchTimeout: any = null;\n  private lastFeatSearchTerm: string = '';\n  \n  /**\n   * Handle feat search input\n   */\n  private async _onFeatSearch(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const searchTerm = ItemSearch.normalizeSearchText(input.value.trim());\n    const resultsDiv = $(input).siblings('.feat-search-results')[0] as HTMLElement;\n    \n    // Clear previous timeout\n    if (this.featSearchTimeout) {\n      clearTimeout(this.featSearchTimeout);\n    }\n    \n    // If search term is empty, hide results\n    if (searchTerm.length === 0) {\n      resultsDiv.style.display = 'none';\n      return;\n    }\n    \n    // Debounce search\n    this.featSearchTimeout = setTimeout(async () => {\n      await this._performFeatSearch(searchTerm, resultsDiv);\n    }, 300);\n  }\n\n  /**\n   * Perform the actual feat search in compendiums and world items\n   */\n  private async _performFeatSearch(searchTerm: string, resultsDiv: HTMLElement): Promise<void> {\n    const results: any[] = [];\n    \n    // Store search term for potential creation\n    this.lastFeatSearchTerm = searchTerm;\n    \n    // Search in world items first\n    if (game.items) {\n      for (const item of game.items as any) {\n        if (item.type === 'feat' && ItemSearch.normalizeSearchText(item.name).includes(searchTerm)) {\n          // Check if feat already exists on actor\n          const existingFeat = this.actor.items.find((i: any) => \n            i.type === 'feat' && i.name === item.name\n          );\n          \n          results.push({\n            name: item.name,\n            uuid: item.uuid,\n            pack: game.i18n!.localize('SRA2.FEATS.WORLD_ITEMS'),\n            featType: item.system.featType,\n            exists: !!existingFeat\n          });\n        }\n      }\n    }\n    \n    // Search in all compendiums\n    for (const pack of game.packs as any) {\n      // Only search in Item compendiums\n      if (pack.documentName !== 'Item') continue;\n      \n      // Get all documents from the pack\n      const documents = await pack.getDocuments();\n      \n      // Filter for feats that match the search term\n      for (const doc of documents) {\n        if (doc.type === 'feat' && ItemSearch.normalizeSearchText(doc.name).includes(searchTerm)) {\n          // Check if feat already exists on actor\n          const existingFeat = this.actor.items.find((i: any) => \n            i.type === 'feat' && i.name === doc.name\n          );\n          \n          results.push({\n            name: doc.name,\n            uuid: doc.uuid,\n            pack: pack.title,\n            featType: doc.system.featType,\n            exists: !!existingFeat\n          });\n        }\n      }\n    }\n    \n    // Display results\n    this._displayFeatSearchResults(results, resultsDiv);\n  }\n\n  /**\n   * Display feat search results\n   */\n  private _displayFeatSearchResults(results: any[], resultsDiv: HTMLElement): Promise<void> {\n    // Check if exact match exists on the actor\n    const formattedSearchTerm = this.lastFeatSearchTerm\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    const exactMatchOnActor = this.actor.items.find((i: any) => \n      i.type === 'feat' && ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(this.lastFeatSearchTerm)\n    );\n    \n    let html = '';\n    \n    // If no results at all, show only the create button with message and type selector\n    if (results.length === 0) {\n      html = `\n        <div class=\"search-result-item no-results-create\">\n          <div class=\"no-results-text\">\n            ${game.i18n!.localize('SRA2.FEATS.SEARCH_NO_RESULTS')}\n          </div>\n          <select class=\"feat-type-selector\">\n            <option value=\"equipment\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.EQUIPMENT')}</option>\n            <option value=\"trait\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.TRAIT')}</option>\n            <option value=\"contact\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CONTACT')}</option>\n            <option value=\"awakened\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.AWAKENED')}</option>\n            <option value=\"adept-power\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.ADEPT_POWER')}</option>\n            <option value=\"cyberware\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CYBERWARE')}</option>\n            <option value=\"cyberdeck\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CYBERDECK')}</option>\n            <option value=\"vehicle\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.VEHICLE')}</option>\n            <option value=\"weapons-spells\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.WEAPONS_SPELLS')}</option>\n            <option value=\"weapon\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.WEAPON')}</option>\n            <option value=\"spell\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.SPELL')}</option>\n          </select>\n          <button class=\"create-feat-btn\" data-feat-name=\"${this.lastFeatSearchTerm}\">\n            <i class=\"fas fa-plus\"></i> ${game.i18n!.localize('SRA2.FEATS.CREATE')}\n          </button>\n        </div>\n      `;\n    } else {\n      // Display search results\n      for (const result of results) {\n        const disabledClass = result.exists ? 'disabled' : '';\n        const buttonText = result.exists ? '✓' : game.i18n!.localize('SRA2.FEATS.ADD_FEAT');\n        const featTypeLabel = game.i18n!.localize(`SRA2.FEATS.FEAT_TYPE.${result.featType.toUpperCase().replace('-', '_')}`);\n        \n        html += `\n          <div class=\"search-result-item ${disabledClass}\">\n            <div class=\"result-info\">\n              <span class=\"result-name\">${result.name}</span>\n              <span class=\"result-pack\">${result.pack} - ${featTypeLabel}</span>\n            </div>\n            <button class=\"add-feat-btn\" data-uuid=\"${result.uuid}\" ${result.exists ? 'disabled' : ''}>\n              ${buttonText}\n            </button>\n          </div>\n        `;\n      }\n      \n      // Add create button if exact match doesn't exist on actor\n      if (!exactMatchOnActor) {\n        html += `\n          <div class=\"search-result-item create-new-item\">\n            <div class=\"result-info\">\n              <span class=\"result-name\"><i class=\"fas fa-plus-circle\"></i> ${formattedSearchTerm}</span>\n              <span class=\"result-pack\">${game.i18n!.localize('SRA2.FEATS.CREATE_NEW')}</span>\n            </div>\n            <select class=\"feat-type-selector-inline\">\n              <option value=\"equipment\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.EQUIPMENT')}</option>\n              <option value=\"trait\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.TRAIT')}</option>\n              <option value=\"contact\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CONTACT')}</option>\n              <option value=\"awakened\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.AWAKENED')}</option>\n              <option value=\"adept-power\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.ADEPT_POWER')}</option>\n              <option value=\"cyberware\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CYBERWARE')}</option>\n              <option value=\"cyberdeck\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.CYBERDECK')}</option>\n              <option value=\"vehicle\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.VEHICLE')}</option>\n              <option value=\"weapons-spells\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.WEAPONS_SPELLS')}</option>\n              <option value=\"weapon\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.WEAPON')}</option>\n              <option value=\"spell\">${game.i18n!.localize('SRA2.FEATS.FEAT_TYPE.SPELL')}</option>\n            </select>\n            <button class=\"create-feat-btn-inline\" data-feat-name=\"${this.lastFeatSearchTerm}\">\n              ${game.i18n!.localize('SRA2.FEATS.CREATE')}\n            </button>\n          </div>\n        `;\n      }\n    }\n    \n    resultsDiv.innerHTML = html;\n    resultsDiv.style.display = 'block';\n    \n    // Attach click handlers\n    $(resultsDiv).find('.add-feat-btn').on('click', this._onAddFeatFromSearch.bind(this));\n    $(resultsDiv).find('.create-feat-btn, .create-feat-btn-inline').on('click', this._onCreateNewFeat.bind(this));\n    \n    // Make entire result items clickable (except disabled ones and create button)\n    $(resultsDiv).find('.search-result-item:not(.disabled):not(.no-results-create):not(.create-new-item)').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.add-feat-btn').length > 0) return;\n      \n      // Find the button in this item and trigger its click\n      const button = $(event.currentTarget).find('.add-feat-btn')[0] as HTMLButtonElement;\n      if (button && !button.disabled) {\n        $(button).trigger('click');\n      }\n    });\n    \n    // Make create items clickable on the entire row\n    $(resultsDiv).find('.search-result-item.create-new-item').on('click', (event) => {\n      // Don't trigger if clicking directly on the button or select\n      if ($(event.target).closest('.create-feat-btn-inline, .feat-type-selector-inline').length > 0) return;\n      \n      // Find the button and trigger its click\n      const button = $(event.currentTarget).find('.create-feat-btn-inline')[0];\n      if (button) {\n        $(button).trigger('click');\n      }\n    });\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle adding a feat from search results\n   */\n  private async _onAddFeatFromSearch(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const uuid = button.dataset.uuid;\n    \n    if (!uuid) return;\n    \n    // Get the feat from the compendium\n    const feat = await fromUuid(uuid as any) as any;\n    \n    if (!feat) {\n      ui.notifications?.error('Feat not found');\n      return;\n    }\n    \n    // Check if feat already exists\n    const existingFeat = this.actor.items.find((i: any) => \n      i.type === 'feat' && i.name === feat.name\n    );\n    \n    if (existingFeat) {\n      ui.notifications?.warn(game.i18n!.format('SRA2.FEATS.ALREADY_EXISTS', { name: feat.name }));\n      return;\n    }\n    \n    // Add the feat to the actor\n    await this.actor.createEmbeddedDocuments('Item', [feat.toObject()]);\n    \n    // Mark button as added\n    button.textContent = '✓';\n    button.disabled = true;\n    button.closest('.search-result-item')?.classList.add('disabled');\n    \n    ui.notifications?.info(`${feat.name} ${game.i18n!.localize('SRA2.FEATS.ADD_FEAT')}`);\n  }\n\n  /**\n   * Handle feat search focus\n   */\n  private _onFeatSearchFocus(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    \n    // If there's already content and results, show them\n    if (input.value.trim().length > 0) {\n      const resultsDiv = $(input).siblings('.feat-search-results')[0] as HTMLElement;\n      if (resultsDiv && resultsDiv.innerHTML.trim().length > 0) {\n        resultsDiv.style.display = 'block';\n      }\n    }\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle feat search blur\n   */\n  private _onFeatSearchBlur(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const blurEvent = event as FocusEvent;\n    \n    // Check if the new focus target is within the results div\n    setTimeout(() => {\n      const resultsDiv = $(input).siblings('.feat-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        // Check if the related target (where focus is going) is inside the results div\n        const relatedTarget = blurEvent.relatedTarget as HTMLElement;\n        if (relatedTarget && resultsDiv.contains(relatedTarget)) {\n          // Don't hide if focus is moving to an element within the results\n          return;\n        }\n        \n        // Also check if any select element in the results is focused\n        const activeElement = document.activeElement as HTMLElement;\n        if (activeElement && resultsDiv.contains(activeElement)) {\n          // Don't hide if a select or other element in results is active\n          return;\n        }\n        \n        resultsDiv.style.display = 'none';\n      }\n    }, 200);\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle sending a catchphrase to chat\n   */\n  private async _onSendCatchphrase(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const catchphrase = element.dataset.catchphrase;\n    \n    if (!catchphrase) return;\n\n    // Create the chat message\n    const messageData = {\n      speaker: ChatMessage.getSpeaker({ actor: this.actor }),\n      content: `<div class=\"sra2-catchphrase\">${catchphrase}</div>`\n    };\n    \n    await ChatMessage.create(messageData as any);\n  }\n\n  /**\n   * Handle rolling a weapon\n   */\n  private async _onRollWeapon(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) {\n      console.error(\"SRA2 | No weapon ID found\");\n      return;\n    }\n\n    const weapon = this.actor.items.get(itemId);\n    if (!weapon || weapon.type !== 'feat') return;\n\n    await this._rollWeaponOrSpell(weapon, 'weapon');\n  }\n\n  /**\n   * Handle rolling a spell\n   */\n  private async _onRollSpell(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) {\n      console.error(\"SRA2 | No spell ID found\");\n      return;\n    }\n\n    const spell = this.actor.items.get(itemId);\n    if (!spell || spell.type !== 'feat') return;\n\n    await this._rollWeaponOrSpell(spell, 'spell');\n  }\n\n  /**\n   * Handle rolling a weapon/spell (old type)\n   */\n  private async _onRollWeaponSpell(event: Event): Promise<void> {\n    event.preventDefault();\n    const element = event.currentTarget as HTMLElement;\n    const itemId = element.dataset.itemId;\n    \n    if (!itemId) {\n      console.error(\"SRA2 | No weapon/spell ID found\");\n      return;\n    }\n\n    const item = this.actor.items.get(itemId);\n    if (!item || item.type !== 'feat') return;\n\n    await this._rollWeaponOrSpell(item, 'weapon-spell');\n  }\n\n\n  /**\n   * Handle rolling a weapon or spell\n   */\n  private async _rollWeaponOrSpell(item: any, type: 'weapon' | 'spell' | 'weapon-spell'): Promise<void> {\n    const itemSystem = item.system as any;\n    \n    // Get weapon type and linked skills\n    const weaponType = itemSystem.weaponType;\n    let weaponLinkedSkill = '';\n    let weaponLinkedSpecialization = '';\n    let weaponLinkedDefenseSkill = '';\n    let weaponLinkedDefenseSpecialization = '';\n    \n    if (weaponType && weaponType !== 'custom-weapon') {\n      // Pre-defined weapon: get from WEAPON_TYPES\n      const weaponStats = WEAPON_TYPES[weaponType as keyof typeof WEAPON_TYPES];\n      if (weaponStats) {\n        weaponLinkedSkill = weaponStats.linkedSkill || '';\n        weaponLinkedSpecialization = weaponStats.linkedSpecialization || '';\n        weaponLinkedDefenseSkill = weaponStats.linkedDefenseSkill || '';\n        weaponLinkedDefenseSpecialization = weaponStats.linkedDefenseSpecialization || '';\n      }\n    }\n\n    // Get all RR sources for the item and enrich with featName\n    const rawItemRRList = itemSystem.rrList || [];\n    const itemRRList = rawItemRRList.map((rrEntry: any) => ({\n      ...rrEntry,\n      featName: item.name  // Add featName (the item name itself)\n    }));\n\n    // Merge weapon type links with custom fields (weapon type has priority)\n    const finalAttackSkill = weaponLinkedSkill || itemSystem.linkedAttackSkill || '';\n    const finalAttackSpec = weaponLinkedSpecialization || itemSystem.linkedAttackSpecialization || '';\n    const finalDefenseSkill = weaponLinkedDefenseSkill || itemSystem.linkedDefenseSkill || '';\n    const finalDefenseSpec = weaponLinkedDefenseSpecialization || itemSystem.linkedDefenseSpecialization || '';\n\n    // Find actor's skill and specialization based on weapon links\n    let attackSkillName: string | undefined = undefined;\n    let attackSkillLevel: number | undefined = undefined;\n    let attackSpecName: string | undefined = undefined;\n    let attackSpecLevel: number | undefined = undefined;\n    let attackLinkedAttribute: string | undefined = undefined;\n    \n    // Try to find the linked attack specialization first\n    if (finalAttackSpec) {\n      const foundSpec = this.actor.items.find((i: any) => \n        i.type === 'specialization' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSpec)\n      );\n      \n      if (foundSpec) {\n        const specSystem = foundSpec.system as any;\n        attackSpecName = foundSpec.name;\n        attackLinkedAttribute = specSystem.linkedAttribute || 'strength';\n        \n        // Get parent skill for specialization\n        const linkedSkillName = specSystem.linkedSkill;\n        if (linkedSkillName) {\n          const parentSkill = this.actor.items.find((i: any) => \n            i.type === 'skill' && i.name === linkedSkillName\n          );\n          if (parentSkill) {\n            attackSkillName = parentSkill.name;\n            attackSkillLevel = ((parentSkill.system as any).rating + (this.actor.system as any).attributes?.[attackLinkedAttribute]) || 0;\n            attackSpecLevel = attackSkillLevel + 2; // Specialization adds +2\n          }\n        }\n      }\n    }\n    \n    // If no specialization found, try to find the linked attack skill\n    if (!attackSpecName && finalAttackSkill) {\n      const foundSkill = this.actor.items.find((i: any) => \n        i.type === 'skill' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSkill)\n      );\n      \n      if (foundSkill) {\n        attackSkillName = foundSkill.name;\n        attackLinkedAttribute = (foundSkill.system as any).linkedAttribute || 'strength';\n        attackSkillLevel = (foundSkill.system as any).rating + (this.actor.system as any).attributes?.[attackLinkedAttribute] || 0;\n      }\n    }\n\n    // Calculate final damage value (base + bonus)\n    const baseDamageValue = itemSystem.damageValue || '0';\n    const damageValueBonus = itemSystem.damageValueBonus || 0;\n    \n    let finalDamageValue = baseDamageValue;\n    if (damageValueBonus > 0 && baseDamageValue !== '0') {\n      if (baseDamageValue === 'FOR') {\n        finalDamageValue = `FOR+${damageValueBonus}`;\n      } else if (baseDamageValue.startsWith('FOR+')) {\n        const baseModifier = parseInt(baseDamageValue.substring(4)) || 0;\n        finalDamageValue = `FOR+${baseModifier + damageValueBonus}`;\n      } else if (baseDamageValue !== 'toxin') {\n        const baseValue = parseInt(baseDamageValue) || 0;\n        finalDamageValue = (baseValue + damageValueBonus).toString();\n      }\n    }\n\n    DiceRoller.handleRollRequest({\n      itemType: type,\n      weaponType: weaponType,\n      itemName: item.name,\n      itemId: item.id,\n      itemRating: itemSystem.rating || 0,\n      itemActive: itemSystem.active,\n      \n      // Merged linked skills\n      linkedAttackSkill: finalAttackSkill,\n      linkedAttackSpecialization: finalAttackSpec,\n      linkedDefenseSkill: finalDefenseSkill,\n      linkedDefenseSpecialization: finalDefenseSpec,\n      linkedAttribute: attackLinkedAttribute,\n      \n      // Weapon properties\n      isWeaponFocus: itemSystem.isWeaponFocus || false,\n      damageValue: finalDamageValue,  // FINAL damage value (base + bonus)\n      damageValueBonus: damageValueBonus,\n      meleeRange: itemSystem.meleeRange,\n      shortRange: itemSystem.shortRange,\n      mediumRange: itemSystem.mediumRange,\n      longRange: itemSystem.longRange,\n      \n      // Attack skill/spec from actor (based on weapon links)\n      skillName: attackSkillName,\n      skillLevel: attackSkillLevel,\n      specName: attackSpecName,\n      specLevel: attackSpecLevel,\n      \n      // Actor information\n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      \n      // RR List\n      rrList: itemRRList\n    });\n  }\n\n  /**\n   * REMOVED: Skill with weapon roll - dialog creation disabled\n   */\n  private async _rollSkillWithWeapon(skill: any, weaponName: string, _skillType: 'skill', weaponDamageValue?: string, weapon?: any): Promise<void> {\n    console.log('Skill with weapon roll disabled', { skill: skill.name, weaponName });\n  }\n\n  /**\n   * REMOVED: Specialization with weapon roll - dialog creation disabled\n   */\n  private async _rollSpecializationWithWeapon(specialization: any, weaponName: string, effectiveRating: number, weaponDamageValue?: string, weapon?: any): Promise<void> {\n    console.log('Specialization with weapon roll disabled', { specialization: specialization.name, weaponName });\n  }\n\n\n  /**\n   * Handle creating a new feat from search\n   */\n  private async _onCreateNewFeat(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const featName = button.dataset.featName;\n    \n    if (!featName) return;\n    \n    // Get the feat type from the selector\n    const selector = $(button).siblings('.feat-type-selector, .feat-type-selector-inline')[0] as HTMLSelectElement;\n    const featType = selector ? selector.value : 'equipment';\n    \n    // Capitalize first letter of each word\n    const formattedName = featName\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    // Create the new feat with default values\n    const featData = {\n      name: formattedName,\n      type: 'feat',\n      system: {\n        description: '',\n        rating: 0,\n        cost: 'free-equipment',\n        active: true,\n        featType: featType,\n        rrType: [],\n        rrValue: [],\n        rrTarget: [],\n        bonusLightDamage: 0,\n        bonusSevereDamage: 0,\n        bonusPhysicalThreshold: 0,\n        bonusMentalThreshold: 0,\n        bonusAnarchy: 0,\n        essenceCost: 0\n      }\n    } as any;\n    \n    // Add the feat to the actor\n    const createdItems = await this.actor.createEmbeddedDocuments('Item', [featData]) as any;\n    \n    if (createdItems && createdItems.length > 0) {\n      const newFeat = createdItems[0] as any;\n      \n      // Clear the search input and hide results\n      const searchInput = this.element.find('.feat-search-input')[0] as HTMLInputElement;\n      if (searchInput) {\n        searchInput.value = '';\n      }\n      \n      const resultsDiv = this.element.find('.feat-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        resultsDiv.style.display = 'none';\n      }\n      \n      // Open the feat sheet for editing\n      if (newFeat && newFeat.sheet) {\n        setTimeout(() => {\n          newFeat.sheet.render(true);\n        }, 100);\n      }\n      \n      ui.notifications?.info(game.i18n!.format('SRA2.FEATS.FEAT_CREATED', { name: formattedName }));\n    }\n  }\n}\n\n","import * as DiceRoller from '../helpers/dice-roller.js';\nimport * as ItemSearch from '../helpers/item-search.js';\nimport * as DefenseSelection from '../helpers/defense-selection.js';\nimport * as SheetHelpers from '../helpers/sheet-helpers.js';\nimport { WEAPON_TYPES } from '../models/item-feat.js';\n\n/**\n * NPC Sheet Application\n * NPCs don't roll dice - they use predefined thresholds\n * Threshold = round(dice pool / 3) + RR level + 1\n */\nexport class NpcSheet extends ActorSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Actor> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'actor', 'npc'],\n      template: 'systems/sra2/templates/actor-npc-sheet.hbs',\n      width: 800,\n      height: 700,\n      tabs: [],\n      dragDrop: [\n        { dragSelector: '.skill-item', dropSelector: null },\n        { dragSelector: '.feat-item', dropSelector: null },\n        { dragSelector: '.specialization-item', dropSelector: null }\n      ],\n      submitOnChange: true,\n    });\n  }\n\n  /**\n   * Handle form submission to update actor data\n   */\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = SheetHelpers.handleSheetUpdate(this.actor, formData);\n    return this.actor.update(expandedData);\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n\n    // Ensure system data is available\n    context.system = this.actor.system;\n\n    // Get feats\n    const allFeats = this.actor.items.filter((item: any) => item.type === 'feat');\n    \n    // Get all active feats for RR calculation\n    const activeFeats = allFeats.filter((feat: any) => feat.system.active === true);\n    \n    // Get actor's strength for damage value calculations\n    const actorStrength = (this.actor.system as any).attributes?.strength || 0;\n    \n    // Get all specializations early (needed for weapon/spell calculations)\n    let allSpecializations = this.actor.items.filter((i: any) => i.type === 'specialization');\n    \n    // Helper function to calculate weapon/spell stats\n    const calculateWeaponSpellStats = (item: any) => {\n      const itemData = {\n        ...item,\n        _id: item.id || item._id,\n        id: item.id || item._id\n      };\n      \n      // Get linked skill name and specialization from WEAPON_TYPES or custom fields\n      let linkedSkillName = '';\n      let linkedSpecializationName = '';\n      const weaponType = item.system.weaponType;\n      \n      if (weaponType && weaponType !== 'custom-weapon') {\n        // Arme pré-définie : récupérer depuis WEAPON_TYPES\n        const weaponStats = WEAPON_TYPES[weaponType as keyof typeof WEAPON_TYPES];\n        if (weaponStats) {\n          linkedSkillName = weaponStats.linkedSkill || '';\n          linkedSpecializationName = weaponStats.linkedSpecialization || '';\n        }\n      } else if (weaponType === 'custom-weapon') {\n        // Arme custom : récupérer depuis les champs du système\n        linkedSkillName = item.system.linkedAttackSkill || '';\n        // Pour les armes custom, pas de spécialisation par défaut\n        linkedSpecializationName = '';\n      }\n      \n      // Try to find the linked skill\n      let totalDicePool = 0;\n      let totalRR = 0;\n      let linkedAttribute = '';\n      \n      if (linkedSkillName) {\n        const linkedSkill = this.actor.items.find((i: any) => \n          i.type === 'skill' && i.name === linkedSkillName\n        );\n        \n        if (linkedSkill) {\n          const skillRating = (linkedSkill.system as any).rating || 0;\n          \n          // Check if there's a specialization for this weapon/spell\n          let matchingSpec = null;\n          \n          if (linkedSpecializationName) {\n            // Look for the specific specialization by name\n            matchingSpec = allSpecializations.find((spec: any) => \n              spec.name === linkedSpecializationName && spec.system.linkedSkill === linkedSkillName\n            );\n          }\n          \n          if (matchingSpec) {\n            // Use specialization: skill rating + spec's attribute + 2\n            linkedAttribute = matchingSpec.system.linkedAttribute || (linkedSkill.system as any).linkedAttribute || 'strength';\n            const attributeValue = this.actor.system.attributes?.[linkedAttribute] || 0;\n            totalDicePool = skillRating + attributeValue + 2;\n            \n            // Calculate RR for specialization\n            activeFeats.forEach((feat: any) => {\n              const rrList = feat.system.rrList || [];\n              rrList.forEach((rrEntry: any) => {\n                if (rrEntry.rrType === 'skill' && rrEntry.rrTarget === linkedSkillName) {\n                  totalRR += rrEntry.rrValue || 0;\n                }\n                if (rrEntry.rrType === 'attribute' && rrEntry.rrTarget === linkedAttribute) {\n                  totalRR += rrEntry.rrValue || 0;\n                }\n                if (rrEntry.rrType === 'specialization' && rrEntry.rrTarget === matchingSpec.name) {\n                  totalRR += rrEntry.rrValue || 0;\n                }\n              });\n            });\n          } else {\n            // Use skill only\n            linkedAttribute = (linkedSkill.system as any).linkedAttribute || 'strength';\n            const attributeValue = this.actor.system.attributes?.[linkedAttribute] || 0;\n            totalDicePool = attributeValue + skillRating;\n            \n            // Calculate RR\n            activeFeats.forEach((feat: any) => {\n              const rrList = feat.system.rrList || [];\n              rrList.forEach((rrEntry: any) => {\n                if (rrEntry.rrType === 'skill' && rrEntry.rrTarget === linkedSkillName) {\n                  totalRR += rrEntry.rrValue || 0;\n                }\n                if (rrEntry.rrType === 'attribute' && rrEntry.rrTarget === linkedAttribute) {\n                  totalRR += rrEntry.rrValue || 0;\n                }\n              });\n            });\n          }\n        }\n      }\n      \n      // If no linked skill found, use a default attribute (usually strength for weapons)\n      if (totalDicePool === 0) {\n        linkedAttribute = 'strength'; // Default for weapons/spells\n        const attributeValue = this.actor.system.attributes?.[linkedAttribute] || 0;\n        totalDicePool = attributeValue;\n        \n        // Calculate RR for attribute only\n        activeFeats.forEach((feat: any) => {\n          const rrList = feat.system.rrList || [];\n          rrList.forEach((rrEntry: any) => {\n            if (rrEntry.rrType === 'attribute' && rrEntry.rrTarget === linkedAttribute) {\n              totalRR += rrEntry.rrValue || 0;\n            }\n          });\n        });\n      }\n      \n      const npcThreshold = Math.round(totalDicePool / 3) + totalRR + 1;\n      \n      itemData.totalDicePool = totalDicePool;\n      itemData.totalRR = totalRR;\n      itemData.npcThreshold = npcThreshold;\n      \n      // Calculate final damage value with bonus\n      const damageValue = item.system.damageValue || '0';\n      const damageValueBonus = item.system.damageValueBonus || 0;\n      itemData.finalDamageValue = SheetHelpers.calculateFinalDamageValue(damageValue, damageValueBonus, actorStrength);\n      \n      return itemData;\n    };\n    \n    // Separate and process weapons, spells, and other feats\n    const rawWeapons = allFeats.filter((feat: any) => \n      feat.system.featType === 'weapon' || feat.system.featType === 'weapons-spells'\n    );\n    const rawSpells = allFeats.filter((feat: any) => \n      feat.system.featType === 'spell'\n    );\n    const otherFeats = allFeats.filter((feat: any) => \n      feat.system.featType !== 'weapon' && \n      feat.system.featType !== 'spell' && \n      feat.system.featType !== 'weapons-spells'\n    );\n    \n    // Calculate stats for weapons and spells using linked skills from WEAPON_TYPES\n    const weapons = rawWeapons.map((weapon: any) => calculateWeaponSpellStats(weapon));\n    const spells = rawSpells.map((spell: any) => calculateWeaponSpellStats(spell));\n    \n    context.weapons = weapons;\n    context.spells = spells;\n    context.feats = otherFeats;\n\n    // Get skills with NPC threshold calculations (sorted alphabetically)\n    const skills = this.actor.items\n      .filter((item: any) => item.type === 'skill')\n      .sort((a: any, b: any) => a.name.localeCompare(b.name));\n    \n    // Sort all specializations alphabetically (already defined above)\n    allSpecializations = allSpecializations.sort((a: any, b: any) => a.name.localeCompare(b.name));\n    \n    // Organize specializations by linked skill\n    const specializationsBySkill = new Map<string, any[]>();\n    \n    allSpecializations.forEach((spec: any) => {\n      const linkedSkillName = spec.system.linkedSkill;\n      if (linkedSkillName) {\n        const linkedSkill = this.actor.items.find((i: any) => \n          i.type === 'skill' && i.name === linkedSkillName\n        );\n        \n        if (linkedSkill && linkedSkill.id) {\n          const skillId = linkedSkill.id;\n          if (!specializationsBySkill.has(skillId)) {\n            specializationsBySkill.set(skillId, []);\n          }\n          specializationsBySkill.get(skillId)!.push(spec);\n        }\n      }\n    });\n\n    // Calculate NPC thresholds for skills\n    const skillsWithThresholds = skills.map((skill: any) => {\n      const skillData = {\n        ...skill,\n        _id: skill.id || skill._id, // Ensure ID is present\n        id: skill.id || skill._id\n      };\n      \n      // Get attribute value\n      const linkedAttribute = skill.system.linkedAttribute;\n      let attributeValue = 0;\n      if (linkedAttribute && this.actor.system.attributes) {\n        attributeValue = this.actor.system.attributes[linkedAttribute] || 0;\n      }\n      \n      // Calculate total dice pool (attribute + skill rating)\n      const skillRating = skill.system.rating || 0;\n      const totalDicePool = attributeValue + skillRating;\n      \n      // Calculate total RR for this skill\n      let totalRR = 0;\n      \n      // Get all active feats\n      const activeFeats = this.actor.items.filter((item: any) => \n        item.type === 'feat' && item.system.active === true\n      );\n      \n      // Check each feat for RR that applies to this skill\n      activeFeats.forEach((feat: any) => {\n        const rrList = feat.system.rrList || [];\n        rrList.forEach((rrEntry: any) => {\n          if (rrEntry.rrType === 'skill' && rrEntry.rrTarget === skill.name) {\n            totalRR += rrEntry.rrValue || 0;\n          }\n          // Also check for attribute RR\n          if (rrEntry.rrType === 'attribute' && rrEntry.rrTarget === linkedAttribute) {\n            totalRR += rrEntry.rrValue || 0;\n          }\n        });\n      });\n      \n      // Calculate NPC threshold: round(dice pool / 3) + RR + 1\n      const npcThreshold = Math.round(totalDicePool / 3) + totalRR + 1;\n      \n      skillData.totalDicePool = totalDicePool;\n      skillData.totalRR = totalRR;\n      skillData.npcThreshold = npcThreshold;\n      \n      // Attach specializations for this skill with their thresholds (sorted alphabetically)\n      const specs = (specializationsBySkill.get(skill.id) || []).sort((a: any, b: any) => a.name.localeCompare(b.name));\n      skillData.specializations = specs.map((spec: any) => {\n        const specData = {\n          ...spec,\n          _id: spec.id || spec._id, // Ensure ID is present\n          id: spec.id || spec._id\n        };\n        \n        // Get specialization's linked attribute (can be different from skill's attribute)\n        const specLinkedAttribute = spec.system.linkedAttribute || linkedAttribute;\n        const specAttributeValue = this.actor.system.attributes?.[specLinkedAttribute] || 0;\n        \n        // Specialization: skill rating + spec's attribute + 2\n        const specDicePool = skillRating + specAttributeValue + 2;\n        \n        // Calculate total RR for specialization\n        let specTotalRR = 0;\n        \n        // Check for skill RR\n        activeFeats.forEach((feat: any) => {\n          const rrList = feat.system.rrList || [];\n          rrList.forEach((rrEntry: any) => {\n            if (rrEntry.rrType === 'skill' && rrEntry.rrTarget === skill.name) {\n              specTotalRR += rrEntry.rrValue || 0;\n            }\n          });\n        });\n        \n        // Check for attribute RR (using spec's attribute)\n        activeFeats.forEach((feat: any) => {\n          const rrList = feat.system.rrList || [];\n          rrList.forEach((rrEntry: any) => {\n            if (rrEntry.rrType === 'attribute' && rrEntry.rrTarget === specLinkedAttribute) {\n              specTotalRR += rrEntry.rrValue || 0;\n            }\n          });\n        });\n        \n        // Check for specialization-specific RR\n        activeFeats.forEach((feat: any) => {\n          const rrList = feat.system.rrList || [];\n          rrList.forEach((rrEntry: any) => {\n            if (rrEntry.rrType === 'specialization' && rrEntry.rrTarget === spec.name) {\n              specTotalRR += rrEntry.rrValue || 0;\n            }\n          });\n        });\n        \n        // Calculate specialization threshold\n        const specThreshold = Math.round(specDicePool / 3) + specTotalRR + 1;\n        \n        specData.totalDicePool = specDicePool;\n        specData.totalRR = specTotalRR;\n        specData.npcThreshold = specThreshold;\n        \n        return specData;\n      });\n      \n      return skillData;\n    });\n\n    context.skills = skillsWithThresholds;\n\n    return context;\n  }\n\n  override activateListeners(html: JQuery<HTMLElement>): void {\n    super.activateListeners(html);\n\n    // Roll skill\n    html.find('[data-action=\"roll-skill\"]').on('click', this._onRollSkill.bind(this));\n\n    // Roll specialization\n    html.find('[data-action=\"roll-specialization\"]').on('click', this._onRollSpecialization.bind(this));\n\n    // Attack with threshold\n    html.find('[data-action=\"attack-threshold\"]').on('click', this._onAttackThreshold.bind(this));\n\n    // Attack with threshold (weapon)\n    html.find('[data-action=\"attack-threshold-weapon\"]').on('click', this._onAttackThresholdWeapon.bind(this));\n\n    // Attack with threshold (spell)\n    html.find('[data-action=\"attack-threshold-spell\"]').on('click', this._onAttackThresholdSpell.bind(this));\n\n    // Roll NPC weapon with dice\n    html.find('[data-action=\"roll-npc-weapon-dice\"]').on('click', this._onRollNPCWeaponDice.bind(this));\n\n    // Roll NPC spell with dice\n    html.find('[data-action=\"roll-npc-spell-dice\"]').on('click', this._onRollNPCSpellDice.bind(this));\n\n    // Edit skill\n    html.find('[data-action=\"edit-skill\"]').on('click', async (event: JQuery.ClickEvent) => {\n      event.preventDefault();\n      const itemId = $(event.currentTarget).data('item-id');\n      const item = this.actor.items.get(itemId);\n      if (item) {\n        item.sheet?.render(true);\n      }\n    });\n\n    // Delete skill\n    html.find('[data-action=\"delete-skill\"]').on('click', async (event: JQuery.ClickEvent) => {\n      event.preventDefault();\n      const itemId = $(event.currentTarget).data('item-id');\n      const item = this.actor.items.get(itemId);\n      if (item) {\n        const confirmed = await Dialog.confirm({\n          title: game.i18n!.localize('SRA2.SKILLS.DELETE'),\n          content: `<p>${game.i18n!.format('SRA2.CONFIRM_DELETE', { name: item.name })}</p>`,\n        });\n        if (confirmed) {\n          await item.delete();\n        }\n      }\n    });\n\n    // Edit specialization\n    html.find('[data-action=\"edit-specialization\"]').on('click', async (event: JQuery.ClickEvent) => {\n      event.preventDefault();\n      const itemId = $(event.currentTarget).data('item-id');\n      const item = this.actor.items.get(itemId);\n      if (item) {\n        item.sheet?.render(true);\n      }\n    });\n\n    // Delete specialization\n    html.find('[data-action=\"delete-specialization\"]').on('click', async (event: JQuery.ClickEvent) => {\n      event.preventDefault();\n      const itemId = $(event.currentTarget).data('item-id');\n      const item = this.actor.items.get(itemId);\n      if (item) {\n        const confirmed = await Dialog.confirm({\n          title: game.i18n!.localize('SRA2.SPECIALIZATIONS.DELETE'),\n          content: `<p>${game.i18n!.format('SRA2.CONFIRM_DELETE', { name: item.name })}</p>`,\n        });\n        if (confirmed) {\n          await item.delete();\n        }\n      }\n    });\n\n    // Edit feat\n    html.find('[data-action=\"edit-feat\"]').on('click', async (event: JQuery.ClickEvent) => {\n      event.preventDefault();\n      const itemId = $(event.currentTarget).data('item-id');\n      const item = this.actor.items.get(itemId);\n      if (item) {\n        item.sheet?.render(true);\n      }\n    });\n\n    // Delete feat\n    html.find('[data-action=\"delete-feat\"]').on('click', async (event: JQuery.ClickEvent) => {\n      event.preventDefault();\n      const itemId = $(event.currentTarget).data('item-id');\n      const item = this.actor.items.get(itemId);\n      if (item) {\n        const confirmed = await Dialog.confirm({\n          title: game.i18n!.localize('SRA2.FEATS.DELETE'),\n          content: `<p>${game.i18n!.format('SRA2.CONFIRM_DELETE', { name: item.name })}</p>`,\n        });\n        if (confirmed) {\n          await item.delete();\n        }\n      }\n    });\n\n    // Add world skill button\n    html.find('[data-action=\"add-world-skill\"]').on('click', async (event: JQuery.ClickEvent) => {\n      event.preventDefault();\n      this._showItemBrowser('skill');\n    });\n\n    // Add world feat button\n    html.find('[data-action=\"add-world-feat\"]').on('click', async (event: JQuery.ClickEvent) => {\n      event.preventDefault();\n      this._showItemBrowser('feat');\n    });\n  }\n\n  /**\n   * Handle rolling a skill (NPC)\n   */\n  private async _onRollSkill(event: JQuery.ClickEvent): Promise<void> {\n    event.preventDefault();\n    const element = $(event.currentTarget);\n    const itemId = element.data('item-id') || element.attr('data-item-id');\n\n    if (!itemId) return;\n\n    const skill = this.actor.items.get(itemId);\n    if (!skill || skill.type !== 'skill') return;\n\n    const skillSystem = skill.system as any;\n    const rating = skillSystem.rating || 0;\n    const linkedAttribute = skillSystem.linkedAttribute || 'strength';\n    const attributeValue = (this.actor.system as any).attributes?.[linkedAttribute] || 0;\n    \n    // Get RR sources for skill and attribute\n    const skillRRSources = this.getRRSources('skill', skill.name);\n    const attributeRRSources = this.getRRSources('attribute', linkedAttribute);\n    const allRRSources = [...skillRRSources, ...attributeRRSources];\n\n    DiceRoller.handleRollRequest({\n      itemType: 'skill',\n      itemName: skill.name,\n      itemId: skill.id,\n      itemRating: rating,\n      skillName: skill.name,\n      skillLevel: attributeValue + rating,  // Total dice pool (attribute + rating)\n      linkedAttribute: linkedAttribute,\n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      rrList: allRRSources\n    });\n  }\n\n  /**\n   * Handle rolling a specialization (NPC)\n   */\n  private async _onRollSpecialization(event: JQuery.ClickEvent): Promise<void> {\n    event.preventDefault();\n    const element = $(event.currentTarget);\n    const itemId = element.data('item-id') || element.attr('data-item-id');\n    \n    if (!itemId) return;\n\n    const specialization = this.actor.items.get(itemId);\n    if (!specialization || specialization.type !== 'specialization') return;\n\n    const specSystem = specialization.system as any;\n    const linkedAttribute = specSystem.linkedAttribute || 'strength';\n    const linkedSkillName = specSystem.linkedSkill;\n    const attributeValue = (this.actor.system as any).attributes?.[linkedAttribute] || 0;\n    \n    // Get the linked skill to calculate effective rating\n    const linkedSkill = this.actor.items.find((i: any) => i.type === 'skill' && i.name === linkedSkillName);\n    const skillRating = linkedSkill ? (linkedSkill.system as any).rating || 0 : 0;\n    const effectiveRating = skillRating + 2; // +2 from specialization\n    \n    // Get RR sources\n    const specRRSources = this.getRRSources('specialization', specialization.name);\n    const attributeRRSources = this.getRRSources('attribute', linkedAttribute);\n    const skillRRSources = linkedSkillName ? this.getRRSources('skill', linkedSkillName) : [];\n    const allRRSources = [...specRRSources, ...skillRRSources, ...attributeRRSources];\n\n    DiceRoller.handleRollRequest({\n      itemType: 'specialization',\n      itemName: specialization.name,\n      itemId: specialization.id,\n      specName: specialization.name,\n      specLevel: attributeValue + effectiveRating,  // Total dice pool (attribute + effectiveRating)\n      skillName: linkedSkillName,\n      skillLevel: skillRating,  // Just the skill rating (without attribute)\n      linkedAttribute: linkedAttribute,\n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      rrList: allRRSources\n    });\n  }\n\n  /**\n   * Handle attack with threshold (NPC skill/spec without weapon)\n   */\n  private async _onAttackThreshold(event: JQuery.ClickEvent): Promise<void> {\n    event.preventDefault();\n    const element = $(event.currentTarget);\n    const itemId = element.data('item-id') || element.attr('data-item-id');\n    const threshold = element.data('threshold') || element.attr('data-threshold');\n    const itemName = element.data('item-name') || element.attr('data-item-name');\n\n    if (!itemId) return;\n\n    const item = this.actor.items.get(itemId);\n    if (!item) return;\n\n    const itemSystem = item.system as any;\n    const itemType = item.type;\n    const linkedAttribute = itemSystem.linkedAttribute || 'strength';\n    \n    // Get RR sources\n    const rrSources = this.getRRSources(itemType as any, item.name);\n\n    DiceRoller.handleRollRequest({\n      itemType: itemType,\n      itemName: itemName || item.name,\n      itemId: itemId,\n      itemRating: itemSystem.rating || 0,\n      skillName: itemType === 'skill' ? item.name : undefined,\n      specName: itemType === 'specialization' ? item.name : undefined,\n      linkedAttribute: linkedAttribute,\n      threshold: threshold ? parseInt(threshold) : undefined,\n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      rrList: rrSources\n    });\n  }\n\n  /**\n   * REMOVED: Defense roll prompt for NPC attack\n   */\n  private async _promptDefenseRollForNPC(defenderActor: any, attackThreshold: number, attackName: string, defenderToken?: any): Promise<void> {\n    console.log('NPC defense prompt disabled', { defenderActor: defenderActor.name, attackThreshold, attackName });\n  }\n\n  /**\n   * REMOVED: Defense roll against NPC attack\n   */\n  private async _rollDefenseAgainstNPC(defenseItem: any, itemType: 'skill' | 'spec', attackName: string, attackThreshold: number, defenderActor: any, defenderToken?: any): Promise<void> {\n    console.log('NPC defense roll disabled', { defenseItem: defenseItem.name, itemType, attackName, attackThreshold });\n  }\n\n\n  /**\n   * REMOVED: NPC attack result display\n   */\n  private async _displayNPCAttackResult(attackName: string, attackThreshold: number, defenseResult: any | null, defenderActor: any, defenderToken?: any): Promise<void> {\n    console.log('NPC attack result display disabled', { attackName, attackThreshold, defenderActor: defenderActor.name });\n  }\n\n\n\n\n  /**\n   * Handle attacking with threshold (weapon)\n   */\n  private async _onAttackThresholdWeapon(event: JQuery.ClickEvent): Promise<void> {\n    event.preventDefault();\n    const element = $(event.currentTarget);\n    const itemId = element.data('item-id') || element.attr('data-item-id');\n    const threshold = element.data('threshold') || element.attr('data-threshold');\n    const itemName = element.data('item-name') || element.attr('data-item-name');\n    const weaponVD = element.data('weapon-vd') || element.attr('data-weapon-vd') || '0';\n\n    if (!itemId) return;\n\n    const weapon = this.actor.items.get(itemId);\n    if (!weapon || weapon.type !== 'feat') return;\n\n    const weaponSystem = weapon.system as any;\n    const weaponType = weaponSystem.weaponType;\n    \n    let weaponLinkedSkill = '';\n    let weaponLinkedSpecialization = '';\n    let weaponLinkedDefenseSkill = '';\n    let weaponLinkedDefenseSpecialization = '';\n    \n    if (weaponType && weaponType !== 'custom-weapon') {\n      const weaponStats = WEAPON_TYPES[weaponType as keyof typeof WEAPON_TYPES];\n      if (weaponStats) {\n        weaponLinkedSkill = weaponStats.linkedSkill || '';\n        weaponLinkedSpecialization = weaponStats.linkedSpecialization || '';\n        weaponLinkedDefenseSkill = weaponStats.linkedDefenseSkill || '';\n        weaponLinkedDefenseSpecialization = weaponStats.linkedDefenseSpecialization || '';\n      }\n    }\n\n    // Enrich RR list with featName\n    const rawItemRRList = weaponSystem.rrList || [];\n    const itemRRList = rawItemRRList.map((rrEntry: any) => ({\n      ...rrEntry,\n      featName: weapon.name  // Add featName (the weapon name itself)\n    }));\n\n    // Merge weapon type links with custom fields (weapon type has priority)\n    const finalAttackSkill = weaponLinkedSkill || weaponSystem.linkedAttackSkill || '';\n    const finalAttackSpec = weaponLinkedSpecialization || weaponSystem.linkedAttackSpecialization || '';\n    const finalDefenseSkill = weaponLinkedDefenseSkill || weaponSystem.linkedDefenseSkill || '';\n    const finalDefenseSpec = weaponLinkedDefenseSpecialization || weaponSystem.linkedDefenseSpecialization || '';\n\n    // Find actor's skill and specialization based on weapon links\n    let attackSkillName: string | undefined = undefined;\n    let attackSkillLevel: number | undefined = undefined;\n    let attackSpecName: string | undefined = undefined;\n    let attackSpecLevel: number | undefined = undefined;\n    let attackLinkedAttribute: string | undefined = undefined;\n    \n    // Try to find the linked attack specialization first\n    if (finalAttackSpec) {\n      const foundSpec = this.actor.items.find((i: any) => \n        i.type === 'specialization' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSpec)\n      );\n      \n      if (foundSpec) {\n        const specSystem = foundSpec.system as any;\n        attackSpecName = foundSpec.name;\n        attackLinkedAttribute = specSystem.linkedAttribute || 'strength';\n        const attributeValue = attackLinkedAttribute ? ((this.actor.system as any).attributes?.[attackLinkedAttribute] || 0) : 0;\n        \n        // Get parent skill for specialization\n        const linkedSkillName = specSystem.linkedSkill;\n        if (linkedSkillName) {\n          const parentSkill = this.actor.items.find((i: any) => \n            i.type === 'skill' && i.name === linkedSkillName\n          );\n          if (parentSkill) {\n            attackSkillName = parentSkill.name;\n            const skillRating = (parentSkill.system as any).rating || 0;\n            attackSkillLevel = skillRating;  // Just the skill rating (without attribute)\n            attackSpecLevel = attributeValue + skillRating + 2; // Total dice pool (attribute + rating + 2)\n          }\n        }\n      }\n    }\n    \n    // If no specialization found, try to find the linked attack skill\n    if (!attackSpecName && finalAttackSkill) {\n      const foundSkill = this.actor.items.find((i: any) => \n        i.type === 'skill' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSkill)\n      );\n      \n      if (foundSkill) {\n        attackSkillName = foundSkill.name;\n        attackLinkedAttribute = (foundSkill.system as any).linkedAttribute || 'strength';\n        const attributeValue = attackLinkedAttribute ? ((this.actor.system as any).attributes?.[attackLinkedAttribute] || 0) : 0;\n        const skillRating = (foundSkill.system as any).rating || 0;\n        attackSkillLevel = attributeValue + skillRating; // Total dice pool (attribute + rating)\n      }\n    }\n\n    // Calculate final damage value (base + bonus)\n    const baseDamageValue = weaponSystem.damageValue || '0';\n    const damageValueBonus = weaponSystem.damageValueBonus || 0;\n    \n    let finalDamageValue = baseDamageValue;\n    if (damageValueBonus > 0 && baseDamageValue !== '0') {\n      if (baseDamageValue === 'FOR') {\n        finalDamageValue = `FOR+${damageValueBonus}`;\n      } else if (baseDamageValue.startsWith('FOR+')) {\n        const baseModifier = parseInt(baseDamageValue.substring(4)) || 0;\n        finalDamageValue = `FOR+${baseModifier + damageValueBonus}`;\n      } else if (baseDamageValue !== 'toxin') {\n        const baseValue = parseInt(baseDamageValue) || 0;\n        finalDamageValue = (baseValue + damageValueBonus).toString();\n      }\n    }\n\n    DiceRoller.handleRollRequest({\n      itemType: 'weapon',\n      weaponType: weaponType,\n      itemName: itemName || weapon.name,\n      itemId: itemId,\n      itemRating: weaponSystem.rating || 0,\n      itemActive: weaponSystem.active,\n      \n      linkedAttackSkill: finalAttackSkill,\n      linkedAttackSpecialization: finalAttackSpec,\n      linkedDefenseSkill: finalDefenseSkill,\n      linkedDefenseSpecialization: finalDefenseSpec,\n      linkedAttribute: attackLinkedAttribute,\n      \n      isWeaponFocus: weaponSystem.isWeaponFocus || false,\n      damageValue: finalDamageValue,  // FINAL damage value (base + bonus)\n      damageValueBonus: damageValueBonus,\n      meleeRange: weaponSystem.meleeRange,\n      shortRange: weaponSystem.shortRange,\n      mediumRange: weaponSystem.mediumRange,\n      longRange: weaponSystem.longRange,\n      \n      // Attack skill/spec from actor (based on weapon links)\n      skillName: attackSkillName,\n      skillLevel: attackSkillLevel,\n      specName: attackSpecName,\n      specLevel: attackSpecLevel,\n      \n      threshold: threshold ? parseInt(threshold) : undefined,\n      \n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      \n      rrList: itemRRList\n    });\n  }\n\n  /**\n   * Handle attacking with threshold (spell)\n   */\n  private async _onAttackThresholdSpell(event: JQuery.ClickEvent): Promise<void> {\n    event.preventDefault();\n    const element = $(event.currentTarget);\n    const itemId = element.data('item-id') || element.attr('data-item-id');\n    const threshold = element.data('threshold') || element.attr('data-threshold');\n    const itemName = element.data('item-name') || element.attr('data-item-name');\n    const spellVD = element.data('spell-vd') || element.attr('data-spell-vd') || '0';\n\n    if (!itemId) return;\n\n    const spell = this.actor.items.get(itemId);\n    if (!spell || spell.type !== 'feat') return;\n\n    const spellSystem = spell.system as any;\n    const weaponType = spellSystem.weaponType;\n    \n    let weaponLinkedSkill = '';\n    let weaponLinkedSpecialization = '';\n    let weaponLinkedDefenseSkill = '';\n    let weaponLinkedDefenseSpecialization = '';\n    \n    if (weaponType && weaponType !== 'custom-weapon') {\n      const weaponStats = WEAPON_TYPES[weaponType as keyof typeof WEAPON_TYPES];\n      if (weaponStats) {\n        weaponLinkedSkill = weaponStats.linkedSkill || '';\n        weaponLinkedSpecialization = weaponStats.linkedSpecialization || '';\n        weaponLinkedDefenseSkill = weaponStats.linkedDefenseSkill || '';\n        weaponLinkedDefenseSpecialization = weaponStats.linkedDefenseSpecialization || '';\n      }\n    }\n\n    // Enrich RR list with featName\n    const rawItemRRList = spellSystem.rrList || [];\n    const itemRRList = rawItemRRList.map((rrEntry: any) => ({\n      ...rrEntry,\n      featName: spell.name  // Add featName (the spell name itself)\n    }));\n\n    // Merge weapon type links with custom fields (weapon type has priority)\n    const finalAttackSkill = weaponLinkedSkill || spellSystem.linkedAttackSkill || '';\n    const finalAttackSpec = weaponLinkedSpecialization || spellSystem.linkedAttackSpecialization || '';\n    const finalDefenseSkill = weaponLinkedDefenseSkill || spellSystem.linkedDefenseSkill || '';\n    const finalDefenseSpec = weaponLinkedDefenseSpecialization || spellSystem.linkedDefenseSpecialization || '';\n\n    // Find actor's skill and specialization based on spell links\n    let attackSkillName = '';\n    let attackSkillLevel = 0;\n    let attackSpecName = '';\n    let attackSpecLevel = 0;\n    let attackLinkedAttribute = '';\n    \n    // Try to find the linked attack specialization first\n    if (finalAttackSpec) {\n      const foundSpec = this.actor.items.find((i: any) => \n        i.type === 'specialization' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSpec)\n      );\n      \n      if (foundSpec) {\n        const specSystem = foundSpec.system as any;\n        attackSpecName = foundSpec.name;\n        attackLinkedAttribute = specSystem.linkedAttribute || 'strength';\n        const attributeValue = attackLinkedAttribute ? ((this.actor.system as any).attributes?.[attackLinkedAttribute] || 0) : 0;\n        \n        // Get parent skill for specialization\n        const linkedSkillName = specSystem.linkedSkill;\n        if (linkedSkillName) {\n          const parentSkill = this.actor.items.find((i: any) => \n            i.type === 'skill' && i.name === linkedSkillName\n          );\n          if (parentSkill) {\n            attackSkillName = parentSkill.name;\n            const skillRating = (parentSkill.system as any).rating || 0;\n            attackSkillLevel = skillRating;  // Just the skill rating (without attribute)\n            attackSpecLevel = attributeValue + skillRating + 2; // Total dice pool (attribute + rating + 2)\n          }\n        }\n      }\n    }\n    \n    // If no specialization found, try to find the linked attack skill\n    if (!attackSpecName && finalAttackSkill) {\n      const foundSkill = this.actor.items.find((i: any) => \n        i.type === 'skill' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSkill)\n      );\n      \n      if (foundSkill) {\n        attackSkillName = foundSkill.name;\n        attackLinkedAttribute = (foundSkill.system as any).linkedAttribute || 'strength';\n        const attributeValue = attackLinkedAttribute ? ((this.actor.system as any).attributes?.[attackLinkedAttribute] || 0) : 0;\n        const skillRating = (foundSkill.system as any).rating || 0;\n        attackSkillLevel = attributeValue + skillRating; // Total dice pool (attribute + rating)\n      }\n    }\n\n    // Calculate final damage value (base + bonus)\n    const baseDamageValue = spellSystem.damageValue || '0';\n    const damageValueBonus = spellSystem.damageValueBonus || 0;\n    \n    let finalDamageValue = baseDamageValue;\n    if (damageValueBonus > 0 && baseDamageValue !== '0') {\n      if (baseDamageValue === 'FOR') {\n        finalDamageValue = `FOR+${damageValueBonus}`;\n      } else if (baseDamageValue.startsWith('FOR+')) {\n        const baseModifier = parseInt(baseDamageValue.substring(4)) || 0;\n        finalDamageValue = `FOR+${baseModifier + damageValueBonus}`;\n      } else if (baseDamageValue !== 'toxin') {\n        const baseValue = parseInt(baseDamageValue) || 0;\n        finalDamageValue = (baseValue + damageValueBonus).toString();\n      }\n    }\n\n    DiceRoller.handleRollRequest({\n      itemType: 'spell',\n      weaponType: weaponType,\n      itemName: itemName || spell.name,\n      itemId: itemId,\n      itemRating: spellSystem.rating || 0,\n      itemActive: spellSystem.active,\n      \n      linkedAttackSkill: finalAttackSkill,\n      linkedAttackSpecialization: finalAttackSpec,\n      linkedDefenseSkill: finalDefenseSkill,\n      linkedDefenseSpecialization: finalDefenseSpec,\n      linkedAttribute: attackLinkedAttribute,\n      \n      isWeaponFocus: spellSystem.isWeaponFocus || false,\n      damageValue: finalDamageValue,  // FINAL damage value (base + bonus)\n      damageValueBonus: damageValueBonus,\n      meleeRange: spellSystem.meleeRange,\n      shortRange: spellSystem.shortRange,\n      mediumRange: spellSystem.mediumRange,\n      longRange: spellSystem.longRange,\n      \n      // Attack skill/spec from actor (based on spell links)\n      skillName: attackSkillName,\n      skillLevel: attackSkillLevel,\n      specName: attackSpecName,\n      specLevel: attackSpecLevel,\n      \n      threshold: threshold ? parseInt(threshold) : undefined,\n      \n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      \n      rrList: itemRRList\n    });\n  }\n\n  /**\n   * Handle rolling NPC weapon with dice\n   */\n  private async _onRollNPCWeaponDice(event: JQuery.ClickEvent): Promise<void> {\n    event.preventDefault();\n    const element = $(event.currentTarget);\n    const itemId = element.data('item-id') || element.attr('data-item-id');\n    const weaponVD = element.data('weapon-vd') || element.attr('data-weapon-vd') || '0';\n\n    if (!itemId) return;\n\n    const weapon = this.actor.items.get(itemId);\n    if (!weapon || weapon.type !== 'feat') return;\n\n    const weaponSystem = weapon.system as any;\n    const weaponType = weaponSystem.weaponType;\n    \n    let weaponLinkedSkill = '';\n    let weaponLinkedSpecialization = '';\n    let weaponLinkedDefenseSkill = '';\n    let weaponLinkedDefenseSpecialization = '';\n    \n    if (weaponType && weaponType !== 'custom-weapon') {\n      const weaponStats = WEAPON_TYPES[weaponType as keyof typeof WEAPON_TYPES];\n      if (weaponStats) {\n        weaponLinkedSkill = weaponStats.linkedSkill || '';\n        weaponLinkedSpecialization = weaponStats.linkedSpecialization || '';\n        weaponLinkedDefenseSkill = weaponStats.linkedDefenseSkill || '';\n        weaponLinkedDefenseSpecialization = weaponStats.linkedDefenseSpecialization || '';\n      }\n    }\n\n    // Enrich RR list with featName\n    const rawItemRRList = weaponSystem.rrList || [];\n    const itemRRList = rawItemRRList.map((rrEntry: any) => ({\n      ...rrEntry,\n      featName: weapon.name  // Add featName (the weapon name itself)\n    }));\n\n    // Merge weapon type links with custom fields (weapon type has priority)\n    const finalAttackSkill = weaponLinkedSkill || weaponSystem.linkedAttackSkill || '';\n    const finalAttackSpec = weaponLinkedSpecialization || weaponSystem.linkedAttackSpecialization || '';\n    const finalDefenseSkill = weaponLinkedDefenseSkill || weaponSystem.linkedDefenseSkill || '';\n    const finalDefenseSpec = weaponLinkedDefenseSpecialization || weaponSystem.linkedDefenseSpecialization || '';\n\n    // Find actor's skill and specialization based on weapon links\n    let attackSkillName: string | undefined = undefined;\n    let attackSkillLevel: number | undefined = undefined;\n    let attackSpecName: string | undefined = undefined;\n    let attackSpecLevel: number | undefined = undefined;\n    let attackLinkedAttribute: string | undefined = undefined;\n    \n    // Try to find the linked attack specialization first\n    if (finalAttackSpec) {\n      const foundSpec = this.actor.items.find((i: any) => \n        i.type === 'specialization' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSpec)\n      );\n      \n      if (foundSpec) {\n        const specSystem = foundSpec.system as any;\n        attackSpecName = foundSpec.name;\n        attackLinkedAttribute = specSystem.linkedAttribute || 'strength';\n        const attributeValue = attackLinkedAttribute ? ((this.actor.system as any).attributes?.[attackLinkedAttribute] || 0) : 0;\n        \n        // Get parent skill for specialization\n        const linkedSkillName = specSystem.linkedSkill;\n        if (linkedSkillName) {\n          const parentSkill = this.actor.items.find((i: any) => \n            i.type === 'skill' && i.name === linkedSkillName\n          );\n          if (parentSkill) {\n            attackSkillName = parentSkill.name;\n            const skillRating = (parentSkill.system as any).rating || 0;\n            attackSkillLevel = skillRating;  // Just the skill rating (without attribute)\n            attackSpecLevel = attributeValue + skillRating + 2; // Total dice pool (attribute + rating + 2)\n          }\n        }\n      }\n    }\n    \n    // If no specialization found, try to find the linked attack skill\n    if (!attackSpecName && finalAttackSkill) {\n      const foundSkill = this.actor.items.find((i: any) => \n        i.type === 'skill' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSkill)\n      );\n      \n      if (foundSkill) {\n        attackSkillName = foundSkill.name;\n        attackLinkedAttribute = (foundSkill.system as any).linkedAttribute || 'strength';\n        const attributeValue = attackLinkedAttribute ? ((this.actor.system as any).attributes?.[attackLinkedAttribute] || 0) : 0;\n        const skillRating = (foundSkill.system as any).rating || 0;\n        attackSkillLevel = attributeValue + skillRating; // Total dice pool (attribute + rating)\n      }\n    }\n\n    // Calculate final damage value (base + bonus)\n    const baseDamageValue = weaponSystem.damageValue || '0';\n    const damageValueBonus = weaponSystem.damageValueBonus || 0;\n    \n    let finalDamageValue = baseDamageValue;\n    if (damageValueBonus > 0 && baseDamageValue !== '0') {\n      if (baseDamageValue === 'FOR') {\n        finalDamageValue = `FOR+${damageValueBonus}`;\n      } else if (baseDamageValue.startsWith('FOR+')) {\n        const baseModifier = parseInt(baseDamageValue.substring(4)) || 0;\n        finalDamageValue = `FOR+${baseModifier + damageValueBonus}`;\n      } else if (baseDamageValue !== 'toxin') {\n        const baseValue = parseInt(baseDamageValue) || 0;\n        finalDamageValue = (baseValue + damageValueBonus).toString();\n      }\n    }\n\n    DiceRoller.handleRollRequest({\n      itemType: 'weapon',\n      weaponType: weaponType,\n      itemName: weapon.name,\n      itemId: itemId,\n      itemRating: weaponSystem.rating || 0,\n      itemActive: weaponSystem.active,\n      \n      linkedAttackSkill: finalAttackSkill,\n      linkedAttackSpecialization: finalAttackSpec,\n      linkedDefenseSkill: finalDefenseSkill,\n      linkedDefenseSpecialization: finalDefenseSpec,\n      linkedAttribute: attackLinkedAttribute,\n      \n      isWeaponFocus: weaponSystem.isWeaponFocus || false,\n      damageValue: finalDamageValue,  // FINAL damage value (base + bonus)\n      damageValueBonus: damageValueBonus,\n      meleeRange: weaponSystem.meleeRange,\n      shortRange: weaponSystem.shortRange,\n      mediumRange: weaponSystem.mediumRange,\n      longRange: weaponSystem.longRange,\n      \n      // Attack skill/spec from actor (based on weapon links)\n      skillName: attackSkillName,\n      skillLevel: attackSkillLevel,\n      specName: attackSpecName,\n      specLevel: attackSpecLevel,\n      \n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      \n      rrList: itemRRList\n    });\n  }\n\n  /**\n   * Handle rolling NPC spell with dice\n   */\n  private async _onRollNPCSpellDice(event: JQuery.ClickEvent): Promise<void> {\n    event.preventDefault();\n    const element = $(event.currentTarget);\n    const itemId = element.data('item-id') || element.attr('data-item-id');\n    const spellVD = element.data('spell-vd') || element.attr('data-spell-vd') || '0';\n\n    if (!itemId) return;\n\n    const spell = this.actor.items.get(itemId);\n    if (!spell || spell.type !== 'feat') return;\n\n    const spellSystem = spell.system as any;\n    const weaponType = spellSystem.weaponType;\n    \n    let weaponLinkedSkill = '';\n    let weaponLinkedSpecialization = '';\n    let weaponLinkedDefenseSkill = '';\n    let weaponLinkedDefenseSpecialization = '';\n    \n    if (weaponType && weaponType !== 'custom-weapon') {\n      const weaponStats = WEAPON_TYPES[weaponType as keyof typeof WEAPON_TYPES];\n      if (weaponStats) {\n        weaponLinkedSkill = weaponStats.linkedSkill || '';\n        weaponLinkedSpecialization = weaponStats.linkedSpecialization || '';\n        weaponLinkedDefenseSkill = weaponStats.linkedDefenseSkill || '';\n        weaponLinkedDefenseSpecialization = weaponStats.linkedDefenseSpecialization || '';\n      }\n    }\n\n    // Enrich RR list with featName\n    const rawItemRRList = spellSystem.rrList || [];\n    const itemRRList = rawItemRRList.map((rrEntry: any) => ({\n      ...rrEntry,\n      featName: spell.name  // Add featName (the spell name itself)\n    }));\n\n    // Merge weapon type links with custom fields (weapon type has priority)\n    const finalAttackSkill = weaponLinkedSkill || spellSystem.linkedAttackSkill || '';\n    const finalAttackSpec = weaponLinkedSpecialization || spellSystem.linkedAttackSpecialization || '';\n    const finalDefenseSkill = weaponLinkedDefenseSkill || spellSystem.linkedDefenseSkill || '';\n    const finalDefenseSpec = weaponLinkedDefenseSpecialization || spellSystem.linkedDefenseSpecialization || '';\n\n    // Find actor's skill and specialization based on spell links\n    let attackSkillName = '';\n    let attackSkillLevel = 0;\n    let attackSpecName = '';\n    let attackSpecLevel = 0;\n    let attackLinkedAttribute = '';\n    \n    // Try to find the linked attack specialization first\n    if (finalAttackSpec) {\n      const foundSpec = this.actor.items.find((i: any) => \n        i.type === 'specialization' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSpec)\n      );\n      \n      if (foundSpec) {\n        const specSystem = foundSpec.system as any;\n        attackSpecName = foundSpec.name;\n        attackLinkedAttribute = specSystem.linkedAttribute || 'strength';\n        const attributeValue = attackLinkedAttribute ? ((this.actor.system as any).attributes?.[attackLinkedAttribute] || 0) : 0;\n        \n        // Get parent skill for specialization\n        const linkedSkillName = specSystem.linkedSkill;\n        if (linkedSkillName) {\n          const parentSkill = this.actor.items.find((i: any) => \n            i.type === 'skill' && i.name === linkedSkillName\n          );\n          if (parentSkill) {\n            attackSkillName = parentSkill.name;\n            const skillRating = (parentSkill.system as any).rating || 0;\n            attackSkillLevel = skillRating;  // Just the skill rating (without attribute)\n            attackSpecLevel = attributeValue + skillRating + 2; // Total dice pool (attribute + rating + 2)\n          }\n        }\n      }\n    }\n    \n    // If no specialization found, try to find the linked attack skill\n    if (!attackSpecName && finalAttackSkill) {\n      const foundSkill = this.actor.items.find((i: any) => \n        i.type === 'skill' && \n        ItemSearch.normalizeSearchText(i.name) === ItemSearch.normalizeSearchText(finalAttackSkill)\n      );\n      \n      if (foundSkill) {\n        attackSkillName = foundSkill.name;\n        attackLinkedAttribute = (foundSkill.system as any).linkedAttribute || 'strength';\n        const attributeValue = attackLinkedAttribute ? ((this.actor.system as any).attributes?.[attackLinkedAttribute] || 0) : 0;\n        const skillRating = (foundSkill.system as any).rating || 0;\n        attackSkillLevel = attributeValue + skillRating; // Total dice pool (attribute + rating)\n      }\n    }\n\n    // Calculate final damage value (base + bonus)\n    const baseDamageValue = spellSystem.damageValue || '0';\n    const damageValueBonus = spellSystem.damageValueBonus || 0;\n    \n    let finalDamageValue = baseDamageValue;\n    if (damageValueBonus > 0 && baseDamageValue !== '0') {\n      if (baseDamageValue === 'FOR') {\n        finalDamageValue = `FOR+${damageValueBonus}`;\n      } else if (baseDamageValue.startsWith('FOR+')) {\n        const baseModifier = parseInt(baseDamageValue.substring(4)) || 0;\n        finalDamageValue = `FOR+${baseModifier + damageValueBonus}`;\n      } else if (baseDamageValue !== 'toxin') {\n        const baseValue = parseInt(baseDamageValue) || 0;\n        finalDamageValue = (baseValue + damageValueBonus).toString();\n      }\n    }\n\n    DiceRoller.handleRollRequest({\n      itemType: 'spell',\n      weaponType: weaponType,\n      itemName: spell.name,\n      itemId: itemId,\n      itemRating: spellSystem.rating || 0,\n      itemActive: spellSystem.active,\n      \n      linkedAttackSkill: finalAttackSkill,\n      linkedAttackSpecialization: finalAttackSpec,\n      linkedDefenseSkill: finalDefenseSkill,\n      linkedDefenseSpecialization: finalDefenseSpec,\n      linkedAttribute: attackLinkedAttribute,\n      \n      isWeaponFocus: spellSystem.isWeaponFocus || false,\n      damageValue: finalDamageValue,  // FINAL damage value (base + bonus)\n      damageValueBonus: damageValueBonus,\n      meleeRange: spellSystem.meleeRange,\n      shortRange: spellSystem.shortRange,\n      mediumRange: spellSystem.mediumRange,\n      longRange: spellSystem.longRange,\n      \n      // Attack skill/spec from actor (based on spell links)\n      skillName: attackSkillName,\n      skillLevel: attackSkillLevel,\n      specName: attackSpecName,\n      specLevel: attackSpecLevel,\n      \n      actorId: this.actor.id,\n      actorUuid: this.actor.uuid,\n      actorName: this.actor.name,\n      \n      rrList: itemRRList\n    });\n  }\n\n  /**\n   * REMOVED: NPC weapon/spell roll with dice\n   */\n  private async _rollNPCWeaponOrSpellWithDice(item: any, type: 'weapon' | 'spell', weaponVD: string): Promise<void> {\n    console.log('NPC weapon/spell dice roll disabled', { item: item.name, type, weaponVD });\n  }\n\n  /**\n   * REMOVED: Skill with weapon roll for NPC\n   */\n  private async _rollSkillWithWeapon(skill: any, weaponName: string, skillType: string, weaponDamageValue: string, weapon?: any): Promise<void> {\n    console.log('NPC skill with weapon roll disabled', { skill: skill.name, weaponName, skillType });\n  }\n\n  /**\n   * REMOVED: Attack with defense system for NPC\n   */\n  private async _rollAttackWithDefenseNPC(skillName: string, dicePool: number, riskDice: number = 0, riskReduction: number = 0, rollMode: string = 'normal', weaponDamageValue?: string, attackingWeapon?: any): Promise<void> {\n    console.log('NPC attack with defense disabled', { skillName, dicePool, riskDice, riskReduction, rollMode });\n  }\n\n  /**\n   * REMOVED: Display roll result with VD\n   */\n  private async _displayRollResultWithVD(skillName: string, rollResult: any, weaponDamageValue?: string, damageValueBonus?: number): Promise<void> {\n    console.log('NPC roll result display disabled', { skillName, weaponDamageValue });\n  }\n\n  /**\n   * REMOVED: Defense roll prompt with attack result\n   */\n  private async _promptDefenseRollWithAttackResult(defenderActor: any, attackResult: any, attackName: string, weaponDamageValue: string, attackingWeapon?: any, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    console.log('Defense roll prompt with attack result disabled', { defenderActor: defenderActor.name, attackName });\n  }\n\n  /**\n   * REMOVED: Defense roll prompt with VD\n   */\n  private async _promptDefenseRollWithVD(defenderActor: any, attackThreshold: number, attackName: string, weaponDamageValue: string, attackingWeapon?: any, defenderToken?: any): Promise<void> {\n    console.log('Defense roll prompt with VD disabled', { defenderActor: defenderActor.name, attackName, weaponDamageValue });\n  }\n\n  /**\n   * REMOVED: Threshold defense against dice attack\n   */\n  private async _defendWithThresholdAgainstDiceAttack(defenseItem: any, threshold: number, attackName: string, attackResult: any, defenderActor: any, weaponDamageValue: string, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    console.log('Threshold defense against dice attack disabled', { defenseItem: defenseItem.name, threshold, attackName });\n  }\n\n  /**\n   * REMOVED: Defense roll against NPC dice attack\n   */\n  private async _rollDefenseAgainstNPCDiceAttack(defenseItem: any, itemType: 'skill' | 'spec', attackName: string, attackResult: any, defenderActor: any, weaponDamageValue: string, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    console.log('Defense roll against NPC dice attack disabled', { defenseItem: defenseItem.name, itemType, attackName });\n  }\n\n  /**\n   * REMOVED: NPC dice attack result display\n   */\n  private async _displayNPCDiceAttackResult(attackName: string, attackResult: any, defenseResult: any | null, defenderActor: any, weaponDamageValue: string, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    console.log('NPC dice attack result display disabled', { attackName, defenderActor: defenderActor.name, weaponDamageValue });\n  }\n\n\n\n  /**\n   * REMOVED: Threshold defense against weapon attack\n   */\n  private async _defendWithThresholdAgainstWeapon(defenseItem: any, threshold: number, attackName: string, attackThreshold: number, defenderActor: any, weaponDamageValue: string, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    console.log('Threshold defense against weapon attack disabled', { defenseItem: defenseItem.name, threshold, attackName });\n  }\n\n  /**\n   * REMOVED: Defense roll against NPC weapon attack\n   */\n  private async _rollDefenseAgainstNPCWeapon(defenseItem: any, itemType: 'skill' | 'spec', attackName: string, attackThreshold: number, defenderActor: any, weaponDamageValue: string, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    console.log('Defense roll against NPC weapon attack disabled', { defenseItem: defenseItem.name, itemType, attackName });\n  }\n\n  /**\n   * REMOVED: NPC weapon attack result display\n   */\n  private async _displayNPCWeaponAttackResult(attackName: string, attackThreshold: number, defenseResult: any | null, defenderActor: any, weaponDamageValue: string, damageValueBonus?: number, defenderToken?: any): Promise<void> {\n    console.log('NPC weapon attack result display disabled', { attackName, attackThreshold, defenderActor: defenderActor.name });\n  }\n\n\n  /**\n   * Get RR sources from active feats\n   */\n  private getRRSources(itemType: 'skill' | 'specialization' | 'attribute', itemName: string): Array<{ featName: string, rrValue: number }> {\n    return SheetHelpers.getRRSources(this.actor, itemType, itemName);\n  }\n\n  /**\n   * REMOVED: Skill dice rolling logic\n   */\n  private async _rollSkillDice(skillName: string, dicePool: number, riskDice: number = 0, riskReduction: number = 0, rollMode: string = 'normal'): Promise<void> {\n    console.log('NPC dice roll disabled', { skillName, dicePool, riskDice, riskReduction, rollMode });\n  }\n\n\n  /**\n   * Show item browser dialog\n   */\n  private async _showItemBrowser(itemType: string): Promise<void> {\n    const items = game.items!.filter((item: any) => item.type === itemType);\n    \n    const itemOptions = items.map((item: any) => {\n      return `<option value=\"${item.id}\">${item.name}</option>`;\n    }).join('');\n\n    const content = `\n      <div class=\"form-group\">\n        <label>${game.i18n!.localize(`SRA2.${itemType.toUpperCase()}S.WORLD_ITEMS`)}</label>\n        <select id=\"item-select\" style=\"width: 100%;\">\n          <option value=\"\">${game.i18n!.localize(`SRA2.${itemType.toUpperCase()}S.SEARCH_PLACEHOLDER`)}</option>\n          ${itemOptions}\n        </select>\n      </div>\n    `;\n\n    new Dialog({\n      title: game.i18n!.localize(`SRA2.${itemType.toUpperCase()}S.ADD_${itemType.toUpperCase()}`),\n      content,\n      buttons: {\n        add: {\n          icon: '<i class=\"fas fa-plus\"></i>',\n          label: game.i18n!.localize(`SRA2.${itemType.toUpperCase()}S.ADD_${itemType.toUpperCase()}`),\n          callback: async (html: JQuery) => {\n            const itemId = html.find('#item-select').val() as string;\n            if (itemId) {\n              const item = game.items!.get(itemId);\n              if (item) {\n                await this.actor.createEmbeddedDocuments('Item', [item.toObject()]);\n              }\n            }\n          }\n        },\n        cancel: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n!.localize('Cancel')\n        }\n      },\n      default: 'add'\n    }).render(true);\n  }\n\n  protected override async _onDropItem(_event: DragEvent, data: ActorSheet.DropData.Item): Promise<unknown> {\n    if (!this.actor.isOwner) return false;\n    const item = await Item.implementation.fromDropData(data);\n    if (!item) return false;\n\n    // Check if item already exists on the actor\n    const existingItem = this.actor.items.find((i: any) => i.name === item.name && i.type === item.type);\n    if (existingItem) {\n      ui.notifications!.warn(game.i18n!.format('SRA2.ALREADY_EXISTS', { name: item.name }));\n      return false;\n    }\n\n    // Create the item on the actor\n    return await this.actor.createEmbeddedDocuments('Item', [item.toObject()]);\n  }\n}\n\n","import { WEAPON_TYPES, VEHICLE_TYPES } from '../models/item-feat.js';\nimport * as ItemSearch from '../helpers/item-search.js';\n\n/**\n * Feat Sheet Application\n */\nexport class FeatSheet extends ItemSheet {\n  /** Track the currently active section */\n  private _activeSection: string = 'general';\n  \n  static override get defaultOptions(): DocumentSheet.Options<Item> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'item', 'feat'],\n      template: 'systems/sra2/templates/item-feat-sheet.hbs',\n      width: 720,\n      height: 680,\n      tabs: [],\n      dragDrop: [\n        { dropSelector: '.rr-target-drop-zone' }\n      ],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n    \n    // Ensure prepareDerivedData is called to calculate recommendedLevel\n    this.item.prepareData();\n    \n    context.system = this.item.system;\n    \n    // Pass the active section to the template\n    context.activeSection = this._activeSection;\n    \n    // Calculate final damage value\n    context.finalDamageValue = this._calculateFinalDamageValue();\n    \n    // Calculate final vehicle stats\n    context.finalVehicleStats = this._calculateFinalVehicleStats();\n    \n    // Build RR entries array from rrList\n    context.rrEntries = [];\n    const rrList = context.system.rrList || [];\n    \n    for (let i = 0; i < rrList.length; i++) {\n      const rrEntry = rrList[i];\n      const rrType = rrEntry.rrType;\n      const rrValue = rrEntry.rrValue || 0;\n      const rrTarget = rrEntry.rrTarget || '';\n      \n      const entry: any = {\n        index: i,\n        rrType,\n        rrValue,\n        rrTarget,\n        rrTargetName: rrTarget\n      };\n      \n      if (rrType === 'skill' || rrType === 'specialization') {\n        entry.rrTargetType = rrType === 'skill' \n          ? game.i18n!.localize('SRA2.FEATS.RR_TYPE.SKILL')\n          : game.i18n!.localize('SRA2.FEATS.RR_TYPE.SPECIALIZATION');\n        \n        // If the feat is on an actor, check if the target exists\n        if (this.item.actor && rrTarget) {\n          const targetItem = this.item.actor.items.find((i: any) => \n            i.type === rrType && i.name === rrTarget\n          );\n          \n          if (!targetItem) {\n            entry.rrTargetNotFound = true;\n          }\n        }\n      }\n      \n      context.rrEntries.push(entry);\n    }\n    \n    return context;\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n    \n    // Add RR entry button\n    html.find('[data-action=\"add-rr-entry\"]').on('click', this._onAddRREntry.bind(this));\n    \n    // Remove RR entry button\n    html.find('[data-action=\"remove-rr-entry\"]').on('click', this._onRemoveRREntry.bind(this));\n    \n    // Clear RR target button\n    html.find('[data-action=\"clear-rr-target\"]').on('click', this._onClearRRTarget.bind(this));\n    \n    // Add narrative effect button\n    html.find('[data-action=\"add-narrative-effect\"]').on('click', this._onAddNarrativeEffect.bind(this));\n    \n    // Remove narrative effect button\n    html.find('[data-action=\"remove-narrative-effect\"]').on('click', this._onRemoveNarrativeEffect.bind(this));\n    \n    // Weapon type selection\n    html.find('[data-action=\"select-weapon-type\"]').on('change', this._onWeaponTypeChange.bind(this));\n    \n    // Vehicle type selection\n    html.find('[data-action=\"select-vehicle-type\"]').on('change', this._onVehicleTypeChange.bind(this));\n    \n    // Damage value bonus checkboxes\n    html.find('.damage-bonus-checkbox').on('change', this._onDamageValueBonusChange.bind(this));\n    \n    // Sustained spell checkboxes\n    html.find('.sustained-spell-checkbox').on('change', this._onSustainedSpellChange.bind(this));\n    \n    // Summoned spirit checkbox\n    html.find('.summoned-spirit-checkbox').on('change', this._onSummonedSpiritChange.bind(this));\n    \n    // Range improvement checkboxes\n    html.find('.range-improvement-checkbox input[type=\"checkbox\"]').on('change', this._onRangeImprovementChange.bind(this));\n    \n    // Section navigation\n    html.find('.section-nav .nav-item').on('click', this._onSectionNavigation.bind(this));\n    \n    // RR target search\n    html.find('.rr-target-search-input').on('input', this._onRRTargetSearch.bind(this));\n    html.find('.rr-target-search-input').on('focus', this._onRRTargetSearchFocus.bind(this));\n    html.find('.rr-target-search-input').on('blur', this._onRRTargetSearchBlur.bind(this));\n    \n    // Close RR target search results when clicking outside\n    $(document).on('click.rr-target-search', (event) => {\n      const target = event.target as unknown as HTMLElement;\n      const searchContainers = html.find('.rr-target-search-container');\n      searchContainers.each((_, container) => {\n        if (!container.contains(target)) {\n          $(container).find('.rr-target-search-results').hide();\n        }\n      });\n    });\n  }\n  \n  /**\n   * Handle section navigation\n   */\n  private _onSectionNavigation(event: Event): void {\n    event.preventDefault();\n    \n    const button = event.currentTarget as HTMLElement;\n    const section = button.dataset.section;\n    \n    if (!section) return;\n    \n    // Save the active section\n    this._activeSection = section;\n    \n    // Find the form element\n    if (!this.form) return;\n    const form = $(this.form);\n    \n    // Update navigation buttons\n    form.find('.section-nav .nav-item').removeClass('active');\n    button.classList.add('active');\n    \n    // Update content sections\n    form.find('.content-section').removeClass('active');\n    form.find(`[data-section-content=\"${section}\"]`).addClass('active');\n  }\n\n  /**\n   * Handle adding a new RR entry\n   */\n  private async _onAddRREntry(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const rrList = [...((this.item.system as any).rrList || [])];\n    \n    rrList.push({\n      rrType: 'skill',\n      rrValue: 0,\n      rrTarget: ''\n    });\n    \n    await this.item.update({\n      'system.rrList': rrList\n    } as any);\n    \n    this.render(false);\n  }\n\n  /**\n   * Handle removing an RR entry\n   */\n  private async _onRemoveRREntry(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const index = parseInt((event.currentTarget as HTMLElement).dataset.index || '0');\n    \n    const rrList = [...((this.item.system as any).rrList || [])];\n    \n    rrList.splice(index, 1);\n    \n    await this.item.update({\n      'system.rrList': rrList\n    } as any);\n    \n    this.render(false);\n  }\n\n  /**\n   * Handle clearing the RR target for a specific entry\n   */\n  private async _onClearRRTarget(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const index = parseInt((event.currentTarget as HTMLElement).dataset.index || '0');\n    const rrList = [...((this.item.system as any).rrList || [])];\n    \n    if (rrList[index]) {\n      rrList[index] = { ...rrList[index], rrTarget: '' };\n    }\n    \n    await this.item.update({ 'system.rrList': rrList } as any);\n    this.render(false);\n  }\n\n  /**\n   * Handle dropping a skill or specialization onto the RR target field\n   */\n  protected override async _onDrop(event: DragEvent): Promise<any> {\n    const data = TextEditor.getDragEventData(event) as any;\n    \n    // Handle Item drops\n    if (data && data.type === 'Item') {\n      const item = await Item.implementation.fromDropData(data) as any;\n      \n      if (!item) return super._onDrop(event);\n      \n      // Find the drop zone and get the index\n      const dropZone = (event.target as HTMLElement).closest('[data-rr-index]');\n      if (!dropZone) return super._onDrop(event);\n      \n      const index = parseInt((dropZone as HTMLElement).dataset.rrIndex || '0');\n      const rrList = [...((this.item.system as any).rrList || [])];\n      const rrType = rrList[index]?.rrType;\n      \n      // Check if it's a skill or specialization matching the RR type\n      if (item.type === 'skill' && rrType === 'skill') {\n        // Store the skill name (not ID) so the feat can be prepared in advance\n        rrList[index] = { ...rrList[index], rrTarget: item.name };\n        await this.item.update({ 'system.rrList': rrList } as any);\n        this.render(false);\n        ui.notifications?.info(game.i18n!.format('SRA2.FEATS.LINKED_TO_TARGET', { name: item.name }));\n        return;\n      } else if (item.type === 'specialization' && rrType === 'specialization') {\n        // Store the specialization name (not ID) so the feat can be prepared in advance\n        rrList[index] = { ...rrList[index], rrTarget: item.name };\n        await this.item.update({ 'system.rrList': rrList } as any);\n        this.render(false);\n        ui.notifications?.info(game.i18n!.format('SRA2.FEATS.LINKED_TO_TARGET', { name: item.name }));\n        return;\n      } else if (rrType === 'skill' || rrType === 'specialization') {\n        // Wrong type of item\n        ui.notifications?.warn(game.i18n!.localize('SRA2.FEATS.WRONG_TARGET_TYPE'));\n        return;\n      }\n    }\n\n    return super._onDrop(event);\n  }\n\n  /**\n   * Handle adding a new narrative effect\n   */\n  private async _onAddNarrativeEffect(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const narrativeEffects = [...((this.item.system as any).narrativeEffects || [])];\n    \n    narrativeEffects.push({\n      text: \"\",\n      isNegative: false\n    });\n    \n    await this.item.update({\n      'system.narrativeEffects': narrativeEffects\n    } as any);\n    \n    this.render(false);\n  }\n\n  /**\n   * Handle removing a narrative effect\n   */\n  private async _onRemoveNarrativeEffect(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const index = parseInt((event.currentTarget as HTMLElement).dataset.index || '0');\n    \n    const narrativeEffects = [...((this.item.system as any).narrativeEffects || [])];\n    \n    narrativeEffects.splice(index, 1);\n    \n    await this.item.update({\n      'system.narrativeEffects': narrativeEffects\n    } as any);\n    \n    this.render(false);\n  }\n\n  /**\n   * Calculate the final damage value taking into account STRENGTH attribute\n   */\n  private _calculateFinalDamageValue(): string {\n    const damageValue = (this.item.system as any).damageValue || \"0\";\n    const damageValueBonus = (this.item.system as any).damageValueBonus || 0;\n    \n    // Get the actor's strength if available\n    const strength = this.item.actor ? ((this.item.actor.system as any)?.attributes?.strength || 0) : 0;\n    \n    // Parse the damage value\n    if (damageValue === \"FOR\") {\n      // Pure STRENGTH\n      const total = strength + damageValueBonus;\n      if (!this.item.actor) {\n        return damageValueBonus > 0 ? `FOR+${damageValueBonus}` : \"FOR\";\n      }\n      return `${total} (FOR${damageValueBonus > 0 ? `+${damageValueBonus}` : ''})`;\n    } else if (damageValue.startsWith(\"FOR+\")) {\n      // STRENGTH + modifier\n      const modifier = parseInt(damageValue.substring(4)) || 0;\n      const total = strength + modifier + damageValueBonus;\n      if (!this.item.actor) {\n        return damageValueBonus > 0 ? `FOR+${modifier}+${damageValueBonus}` : `FOR+${modifier}`;\n      }\n      return `${total} (FOR+${modifier}${damageValueBonus > 0 ? `+${damageValueBonus}` : ''})`;\n    } else if (damageValue === \"toxin\") {\n      // Special case for gas grenades\n      return \"selon toxine\";\n    } else {\n      // Numeric value\n      const base = parseInt(damageValue) || 0;\n      const total = base + damageValueBonus;\n      if (damageValueBonus > 0) {\n        return `${total} (${base}+${damageValueBonus})`;\n      }\n      return total.toString();\n    }\n  }\n\n  /**\n   * Handle weapon type selection change\n   */\n  private async _onWeaponTypeChange(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const weaponType = (event.currentTarget as HTMLSelectElement).value;\n    \n    if (!weaponType || !WEAPON_TYPES[weaponType as keyof typeof WEAPON_TYPES]) {\n      return;\n    }\n    \n    const weaponStats = WEAPON_TYPES[weaponType as keyof typeof WEAPON_TYPES];\n    \n    // Convert damage value to string\n    const damageValue = typeof weaponStats.vd === 'number' ? weaponStats.vd.toString() : weaponStats.vd;\n    \n    await this.item.update({\n      'system.weaponType': weaponType,\n      'system.damageValue': damageValue,\n      'system.meleeRange': weaponStats.melee,\n      'system.shortRange': weaponStats.short,\n      'system.mediumRange': weaponStats.medium,\n      'system.longRange': weaponStats.long\n    } as any);\n    \n    this.render(false);\n  }\n\n  /**\n   * Handle vehicle type selection change\n   */\n  private async _onVehicleTypeChange(event: Event): Promise<void> {\n    event.preventDefault();\n    \n    const vehicleType = (event.currentTarget as HTMLSelectElement).value;\n    \n    if (!vehicleType || !VEHICLE_TYPES[vehicleType as keyof typeof VEHICLE_TYPES]) {\n      return;\n    }\n    \n    const vehicleStats = VEHICLE_TYPES[vehicleType as keyof typeof VEHICLE_TYPES];\n    \n    await this.item.update({\n      'system.vehicleType': vehicleType,\n      'system.autopilot': vehicleStats.autopilot,\n      'system.structure': vehicleStats.structure,\n      'system.handling': vehicleStats.handling,\n      'system.speed': vehicleStats.speed,\n      'system.flyingSpeed': vehicleStats.flyingSpeed,\n      'system.armor': vehicleStats.armor,\n      'system.weaponMount': vehicleStats.weaponMount\n    } as any);\n    \n    this.render(false);\n  }\n\n  /**\n   * Calculate the final vehicle stats taking into account bonuses\n   */\n  private _calculateFinalVehicleStats(): any {\n    const baseAutopilot = (this.item.system as any).autopilot || 6;\n    const baseStructure = (this.item.system as any).structure || 2;\n    const baseHandling = (this.item.system as any).handling || 5;\n    const baseSpeed = (this.item.system as any).speed || 3;\n    const baseFlyingSpeed = (this.item.system as any).flyingSpeed || 0;\n    const baseArmor = (this.item.system as any).armor || 0;\n    \n    const autopilotBonus = (this.item.system as any).autopilotBonus || 0;\n    const speedBonus = (this.item.system as any).speedBonus || 0;\n    const handlingBonus = (this.item.system as any).handlingBonus || 0;\n    const armorBonus = (this.item.system as any).armorBonus || 0;\n    const isFlying = (this.item.system as any).isFlying || false;\n    const isFixed = (this.item.system as any).isFixed || false;\n    \n    // Calculate final values\n    const finalAutopilot = Math.min(12, baseAutopilot + autopilotBonus);\n    const finalHandling = baseHandling + handlingBonus;\n    const finalSpeed = isFixed ? 0 : (baseSpeed + speedBonus);\n    const finalFlyingSpeed = isFlying ? (baseFlyingSpeed > 0 ? baseFlyingSpeed : 1) : 0;\n    const finalArmor = Math.min(baseStructure, baseArmor + armorBonus);\n    \n    return {\n      autopilot: finalAutopilot,\n      structure: baseStructure,\n      handling: finalHandling,\n      speed: finalSpeed,\n      flyingSpeed: finalFlyingSpeed,\n      armor: finalArmor\n    };\n  }\n\n\n  /**\n   * Handle damage value bonus checkbox changes\n   */\n  private _onDamageValueBonusChange(event: Event): void {\n    event.preventDefault();\n    \n    const checkbox = event.currentTarget as HTMLInputElement;\n    const value = parseInt(checkbox.dataset.bonusValue || '0');\n    const currentBonus = (this.item.system as any).damageValueBonus || 0;\n    \n    let newBonus: number;\n    \n    if (checkbox.checked) {\n      // If checking, set to the checkbox value\n      newBonus = value;\n    } else {\n      // If unchecking, decrease appropriately\n      if (value === 2 && currentBonus === 2) {\n        newBonus = 1;\n      } else if (value === 1 && currentBonus >= 1) {\n        newBonus = 0;\n      } else {\n        newBonus = currentBonus;\n      }\n    }\n    \n    // Update the hidden input field\n    const hiddenInput = this.element.find('input[name=\"system.damageValueBonus\"]')[0] as HTMLInputElement;\n    if (hiddenInput) {\n      hiddenInput.value = newBonus.toString();\n    }\n    \n    // Update the checkboxes state\n    const checkboxes = this.element.find('.damage-bonus-checkbox');\n    checkboxes.each((_, cb) => {\n      const cbElement = cb as HTMLInputElement;\n      const cbValue = parseInt(cbElement.dataset.bonusValue || '0');\n      if (cbValue === 1) {\n        cbElement.checked = newBonus >= 1;\n      } else if (cbValue === 2) {\n        cbElement.checked = newBonus === 2;\n      }\n    });\n  }\n\n  /**\n   * Handle sustained spell checkbox changes\n   */\n  private _onSustainedSpellChange(event: Event): void {\n    event.preventDefault();\n    \n    const checkbox = event.currentTarget as HTMLInputElement;\n    const value = parseInt(checkbox.dataset.spellValue || '0');\n    const currentCount = (this.item.system as any).sustainedSpellCount || 0;\n    \n    let newCount: number;\n    \n    if (checkbox.checked) {\n      // If checking, set to the checkbox value\n      newCount = value;\n    } else {\n      // If unchecking, decrease appropriately\n      if (value === 2 && currentCount === 2) {\n        newCount = 1;\n      } else if (value === 1 && currentCount >= 1) {\n        newCount = 0;\n      } else {\n        newCount = currentCount;\n      }\n    }\n    \n    // Update the hidden input field\n    const hiddenInput = this.element.find('input[name=\"system.sustainedSpellCount\"]')[0] as HTMLInputElement;\n    if (hiddenInput) {\n      hiddenInput.value = newCount.toString();\n    }\n    \n    // Update the checkboxes state\n    const checkboxes = this.element.find('.sustained-spell-checkbox');\n    checkboxes.each((_, cb) => {\n      const cbElement = cb as HTMLInputElement;\n      const cbValue = parseInt(cbElement.dataset.spellValue || '0');\n      if (cbValue === 1) {\n        cbElement.checked = newCount >= 1;\n      } else if (cbValue === 2) {\n        cbElement.checked = newCount === 2;\n      }\n    });\n  }\n\n  /**\n   * Handle summoned spirit checkbox change\n   */\n  private _onSummonedSpiritChange(event: Event): void {\n    event.preventDefault();\n    \n    const checkbox = event.currentTarget as HTMLInputElement;\n    const newCount = checkbox.checked ? 1 : 0;\n    \n    // Update the hidden input field\n    const hiddenInput = this.element.find('input[name=\"system.summonedSpiritCount\"]')[0] as HTMLInputElement;\n    if (hiddenInput) {\n      hiddenInput.value = newCount.toString();\n    }\n  }\n\n  /**\n   * Handle range improvement checkbox change\n   * When checked, automatically improves the range: none -> disadvantage, disadvantage -> ok\n   * When unchecked, automatically downgrades the range: ok -> disadvantage, disadvantage -> none\n   */\n  private _onRangeImprovementChange(event: Event): void {\n    event.preventDefault();\n    \n    const checkbox = event.currentTarget as HTMLInputElement;\n    const isChecked = checkbox.checked;\n    \n    // Find which range this checkbox is for\n    const rangeRow = checkbox.closest('.range-row');\n    if (!rangeRow) return;\n    \n    const select = rangeRow.querySelector('select') as HTMLSelectElement;\n    if (!select) return;\n    \n    // Determine which range field we're dealing with\n    const rangeLabel = rangeRow.querySelector('.range-label')?.textContent || '';\n    let fieldName = '';\n    if (rangeLabel.includes('Contact') || rangeLabel.includes('Melee') || rangeLabel.includes('Mêlée')) {\n      fieldName = 'system.meleeRange';\n    } else if (rangeLabel.includes('Courte') || rangeLabel.includes('Short')) {\n      fieldName = 'system.shortRange';\n    } else if (rangeLabel.includes('Moyenne') || rangeLabel.includes('Medium')) {\n      fieldName = 'system.mediumRange';\n    } else if (rangeLabel.includes('Longue') || rangeLabel.includes('Long')) {\n      fieldName = 'system.longRange';\n    }\n    \n    const currentValue = select.value;\n    let newValue = currentValue;\n    \n    if (isChecked) {\n      // Improve the range: none -> disadvantage, disadvantage -> ok\n      if (currentValue === 'none') {\n        newValue = 'disadvantage';\n      } else if (currentValue === 'disadvantage') {\n        newValue = 'ok';\n      }\n      // If already 'ok', keep it at 'ok'\n    } else {\n      // Downgrade the range: ok -> disadvantage, disadvantage -> none\n      if (currentValue === 'ok') {\n        newValue = 'disadvantage';\n      } else if (currentValue === 'disadvantage') {\n        newValue = 'none';\n      }\n      // If already 'none', keep it at 'none'\n    }\n    \n    // Update the disabled select for visual display\n    select.value = newValue;\n    \n    // Update the hidden input that holds the actual value\n    const hiddenInput = this.element.find(`input[name=\"${fieldName}\"]`)[0] as HTMLInputElement;\n    if (hiddenInput) {\n      hiddenInput.value = newValue;\n    }\n  }\n\n  /**\n   * Handle RR target search input\n   */\n  private rrTargetSearchTimeout: any = null;\n  \n  private async _onRRTargetSearch(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const searchTerm = ItemSearch.normalizeSearchText(input.value.trim());\n    const rrIndex = parseInt(input.dataset.rrIndex || '0');\n    const resultsDiv = $(input).siblings('.rr-target-search-results')[0] as HTMLElement;\n    \n    // Clear previous timeout\n    if (this.rrTargetSearchTimeout) {\n      clearTimeout(this.rrTargetSearchTimeout);\n    }\n    \n    // If search term is empty, hide results\n    if (searchTerm.length === 0) {\n      resultsDiv.style.display = 'none';\n      return;\n    }\n    \n    // Debounce search\n    this.rrTargetSearchTimeout = setTimeout(async () => {\n      await this._performRRTargetSearch(searchTerm, rrIndex, resultsDiv);\n    }, 300);\n  }\n\n  /**\n   * Perform the actual RR target search in actor items and compendiums\n   */\n  private async _performRRTargetSearch(searchTerm: string, rrIndex: number, resultsDiv: HTMLElement): Promise<void> {\n    const results: any[] = [];\n    const rrList = (this.item.system as any).rrList || [];\n    const rrType = rrList[rrIndex]?.rrType;\n    \n    if (!rrType || rrType === 'attribute') {\n      resultsDiv.style.display = 'none';\n      return;\n    }\n    \n    // Search in actor items if this feat is on an actor\n    if (this.item.actor) {\n      for (const item of this.item.actor.items as any) {\n        if (item.type === rrType && ItemSearch.normalizeSearchText(item.name).includes(searchTerm)) {\n          results.push({\n            name: item.name,\n            uuid: item.uuid,\n            source: game.i18n!.localize('SRA2.FEATS.FROM_ACTOR'),\n            type: rrType\n          });\n        }\n      }\n    }\n    \n    // Search in world items\n    if (game.items) {\n      for (const item of game.items as any) {\n        if (item.type === rrType && ItemSearch.normalizeSearchText(item.name).includes(searchTerm)) {\n          // Check if not already in results\n          const exists = results.some(r => r.name === item.name);\n          if (!exists) {\n            results.push({\n              name: item.name,\n              uuid: item.uuid,\n              source: game.i18n!.localize('SRA2.SKILLS.WORLD_ITEMS'),\n              type: rrType\n            });\n          }\n        }\n      }\n    }\n    \n    // Search in all compendiums\n    for (const pack of game.packs as any) {\n      // Only search in Item compendiums\n      if (pack.documentName !== 'Item') continue;\n      \n      // Get all documents from the pack\n      const documents = await pack.getDocuments();\n      \n      // Filter for items that match the search term and type\n      for (const doc of documents) {\n        if (doc.type === rrType && ItemSearch.normalizeSearchText(doc.name).includes(searchTerm)) {\n          // Check if not already in results\n          const exists = results.some(r => r.name === doc.name);\n          if (!exists) {\n            results.push({\n              name: doc.name,\n              uuid: doc.uuid,\n              source: pack.title,\n              type: rrType\n            });\n          }\n        }\n      }\n    }\n    \n    // Display results\n    this._displayRRTargetSearchResults(results, rrIndex, resultsDiv);\n  }\n\n  /**\n   * Display RR target search results\n   */\n  private _displayRRTargetSearchResults(results: any[], rrIndex: number, resultsDiv: HTMLElement): void {\n    let html = '';\n    \n    if (results.length === 0) {\n      html = `\n        <div class=\"search-result-item no-results\">\n          <div class=\"no-results-text\">\n            ${game.i18n!.localize('SRA2.SKILLS.SEARCH_NO_RESULTS')}\n          </div>\n        </div>\n      `;\n    } else {\n      // Display search results\n      for (const result of results) {\n        const typeLabel = result.type === 'skill' \n          ? game.i18n!.localize('SRA2.FEATS.RR_TYPE.SKILL')\n          : game.i18n!.localize('SRA2.FEATS.RR_TYPE.SPECIALIZATION');\n        \n        html += `\n          <div class=\"search-result-item\" data-result-name=\"${result.name}\" data-rr-index=\"${rrIndex}\">\n            <div class=\"result-info\">\n              <span class=\"result-name\">${result.name}</span>\n              <span class=\"result-pack\">${result.source} - ${typeLabel}</span>\n            </div>\n            <button class=\"add-rr-target-btn\" data-target-name=\"${result.name}\" data-rr-index=\"${rrIndex}\">\n              ${game.i18n!.localize('SRA2.FEATS.SELECT')}\n            </button>\n          </div>\n        `;\n      }\n    }\n    \n    resultsDiv.innerHTML = html;\n    resultsDiv.style.display = 'block';\n    \n    // Attach click handlers to buttons\n    $(resultsDiv).find('.add-rr-target-btn').on('click', this._onSelectRRTarget.bind(this));\n    \n    // Make entire result items clickable\n    $(resultsDiv).find('.search-result-item:not(.no-results)').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.add-rr-target-btn').length > 0) return;\n      \n      // Find the button in this item and trigger its click\n      const button = $(event.currentTarget).find('.add-rr-target-btn')[0] as HTMLButtonElement;\n      if (button) {\n        $(button).trigger('click');\n      }\n    });\n  }\n\n  /**\n   * Handle selecting an RR target from search results\n   */\n  private async _onSelectRRTarget(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const targetName = button.dataset.targetName;\n    const rrIndex = parseInt(button.dataset.rrIndex || '0');\n    \n    if (!targetName) return;\n    \n    const rrList = [...((this.item.system as any).rrList || [])];\n    \n    if (rrList[rrIndex]) {\n      rrList[rrIndex] = { ...rrList[rrIndex], rrTarget: targetName };\n    }\n    \n    await this.item.update({ 'system.rrList': rrList } as any);\n    this.render(false);\n    \n    ui.notifications?.info(game.i18n!.format('SRA2.FEATS.LINKED_TO_TARGET', { name: targetName }));\n  }\n\n  /**\n   * Handle RR target search focus\n   */\n  private _onRRTargetSearchFocus(event: Event): void {\n    const input = event.currentTarget as HTMLInputElement;\n    \n    // If there's already content and results, show them\n    if (input.value.trim().length > 0) {\n      const resultsDiv = $(input).siblings('.rr-target-search-results')[0] as HTMLElement;\n      if (resultsDiv && resultsDiv.innerHTML.trim().length > 0) {\n        resultsDiv.style.display = 'block';\n      }\n    }\n  }\n\n  /**\n   * Handle RR target search blur\n   */\n  private _onRRTargetSearchBlur(event: Event): void {\n    const input = event.currentTarget as HTMLInputElement;\n    const blurEvent = event as FocusEvent;\n    \n    // Check if the new focus target is within the results div\n    setTimeout(() => {\n      const resultsDiv = $(input).siblings('.rr-target-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        // Check if the related target (where focus is going) is inside the results div\n        const relatedTarget = blurEvent.relatedTarget as HTMLElement;\n        if (relatedTarget && resultsDiv.contains(relatedTarget)) {\n          // Don't hide if focus is moving to an element within the results\n          return;\n        }\n        \n        // Also check if any element in the results is focused\n        const activeElement = document.activeElement as HTMLElement;\n        if (activeElement && resultsDiv.contains(activeElement)) {\n          // Don't hide if an element in results is active\n          return;\n        }\n        \n        resultsDiv.style.display = 'none';\n      }\n    }, 200);\n  }\n\n  override async close(options?: Application.CloseOptions): Promise<void> {\n    // Clean up document-level event listeners\n    $(document).off('click.rr-target-search');\n    return super.close(options);\n  }\n\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = foundry.utils.expandObject(formData) as any;\n    \n    // Check if isFirstFeat is being set to true for a trait\n    if (expandedData.system?.isFirstFeat === true && \n        expandedData.system?.featType === 'trait' && \n        this.item.actor) {\n      \n      // Find all other traits on the same actor that have isFirstFeat = true\n      const otherFirstFeats = this.item.actor.items.filter((item: any) => \n        item.type === 'feat' &&\n        item.id !== this.item.id &&\n        item.system?.featType === 'trait' &&\n        item.system?.isFirstFeat === true\n      );\n      \n      // If there are other traits with isFirstFeat, uncheck them\n      if (otherFirstFeats.length > 0) {\n        for (const otherFeat of otherFirstFeats) {\n          await otherFeat.update({\n            'system.isFirstFeat': false\n          } as any);\n        }\n        \n        ui.notifications?.info(\n          game.i18n!.localize('SRA2.FEATS.FIRST_FEAT_TRANSFERRED') || \n          'The \"first trait\" flag has been moved from the other trait(s) to this one.'\n        );\n      }\n    }\n    \n    // Update the item first to recalculate recommendedLevel\n    await this.item.update(expandedData);\n    \n    // Recalculate derived data to get the new recommendedLevel\n    this.item.prepareData();\n    \n    // Sync rating with recommendedLevel\n    const recommendedLevel = (this.item.system as any).recommendedLevel || 0;\n    const currentRating = (this.item.system as any).rating || 0;\n    \n    // Only update rating if it's different from recommendedLevel\n    if (currentRating !== recommendedLevel) {\n      await this.item.update({\n        'system.rating': recommendedLevel\n      } as any);\n    }\n    \n    return this.item;\n  }\n}\n\n","/**\n * Skill Sheet Application\n */\nexport class SkillSheet extends ItemSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Item> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'item', 'skill'],\n      template: 'systems/sra2/templates/item-skill-sheet.hbs',\n      width: 520,\n      height: 480,\n      tabs: [],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n    context.system = this.item.system;\n    return context;\n  }\n\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = foundry.utils.expandObject(formData);\n    return this.item.update(expandedData);\n  }\n}\n\n","import * as ItemSearch from '../helpers/item-search.js';\n\n/**\n * Specialization Sheet Application\n */\nexport class SpecializationSheet extends ItemSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Item> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'item', 'specialization'],\n      template: 'systems/sra2/templates/item-specialization-sheet.hbs',\n      width: 520,\n      height: 480,\n      tabs: [],\n      dragDrop: [\n        { dropSelector: '.linked-skill-drop-zone' }\n      ],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n    context.system = this.item.system;\n    \n    // Get linked skill info if exists\n    if (context.system.linkedSkill) {\n      // linkedSkill is stored as a name, so we display it directly\n      context.linkedSkillName = context.system.linkedSkill;\n      \n      // If the specialization is on an actor, check if the skill exists\n      if (this.item.actor) {\n        const linkedSkill = this.item.actor.items.find((i: any) => \n          i.type === 'skill' && i.name === context.system.linkedSkill\n        );\n        \n        if (!linkedSkill) {\n          // Mark as warning if skill doesn't exist on this actor\n          context.linkedSkillNotFound = true;\n        }\n      }\n    }\n    \n    // Get list of skills from the actor if this item is owned (for dropdown)\n    if (this.item.actor) {\n      const skills = this.item.actor.items.filter((i: any) => i.type === 'skill');\n      context.skills = skills.map((s: any) => ({\n        name: s.name\n      }));\n    } else {\n      context.skills = [];\n    }\n    \n    return context;\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n    \n    // Clear linked skill button\n    html.find('[data-action=\"clear-linked-skill\"]').on('click', this._onClearLinkedSkill.bind(this));\n    \n    // Skill search\n    html.find('.skill-search-input').on('input', this._onSkillSearch.bind(this));\n    html.find('.skill-search-input').on('focus', this._onSkillSearchFocus.bind(this));\n    html.find('.skill-search-input').on('blur', this._onSkillSearchBlur.bind(this));\n    \n    // Close skill search results when clicking outside\n    $(document).on('click.skill-search-spec', (event) => {\n      const target = event.target as unknown as HTMLElement;\n      const skillSearchContainer = html.find('.skill-search-container')[0] as HTMLElement;\n      if (skillSearchContainer && !skillSearchContainer.contains(target)) {\n        html.find('.skill-search-results').hide();\n      }\n    });\n  }\n\n  override async close(options?: Application.CloseOptions): Promise<void> {\n    // Clean up document-level event listeners\n    $(document).off('click.skill-search-spec');\n    return super.close(options);\n  }\n\n  /**\n   * Handle clearing the linked skill\n   */\n  private async _onClearLinkedSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    await this.item.update({ 'system.linkedSkill': '' } as any);\n    this.render(false);\n  }\n\n  /**\n   * Handle dropping a skill onto the linked skill field\n   */\n  protected override async _onDrop(event: DragEvent): Promise<any> {\n    const data = TextEditor.getDragEventData(event) as any;\n    \n    // Handle Item drops\n    if (data && data.type === 'Item') {\n      const item = await Item.implementation.fromDropData(data) as any;\n      \n      if (!item) return super._onDrop(event);\n      \n      // Check if it's a skill\n      if (item.type === 'skill') {\n        // Store the skill name (not ID) so the specialization can be prepared in advance\n        await this.item.update({ 'system.linkedSkill': item.name } as any);\n        this.render(false);\n        ui.notifications?.info(game.i18n!.format('SRA2.SPECIALIZATIONS.LINKED_TO_SKILL', { name: item.name }));\n        return;\n      } else {\n        ui.notifications?.warn(game.i18n!.localize('SRA2.SPECIALIZATIONS.ONLY_SKILLS_CAN_BE_LINKED'));\n        return;\n      }\n    }\n\n    return super._onDrop(event);\n  }\n\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = foundry.utils.expandObject(formData);\n    return this.item.update(expandedData);\n  }\n\n  /**\n   * SKILL SEARCH FUNCTIONS\n   */\n  \n  private skillSearchTimeout: any = null;\n  private lastSkillSearchTerm: string = '';\n  \n  /**\n   * Handle skill search input\n   */\n  private async _onSkillSearch(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const searchTerm = ItemSearch.normalizeSearchText(input.value.trim());\n    const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n    \n    // Clear previous timeout\n    if (this.skillSearchTimeout) {\n      clearTimeout(this.skillSearchTimeout);\n    }\n    \n    // If search term is empty, hide results\n    if (searchTerm.length === 0) {\n      resultsDiv.style.display = 'none';\n      return;\n    }\n    \n    // Debounce search\n    this.skillSearchTimeout = setTimeout(async () => {\n      await this._performSkillSearch(searchTerm, resultsDiv);\n    }, 300);\n  }\n\n  /**\n   * Perform the actual skill search in compendiums and world items\n   */\n  private async _performSkillSearch(searchTerm: string, resultsDiv: HTMLElement): Promise<void> {\n    const results: any[] = [];\n    \n    // Store search term for potential creation\n    this.lastSkillSearchTerm = searchTerm;\n    \n    // Search in world items first\n    if (game.items) {\n      for (const item of game.items as any) {\n        if (item.type === 'skill' && ItemSearch.normalizeSearchText(item.name).includes(searchTerm)) {\n          results.push({\n            name: item.name,\n            uuid: item.uuid,\n            pack: game.i18n!.localize('SRA2.SPECIALIZATIONS.WORLD_ITEMS'),\n            linkedAttribute: item.system.linkedAttribute,\n            isWorldItem: true\n          });\n        }\n      }\n    }\n    \n    // Search in all compendiums\n    for (const pack of game.packs as any) {\n      // Only search in Item compendiums\n      if (pack.documentName !== 'Item') continue;\n      \n      // Get all documents from the pack\n      const documents = await pack.getDocuments();\n      \n      // Filter for skills that match the search term\n      for (const doc of documents) {\n        if (doc.type === 'skill' && ItemSearch.normalizeSearchText(doc.name).includes(searchTerm)) {\n          results.push({\n            name: doc.name,\n            uuid: doc.uuid,\n            pack: pack.title,\n            linkedAttribute: doc.system.linkedAttribute,\n            isWorldItem: false\n          });\n        }\n      }\n    }\n    \n    // Display results\n    this._displaySkillSearchResults(results, resultsDiv);\n  }\n\n  /**\n   * Display skill search results\n   */\n  private _displaySkillSearchResults(results: any[], resultsDiv: HTMLElement): Promise<void> {\n    // Check if exact match exists\n    const formattedSearchTerm = this.lastSkillSearchTerm\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    const exactMatch = results.find((r: any) => \n      ItemSearch.normalizeSearchText(r.name) === ItemSearch.normalizeSearchText(this.lastSkillSearchTerm)\n    );\n    \n    let html = '';\n    \n    // If no results at all, show only the create button with message\n    if (results.length === 0) {\n      html = `\n        <div class=\"search-result-item no-results-create\">\n          <div class=\"no-results-text\">\n            ${game.i18n!.localize('SRA2.SPECIALIZATIONS.SEARCH_NO_RESULTS')}\n          </div>\n          <button class=\"create-skill-btn\" data-skill-name=\"${this.lastSkillSearchTerm}\">\n            <i class=\"fas fa-plus\"></i> ${game.i18n!.localize('SRA2.SPECIALIZATIONS.CREATE_SKILL')}\n          </button>\n        </div>\n      `;\n    } else {\n      // Display search results\n      for (const result of results) {\n        const attributeLabel = game.i18n!.localize(`SRA2.ATTRIBUTES.${result.linkedAttribute.toUpperCase()}`);\n        \n        html += `\n          <div class=\"search-result-item\">\n            <div class=\"result-info\">\n              <span class=\"result-name\">${result.name}</span>\n              <span class=\"result-pack\">${result.pack} - ${attributeLabel}</span>\n            </div>\n            <button class=\"link-skill-btn\" data-skill-name=\"${result.name}\">\n              ${game.i18n!.localize('SRA2.SPECIALIZATIONS.LINK_SKILL')}\n            </button>\n          </div>\n        `;\n      }\n      \n      // Add create button if exact match doesn't exist\n      if (!exactMatch) {\n        html += `\n          <div class=\"search-result-item create-new-item\">\n            <div class=\"result-info\">\n              <span class=\"result-name\"><i class=\"fas fa-plus-circle\"></i> ${formattedSearchTerm}</span>\n              <span class=\"result-pack\">${game.i18n!.localize('SRA2.SPECIALIZATIONS.CREATE_NEW_SKILL')}</span>\n            </div>\n            <button class=\"create-skill-btn-inline\" data-skill-name=\"${this.lastSkillSearchTerm}\">\n              ${game.i18n!.localize('SRA2.SPECIALIZATIONS.CREATE_SKILL')}\n            </button>\n          </div>\n        `;\n      }\n    }\n    \n    resultsDiv.innerHTML = html;\n    resultsDiv.style.display = 'block';\n    \n    // Attach click handlers\n    $(resultsDiv).find('.link-skill-btn').on('click', this._onLinkSkillFromSearch.bind(this));\n    $(resultsDiv).find('.create-skill-btn, .create-skill-btn-inline').on('click', this._onCreateNewSkill.bind(this));\n    \n    // Make entire result items clickable (except create button)\n    $(resultsDiv).find('.search-result-item:not(.no-results-create):not(.create-new-item)').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.link-skill-btn').length > 0) return;\n      \n      // Find the button in this item and trigger its click\n      const button = $(event.currentTarget).find('.link-skill-btn')[0];\n      if (button) {\n        $(button).trigger('click');\n      }\n    });\n    \n    // Make create items clickable on the entire row\n    $(resultsDiv).find('.search-result-item.create-new-item').on('click', (event) => {\n      // Don't trigger if clicking directly on the button\n      if ($(event.target).closest('.create-skill-btn-inline').length > 0) return;\n      \n      // Find the button and trigger its click\n      const button = $(event.currentTarget).find('.create-skill-btn-inline')[0];\n      if (button) {\n        $(button).trigger('click');\n      }\n    });\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle linking a skill from search results\n   */\n  private async _onLinkSkillFromSearch(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const skillName = button.dataset.skillName;\n    \n    if (!skillName) return;\n    \n    // Link the skill to the specialization\n    await this.item.update({ 'system.linkedSkill': skillName } as any);\n    \n    // Clear the search input and hide results\n    const searchInput = this.element.find('.skill-search-input')[0] as HTMLInputElement;\n    if (searchInput) {\n      searchInput.value = '';\n    }\n    \n    const resultsDiv = this.element.find('.skill-search-results')[0] as HTMLElement;\n    if (resultsDiv) {\n      resultsDiv.style.display = 'none';\n    }\n    \n    this.render(false);\n    ui.notifications?.info(game.i18n!.format('SRA2.SPECIALIZATIONS.SKILL_LINKED', { name: skillName }));\n  }\n\n  /**\n   * Handle skill search focus\n   */\n  private _onSkillSearchFocus(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    \n    // If there's already content and results, show them\n    if (input.value.trim().length > 0) {\n      const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv && resultsDiv.innerHTML.trim().length > 0) {\n        resultsDiv.style.display = 'block';\n      }\n    }\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle skill search blur\n   */\n  private _onSkillSearchBlur(event: Event): Promise<void> {\n    const input = event.currentTarget as HTMLInputElement;\n    const blurEvent = event as FocusEvent;\n    \n    // Check if the new focus target is within the results div\n    setTimeout(() => {\n      const resultsDiv = $(input).siblings('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        // Check if the related target (where focus is going) is inside the results div\n        const relatedTarget = blurEvent.relatedTarget as HTMLElement;\n        if (relatedTarget && resultsDiv.contains(relatedTarget)) {\n          // Don't hide if focus is moving to an element within the results\n          return;\n        }\n        \n        // Also check if any element in the results is focused\n        const activeElement = document.activeElement as HTMLElement;\n        if (activeElement && resultsDiv.contains(activeElement)) {\n          // Don't hide if an element in results is active\n          return;\n        }\n        \n        resultsDiv.style.display = 'none';\n      }\n    }, 200);\n    \n    return Promise.resolve();\n  }\n\n  /**\n   * Handle creating a new skill from search and linking it\n   */\n  private async _onCreateNewSkill(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    \n    const button = event.currentTarget as HTMLButtonElement;\n    const skillName = button.dataset.skillName;\n    \n    if (!skillName) return;\n    \n    // Capitalize first letter of each word\n    const formattedName = skillName\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    // Create the new skill as a world item with default values\n    const skillData = {\n      name: formattedName,\n      type: 'skill',\n      system: {\n        rating: 1,\n        linkedAttribute: 'strength',\n        description: ''\n      }\n    } as any;\n    \n    // Create as a world item\n    const createdItems = await Item.create(skillData) as any;\n    \n    if (createdItems) {\n      // Link the skill to the specialization\n      await this.item.update({ 'system.linkedSkill': formattedName } as any);\n      \n      // Clear the search input and hide results\n      const searchInput = this.element.find('.skill-search-input')[0] as HTMLInputElement;\n      if (searchInput) {\n        searchInput.value = '';\n      }\n      \n      const resultsDiv = this.element.find('.skill-search-results')[0] as HTMLElement;\n      if (resultsDiv) {\n        resultsDiv.style.display = 'none';\n      }\n      \n      this.render(false);\n      \n      // Open the skill sheet for editing\n      setTimeout(() => {\n        if (createdItems.sheet) {\n          createdItems.sheet.render(true);\n        }\n      }, 100);\n      \n      ui.notifications?.info(game.i18n!.format('SRA2.SPECIALIZATIONS.SKILL_CREATED_AND_LINKED', { name: formattedName }));\n    }\n  }\n}\n\n","/**\n * Metatype Sheet Application\n */\nexport class MetatypeSheet extends ItemSheet {\n  static override get defaultOptions(): DocumentSheet.Options<Item> {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'sheet', 'item', 'metatype'],\n      template: 'systems/sra2/templates/item-metatype-sheet.hbs',\n      width: 520,\n      height: 580,\n      tabs: [],\n      submitOnChange: true,\n    });\n  }\n\n  override getData(): any {\n    const context = super.getData() as any;\n    context.system = this.item.system;\n    return context;\n  }\n\n  protected override async _updateObject(_event: Event, formData: any): Promise<any> {\n    const expandedData = foundry.utils.expandObject(formData);\n    return this.item.update(expandedData);\n  }\n}\n\n","import { RollRequestData } from '../helpers/dice-roller.js';\nimport * as SheetHelpers from '../helpers/sheet-helpers.js';\n\n/**\n * Roll Dialog Application\n * Displays roll information in a popup dialog\n */\nexport class RollDialog extends Application {\n  private rollData: RollRequestData;\n  private actor: any = null;\n  private targetToken: any = null;\n  private rrEnabled: Map<string, boolean> = new Map(); // Track which RR sources are enabled\n\n  constructor(rollData: RollRequestData) {\n    super();\n    this.rollData = rollData;\n    \n    // Get actor from roll data\n    if (rollData.actorUuid) {\n      this.actor = fromUuidSync(rollData.actorUuid);\n    } else if (rollData.actorId) {\n      this.actor = game.actors?.get(rollData.actorId) || null;\n    }\n    \n    // Get target token (first targeted token)\n    const targets = Array.from(game.user?.targets || []);\n    if (targets.length > 0) {\n      this.targetToken = targets[0] || null;\n    }\n  }\n\n  static override get defaultOptions(): any {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['sra2', 'roll-dialog'],\n      template: 'systems/sra2/templates/roll-dialog.hbs',\n      width: 450,\n      height: 450,\n      resizable: true,\n      minimizable: false,\n      title: 'Jet de Dés'\n    });\n  }\n\n  override getData(): any {\n    const context: any = {\n      rollData: this.rollData,\n      actor: this.actor,\n      targetToken: this.targetToken\n    };\n\n    // Calculate dice pool\n    let dicePool = 0;\n    if (this.rollData.specLevel !== undefined) {\n      dicePool = this.rollData.specLevel;\n    } else if (this.rollData.skillLevel !== undefined) {\n      dicePool = this.rollData.skillLevel;\n    } else if (this.rollData.linkedAttribute) {\n      const attributeValue = (this.actor?.system as any)?.attributes?.[this.rollData.linkedAttribute] || 0;\n      dicePool = attributeValue;\n    }\n    context.dicePool = dicePool;\n\n    let threshold = this.rollData.threshold;\n    context.threshold = threshold;\n    context.hasThreshold = threshold !== undefined;\n\n    // Get skill/spec name\n    context.skillDisplayName = this.rollData.specName || this.rollData.skillName || this.rollData.linkedAttackSkill || 'Aucune';\n\n    // Calculate total RR and get RR sources\n    // rrList already contains RRSource objects with featName and rrValue (enriched before passing to handleRollRequest)\n    let totalRR = 0;\n    const rrSources: any[] = [];\n    if (this.rollData.rrList && Array.isArray(this.rollData.rrList)) {\n      for (const rrSource of this.rollData.rrList) {\n        if (rrSource && typeof rrSource === 'object') {\n          const rrValue = rrSource.rrValue || 0;\n          if (rrValue > 0) {\n            // featName is now always present in rrList (enriched in character-sheet.ts and npc-sheet.ts)\n            const featName = rrSource.featName || 'Inconnu';\n            const rrId = `${featName}-${rrValue}`;\n            \n            // Initialize as enabled if not already set\n            if (!this.rrEnabled.has(rrId)) {\n              this.rrEnabled.set(rrId, true);\n            }\n            \n            const isEnabled = this.rrEnabled.get(rrId) || false;\n            \n            rrSources.push({\n              id: rrId,\n              featName: featName,\n              rrValue: rrValue,\n              enabled: isEnabled\n            });\n            \n            if (isEnabled) {\n              totalRR += rrValue;\n            }\n          }\n        }\n      }\n    }\n    context.totalRR = Math.min(3, totalRR); // RR is capped at 3\n    context.rrSources = rrSources;\n\n    // Get VD (Valeur de Défense) - this would be from the target or weapon\n    // For now, we'll show weapon VD if available\n    context.vd = this.rollData.damageValue || 0;\n\n    // Get all skills and specializations from actor, organized hierarchically\n    if (this.actor) {\n      const skills = this.actor.items\n        .filter((item: any) => item.type === 'skill')\n        .map((skill: any) => {\n          const linkedAttribute = skill.system?.linkedAttribute || 'strength';\n          const attributeValue = (this.actor?.system as any)?.attributes?.[linkedAttribute] || 0;\n          const skillRating = skill.system?.rating || 0;\n          return {\n            id: skill.id,\n            name: skill.name,\n            rating: skillRating,\n            linkedAttribute: linkedAttribute,\n            dicePool: attributeValue + skillRating,\n            type: 'skill',\n            specializations: [] as any[]\n          };\n        })\n        .sort((a: any, b: any) => a.name.localeCompare(b.name));\n\n      // Get all specializations and group them under their parent skills\n      const allSpecializations = this.actor.items\n        .filter((item: any) => item.type === 'specialization')\n        .map((spec: any) => {\n          const linkedAttribute = spec.system?.linkedAttribute || 'strength';\n          const linkedSkillName = spec.system?.linkedSkill;\n          const attributeValue = (this.actor?.system as any)?.attributes?.[linkedAttribute] || 0;\n          \n          // Find parent skill\n          const parentSkill = this.actor!.items.find((i: any) => \n            i.type === 'skill' && i.name === linkedSkillName\n          );\n          const skillRating = parentSkill ? (parentSkill.system as any).rating || 0 : 0;\n          const effectiveRating = skillRating + 2; // +2 from specialization\n          \n          return {\n            id: spec.id,\n            name: spec.name,\n            rating: effectiveRating,\n            linkedAttribute: linkedAttribute,\n            dicePool: attributeValue + effectiveRating,\n            type: 'specialization',\n            linkedSkillName: linkedSkillName\n          };\n        });\n\n      // Group specializations under their parent skills\n      for (const spec of allSpecializations) {\n        const parentSkill = skills.find((s: any) => s.name === spec.linkedSkillName);\n        if (parentSkill) {\n          parentSkill.specializations.push(spec);\n        }\n      }\n\n      // Sort specializations within each skill\n      for (const skill of skills) {\n        skill.specializations.sort((a: any, b: any) => a.name.localeCompare(b.name));\n      }\n\n      // Create flat list for dropdown (skill first, then its specializations)\n      const dropdownOptions: any[] = [];\n      for (const skill of skills) {\n        // Add skill option\n        const skillSelected = skill.name === this.rollData.skillName || \n                             (this.rollData.linkedAttackSkill && skill.name === this.rollData.linkedAttackSkill);\n        dropdownOptions.push({\n          value: `skill:${skill.id}`,\n          label: `${skill.name} (${skill.dicePool} dés)`,\n          type: 'skill',\n          id: skill.id,\n          name: skill.name,\n          dicePool: skill.dicePool,\n          linkedAttribute: skill.linkedAttribute,\n          rating: skill.rating,\n          isSelected: skillSelected && !this.rollData.specName\n        });\n\n        // Add specializations under this skill\n        for (const spec of skill.specializations) {\n          const specSelected = spec.name === this.rollData.specName ||\n                              (this.rollData.linkedAttackSpecialization && spec.name === this.rollData.linkedAttackSpecialization);\n          dropdownOptions.push({\n            value: `spec:${spec.id}`,\n            label: `  └ ${spec.name} (${spec.dicePool} dés)`,\n            type: 'specialization',\n            id: spec.id,\n            name: spec.name,\n            dicePool: spec.dicePool,\n            linkedAttribute: spec.linkedAttribute,\n            linkedSkillName: spec.linkedSkillName,\n            rating: spec.rating,\n            isSelected: specSelected\n          });\n        }\n      }\n\n      context.skillsWithSpecs = skills;\n      context.dropdownOptions = dropdownOptions;\n      \n      // Determine selected value for dropdown\n      if (this.rollData.specName) {\n        const selectedSpec = dropdownOptions.find((opt: any) => opt.type === 'specialization' && opt.name === this.rollData.specName);\n        context.selectedValue = selectedSpec ? selectedSpec.value : '';\n      } else if (this.rollData.skillName) {\n        const selectedSkill = dropdownOptions.find((opt: any) => opt.type === 'skill' && opt.name === this.rollData.skillName);\n        context.selectedValue = selectedSkill ? selectedSkill.value : '';\n      } else {\n        context.selectedValue = '';\n      }\n    }\n\n    return context;\n  }\n\n  override activateListeners(html: JQuery): void {\n    super.activateListeners(html);\n    \n    // Close button\n    html.find('.close-button').on('click', () => {\n      this.close();\n    });\n\n    // Skill/Spec selection dropdown (only if no threshold)\n    html.find('.skill-dropdown').on('change', (event) => {\n      const select = event.currentTarget as HTMLSelectElement;\n      \n      // Don't allow changes if threshold is set\n      if (this.rollData.threshold !== undefined) {\n        return;\n      }\n      \n      const value = select.value;\n      \n      if (!value || !this.actor) return;\n\n      const [type, id] = value.split(':');\n      if (!type || !id) return;\n\n      const item = this.actor.items.get(id);\n      if (!item) return;\n\n      if (type === 'skill') {\n        const skillSystem = item.system as any;\n        const linkedAttribute = skillSystem.linkedAttribute || 'strength';\n        const attributeValue = (this.actor.system as any).attributes?.[linkedAttribute] || 0;\n        const skillRating = skillSystem.rating || 0;\n        const dicePool = attributeValue + skillRating;\n        \n        // Update roll data\n        this.rollData.skillName = item.name;\n        this.rollData.specName = undefined;\n        this.rollData.skillLevel = dicePool;\n        this.rollData.specLevel = undefined;\n        this.rollData.linkedAttribute = linkedAttribute;\n        \n        // Recalculate RR and threshold (synchronously)\n        this.updateRRForSkill(item.name, linkedAttribute, dicePool);\n        \n        // Re-render after RR is updated\n        this.render();\n      } else if (type === 'spec') {\n        const specSystem = item.system as any;\n        const linkedAttribute = specSystem.linkedAttribute || 'strength';\n        const linkedSkillName = specSystem.linkedSkill;\n        const attributeValue = (this.actor.system as any).attributes?.[linkedAttribute] || 0;\n        \n        // Find parent skill\n        const parentSkill = this.actor.items.find((i: any) => \n          i.type === 'skill' && i.name === linkedSkillName\n        );\n        const skillRating = parentSkill ? (parentSkill.system as any).rating || 0 : 0;\n        const effectiveRating = skillRating + 2;\n        const dicePool = attributeValue + effectiveRating;\n        \n        // Update roll data\n        this.rollData.specName = item.name;\n        this.rollData.skillName = linkedSkillName;\n        this.rollData.skillLevel = skillRating;\n        this.rollData.specLevel = dicePool;\n        this.rollData.linkedAttribute = linkedAttribute;\n        \n        // Recalculate RR and threshold (synchronously)\n        this.updateRRForSpec(item.name, linkedSkillName, linkedAttribute, dicePool);\n        \n        // Re-render after RR is updated\n        this.render();\n      }\n    });\n\n    // RR checkbox toggles\n    html.find('.rr-checkbox').on('change', (event) => {\n      const checkbox = event.currentTarget as HTMLInputElement;\n      const rrId = checkbox.dataset.rrId;\n      const enabled = checkbox.checked;\n      \n      if (rrId) {\n        this.rrEnabled.set(rrId, enabled);\n        // Re-render to update total RR\n        this.render();\n      }\n    });\n\n    // Roll Dice button\n    html.find('.roll-dice-button').on('click', () => {\n      // Calculate final RR based on enabled checkboxes\n      let finalRR = 0;\n      if (this.rollData.rrList && Array.isArray(this.rollData.rrList)) {\n        for (const rrSource of this.rollData.rrList) {\n          if (rrSource && typeof rrSource === 'object') {\n            const rrValue = rrSource.rrValue || 0;\n            const featName = rrSource.featName || 'Inconnu';\n            const rrId = `${featName}-${rrValue}`;\n            \n            if (this.rrEnabled.get(rrId)) {\n              finalRR += rrValue;\n            }\n          }\n        }\n      }\n      \n      // Update roll data with final RR\n      const finalRRList = this.rollData.rrList?.filter((rr: any) => {\n        const rrId = `${rr.featName || 'Inconnu'}-${rr.rrValue || 0}`;\n        return this.rrEnabled.get(rrId);\n      }) || [];\n      \n      const updatedRollData = {\n        ...this.rollData,\n        rrList: finalRRList\n      };\n      \n      // Log the roll request (for now, until dice rolling is implemented)\n      console.log('=== ROLL DICE ===', updatedRollData);\n      \n      // Close the dialog\n      this.close();\n    });\n  }\n\n  private updateRRForSkill(skillName: string, linkedAttribute: string, dicePool: number): void {\n    if (!this.actor) return;\n    \n    // Get RR sources synchronously (already imported at top)\n    const skillRRSources = SheetHelpers.getRRSources(this.actor, 'skill', skillName);\n    const attributeRRSources = SheetHelpers.getRRSources(this.actor, 'attribute', linkedAttribute);\n    this.rollData.rrList = [...skillRRSources, ...attributeRRSources];\n    \n    // Reset RR enabled state for new sources\n    this.rrEnabled.clear();\n    for (const rrSource of this.rollData.rrList) {\n      if (rrSource && typeof rrSource === 'object') {\n        const rrValue = rrSource.rrValue || 0;\n        const featName = rrSource.featName || 'Inconnu';\n        if (rrValue > 0) {\n          const rrId = `${featName}-${rrValue}`;\n          this.rrEnabled.set(rrId, true);\n        }\n      }\n    }\n    \n    // Recalculate threshold if it was set\n    if (this.rollData.threshold !== undefined) {\n      const totalRR = Math.min(3, skillRRSources.reduce((sum: number, r: any) => sum + (r.rrValue || 0), 0) + \n                                attributeRRSources.reduce((sum: number, r: any) => sum + (r.rrValue || 0), 0));\n      this.rollData.threshold = Math.round(dicePool / 3) + totalRR + 1;\n    }\n  }\n\n  private updateRRForSpec(specName: string, skillName: string, linkedAttribute: string, dicePool: number): void {\n    if (!this.actor) return;\n    \n    // Get RR sources synchronously (already imported at top)\n    const specRRSources = SheetHelpers.getRRSources(this.actor, 'specialization', specName);\n    const skillRRSources = SheetHelpers.getRRSources(this.actor, 'skill', skillName);\n    const attributeRRSources = SheetHelpers.getRRSources(this.actor, 'attribute', linkedAttribute);\n    this.rollData.rrList = [...specRRSources, ...skillRRSources, ...attributeRRSources];\n    \n    // Reset RR enabled state for new sources\n    this.rrEnabled.clear();\n    for (const rrSource of this.rollData.rrList) {\n      if (rrSource && typeof rrSource === 'object') {\n        const rrValue = rrSource.rrValue || 0;\n        const featName = rrSource.featName || 'Inconnu';\n        if (rrValue > 0) {\n          const rrId = `${featName}-${rrValue}`;\n          this.rrEnabled.set(rrId, true);\n        }\n      }\n    }\n    \n    // Recalculate threshold if it was set\n    if (this.rollData.threshold !== undefined) {\n      const totalRR = Math.min(3, specRRSources.reduce((sum: number, r: any) => sum + (r.rrValue || 0), 0) + \n                                skillRRSources.reduce((sum: number, r: any) => sum + (r.rrValue || 0), 0) + \n                                attributeRRSources.reduce((sum: number, r: any) => sum + (r.rrValue || 0), 0));\n      this.rollData.threshold = Math.round(dicePool / 3) + totalRR + 1;\n    }\n  }\n}\n\n","export const HOOKS = {\n  MIGRATIONS: 'sra2-declareMigration',\n}","import { HOOKS } from \"../hooks.mjs\"\n\nconst CURRENT_SYSTEM_VERSION = \"currentSystemVersion\";\n\nexport class Migration {\n  get code() { return \"sample\"; }\n\n  get version() { return \"0.0.0\"; }\n\n  async migrate() { return () => { } };\n\n  async applyItemsUpdates(computeUpdates = (items) => []) {\n    await game.actors.forEach(async (actor) => {\n      const actorItemUpdates = computeUpdates(actor.items);\n      if (actorItemUpdates.length > 0) {\n        const message = game.i18n.format('SRA2.MIGRATION.APPLYING_ACTOR_ITEMS', { name: actor.name });\n        console.log(SYSTEM.LOG.HEAD, this.code, message, actorItemUpdates);\n        await actor.updateEmbeddedDocuments('Item', actorItemUpdates);\n      }\n    })\n\n    const itemUpdates = computeUpdates(game.items);\n    if (itemUpdates.length > 0) {\n      const message = game.i18n.localize('SRA2.MIGRATION.APPLYING_ITEMS');\n      console.log(SYSTEM.LOG.HEAD, this.code, message, itemUpdates);\n      await Item.updateDocuments(itemUpdates);\n    }\n  }\n}\n\nexport class Migrations {\n  constructor() {\n    // Hooks.once(HOOKS.MIGRATIONS, declareMigrations => declareMigrations(\n    //   /* add system migrations here, can declared anywhere */\n    // ))\n\n    game.settings.register(SYSTEM.id, CURRENT_SYSTEM_VERSION, {\n      name: \"SRA2.MIGRATION.SETTING_NAME\",\n      scope: \"world\",\n      config: false,\n      type: String,\n      default: \"0.0.0\"\n    })\n  }\n\n  migrate() {\n    const currentVersion = game.settings.get(SYSTEM.id, CURRENT_SYSTEM_VERSION)\n    if (foundry.utils.isNewerVersion(game.system.version, currentVersion)) {\n      //if (true) {\n      let migrations = []\n      Hooks.callAll(HOOKS.MIGRATIONS, (...list) =>\n        migrations = migrations.concat(list.filter(m => foundry.utils.isNewerVersion(m.version, currentVersion)))\n      )\n      Hooks.off(HOOKS.MIGRATIONS, () => { })\n\n      if (migrations.length > 0) {\n        migrations.sort((a, b) => foundry.utils.isNewerVersion(a.version, b.version) ? 1 : foundry.utils.isNewerVersion(b.version, a.version) ? -1 : 0)\n        migrations.forEach(async m => {\n          const message = game.i18n.format('SRA2.MIGRATION.EXECUTING', { code: m.code, currentVersion: currentVersion, targetVersion: m.version });\n          this.$notify(message);\n          await m.migrate()\n        })\n        const message = game.i18n.format('SRA2.MIGRATION.DONE', { version: game.system.version });\n        this.$notify(message)\n      }\n      else {\n        const message = game.i18n.format('SRA2.MIGRATION.NOT_NEEDED', { version: game.system.version });\n        console.log(SYSTEM.LOG.HEAD + message)\n      }\n      game.settings.set(SYSTEM.id, CURRENT_SYSTEM_VERSION, game.system.version)\n    }\n    else {\n      const message = game.i18n.localize('SRA2.MIGRATION.VERSION_UNCHANGED');\n      console.log(SYSTEM.LOG.HEAD + message)\n    }\n  }\n\n\n  $notify(message) {\n    ui.notifications.info(message);\n    console.log(SYSTEM.LOG.HEAD + message);\n  }\n}\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.3: Convert rrType, rrValue, rrTarget arrays to rrList\n * This migration transforms the three separate arrays into a single array of objects\n * where each object contains {rrType, rrValue, rrTarget}\n */\nexport class Migration_13_0_3 extends Migration {\n  get code() { \n    return \"migration-13.0.3\"; \n  }\n\n  get version() { \n    return \"13.0.3\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.3: Converting rrType/rrValue/rrTarget to rrList\");\n    \n    let totalMigrated = 0;\n    let totalSkipped = 0;\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      for (const item of items) {\n        // Only process feat items\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the raw source data which contains fields even if they're not in the schema\n        const sourceSystem = item._source?.system || item.system;\n        const system = item.system;\n        \n        // Check for old format in the source data (raw data from database)\n        const hasOldFormat = (\n          (sourceSystem.rrType !== undefined && Array.isArray(sourceSystem.rrType)) ||\n          (sourceSystem.rrValue !== undefined && Array.isArray(sourceSystem.rrValue)) ||\n          (sourceSystem.rrTarget !== undefined && Array.isArray(sourceSystem.rrTarget))\n        );\n        \n        // Check if rrList already exists with content in source\n        const hasNewFormatInSource = (\n          sourceSystem.rrList !== undefined && \n          Array.isArray(sourceSystem.rrList)\n        );\n        \n        // Skip if already migrated (has new format in source AND no old format)\n        if (hasNewFormatInSource && !hasOldFormat) {\n          console.log(SYSTEM.LOG.HEAD + `Migration 13.0.3: Skipping \"${item.name}\" - already has rrList in source (${sourceSystem.rrList.length} entries), no old data`);\n          totalSkipped++;\n          continue;\n        }\n        \n        // Skip if no old format to migrate\n        if (!hasOldFormat) {\n          console.log(SYSTEM.LOG.HEAD + `Migration 13.0.3: Skipping \"${item.name}\" - no old format fields found`);\n          totalSkipped++;\n          continue;\n        }\n        \n        // Get the arrays from source data\n        const rrType = Array.isArray(sourceSystem.rrType) ? sourceSystem.rrType : [];\n        const rrValue = Array.isArray(sourceSystem.rrValue) ? sourceSystem.rrValue : [];\n        const rrTarget = Array.isArray(sourceSystem.rrTarget) ? sourceSystem.rrTarget : [];\n        \n        console.log(SYSTEM.LOG.HEAD + `Migration 13.0.3: Found \"${item.name}\" with old format:`, {\n          rrType: rrType,\n          rrValue: rrValue,\n          rrTarget: rrTarget\n        });\n        \n        // Convert the three arrays into a single rrList array\n        const rrList = [];\n        const maxLength = Math.max(rrType.length, rrValue.length, rrTarget.length);\n        \n        for (let i = 0; i < maxLength; i++) {\n          // Only add entries where rrType exists and is not \"none\"\n          const type = rrType[i];\n          if (type && type !== 'none') {\n            rrList.push({\n              rrType: type,\n              rrValue: rrValue[i] !== undefined ? rrValue[i] : 0,\n              rrTarget: rrTarget[i] !== undefined ? rrTarget[i] : ''\n            });\n          }\n        }\n        \n        // Create the update object\n        const update = {\n          _id: item.id,\n          'system.rrList': rrList,\n          // Store backup of old data before deletion\n          'system._rrTypeBackup': rrType,\n          'system._rrValueBackup': rrValue,\n          'system._rrTargetBackup': rrTarget,\n          // Remove old fields by setting them to null (Foundry will delete them)\n          'system.rrType': null,\n          'system.rrValue': null,\n          'system.rrTarget': null\n        };\n        \n        updates.push(update);\n        totalMigrated++;\n        \n        console.log(SYSTEM.LOG.HEAD + `Migration 13.0.3: Converting feat \"${item.name}\":`);\n        console.log(SYSTEM.LOG.HEAD + `  Old data (will be deleted, backed up as _rrTypeBackup/_rrValueBackup/_rrTargetBackup):`, { rrType, rrValue, rrTarget });\n        console.log(SYSTEM.LOG.HEAD + `  New rrList (${rrList.length} entries):`, rrList);\n      }\n      \n      return updates;\n    });\n    \n    const summaryMessage = `Migration 13.0.3 completed - Migrated: ${totalMigrated}, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Show user-friendly notification\n    if (totalMigrated > 0) {\n      const userMessage = game.i18n ? \n        game.i18n.localize('SRA2.MIGRATION.13_0_3_INFO') :\n        'Migration 13.0.3: Risk Reduction data converted. Check console for details.';\n      ui.notifications?.info(userMessage, {permanent: false});\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.4: Clean up old RR fields and backups\n * This migration removes the old rrType/rrValue/rrTarget fields and their backups\n * after confirming that rrList is working properly\n */\nexport class Migration_13_0_4 extends Migration {\n  get code() { \n    return \"migration-13.0.4\"; \n  }\n\n  get version() { \n    return \"13.0.4\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.4: Cleaning up old RR fields and backups\");\n    \n    let totalCleaned = 0;\n    let totalSkipped = 0;\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      for (const item of items) {\n        // Only process feat items\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the raw source data\n        const sourceSystem = item._source?.system || item.system;\n        \n        // Check if there are any old fields or backups to clean\n        const hasOldFields = (\n          sourceSystem.rrType !== undefined ||\n          sourceSystem.rrValue !== undefined ||\n          sourceSystem.rrTarget !== undefined\n        );\n        \n        const hasBackups = (\n          sourceSystem._rrTypeBackup !== undefined ||\n          sourceSystem._rrValueBackup !== undefined ||\n          sourceSystem._rrTargetBackup !== undefined\n        );\n        \n        // Skip if nothing to clean\n        if (!hasOldFields && !hasBackups) {\n          totalSkipped++;\n          continue;\n        }\n        \n        // Check that rrList exists (safety check)\n        const hasRrList = sourceSystem.rrList !== undefined && Array.isArray(sourceSystem.rrList);\n        \n        if (!hasRrList) {\n          console.warn(SYSTEM.LOG.HEAD + `Migration 13.0.4: Skipping \"${item.name}\" - no rrList found! This item may need manual review.`);\n          totalSkipped++;\n          continue;\n        }\n        \n        console.log(SYSTEM.LOG.HEAD + `Migration 13.0.4: Cleaning up feat \"${item.name}\":`);\n        if (hasOldFields) {\n          console.log(SYSTEM.LOG.HEAD + `  Removing old fields: rrType, rrValue, rrTarget`);\n        }\n        if (hasBackups) {\n          console.log(SYSTEM.LOG.HEAD + `  Removing backups: _rrTypeBackup, _rrValueBackup, _rrTargetBackup`);\n        }\n        console.log(SYSTEM.LOG.HEAD + `  Keeping rrList with ${sourceSystem.rrList.length} entries`);\n        \n        // Create the update object to remove all old fields\n        const update = {\n          _id: item.id,\n          // Remove old fields\n          'system.rrType': null,\n          'system.rrValue': null,\n          'system.rrTarget': null,\n          // Remove backup fields\n          'system._rrTypeBackup': null,\n          'system._rrValueBackup': null,\n          'system._rrTargetBackup': null\n        };\n        \n        updates.push(update);\n        totalCleaned++;\n      }\n      \n      return updates;\n    });\n    \n    const summaryMessage = `Migration 13.0.4 completed - Cleaned: ${totalCleaned}, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Show user-friendly notification\n    if (totalCleaned > 0) {\n      const userMessage = game.i18n ? \n        game.i18n.localize('SRA2.MIGRATION.13_0_4_INFO') :\n        'Migration 13.0.4: Old RR fields cleaned up. Data migration complete.';\n      ui.notifications?.info(userMessage, {permanent: false});\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.5: Separate weapons and spells feat types\n * This migration converts \"weapons-spells\" feat type to separate \"weapon\" and \"spell\" types\n * By default, all \"weapons-spells\" are converted to \"weapon\" type\n */\nexport class Migration_13_0_5 extends Migration {\n  get code() { \n    return \"migration-13.0.5\"; \n  }\n\n  get version() { \n    return \"13.0.5\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.5: Separating weapons and spells feat types\");\n    \n    let totalConverted = 0;\n    let totalSkipped = 0;\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      for (const item of items) {\n        // Only process feat items\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the system data\n        const sourceSystem = item._source?.system || item.system;\n        \n        // Check if this is a \"weapons-spells\" feat type\n        if (sourceSystem.featType !== 'weapons-spells') {\n          totalSkipped++;\n          continue;\n        }\n        \n        console.log(SYSTEM.LOG.HEAD + `Migration 13.0.5: Converting feat \"${item.name}\" from \"weapons-spells\" to \"weapon\"`);\n        \n        // Convert to \"weapon\" type by default\n        // Users can manually change specific items to \"spell\" if needed\n        const update = {\n          _id: item.id,\n          'system.featType': 'weapon'\n        };\n        \n        updates.push(update);\n        totalConverted++;\n      }\n      \n      return updates;\n    });\n    \n    const summaryMessage = `Migration 13.0.5 completed - Converted: ${totalConverted} weapons-spells to weapon, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Show user-friendly notification\n    if (totalConverted > 0) {\n      const userMessage = game.i18n ? \n        game.i18n.localize('SRA2.MIGRATION.13_0_5_INFO') :\n        `Migration 13.0.5: Converted ${totalConverted} \"weapons-spells\" feats to \"weapon\" type. You can manually change specific items to \"spell\" type if needed.`;\n      ui.notifications?.info(userMessage, {permanent: false});\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.6: Rollback migration 13.0.5\n * This migration does NOT convert anything - keeps weapons-spells as valid type\n * Only marks that this version has been applied\n */\nexport class Migration_13_0_6 extends Migration {\n  get code() { \n    return \"migration-13.0.6\"; \n  }\n\n  get version() { \n    return \"13.0.6\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Migration 13.0.6: Rollback - keeping old weapons-spells type valid\");\n    console.log(SYSTEM.LOG.HEAD + \"No conversion needed. weapons-spells, weapon, and spell types are all valid.\");\n    \n    // This migration does nothing, just marks the version as applied\n    // Old items with \"weapons-spells\" will continue to work\n    // New items can use \"weapon\" or \"spell\" as separate types\n    \n    const message = \"Migration 13.0.6: All feat types (weapons-spells, weapon, spell) are now valid. No data conversion performed.\";\n    console.log(SYSTEM.LOG.HEAD + message);\n    \n    if (ui.notifications) {\n      ui.notifications.info(message, {permanent: false});\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.7: Convert weapons-spells to weapon (with backup)\n * This migration safely converts all \"weapons-spells\" feat types to \"weapon\"\n * Creates a backup of the old value before conversion\n */\nexport class Migration_13_0_7 extends Migration {\n  get code() { \n    return \"migration-13.0.7\"; \n  }\n\n  get version() { \n    return \"13.0.7\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.7: Converting weapons-spells to weapon (with backup)\");\n    \n    let totalConverted = 0;\n    let totalSkipped = 0;\n    let conversionDetails = [];\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      for (const item of items) {\n        // Only process feat items\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the system data\n        const sourceSystem = item._source?.system || item.system;\n        \n        // Skip if not weapons-spells type\n        if (sourceSystem.featType !== 'weapons-spells') {\n          totalSkipped++;\n          continue;\n        }\n        \n        // Log what we're converting\n        const itemInfo = {\n          name: item.name,\n          id: item.id,\n          oldType: 'weapons-spells',\n          newType: 'weapon',\n          hasWeaponFocus: sourceSystem.isWeaponFocus || false,\n          hasDamageValue: (sourceSystem.damageValue || 0) > 0,\n          hasRanges: (\n            sourceSystem.meleeRange !== 'none' ||\n            sourceSystem.shortRange !== 'none' ||\n            sourceSystem.mediumRange !== 'none' ||\n            sourceSystem.longRange !== 'none'\n          )\n        };\n        \n        console.log(SYSTEM.LOG.HEAD + `Migration 13.0.7: Converting \"${item.name}\" (ID: ${item.id})`);\n        console.log(SYSTEM.LOG.HEAD + `  - Old type: weapons-spells`);\n        console.log(SYSTEM.LOG.HEAD + `  - New type: weapon`);\n        console.log(SYSTEM.LOG.HEAD + `  - Has weapon focus: ${itemInfo.hasWeaponFocus}`);\n        console.log(SYSTEM.LOG.HEAD + `  - Has damage value: ${itemInfo.hasDamageValue}`);\n        console.log(SYSTEM.LOG.HEAD + `  - Has ranges: ${itemInfo.hasRanges}`);\n        \n        conversionDetails.push(itemInfo);\n        \n        // Create the update object\n        const update = {\n          _id: item.id,\n          // Change the type\n          'system.featType': 'weapon',\n          // Create a backup of the old type for safety\n          'system._oldFeatTypeBackup': 'weapons-spells',\n          // Add a migration timestamp\n          'system._migratedAt': new Date().toISOString(),\n          'system._migrationVersion': '13.0.7'\n        };\n        \n        updates.push(update);\n        totalConverted++;\n      }\n      \n      return updates;\n    });\n    \n    // Summary message\n    const summaryMessage = `Migration 13.0.7 completed - Converted: ${totalConverted}, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Detailed summary\n    if (conversionDetails.length > 0) {\n      console.log(SYSTEM.LOG.HEAD + \"=== CONVERSION DETAILS ===\");\n      console.log(SYSTEM.LOG.HEAD + `Total items converted: ${conversionDetails.length}`);\n      \n      const withWeaponFocus = conversionDetails.filter(d => d.hasWeaponFocus).length;\n      const withDamage = conversionDetails.filter(d => d.hasDamageValue).length;\n      const withRanges = conversionDetails.filter(d => d.hasRanges).length;\n      \n      console.log(SYSTEM.LOG.HEAD + `  - Items with weapon focus: ${withWeaponFocus}`);\n      console.log(SYSTEM.LOG.HEAD + `  - Items with damage value: ${withDamage}`);\n      console.log(SYSTEM.LOG.HEAD + `  - Items with ranges: ${withRanges}`);\n      console.log(SYSTEM.LOG.HEAD + \"=========================\");\n      \n      // List all converted items\n      console.log(SYSTEM.LOG.HEAD + \"Converted items:\");\n      conversionDetails.forEach((detail, index) => {\n        console.log(SYSTEM.LOG.HEAD + `  ${index + 1}. \"${detail.name}\" (ID: ${detail.id})`);\n      });\n    }\n    \n    // Show user-friendly notification\n    if (totalConverted > 0) {\n      const userMessage = game.i18n ? \n        game.i18n.format('SRA2.MIGRATION.13_0_7_INFO', { count: totalConverted }) :\n        `Migration 13.0.7: Converted ${totalConverted} \"weapons-spells\" items to \"weapon\" type. All data preserved with backup.`;\n      \n      ui.notifications?.info(userMessage, {permanent: false});\n      \n      console.log(SYSTEM.LOG.HEAD + \"✓ Migration complete. All items have been backed up.\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ Old type saved in system._oldFeatTypeBackup\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ No data was lost in the conversion\");\n    } else {\n      console.log(SYSTEM.LOG.HEAD + \"No items to convert - all items already migrated or are other types\");\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.8: Convert narrativeEffects from string array to object array\n * This migration safely converts all narrativeEffects from simple strings\n * to objects with { text: string, isNegative: boolean } structure\n */\nexport class Migration_13_0_8 extends Migration {\n  get code() { \n    return \"migration-13.0.8\"; \n  }\n\n  get version() { \n    return \"13.0.8\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.8: Converting narrativeEffects to new format and fixing damageValueBonus\");\n    \n    let totalConverted = 0;\n    let totalSkipped = 0;\n    let totalFixed = 0;\n    let conversionDetails = [];\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      for (const item of items) {\n        // Only process feat items\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the system data\n        const sourceSystem = item._source?.system || item.system;\n        \n        let needsUpdate = false;\n        const update = {\n          _id: item.id\n        };\n        \n        // Check and fix narrativeEffects\n        if (sourceSystem.narrativeEffects && sourceSystem.narrativeEffects.length > 0) {\n          // Check if it's already in the new format (first element is an object with 'text' property)\n          const firstEffect = sourceSystem.narrativeEffects[0];\n          if (!(typeof firstEffect === 'object' && firstEffect !== null && 'text' in firstEffect)) {\n            // Convert string array to object array\n            const convertedEffects = sourceSystem.narrativeEffects.map(effect => {\n              if (typeof effect === 'string') {\n                return {\n                  text: effect,\n                  isNegative: false\n                };\n              }\n              // If it's already an object but missing properties, normalize it\n              return {\n                text: effect?.text || effect?.toString() || \"\",\n                isNegative: effect?.isNegative || false\n              };\n            });\n            \n            update['system.narrativeEffects'] = convertedEffects;\n            update['system._migratedNarrativeEffectsAt'] = new Date().toISOString();\n            update['system._narrativeEffectsMigrationVersion'] = '13.0.8';\n            needsUpdate = true;\n            \n            // Log what we're converting\n            console.log(SYSTEM.LOG.HEAD + `Migration 13.0.8: Converting narrativeEffects for \"${item.name}\" (ID: ${item.id})`);\n            console.log(SYSTEM.LOG.HEAD + `  - Effect count: ${sourceSystem.narrativeEffects.length}`);\n            \n            conversionDetails.push({\n              name: item.name,\n              id: item.id,\n              effectCount: sourceSystem.narrativeEffects.length\n            });\n            totalConverted++;\n          }\n        }\n        \n        // Fix missing or invalid damageValueBonus values for ALL feat items\n        if (sourceSystem.damageValueBonus === null || \n            sourceSystem.damageValueBonus === undefined || \n            typeof sourceSystem.damageValueBonus !== 'number' ||\n            !Number.isInteger(sourceSystem.damageValueBonus)) {\n          update['system.damageValueBonus'] = 0;\n          needsUpdate = true;\n          totalFixed++;\n          console.log(SYSTEM.LOG.HEAD + `Migration 13.0.8: Fixing damageValueBonus for \"${item.name}\" (ID: ${item.id})`);\n        }\n        \n        if (needsUpdate) {\n          updates.push(update);\n        } else {\n          totalSkipped++;\n        }\n      }\n      \n      return updates;\n    });\n    \n    // Summary message\n    const summaryMessage = `Migration 13.0.8 completed - NarrativeEffects converted: ${totalConverted}, DamageValueBonus fixed: ${totalFixed}, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Detailed summary\n    if (conversionDetails.length > 0) {\n      console.log(SYSTEM.LOG.HEAD + \"=== CONVERSION DETAILS ===\");\n      console.log(SYSTEM.LOG.HEAD + `Total items converted: ${conversionDetails.length}`);\n      \n      const totalEffects = conversionDetails.reduce((sum, d) => sum + d.effectCount, 0);\n      \n      console.log(SYSTEM.LOG.HEAD + `  - Total narrative effects migrated: ${totalEffects}`);\n      console.log(SYSTEM.LOG.HEAD + \"=========================\");\n      \n      // List all converted items\n      console.log(SYSTEM.LOG.HEAD + \"Converted items:\");\n      conversionDetails.forEach((detail, index) => {\n        console.log(SYSTEM.LOG.HEAD + `  ${index + 1}. \"${detail.name}\" (ID: ${detail.id}) - ${detail.effectCount} effect(s)`);\n      });\n    }\n    \n    if (totalFixed > 0) {\n      console.log(SYSTEM.LOG.HEAD + `Fixed damageValueBonus on ${totalFixed} item(s)`);\n    }\n    \n    // Show user-friendly notification\n    if (totalConverted > 0 || totalFixed > 0) {\n      let userMessage = \"\";\n      if (totalConverted > 0 && totalFixed > 0) {\n        userMessage = game.i18n ? \n          game.i18n.format('SRA2.MIGRATION.13_0_8_INFO', { count: totalConverted, fixed: totalFixed }) :\n          `Migration 13.0.8: Converted narrative effects on ${totalConverted} feat(s) and fixed damageValueBonus on ${totalFixed} feat(s).`;\n      } else if (totalConverted > 0) {\n        userMessage = game.i18n ? \n          game.i18n.format('SRA2.MIGRATION.13_0_8_INFO', { count: totalConverted }) :\n          `Migration 13.0.8: Converted narrative effects on ${totalConverted} feat(s) to new format.`;\n      } else if (totalFixed > 0) {\n        userMessage = `Migration 13.0.8: Fixed damageValueBonus on ${totalFixed} feat(s).`;\n      }\n      \n      ui.notifications?.info(userMessage, {permanent: false});\n      \n      console.log(SYSTEM.LOG.HEAD + \"✓ Migration complete.\");\n      if (totalConverted > 0) {\n        console.log(SYSTEM.LOG.HEAD + \"✓ All narrative effects converted to new format.\");\n        console.log(SYSTEM.LOG.HEAD + \"✓ All effects default to positive (isNegative: false)\");\n      }\n      if (totalFixed > 0) {\n        console.log(SYSTEM.LOG.HEAD + \"✓ All damageValueBonus fields set to valid integer values.\");\n      }\n      console.log(SYSTEM.LOG.HEAD + \"✓ No data was lost in the conversion\");\n    } else {\n      console.log(SYSTEM.LOG.HEAD + \"No items to migrate - all items already up to date\");\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.9: Add value field to narrativeEffects and isFirstFeat field\n * This migration adds a 'value' field to all narrative effects\n * with a default of -1 for consistency with the new schema,\n * and adds an 'isFirstFeat' boolean field with default false\n */\nexport class Migration_13_0_9 extends Migration {\n  get code() { \n    return \"migration-13.0.9\"; \n  }\n\n  get version() { \n    return \"13.0.9\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.9: Adding value field to narrativeEffects and isFirstFeat field\");\n    \n    let totalUpdated = 0;\n    let totalSkipped = 0;\n    let totalFirstFeatAdded = 0;\n    let updateDetails = [];\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      for (const item of items) {\n        // Only process feat items\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the system data\n        const sourceSystem = item._source?.system || item.system;\n        \n        let needsUpdate = false;\n        const update = {\n          _id: item.id\n        };\n        \n        // Check if item has narrativeEffects that need updating\n        if (sourceSystem.narrativeEffects && sourceSystem.narrativeEffects.length > 0) {\n          const updatedEffects = sourceSystem.narrativeEffects.map(effect => {\n            // Check if effect already has a value field\n            if (typeof effect === 'object' && effect !== null && !('value' in effect)) {\n              needsUpdate = true;\n              return {\n                ...effect,\n                value: -1  // Default value for all effects\n              };\n            }\n            return effect;\n          });\n          \n          if (needsUpdate) {\n            update['system.narrativeEffects'] = updatedEffects;\n            update['system._migratedNarrativeEffectsValueAt'] = new Date().toISOString();\n            \n            // Log what we're converting\n            console.log(SYSTEM.LOG.HEAD + `Migration 13.0.9: Adding value field to narrativeEffects for \"${item.name}\" (ID: ${item.id})`);\n            console.log(SYSTEM.LOG.HEAD + `  - Effect count: ${updatedEffects.length}`);\n            \n            updateDetails.push({\n              name: item.name,\n              id: item.id,\n              effectCount: updatedEffects.length,\n              hasFirstFeat: false\n            });\n          }\n        }\n        \n        // Check if item needs isFirstFeat field (add to all feats that don't have it)\n        if (sourceSystem.isFirstFeat === undefined || sourceSystem.isFirstFeat === null) {\n          update['system.isFirstFeat'] = false;\n          needsUpdate = true;\n          totalFirstFeatAdded++;\n          \n          console.log(SYSTEM.LOG.HEAD + `Migration 13.0.9: Adding isFirstFeat field to \"${item.name}\" (ID: ${item.id})`);\n          \n          // Update details if not already added\n          const existingDetail = updateDetails.find(d => d.id === item.id);\n          if (existingDetail) {\n            existingDetail.hasFirstFeat = true;\n          } else {\n            updateDetails.push({\n              name: item.name,\n              id: item.id,\n              effectCount: 0,\n              hasFirstFeat: true\n            });\n          }\n        }\n        \n        if (needsUpdate) {\n          update['system._narrativeEffectsValueMigrationVersion'] = '13.0.9';\n          updates.push(update);\n          totalUpdated++;\n        } else {\n          totalSkipped++;\n        }\n      }\n      \n      return updates;\n    });\n    \n    // Summary message\n    const summaryMessage = `Migration 13.0.9 completed - Items updated: ${totalUpdated}, isFirstFeat added: ${totalFirstFeatAdded}, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Detailed summary\n    if (updateDetails.length > 0) {\n      console.log(SYSTEM.LOG.HEAD + \"=== UPDATE DETAILS ===\");\n      console.log(SYSTEM.LOG.HEAD + `Total items updated: ${updateDetails.length}`);\n      \n      const totalEffects = updateDetails.reduce((sum, d) => sum + d.effectCount, 0);\n      const totalWithFirstFeat = updateDetails.filter(d => d.hasFirstFeat).length;\n      \n      console.log(SYSTEM.LOG.HEAD + `  - Total narrative effects updated: ${totalEffects}`);\n      console.log(SYSTEM.LOG.HEAD + `  - Total items with isFirstFeat added: ${totalWithFirstFeat}`);\n      console.log(SYSTEM.LOG.HEAD + \"======================\");\n      \n      // List all updated items\n      console.log(SYSTEM.LOG.HEAD + \"Updated items:\");\n      updateDetails.forEach((detail, index) => {\n        const updates = [];\n        if (detail.effectCount > 0) updates.push(`${detail.effectCount} effect(s)`);\n        if (detail.hasFirstFeat) updates.push('isFirstFeat added');\n        console.log(SYSTEM.LOG.HEAD + `  ${index + 1}. \"${detail.name}\" (ID: ${detail.id}) - ${updates.join(', ')}`);\n      });\n    }\n    \n    // Show user-friendly notification\n    if (totalUpdated > 0) {\n      const userMessage = game.i18n ? \n        game.i18n.format('SRA2.MIGRATION.13_0_9_INFO', { count: totalUpdated, firstFeatCount: totalFirstFeatAdded }) :\n        `Migration 13.0.9: Updated ${totalUpdated} feat(s) - added value field to narrative effects and isFirstFeat field to ${totalFirstFeatAdded} feat(s).`;\n      \n      ui.notifications?.info(userMessage, {permanent: false});\n      \n      console.log(SYSTEM.LOG.HEAD + \"✓ Migration complete.\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ All narrative effects now have a value field (default: -1)\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ All feats now have isFirstFeat field (default: false)\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ No data was lost in the migration\");\n    } else {\n      console.log(SYSTEM.LOG.HEAD + \"No items to migrate - all items already up to date\");\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.10: Update cost field values\n * This migration updates the cost field to use the new simplified system:\n * - 'specialized-equipment' -> 'advanced-equipment'\n * - 'feat' -> removed (defaults to 0 cost for non-equipment items)\n * - Cost field only applies to equipment and weapon types\n */\nexport class Migration_13_0_10 extends Migration {\n  get code() { \n    return \"migration-13.0.10\"; \n  }\n\n  get version() { \n    return \"13.0.10\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.10: Updating cost field values\");\n    \n    let totalUpdated = 0;\n    let totalSkipped = 0;\n    let updateDetails = [];\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      // Log all feat items for debugging\n      const featItems = items.filter(item => item.type === 'feat');\n      console.log(SYSTEM.LOG.HEAD + `Found ${featItems.length} feat items to check`);\n      \n      for (const item of items) {\n        // Only process feat items\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the system data\n        const sourceSystem = item._source?.system || item.system;\n        \n        // Skip if already migrated\n        if (sourceSystem._costMigrationVersion === '13.0.10') {\n          totalSkipped++;\n          continue;\n        }\n        \n        let needsUpdate = false;\n        const update = {\n          _id: item.id\n        };\n        \n        const currentCost = sourceSystem.cost || 'free-equipment';\n        const featType = sourceSystem.featType || 'equipment';\n        let newCost = currentCost;\n        let reason = '';\n        \n        // Log current state for debugging\n        console.log(SYSTEM.LOG.HEAD + `Checking \"${item.name}\" - cost: \"${currentCost}\", type: \"${featType}\"`);\n        \n        // Convert specialized-equipment to advanced-equipment\n        if (currentCost === 'specialized-equipment') {\n          newCost = 'advanced-equipment';\n          needsUpdate = true;\n          reason = 'specialized-equipment → advanced-equipment';\n        }\n        // Convert old 'feat' cost type to appropriate value\n        else if (currentCost === 'feat') {\n          // For equipment and weapons, set to free-equipment (0 cost)\n          // For other types, the cost doesn't apply anyway but we set it to free-equipment for consistency\n          newCost = 'free-equipment';\n          needsUpdate = true;\n          reason = 'feat → free-equipment (cost = 0 for non-equipment types)';\n        }\n        // Ensure all items have a valid cost value\n        else if (!currentCost || !['free-equipment', 'equipment', 'advanced-equipment'].includes(currentCost)) {\n          newCost = 'free-equipment';\n          needsUpdate = true;\n          reason = `invalid or missing cost (${currentCost}) → free-equipment`;\n        }\n        \n        if (needsUpdate) {\n          update['system.cost'] = newCost;\n          update['system._costMigrationVersion'] = '13.0.10';\n          \n          console.log(SYSTEM.LOG.HEAD + `Migration 13.0.10: Updating cost for \"${item.name}\" (ID: ${item.id})`);\n          console.log(SYSTEM.LOG.HEAD + `  - Type: ${featType}`);\n          console.log(SYSTEM.LOG.HEAD + `  - Old cost: ${currentCost}`);\n          console.log(SYSTEM.LOG.HEAD + `  - New cost: ${newCost}`);\n          console.log(SYSTEM.LOG.HEAD + `  - Reason: ${reason}`);\n          \n          updateDetails.push({\n            name: item.name,\n            id: item.id,\n            featType: featType,\n            oldCost: currentCost,\n            newCost: newCost,\n            reason: reason\n          });\n          \n          updates.push(update);\n          totalUpdated++;\n        }\n      }\n      \n      return updates;\n    });\n    \n    // Summary message\n    const summaryMessage = `Migration 13.0.10 completed - Items updated: ${totalUpdated}, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Detailed summary\n    if (updateDetails.length > 0) {\n      console.log(SYSTEM.LOG.HEAD + \"=== UPDATE DETAILS ===\");\n      console.log(SYSTEM.LOG.HEAD + `Total items updated: ${updateDetails.length}`);\n      \n      const specializedToAdvanced = updateDetails.filter(d => d.oldCost === 'specialized-equipment').length;\n      const featToFree = updateDetails.filter(d => d.oldCost === 'feat').length;\n      \n      console.log(SYSTEM.LOG.HEAD + `  - specialized-equipment → advanced-equipment: ${specializedToAdvanced}`);\n      console.log(SYSTEM.LOG.HEAD + `  - feat → free-equipment: ${featToFree}`);\n      console.log(SYSTEM.LOG.HEAD + \"======================\");\n      \n      // List all updated items\n      console.log(SYSTEM.LOG.HEAD + \"Updated items:\");\n      updateDetails.forEach((detail, index) => {\n        console.log(SYSTEM.LOG.HEAD + `  ${index + 1}. \"${detail.name}\" (${detail.featType}): ${detail.oldCost} → ${detail.newCost}`);\n      });\n    }\n    \n    // Show user-friendly notification\n    if (totalUpdated > 0) {\n      const userMessage = game.i18n ? \n        game.i18n.format('SRA2.MIGRATION.13_0_10_INFO', { \n          count: totalUpdated,\n          specializedCount: updateDetails.filter(d => d.oldCost === 'specialized-equipment').length,\n          featCount: updateDetails.filter(d => d.oldCost === 'feat').length\n        }) :\n        `Migration 13.0.10: Updated ${totalUpdated} feat(s) cost values.`;\n      \n      ui.notifications?.info(userMessage, {permanent: false});\n      \n      console.log(SYSTEM.LOG.HEAD + \"✓ Migration complete.\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ Cost system simplified: free (0¥), equipment (2500¥), advanced (5000¥)\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ Cost now only applies to equipment and weapon types\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ No data was lost in the migration\");\n    } else {\n      console.log(SYSTEM.LOG.HEAD + \"No items to migrate - all items already up to date\");\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.11: Add linked specializations fields to weapons\n * This migration adds the new linkedAttackSpecialization and linkedDefenseSpecialization fields\n * to all weapon and weapons-spells type feats\n */\nexport class Migration_13_0_11 extends Migration {\n  get code() { \n    return \"migration-13.0.11\"; \n  }\n\n  get version() { \n    return \"13.0.11\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.11: Adding linked specializations fields to weapons\");\n    \n    let totalUpdated = 0;\n    let totalSkipped = 0;\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      for (const item of items) {\n        // Only process feat items of type weapon or weapons-spells\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the system data\n        const sourceSystem = item._source?.system || item.system;\n        const featType = sourceSystem.featType || 'equipment';\n        \n        // Only process weapon and weapons-spells types\n        if (featType !== 'weapon' && featType !== 'weapons-spells') {\n          continue;\n        }\n        \n        // Skip if already migrated\n        if (sourceSystem._specializationLinkMigrationVersion === '13.0.11') {\n          totalSkipped++;\n          continue;\n        }\n        \n        // Check if the fields already exist\n        const hasAttackSpec = sourceSystem.hasOwnProperty('linkedAttackSpecialization');\n        const hasDefenseSpec = sourceSystem.hasOwnProperty('linkedDefenseSpecialization');\n        \n        if (hasAttackSpec && hasDefenseSpec) {\n          // Fields already exist, just mark as migrated\n          const update = {\n            _id: item.id,\n            'system._specializationLinkMigrationVersion': '13.0.11'\n          };\n          updates.push(update);\n          totalSkipped++;\n          continue;\n        }\n        \n        // Add the new fields\n        const update = {\n          _id: item.id,\n          'system.linkedAttackSpecialization': sourceSystem.linkedAttackSpecialization || '',\n          'system.linkedDefenseSpecialization': sourceSystem.linkedDefenseSpecialization || '',\n          'system._specializationLinkMigrationVersion': '13.0.11'\n        };\n        \n        console.log(SYSTEM.LOG.HEAD + `Migration 13.0.11: Adding specialization link fields to weapon \"${item.name}\" (ID: ${item.id})`);\n        \n        updates.push(update);\n        totalUpdated++;\n      }\n      \n      return updates;\n    });\n    \n    // Summary message\n    const summaryMessage = `Migration 13.0.11 completed - Weapons updated: ${totalUpdated}, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Show user-friendly notification\n    if (totalUpdated > 0) {\n      const userMessage = game.i18n ? \n        game.i18n.format('SRA2.MIGRATION.13_0_11_INFO', { count: totalUpdated }) :\n        `Migration 13.0.11: Added specialization link fields to ${totalUpdated} weapon(s).`;\n      \n      ui.notifications?.info(userMessage, {permanent: false});\n      \n      console.log(SYSTEM.LOG.HEAD + \"✓ Migration complete.\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ Weapons can now be linked to attack and defense specializations\");\n    } else {\n      console.log(SYSTEM.LOG.HEAD + \"No items to migrate - all items already up to date\");\n    }\n  }\n}\n\n","import { Migration } from \"./migration.mjs\";\n\n/**\n * Migration 13.0.12: Convert \"dice\" to \"disadvantage\" in weapon ranges\n * This migration updates all weapon/spell range values from \"dice\" to \"disadvantage\"\n * for meleeRange, shortRange, mediumRange, and longRange fields\n */\nexport class Migration_13_0_12 extends Migration {\n  get code() { \n    return \"migration-13.0.12\"; \n  }\n\n  get version() { \n    return \"13.0.12\"; \n  }\n\n  async migrate() {\n    console.log(SYSTEM.LOG.HEAD + \"Starting migration 13.0.12: Converting 'dice' to 'disadvantage' in weapon ranges\");\n    \n    let totalUpdated = 0;\n    let totalSkipped = 0;\n    \n    await this.applyItemsUpdates((items) => {\n      const updates = [];\n      \n      for (const item of items) {\n        // Only process feat items\n        if (item.type !== 'feat') {\n          continue;\n        }\n        \n        // Access the system data\n        const sourceSystem = item._source?.system || item.system;\n        \n        // Skip if already migrated\n        if (sourceSystem._rangeDiceToDisadvantageMigrationVersion === '13.0.12') {\n          totalSkipped++;\n          continue;\n        }\n        \n        // Check if any range has \"dice\" value\n        const hasDiceValue = \n          sourceSystem.meleeRange === 'dice' ||\n          sourceSystem.shortRange === 'dice' ||\n          sourceSystem.mediumRange === 'dice' ||\n          sourceSystem.longRange === 'dice';\n        \n        if (!hasDiceValue) {\n          // No \"dice\" values found, skip (don't mark as migrated to allow re-running)\n          totalSkipped++;\n          continue;\n        }\n        \n        // Build update object with converted values\n        const update = {\n          _id: item.id,\n          'system._rangeDiceToDisadvantageMigrationVersion': '13.0.12'\n        };\n        \n        if (sourceSystem.meleeRange === 'dice') {\n          update['system.meleeRange'] = 'disadvantage';\n        }\n        if (sourceSystem.shortRange === 'dice') {\n          update['system.shortRange'] = 'disadvantage';\n        }\n        if (sourceSystem.mediumRange === 'dice') {\n          update['system.mediumRange'] = 'disadvantage';\n        }\n        if (sourceSystem.longRange === 'dice') {\n          update['system.longRange'] = 'disadvantage';\n        }\n        \n        console.log(SYSTEM.LOG.HEAD + `Migration 13.0.12: Converting ranges for \"${item.name}\" (ID: ${item.id})`);\n        \n        updates.push(update);\n        totalUpdated++;\n      }\n      \n      return updates;\n    });\n    \n    // Summary message\n    const summaryMessage = `Migration 13.0.12 completed - Items updated: ${totalUpdated}, Skipped: ${totalSkipped}`;\n    console.log(SYSTEM.LOG.HEAD + summaryMessage);\n    \n    // Show user-friendly notification\n    if (totalUpdated > 0) {\n      const userMessage = game.i18n ? \n        game.i18n.format('SRA2.MIGRATION.13_0_12_INFO', { count: totalUpdated }) :\n        `Migration 13.0.12: Converted weapon ranges from \"dice\" to \"disadvantage\" for ${totalUpdated} item(s).`;\n      \n      ui.notifications?.info(userMessage, {permanent: false});\n      \n      console.log(SYSTEM.LOG.HEAD + \"✓ Migration complete.\");\n      console.log(SYSTEM.LOG.HEAD + \"✓ All weapon ranges now use 'disadvantage' instead of 'dice'\");\n    } else {\n      console.log(SYSTEM.LOG.HEAD + \"No items to migrate - all items already up to date\");\n    }\n  }\n}\n\n","import { SYSTEM } from \"./config/system.ts\";\n\n// Expose the SYSTEM object to the global scope\nglobalThis.SYSTEM = SYSTEM;\n\nimport * as models from \"./models/_module.ts\";\nimport * as documents from \"./documents/_module.ts\";\nimport * as applications from \"./applications/_module.ts\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migrations } from \"./migration/migration.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_3 } from \"./migration/migration-13.0.3.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_4 } from \"./migration/migration-13.0.4.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_5 } from \"./migration/migration-13.0.5.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_6 } from \"./migration/migration-13.0.6.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_7 } from \"./migration/migration-13.0.7.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_8 } from \"./migration/migration-13.0.8.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_9 } from \"./migration/migration-13.0.9.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_10 } from \"./migration/migration-13.0.10.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_11 } from \"./migration/migration-13.0.11.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { Migration_13_0_12 } from \"./migration/migration-13.0.12.mjs\";\n// @ts-ignore - JavaScript module without type declarations\nimport { HOOKS } from \"./hooks.mjs\";\n\nexport class SRA2System {\n  static start(): void {\n    new SRA2System();\n  }\n\n  constructor() {\n    if (game.system) {\n      game.system.sra2 = this;\n    }\n    Hooks.once('init', () => this.onInit());\n  }\n  \n  onInit(): void {\n    console.log(SYSTEM.LOG.HEAD + 'SRA2System.onInit');\n    if (game.system) {\n      game.system.api = {\n        applications,\n        models,\n        documents,\n      };\n    }\n    \n    // Register migrations\n    new Migrations();\n    Hooks.on(HOOKS.MIGRATIONS, (declareMigration: any) => {\n      declareMigration(new Migration_13_0_3());\n      declareMigration(new Migration_13_0_4());\n      declareMigration(new Migration_13_0_5());\n      declareMigration(new Migration_13_0_6());\n      declareMigration(new Migration_13_0_7());\n      declareMigration(new Migration_13_0_8());\n      declareMigration(new Migration_13_0_9());\n      declareMigration(new Migration_13_0_10());\n      declareMigration(new Migration_13_0_11());\n      declareMigration(new Migration_13_0_12());\n    });\n    \n    // Register custom Actor document class\n    CONFIG.Actor.documentClass = documents.SRA2Actor;\n    \n    // Register Actor data models\n    CONFIG.Actor.dataModels = {\n      character: models.CharacterDataModel,\n    };\n    \n    // Register Item data models\n    CONFIG.Item.dataModels = {\n      skill: models.SkillDataModel,\n      feat: models.FeatDataModel,\n      specialization: models.SpecializationDataModel,\n      metatype: models.MetatypeDataModel,\n    };\n    \n    // Register character sheet (PC view - default)\n    DocumentSheetConfig.registerSheet(Actor, \"sra2\", applications.CharacterSheet, {\n      types: [\"character\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.CHARACTER\"\n    });\n    \n    // Register NPC sheet (simplified view for same character type)\n    DocumentSheetConfig.registerSheet(Actor, \"sra2\", applications.NpcSheet, {\n      types: [\"character\"],\n      makeDefault: false,\n      label: \"SRA2.SHEET.NPC\"\n    });\n    \n    // Register feat sheet\n    DocumentSheetConfig.registerSheet(Item, \"sra2\", applications.FeatSheet, {\n      types: [\"feat\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.FEAT\"\n    });\n    \n    // Register skill sheet\n    DocumentSheetConfig.registerSheet(Item, \"sra2\", applications.SkillSheet, {\n      types: [\"skill\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.SKILL\"\n    });\n    \n    // Register specialization sheet\n    DocumentSheetConfig.registerSheet(Item, \"sra2\", applications.SpecializationSheet, {\n      types: [\"specialization\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.SPECIALIZATION\"\n    });\n    \n    // Register metatype sheet\n    DocumentSheetConfig.registerSheet(Item, \"sra2\", applications.MetatypeSheet, {\n      types: [\"metatype\"],\n      makeDefault: true,\n      label: \"SRA2.SHEET.METATYPE\"\n    });\n    \n    // Register Handlebars helpers\n    Handlebars.registerHelper('add', function(a: number, b: number) {\n      return a + b;\n    });\n    \n    Handlebars.registerHelper('eq', function(a: any, b: any) {\n      return a === b;\n    });\n    \n    Handlebars.registerHelper('gt', function(a: any, b: any) {\n      return a > b;\n    });\n    \n    Handlebars.registerHelper('gte', function(a: any, b: any) {\n      return a >= b;\n    });\n    \n    Handlebars.registerHelper('concat', function(...args: any[]) {\n      // Remove the last argument which is the Handlebars options object\n      const values = args.slice(0, -1);\n      return values.join('');\n    });\n    \n    Handlebars.registerHelper('uppercase', function(str: string) {\n      return str ? str.toUpperCase() : '';\n    });\n    \n    // Register chat message hook for apply damage buttons\n    Hooks.on('renderChatMessage', (message: any, html: any) => {\n      html.find('.apply-damage-btn').on('click', async (event: any) => {\n        event.preventDefault();\n        const button = $(event.currentTarget);\n        const defenderUuid = button.data('defender-uuid');\n        const damage = parseInt(button.data('damage'));\n        const defenderName = button.data('defender-name');\n        \n        await applications.CharacterSheet.applyDamage(defenderUuid, damage, defenderName);\n      });\n    });\n    \n    // Register token context menu hook for bookmarks/favorites\n    Hooks.on('getTokenHUDOptions', (hud: any, buttons: any[], token: any) => {\n      const actor = token.actor;\n      if (!actor) return;\n      \n      // Get bookmarked items\n      const bookmarkedItems = actor.items.filter((i: any) => \n        (i.type === 'skill' || i.type === 'feat') && i.system.bookmarked\n      );\n      \n      if (bookmarkedItems.length > 0) {\n        buttons.unshift({\n          name: 'SRA2_BOOKMARKS',\n          title: game.i18n!.localize('SRA2.BOOKMARKS.TITLE'),\n          icon: 'fa-solid fa-star',\n          button: true,\n          onclick: () => {\n            // Show bookmarks dialog\n            this.showBookmarksDialog(actor);\n          }\n        });\n      }\n    });\n    \n    Hooks.once(\"ready\", () => this.onReady());\n  }\n  \n  /**\n   * Show bookmarks/favorites dialog for quick actions\n   */\n  showBookmarksDialog(actor: any): void {\n    const bookmarkedSkills = actor.items.filter((i: any) => i.type === 'skill' && i.system.bookmarked);\n    const bookmarkedFeats = actor.items.filter((i: any) => i.type === 'feat' && i.system.bookmarked);\n    \n    let content = '<div class=\"sra2-bookmark-menu\">';\n    \n    if (bookmarkedSkills.length > 0) {\n      content += '<h3>' + game.i18n!.localize('SRA2.SKILLS.LABEL') + '</h3>';\n      content += '<div class=\"bookmark-list\">';\n      bookmarkedSkills.forEach((skill: any) => {\n        content += `<button class=\"bookmark-item\" data-item-id=\"${skill.id}\" data-item-type=\"skill\">\n          <i class=\"fas fa-dice-d6\"></i> ${skill.name}\n        </button>`;\n      });\n      content += '</div>';\n    }\n    \n    if (bookmarkedFeats.length > 0) {\n      content += '<h3>' + game.i18n!.localize('SRA2.FEATS.LABEL') + '</h3>';\n      content += '<div class=\"bookmark-list\">';\n      bookmarkedFeats.forEach((feat: any) => {\n        content += `<button class=\"bookmark-item\" data-item-id=\"${feat.id}\" data-item-type=\"feat\">\n          <i class=\"fas fa-scroll\"></i> ${feat.name}\n        </button>`;\n      });\n      content += '</div>';\n    }\n    \n    content += '</div>';\n    \n    new Dialog({\n      title: game.i18n!.localize('SRA2.BOOKMARKS.TITLE') + ' - ' + actor.name,\n      content,\n      buttons: {\n        close: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: game.i18n!.localize('Close')\n        }\n      },\n      render: (html: any) => {\n        html.find('.bookmark-item').on('click', async (event: any) => {\n          const itemId = $(event.currentTarget).data('item-id');\n          const item = actor.items.get(itemId);\n          if (!item) return;\n          \n          // Open item sheet\n          item.sheet?.render(true);\n        });\n      }\n    }, { width: 350 }).render(true);\n  }\n\n  async onReady(): Promise<void> {\n    console.log(SYSTEM.LOG.HEAD + 'SRA2System.onReady');\n    \n    // Run migrations\n    const migrations = new Migrations();\n    migrations.migrate();\n    \n    // Migrate old feat data to new array format (deprecated, keeping for older versions)\n    await this.migrateFeatsToArrayFormat();\n    \n    // Migrate anarchyNimbus to anarchySpent\n    await this.migrateAnarchyNimbusToSpent();\n  }\n  \n  /**\n   * Migrate old feat data (single rrType/rrValue/rrTarget) to new array format\n   */\n  async migrateFeatsToArrayFormat(): Promise<void> {\n    const featsToUpdate: any[] = [];\n    \n    // Check all feats in the world\n    for (const item of game.items! as any) {\n      if ((item as any).type === 'feat') {\n        const system = (item as any).system as any;\n        let needsUpdate = false;\n        const updates: any = { _id: (item as any).id };\n        \n        // Check if rrType is not an array (old format)\n        if (system.rrType !== undefined && !Array.isArray(system.rrType)) {\n          needsUpdate = true;\n          // Convert single value to array (only if not \"none\")\n          if (system.rrType !== 'none') {\n            updates['system.rrType'] = [system.rrType];\n            updates['system.rrValue'] = [system.rrValue || 0];\n            updates['system.rrTarget'] = [system.rrTarget || ''];\n          } else {\n            updates['system.rrType'] = [];\n            updates['system.rrValue'] = [];\n            updates['system.rrTarget'] = [];\n          }\n        }\n        \n        if (needsUpdate) {\n          featsToUpdate.push(updates);\n        }\n      }\n    }\n    \n    // Check all feats on actors\n    for (const actor of game.actors! as any) {\n      const actorUpdates: any[] = [];\n      \n      for (const item of (actor as any).items) {\n        if ((item as any).type === 'feat') {\n          const system = (item as any).system as any;\n          let needsUpdate = false;\n          const updates: any = { _id: (item as any).id };\n          \n          // Check if rrType is not an array (old format)\n          if (system.rrType !== undefined && !Array.isArray(system.rrType)) {\n            needsUpdate = true;\n            // Convert single value to array (only if not \"none\")\n            if (system.rrType !== 'none') {\n              updates['system.rrType'] = [system.rrType];\n              updates['system.rrValue'] = [system.rrValue || 0];\n              updates['system.rrTarget'] = [system.rrTarget || ''];\n            } else {\n              updates['system.rrType'] = [];\n              updates['system.rrValue'] = [];\n              updates['system.rrTarget'] = [];\n            }\n          }\n          \n          if (needsUpdate) {\n            actorUpdates.push(updates);\n          }\n        }\n      }\n      \n      if (actorUpdates.length > 0) {\n        console.log(`${SYSTEM.LOG.HEAD} Migrating ${actorUpdates.length} feats on actor ${(actor as any).name}`);\n        await (actor as any).updateEmbeddedDocuments('Item', actorUpdates);\n      }\n    }\n    \n    if (featsToUpdate.length > 0) {\n      console.log(`${SYSTEM.LOG.HEAD} Migrating ${featsToUpdate.length} world feats`);\n      await Item.updateDocuments(featsToUpdate);\n    }\n    \n    if (featsToUpdate.length > 0 || (game.actors! as any).some((a: any) => a.items.some((i: any) => i.type === 'feat'))) {\n      console.log(`${SYSTEM.LOG.HEAD} Feat migration to array format complete`);\n    }\n  }\n  \n  /**\n   * Migrate anarchyNimbus to anarchySpent\n   */\n  async migrateAnarchyNimbusToSpent(): Promise<void> {\n    const actorsToUpdate: any[] = [];\n    \n    // Check all character actors in the world\n    for (const actor of game.actors! as any) {\n      if ((actor as any).type === 'character') {\n        const system = (actor as any).system as any;\n        \n        // Check if the old anarchyNimbus field exists\n        if (system.anarchyNimbus !== undefined && system.anarchySpent === undefined) {\n          actorsToUpdate.push({\n            _id: (actor as any).id,\n            'system.anarchySpent': system.anarchyNimbus\n          });\n        }\n      }\n    }\n    \n    if (actorsToUpdate.length > 0) {\n      console.log(`${SYSTEM.LOG.HEAD} Migrating anarchyNimbus to anarchySpent for ${actorsToUpdate.length} actors`);\n      await Actor.updateDocuments(actorsToUpdate);\n      console.log(`${SYSTEM.LOG.HEAD} anarchyNimbus to anarchySpent migration complete`);\n    }\n  }\n}\n\n","import { SRA2System } from \"./module/sra2-system.ts\";\n\nSRA2System.start();\n\nimport \"./styles/global.scss\";\n\n"],"names":["SYSTEM","documents","SheetHelpers.enrichFeats","SheetHelpers.calculateFinalDamageValue","SheetHelpers.organizeSpecializationsBySkill","SheetHelpers.handleSheetUpdate","SheetHelpers.handleEditItem","SheetHelpers.handleDeleteItem","SheetHelpers.getRRSources","SheetHelpers.calculateRR","DiceRoller.handleRollRequest","SheetHelpers.handleItemDrop","ItemSearch.normalizeSearchText","ItemSearch.itemExistsOnActor","ItemSearch.searchItemsEverywhere","activeFeats","i","message","update","documents.SRA2Actor","models.CharacterDataModel","models.SkillDataModel","models.FeatDataModel","models.SpecializationDataModel","models.MetatypeDataModel","applications.CharacterSheet","applications.NpcSheet","applications.FeatSheet","applications.SkillSheet","applications.SpecializationSheet","applications.MetatypeSheet"],"mappings":"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"}